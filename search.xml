<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Knife4j接口文档快速上手</title>
      <link href="/2024/06/22/tools-knife4j%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/06/22/tools-knife4j%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Swagger2配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--接口文档knife4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi2-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.academiclink.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: Swagger2配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Swagger2Config</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">.host(<span class="string">&quot;http://localhost:8080&quot;</span>)</span><br><span class="line">.apiInfo(apiInfo())</span><br><span class="line">.select()</span><br><span class="line">.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.academiclink.controller&quot;</span>))</span><br><span class="line">.paths(PathSelectors.any())</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">.title(<span class="string">&quot;AcademicLink&quot;</span>)</span><br><span class="line">.description(<span class="string">&quot;AcademicLink接口文档&quot;</span>)</span><br><span class="line">.contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;AcademicLink&quot;</span>,<span class="string">&quot;http://localhost:8080/doc.html&quot;</span>,<span class="string">&quot;&quot;</span>))</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在 SpringBoot 项目启动后，访问 <code>http://localhost:8080/doc.html</code> 地址即可查看生成的Knife4j接口文档。</p><h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><ol><li><code>@ApiOperation</code></li></ol><ul><li>用途：用于描述一个API的操作信息，如简要说明、操作类型等。</li><li>示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;获取用户列表&quot;, notes = &quot;返回所有用户的列表信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol><li><code>@ApiImplicitParams</code></li></ol><ul><li>用途：用于描述接口中非路径参数的请求参数信息，常与@ApiImplicitParam一起使用。</li><li>示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;创建用户&quot;)</span></span><br><span class="line"><span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">        @ApiImplicitParam(name = &quot;username&quot;, value = &quot;用户名&quot;, required = true, dataType = &quot;String&quot;, paramType = &quot;query&quot;),</span></span><br><span class="line"><span class="meta">        @ApiImplicitParam(name = &quot;email&quot;, value = &quot;邮箱地址&quot;, required = false, dataType = &quot;String&quot;, paramType = &quot;query&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestParam</span> String username, <span class="meta">@RequestParam</span> String email)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol><li><code>@ApiResponses</code></li></ol><ul><li>用途：用于描述API响应的信息，包括HTTP状态码和响应消息体等，常与@ApiResponse一起使用。</li><li>示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;删除用户&quot;)</span></span><br><span class="line"><span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 200, message = &quot;删除成功&quot;),</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 404, message = &quot;用户未找到&quot;),</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 500, message = &quot;服务器内部错误&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol><li><code>@ApiModel 和 @ApiModelProperty</code></li></ol><ul><li>用途：用于定义和描述API模型（通常是请求体或响应体中的对象模型）的结构和属性。</li><li>示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户名&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol><li><code>@ApiParam</code></li></ol><ul><li>用途：用于描述方法参数，通常用于方法参数级别的注解，可以指定参数的名称、是否必填、描述等。</li><li>示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/users/search&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;搜索用户&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(<span class="meta">@ApiParam(value = &quot;用户名或邮箱关键字&quot;, required = true)</span> String keyword)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql连接问题 | Could not get JDBC Connection |Access denied for user</title>
      <link href="/2024/06/17/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-mysql%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98/"/>
      <url>/2024/06/17/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-mysql%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="Could-not-get-JDBC-Connection"><a href="#Could-not-get-JDBC-Connection" class="headerlink" title="Could not get JDBC Connection"></a><strong>Could not get JDBC Connection</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.jdbc.CannotGetJdbcConnectionException:</span><br><span class="line">Could not get JDBC Connection; nested exception is org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (Could not create connection to database server.)</span><br><span class="line">The error may exist in mappers/AdminDao.xml</span><br><span class="line">The error may involve dao.admin.AdminDao.login</span><br><span class="line">The error occurred while executing a query……</span><br></pre></td></tr></table></figure><ol><li>检查配置文件配置信息（一般没问题，网上很多配置）</li><li>检查驱动版本和mysql版本是否对应，更换项目依赖</li></ol><h3 id="Access-denied-for-user"><a href="#Access-denied-for-user" class="headerlink" title="Access denied for user"></a><strong>Access denied for user</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2024-03-06 20:47:16.007 ERROR 47260 --- [nio-8181-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)</span><br><span class="line">### The error may exist in file [D:\Java_code\CourseHelper\coursehelper_springboot\target\classes\com\rexlee\coursehelper_springboot\mapper\xml\CommentsMapper.xml]</span><br><span class="line">### The error may involve com.rexlee.coursehelper_springboot.mapper.CommentsMapper.selectAllCourse</span><br><span class="line">### The error occurred while executing a query</span><br><span class="line">### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)] with root cause</span><br><span class="line"></span><br><span class="line">java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)</span><br><span class="line">at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:957) ~[mysql-connector-java-5.1.38.jar:5.1.38]......</span><br></pre></td></tr></table></figure><ol><li><p>程序中数据库用户名和密码与数据库不一致；</p></li><li><p>数据库权限不够；</p><p>权限不足解决方案：</p><p>grant语句正确的修改数据库对应的权限：</p><p>为root用户下的safemanage数据库中所有表赋予全部权限：</p><p><code>GRANT ALL PRIVILEGES ON safemanage.* TO root@&#39;127.0.0.1&#39; IDENTIFIED BY &#39;root&#39;;</code><br>为root用户下的safemanage数据库中user表赋予全部权限：</p><p><code>GRANT ALL PRIVILEGES ON safemanage.user TO root@&#39;127.0.0.1&#39; IDENTIFIED BY &#39;root&#39;;</code></p><p>刷新权限<br><code>FLUSH PRIVILEGES;</code><br><a href="https://blog.csdn.net/CaiWangCoder/article/details/134822292?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-5-134822292-blog-127862505.235^v43^pc_blog_bottom_relevance_base4&amp;spm=1001.2101.3001.4242.4&amp;utm_relevant_index=8">参考链接</a></p><p>宝塔面板可在phpAdmin-用户中编辑用户权限</p><p><strong>记得重启mysql服务</strong></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot项目打包部署后访问不到resources下的文件</title>
      <link href="/2024/06/17/%E6%8E%92%E9%94%99%E6%97%A5%E8%AE%B0-%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/"/>
      <url>/2024/06/17/%E6%8E%92%E9%94%99%E6%97%A5%E8%AE%B0-%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在项目中需要从resources中读取文件，本地中运行没问题，但打jar包部署到云服务器上运行的时候，却报了以下错误，如下图：<br><img src="https://s3.bmp.ovh/imgs/2024/06/17/d5494fc20ed0c1a5.png" alt=""></p><p><strong>错误代码如下</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWordAllow</span> <span class="keyword">implements</span> <span class="title class_">IWordAllow</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Resource</span> <span class="variable">myAllowWords</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;myNotSensitiveWords.txt&quot;</span>);</span><br><span class="line">            <span class="type">Path</span> <span class="variable">myAllowWordsPath</span> <span class="operator">=</span> Paths.get(myAllowWords.getFile().getPath());</span><br><span class="line">            list = Files.readAllLines(myAllowWordsPath, StandardCharsets.UTF_8);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ioException) &#123;</span><br><span class="line">            ioException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>开发者在Spring Boot项目中常常需要读取位于resources目录下的文件。在IDE中，这些文件位于文件系统上的明确路径，因此使用如FileUtils.readLines或Resource.getFile()等方法可以轻松读取这些文件。</p><p>然而，当应用被打包成JAR文件后，情况就截然不同了。JAR文件实质上是一个压缩包，其中的资源文件被封装在内部，并不直接位于文件系统上。因此，尝试使用文件系统路径去访问这些资源，就会导致FileNotFoundException。</p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p><strong>使用InputStream读取资源</strong><br>当处理打包进JAR文件的资源时，最佳实践是将资源文件作为一个InputStream来读取。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWordAllow</span> <span class="keyword">implements</span> <span class="title class_">IWordAllow</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getResourceAsStream(<span class="string">&quot;/myNotSensitiveWords.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8))) &#123;</span><br><span class="line">                    String line;</span><br><span class="line">                    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                        list.add(line);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>优势：</strong></p><ul><li>此方法不依赖于文件的物理位置，因此无论是在IDE还是JAR环境中均可工作。</li><li>通过流操作，可以更灵活地处理文件，如逐行处理或使用不同的字符编码。</li><li>避免了直接在文件系统上操作文件的安全风险。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>敏感词检测sensitive-word</title>
      <link href="/2024/06/16/tools-%E6%95%8F%E6%84%9F%E8%AF%8D%E6%A3%80%E6%B5%8B/"/>
      <url>/2024/06/16/tools-%E6%95%8F%E6%84%9F%E8%AF%8D%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<p><strong>sensitive-word</strong> 是一个 Java 编写的敏感词过滤工具包，可以用于对文本中的敏感词进行过滤。该工具包提供了多种敏感词匹配算法，并支持自定义敏感词库和替换策略。使用该工具包可以有效地保护用户隐私，防止不良信息的传播。 具体来说，sensitive-word 工具包提供了以下功能：</p><ul><li>多种敏感词匹配算法，包括 DFA、AC 自动机等，可以根据实际需求选择合适的算法；</li><li>支持自定义敏感词库和替换策略，可以根据实际需求添加、删除或修改敏感词；</li><li>支持对文本中的敏感词进行替换或标记，可以根据实际需求选择合适的处理方式；</li><li>支持对敏感词进行分组，可以根据实际需求对敏感词进行分类管理。</li></ul><h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 敏感词监测 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.houbb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sensitive-word<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rexlee.coursehelper_springboot.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.api.IWordAllow;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.api.IWordDeny;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.bs.SensitiveWordBs;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.support.allow.WordAllows;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.support.deny.WordDenys;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.support.ignore.SensitiveWordCharIgnores;</span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.support.resultcondition.WordResultConditions;</span><br><span class="line"><span class="keyword">import</span> com.rexlee.coursehelper_springboot.entity.MyWordAllow;</span><br><span class="line"><span class="keyword">import</span> com.rexlee.coursehelper_springboot.entity.MyWordDeny;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置默认敏感词 + 自定义敏感词</span></span><br><span class="line">    <span class="type">IWordDeny</span> <span class="variable">wordDeny</span> <span class="operator">=</span> WordDenys.chains(WordDenys.defaults(), <span class="keyword">new</span> <span class="title class_">MyWordDeny</span>());</span><br><span class="line">    <span class="type">IWordAllow</span> <span class="variable">wordAllow</span> <span class="operator">=</span> WordAllows.chains(WordAllows.defaults(), <span class="keyword">new</span> <span class="title class_">MyWordAllow</span>());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SensitiveWordBs <span class="title function_">sensitiveWordBs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SensitiveWordBs.newInstance()</span><br><span class="line">                .charIgnore(SensitiveWordCharIgnores.specialChars())</span><br><span class="line"></span><br><span class="line">                .wordResultCondition(WordResultConditions.alwaysTrue())</span><br><span class="line">                <span class="comment">// 忽略大小写</span></span><br><span class="line">                .ignoreCase(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 忽略半角圆角</span></span><br><span class="line">                .ignoreWidth(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 忽略数字的写法</span></span><br><span class="line">                .ignoreNumStyle(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 忽略中文的书写格式：简繁体</span></span><br><span class="line">                .ignoreChineseStyle(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 忽略英文的书写格式</span></span><br><span class="line">                .ignoreEnglishStyle(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 忽略重复词</span></span><br><span class="line">                .ignoreRepeat(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 是否启用数字检测</span></span><br><span class="line">                .enableNumCheck(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 是否启用邮箱检测</span></span><br><span class="line">                .enableEmailCheck(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 是否启用链接检测</span></span><br><span class="line">                .enableUrlCheck(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 数字检测，自定义指定长度</span></span><br><span class="line">                .numCheckLen(<span class="number">8</span>)</span><br><span class="line">                <span class="comment">// 配置自定义敏感词</span></span><br><span class="line">                .wordDeny(wordDeny)</span><br><span class="line">                <span class="comment">// 配置非自定义敏感词</span></span><br><span class="line">                .wordAllow(wordAllow)</span><br><span class="line">                .init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rexlee.coursehelper_springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.api.IWordAllow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWordAllow</span> <span class="keyword">implements</span> <span class="title class_">IWordAllow</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getResourceAsStream(<span class="string">&quot;/myNotSensitiveWords.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8))) &#123;</span><br><span class="line">                    String line;</span><br><span class="line">                    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                        list.add(line);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rexlee.coursehelper_springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.houbb.sensitive.word.api.IWordDeny;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWordDeny</span> <span class="keyword">implements</span> <span class="title class_">IWordDeny</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">deny</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getResourceAsStream(<span class="string">&quot;/mySensitiveWords.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8))) &#123;</span><br><span class="line">                    String line;</span><br><span class="line">                    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                        list.add(line);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>在resource目录下创建自定义敏感词白名单黑名单，文件内词语用换行分隔</p><ul><li>mySensitiveWord.txt</li><li>myNotSensitiveWord.txt</li></ul><p><strong>注：</strong> 使用SensitiveWordHelper类中的方法进行敏感词操作只能使用default敏感词库，若要添加自定义词库需使用SensitiveWordBs类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SensitiveWordBs sensitiveWordBs;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">comments</span> <span class="operator">=</span> <span class="string">&quot;大@傻..@逼&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> sensitiveWordBs.replace(comments);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>智能数据分析平台 AIGC应用</title>
      <link href="/2024/05/30/%E6%99%BA%E8%83%BD%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/"/>
      <url>/2024/05/30/%E6%99%BA%E8%83%BD%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="项目描述"><a href="#项目描述" class="headerlink" title="项目描述"></a>项目描述</h3><p>本项目是一个基于Vue、SpringBoot、Echarts和AIGC技术的全新数据分析解决方案。它通过AI和自动化实现数据分析的智能化和高效化,降低了数据分析的学习和使用门槛,提升了数据分析效率。<br>该平台只需要用户导入原始数据集,并简单描述分析需求,就可以自动生成精美的可视化图表和有价值的分析见解。平台通过Spring Boot搭建后端服务,Vue构建前端界面,Echarts渲染图表，基于阻塞队列进行异步编程及性能优化。关键的自动分析功能由AIGC提供支持。</p><h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><ol><li><p>管理员</p><ul><li>后台用户管理</li><li>角色授权</li></ul></li><li><p>普通用户</p><ul><li>每日5次免费额度</li><li>等待时间较长（普通用户任务队列）</li><li>可视化图表及分析结论保留7天</li><li>图表导出及拷贝配置代码</li></ul></li><li><p>VIP用户</p><ul><li>每日100次免费额度</li><li>等待时间较短（VIP用户任务队列）</li><li>可视化图表及分析结论永久表留</li><li>图表编辑</li><li>图表导出及拷贝配置代码<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/97a7ebcfdf9806ff.png" alt=""></li></ul></li></ol><h3 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h3><ul><li>登录注册<ul><li><strong>邮箱验证</strong></li></ul></li><li>用户管理（admin）</li><li><p>个人信息管理</p><ul><li>个人信息查看（剩余额度，账号创建时间、vip到期时间、绑定邮箱等）</li><li>修改密码</li><li>换绑邮箱</li><li><strong>充值VIP（支付宝沙箱）</strong></li></ul></li><li><p><strong>智能数据分析模块</strong></p><ul><li>支持xlsx/xls/csv/txt数据上传（包含数据内容的表格或文本）</li><li>支持<strong>异步</strong>生成图表及结论</li><li><strong>设置普通队列和VIP队列</strong></li></ul></li><li><p><strong>实时图表编辑模块</strong></p><ul><li>修改图表配置项</li><li>编辑数据视图</li><li>复制echarts配置代码</li></ul></li><li><p>意见反馈</p><ul><li>接入第三方评论系统（畅言云评）</li></ul></li><li><p>其他功能</p><ul><li><strong>AOP＋自定义注解实现权限校验</strong></li><li>MD5摘要算法进行用户密码加密储存</li><li>定时任务（每日重置免费额度、处理到期的图表及vip）</li><li>redisson限流器</li></ul></li></ul><h3 id="系统实现"><a href="#系统实现" class="headerlink" title="系统实现"></a>系统实现</h3><p>数据流图：<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/18ed2e5f58a0037b.png" alt=""></p><p>AIGC智能数据分析流程图：<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/f342d05ecb8c35d2.png" alt=""></p><p><strong>关联文章</strong><br><a href="https://rxlee03.github.io/2024/05/19/tools-%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81/">springboot整合redis和邮件发送实现邮箱验证</a><br><a href="https://rxlee03.github.io/2024/05/21/tools-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E6%94%AF%E4%BB%98/">支付宝沙箱</a><br><a href="https://rxlee03.github.io/2024/05/10/tools-%E8%AE%AF%E9%A3%9E%E6%98%9F%E7%81%AB%E7%9A%84%E4%BD%BF%E7%94%A8/">讯飞星火大模型的使用</a><br><a href="https://rxlee03.github.io/2024/04/02/tools-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5/">线程池和阻塞队列实现异步 | 多个阻塞队列的应用</a><br><a href="https://rxlee03.github.io/2024/03/07/Vue%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E7%95%85%E8%A8%80%E4%BA%91%E8%AF%84/">接入畅言云评系统</a><br><a href="https://rxlee03.github.io/2024/04/03/tools-redisson%E9%99%90%E6%B5%81%E5%99%A8/">集成Redisson限流器</a><br><a href="https://rxlee03.github.io/2024/04/02/tools-%E8%AF%BB%E5%8F%96excel_csv_txt%E8%BD%AC%E4%B8%BAstring/">Java将excel\txt\csv文件内容转换为字符串对象</a></p><h3 id="系统展示"><a href="#系统展示" class="headerlink" title="系统展示"></a>系统展示</h3><p>登录<br><img src="https://s21.ax1x.com/2024/06/23/pkrs9it.png" alt="pkrs9it.png"><br>注册<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/61412a9f70d0f4f6.png" alt=""><br>个人信息管理<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/6636984742b75c93.png" alt=""><br>AI数据分析<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/3f57256c658551ac.png" alt=""><br>图表管理<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/d0fed02a5b231c04.png" alt=""><br>图表编辑<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/ab04fec86f3b6768.png" alt=""><br><img src="https://s21.ax1x.com/2024/06/23/pkrrzdA.png" alt=""><br>意见反馈<br><img src="https://s3.bmp.ovh/imgs/2024/06/23/989c15f1731758af.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> mybaties-plus </tag>
            
            <tag> AIGC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot整合支付宝沙箱支付</title>
      <link href="/2024/05/21/tools-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E6%94%AF%E4%BB%98/"/>
      <url>/2024/05/21/tools-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E6%94%AF%E4%BB%98/</url>
      
        <content type="html"><![CDATA[<h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><ol><li>进入支付宝开发者平台创建网页移动应用</li><li>创建成功后进入沙箱<br> <a href="https://open.alipay.com/develop/sandbox/app">支付宝开发者平台-沙箱</a></li><li>启用系统默认密钥-公钥模式<br><img src="https://s3.bmp.ovh/imgs/2024/06/18/4f15008baa61404a.png" alt=""></li></ol><h3 id="springboot与支付宝沙箱的整合"><a href="#springboot与支付宝沙箱的整合" class="headerlink" title="springboot与支付宝沙箱的整合"></a>springboot与支付宝沙箱的整合</h3><ol><li><p>项目依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Alipay沙箱支付--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-easysdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.22.113.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>application.yml 配置参数</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#支付宝</span></span><br><span class="line"><span class="attr">alipay:</span></span><br><span class="line">  <span class="attr">appId:</span> <span class="comment">#沙箱中的应用id</span></span><br><span class="line">  <span class="attr">appPrivateKey:</span> <span class="comment">#应用私钥</span></span><br><span class="line">  <span class="attr">alipayPublicKey:</span> <span class="comment">#支付宝公钥</span></span><br><span class="line">  <span class="attr">notifyUrl:</span> <span class="comment">#回调地址 支付接口后产生的回调(需要公网)</span></span><br><span class="line">  <span class="attr">returnUrl:</span> <span class="comment">#支付成功后的页面跳转</span></span><br></pre></td></tr></table></figure><p>沙箱应用-开发信息中点击查看（系统默认密钥-公钥模式）：<br><img src="https://s3.bmp.ovh/imgs/2024/06/18/a312f0b301cd2cac.png" alt=""></p></li><li><p>AliPayConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alipay.easysdk.factory.Factory;</span><br><span class="line"><span class="keyword">import</span> com.alipay.easysdk.kernel.Config;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;alipay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="keyword">private</span> String appPrivateKey;</span><br><span class="line">    <span class="keyword">private</span> String alipayPublicKey;</span><br><span class="line">    <span class="keyword">private</span> String notifyUrl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.protocol = <span class="string">&quot;https&quot;</span>;</span><br><span class="line">        config.gatewayHost = <span class="string">&quot;https://openapi-sandbox.dl.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line">        config.signType = <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line">        config.appId = <span class="built_in">this</span>.appId;</span><br><span class="line">        config.merchantPrivateKey = <span class="built_in">this</span>.appPrivateKey;</span><br><span class="line">        config.alipayPublicKey = <span class="built_in">this</span>.alipayPublicKey;</span><br><span class="line">        config.notifyUrl = <span class="built_in">this</span>.notifyUrl;</span><br><span class="line">        Factory.setOptions(config);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>Controller:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/pay&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AliPayConfig aliPayConfig;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GATEWAY_URL</span> <span class="operator">=</span><span class="string">&quot;https://openapi-sandbox.dl.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FORMAT</span> <span class="operator">=</span><span class="string">&quot;JSON&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARSET</span> <span class="operator">=</span><span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SIGN_TYPE</span> <span class="operator">=</span><span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/alipay&quot;)</span> <span class="comment">// &amp;subject=xxx&amp;traceNo=xxx&amp;totalAmount=xxx</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(AliPayRequest aliPay, HttpServletResponse httpResponse)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">AlipayClient</span> <span class="variable">alipayClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAlipayClient</span>(GATEWAY_URL, aliPayConfig.getAppId(),</span><br><span class="line">                aliPayConfig.getAppPrivateKey(), FORMAT, CHARSET, aliPayConfig.getAlipayPublicKey(), SIGN_TYPE);</span><br><span class="line">        <span class="type">AlipayTradePagePayRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlipayTradePagePayRequest</span>();</span><br><span class="line">        request.setNotifyUrl(aliPayConfig.getNotifyUrl());</span><br><span class="line">        request.setBizContent(<span class="string">&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;</span> + aliPay.getTraceNo() + <span class="string">&quot;\&quot;,&quot;</span></span><br><span class="line">                + <span class="string">&quot;\&quot;total_amount\&quot;:\&quot;&quot;</span> + aliPay.getTotalAmount() + <span class="string">&quot;\&quot;,&quot;</span></span><br><span class="line">                + <span class="string">&quot;\&quot;subject\&quot;:\&quot;&quot;</span> + aliPay.getSubject() + <span class="string">&quot;\&quot;,&quot;</span></span><br><span class="line">                + <span class="string">&quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">form</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        userId = aliPay.getUserId();</span><br><span class="line">        System.out.println(userId);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 调用SDK生成表单</span></span><br><span class="line">            form = alipayClient.pageExecute(request).getBody();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        httpResponse.setContentType(<span class="string">&quot;text/html;charset=&quot;</span> + CHARSET);</span><br><span class="line">        <span class="comment">// 直接将完整的表单html输出到页面</span></span><br><span class="line">        httpResponse.getWriter().write(form);</span><br><span class="line">        httpResponse.getWriter().flush();</span><br><span class="line">        httpResponse.getWriter().close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/notify&quot;)</span>  <span class="comment">// 注意这里必须是POST接口</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">payNotify</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;trade_status&quot;</span>).equals(<span class="string">&quot;TRADE_SUCCESS&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;=========支付宝异步回调========&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line">            <span class="keyword">for</span> (String name : requestParams.keySet()) &#123;</span><br><span class="line">                params.put(name, request.getParameter(name));</span><br><span class="line">                <span class="comment">// System.out.println(name + &quot; = &quot; + request.getParameter(name));</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 支付宝验签</span></span><br><span class="line">            <span class="keyword">if</span> (Factory.Payment.Common().verifyNotify(params)) &#123;</span><br><span class="line">                <span class="comment">// 验签通过</span></span><br><span class="line">                System.out.println(<span class="string">&quot;交易名称: &quot;</span> + params.get(<span class="string">&quot;subject&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;交易状态: &quot;</span> + params.get(<span class="string">&quot;trade_status&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;支付宝交易凭证号: &quot;</span> + params.get(<span class="string">&quot;trade_no&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;商户订单号: &quot;</span> + params.get(<span class="string">&quot;out_trade_no&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;交易金额: &quot;</span> + params.get(<span class="string">&quot;total_amount&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;买家在支付宝唯一id: &quot;</span> + params.get(<span class="string">&quot;buyer_id&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;买家付款时间: &quot;</span> + params.get(<span class="string">&quot;gmt_payment&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;买家付款金额: &quot;</span> + params.get(<span class="string">&quot;buyer_pay_amount&quot;</span>));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 更新订单未已支付</span></span><br><span class="line">                <span class="comment">//ordersMapper.updateState(tradeNo, &quot;已支付&quot;, gmtPayment, alipayTradeNo);</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(userId);</span><br><span class="line">                    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">                    userService.toVip(Float.parseFloat(params.get(<span class="string">&quot;total_amount&quot;</span>)), user);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BusinessException exception)&#123;</span><br><span class="line">                    log.info(exception.getMessage());</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AliPayRequest:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String traceNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> totalAmount;</span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line">    <span class="keyword">private</span> String alipayTraceNo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><strong>前端代码Vue</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">charge</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> no = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>().<span class="title function_">toString</span>();</span><br><span class="line">      <span class="keyword">const</span> params = &#123;</span><br><span class="line">        <span class="attr">subject</span>: <span class="string">&#x27;vip充值&#x27;</span>,</span><br><span class="line">        <span class="attr">traceNo</span>: no,</span><br><span class="line">        <span class="attr">totalAmount</span>: <span class="variable language_">this</span>.<span class="property">price</span>,</span><br><span class="line">        <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">user</span>.<span class="property">id</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">price</span>===<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>:<span class="string">&quot;请至少选择一个套餐&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>:<span class="string">&quot;error&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">`http://localhost:8180/api/pay/alipay?subject=<span class="subst">$&#123;params.subject&#125;</span>&amp;traceNo=<span class="subst">$&#123;params.traceNo&#125;</span>&amp;totalAmount=<span class="subst">$&#123;params.totalAmount&#125;</span>&amp;userId=<span class="subst">$&#123;params.userId&#125;</span>`</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;付款成功&#x27;</span>)</span><br><span class="line">      location.<span class="title function_">reload</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>点击沙箱账号查看账号信息或直接下载沙箱工具支付<br><img src="https://s3.bmp.ovh/imgs/2024/06/18/096a8b4096f85a4e.png" alt=""><br>大功告成<br><img src="https://s3.bmp.ovh/imgs/2024/06/18/493f54f5293176d0.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2024/06/18/ff24e77c139d007c.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springboot整合redis和邮件发送实现邮箱验证</title>
      <link href="/2024/05/19/tools-%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81/"/>
      <url>/2024/05/19/tools-%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81/</url>
      
        <content type="html"><![CDATA[<h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mail邮件发送pom支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="comment"># SMTP服务器  其他邮箱可自行百度</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line">    <span class="comment"># 发送验证码的邮箱</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">15083797073</span><span class="string">@163.com</span></span><br><span class="line">    <span class="comment"># 授权码</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxxxxxxxxxxx</span></span><br><span class="line">    <span class="comment"># 编码</span></span><br><span class="line">    <span class="attr">default-encoding:</span> <span class="string">utf-8</span></span><br><span class="line">    <span class="comment"># 其它参数</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="comment"># 邮件接收时间的限制，单位毫秒</span></span><br><span class="line">          <span class="attr">timeout:</span> <span class="number">10000</span></span><br><span class="line">          <span class="comment"># 连接时间的限制，单位毫秒</span></span><br><span class="line">          <span class="attr">connectiontimeout:</span> <span class="number">10000</span></span><br><span class="line">          <span class="comment"># 邮件发送时间的限制，单位毫秒</span></span><br><span class="line">          <span class="attr">writetimeout:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">host:</span> </span><br><span class="line">        <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">password:</span> </span><br><span class="line">        <span class="attr">jedis:</span></span><br><span class="line">            <span class="attr">pool:</span></span><br><span class="line">                <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">                <span class="attr">max-wait:</span> <span class="number">-1</span></span><br><span class="line">                <span class="attr">max-idle:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><p><a href="https://jingyan.baidu.com/article/fedf0737af2b4035ac8977ea.html">获取邮箱授权码的方法</a></p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>工具类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.FileSystemResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.SimpleMailMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发送邮件工具类 MailUtil</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailUtil</span> <span class="keyword">implements</span> <span class="title class_">EmailService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 配置文件中我的qq邮箱</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.mail.from&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String from;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 简单文本邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to 收件人</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject 主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendSimpleMail</span><span class="params">(String to, String subject, String content)</span> &#123;</span><br><span class="line">        <span class="comment">//创建SimpleMailMessage对象</span></span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">        <span class="comment">//邮件发送人</span></span><br><span class="line">        message.setFrom(from);</span><br><span class="line">        <span class="comment">//邮件接收人</span></span><br><span class="line">        message.setTo(to);</span><br><span class="line">        <span class="comment">//邮件主题</span></span><br><span class="line">        message.setSubject(subject);</span><br><span class="line">        <span class="comment">//邮件内容</span></span><br><span class="line">        message.setText(content);</span><br><span class="line">        <span class="comment">//发送邮件</span></span><br><span class="line">        mailSender.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * html邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to 收件人,多个时参数形式 ：&quot;xxx@xxx.com,xxx@xxx.com,xxx@xxx.com&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject 主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendHtmlMail</span><span class="params">(String to, String subject, String content)</span> &#123;</span><br><span class="line">        <span class="comment">//获取MimeMessage对象</span></span><br><span class="line">        <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper messageHelper;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            messageHelper = <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//邮件发送人</span></span><br><span class="line">            messageHelper.setFrom(from);</span><br><span class="line">            <span class="comment">//邮件接收人,设置多个收件人地址</span></span><br><span class="line">            InternetAddress[] internetAddressTo = InternetAddress.parse(to);</span><br><span class="line">            messageHelper.setTo(internetAddressTo);</span><br><span class="line">            <span class="comment">//messageHelper.setTo(to);</span></span><br><span class="line">            <span class="comment">//邮件主题</span></span><br><span class="line">            message.setSubject(subject);</span><br><span class="line">            <span class="comment">//邮件内容，html格式</span></span><br><span class="line">            messageHelper.setText(content, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//发送</span></span><br><span class="line">            mailSender.send(message);</span><br><span class="line">            <span class="comment">//日志信息</span></span><br><span class="line">            logger.info(<span class="string">&quot;邮件已经发送。&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;发送邮件时发生异常！&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带附件的邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to 收件人</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject 主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 附件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendAttachmentsMail</span><span class="params">(String to, String subject, String content, String filePath)</span> &#123;</span><br><span class="line">        <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">            helper.setFrom(from);</span><br><span class="line">            helper.setTo(to);</span><br><span class="line">            helper.setSubject(subject);</span><br><span class="line">            helper.setText(content, <span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="type">FileSystemResource</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> filePath.substring(filePath.lastIndexOf(File.separator));</span><br><span class="line">            helper.addAttachment(fileName, file);</span><br><span class="line">            mailSender.send(message);</span><br><span class="line">            <span class="comment">//日志信息</span></span><br><span class="line">            logger.info(<span class="string">&quot;邮件已经发送。&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;发送邮件时发生异常！&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>实现邮箱校验：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/email&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BaseResponse <span class="title function_">sendEmail</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email)</span> <span class="keyword">throws</span> UnsupportedEncodingException, AddressException &#123;</span><br><span class="line">    <span class="comment">// 校验邮箱格式</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">emailRegex</span> <span class="operator">=</span> <span class="string">&quot;^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$&quot;</span>;</span><br><span class="line">    <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(emailRegex);</span><br><span class="line">    <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(email);</span><br><span class="line">    <span class="keyword">if</span> (!matcher.matches())</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.error(ErrorCode.PARAMS_ERROR,<span class="string">&quot;邮箱格式错误&quot;</span>);</span><br><span class="line">    <span class="comment">// 检查是否重复发送</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;msg_&quot;</span>+email;</span><br><span class="line">    <span class="type">String</span> <span class="variable">already_have</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span>(already_have == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 随机生成一个6位数字型的字符串</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">digit</span> <span class="operator">=</span> random.nextInt(<span class="number">10</span>); <span class="comment">// 生成0到9之间的随机数</span></span><br><span class="line">            stringBuilder.append(digit);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> stringBuilder.toString();</span><br><span class="line">        <span class="comment">// 邮件对象</span></span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">        message.setSubject(<span class="string">&quot;【数智魔方】邮箱验证码&quot;</span>);</span><br><span class="line">        message.setText(<span class="string">&quot;尊敬的用户您好!\n\n尊敬的: &quot;</span>+email+<span class="string">&quot;，您的校验验证码为: &quot;</span>+code+<span class="string">&quot;，有效期2分钟，请不要把验证码信息泄露给其他人，如非本人请勿操作&quot;</span>);</span><br><span class="line">        message.setTo(email);</span><br><span class="line">        <span class="comment">// 对方看到的发送人</span></span><br><span class="line">        message.setFrom(<span class="keyword">new</span> <span class="title class_">InternetAddress</span>(MimeUtility.encodeText(<span class="string">&quot;数智魔方&quot;</span>)+<span class="string">&quot;&lt;15083797073@163.com&gt;&quot;</span>).toString());</span><br><span class="line">        <span class="comment">//发送邮件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            javaMailSender.send(message);</span><br><span class="line">            redisTemplate.opsForValue().set(key, code, <span class="number">2L</span>, TimeUnit.MINUTES);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.success(code);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.error(ErrorCode.TOO_MANY_REQUEST,<span class="string">&quot;邮箱已发送，请不要频繁点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot快速接入讯飞星火大模型</title>
      <link href="/2024/05/10/tools-%E8%AE%AF%E9%A3%9E%E6%98%9F%E7%81%AB%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/05/10/tools-%E8%AE%AF%E9%A3%9E%E6%98%9F%E7%81%AB%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--讯飞星火大模型sdk--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.briqt<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xunfei-spark4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 讯飞星火配置</span><br><span class="line">xunfei:</span><br><span class="line">  client:</span><br><span class="line">    appid: 98349799</span><br><span class="line">    apiSecret: Njc5********FmZGIzZjg5ZDcw</span><br><span class="line">    apiKey: 7e5841e4844c2********fef838d61fd73</span><br></pre></td></tr></table></figure><p>讯飞星火配置类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;xunfei.client&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XunFeiConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appid;</span><br><span class="line">    <span class="keyword">private</span> String apiSecret;</span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    <span class="keyword">private</span> String appidVIP;</span><br><span class="line">    <span class="keyword">private</span> String apiSecretVIP;</span><br><span class="line">    <span class="keyword">private</span> String apiKeyVIP;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SparkClient <span class="title function_">sparkClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SparkClient</span> <span class="variable">sparkClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SparkClient</span>();</span><br><span class="line">        sparkClient.apiKey = apiKey;</span><br><span class="line">        sparkClient.apiSecret = apiSecret;</span><br><span class="line">        sparkClient.appid = appid;</span><br><span class="line">        <span class="keyword">return</span> sparkClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.constant.UserConstant;</span><br><span class="line"><span class="keyword">import</span> io.github.briqt.spark4j.SparkClient;</span><br><span class="line"><span class="keyword">import</span> io.github.briqt.spark4j.constant.SparkApiVersion;</span><br><span class="line"><span class="keyword">import</span> io.github.briqt.spark4j.model.SparkMessage;</span><br><span class="line"><span class="keyword">import</span> io.github.briqt.spark4j.model.SparkSyncChatResponse;</span><br><span class="line"><span class="keyword">import</span> io.github.briqt.spark4j.model.request.SparkRequest;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SparkManager</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SparkClient sparkClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SparkClient sparkClientVIP;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * AI生成问题的预设条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PRECONDITION</span> <span class="operator">=</span> <span class="string">&quot;你是一个......&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向星火AI发送请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendMesToAIUseXingHuo</span><span class="params">(String content, String role)</span> &#123;</span><br><span class="line">        <span class="comment">// 消息列表，可以在此列表添加历史对话记录</span></span><br><span class="line">        List&lt;SparkMessage&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        messages.add(SparkMessage.systemContent(PRECONDITION));</span><br><span class="line">        messages.add(SparkMessage.userContent(content));</span><br><span class="line">        <span class="comment">// 构造请求</span></span><br><span class="line">        <span class="type">SparkRequest</span> <span class="variable">sparkRequest</span> <span class="operator">=</span> SparkRequest.builder()</span><br><span class="line">                <span class="comment">// 消息列表</span></span><br><span class="line">                .messages(messages)</span><br><span class="line">                <span class="comment">// 模型回答的tokens的最大长度，非必传，默认为2048</span></span><br><span class="line">                .maxTokens(<span class="number">8192</span>)</span><br><span class="line">                <span class="comment">// 结果随机性，取值越高随机性越强，即相同的问题得到的不同答案的可能性越高，非必传，取值为[0,1]，默认为0.5</span></span><br><span class="line">                .temperature(<span class="number">0.2</span>)</span><br><span class="line">                .topK(<span class="number">2</span>)</span><br><span class="line">                <span class="comment">// 指定请求版本</span></span><br><span class="line">                .apiVersion(SparkApiVersion.V3_5)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 同步调用</span></span><br><span class="line">        SparkSyncChatResponse chatResponse;</span><br><span class="line">        chatResponse = sparkClientVIP.chatSync(sparkRequest);</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseContent</span> <span class="operator">=</span> chatResponse.getContent();</span><br><span class="line">        log.info(<span class="string">&quot;星火AI返回的结果&#123;&#125;&quot;</span>, responseContent);</span><br><span class="line">        <span class="keyword">return</span> responseContent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SparkManagerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SparkManager sparkManager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> <span class="string">&quot;分析需求：\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;分析网站用户的增长情况\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;原始数据：\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;日期，用户数\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;1号,10 \n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;2号,20\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;3号,30&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sparkManager.sendMesToAIUseXingHuo(userInput);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIGC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>neo4j-多层关系查询</title>
      <link href="/2024/05/06/neo4j-%E6%9F%A5%E8%AF%A2%E7%BB%93%E7%82%B9%E7%9A%84%E5%A4%9A%E5%B1%82%E5%85%B3%E7%B3%BB/"/>
      <url>/2024/05/06/neo4j-%E6%9F%A5%E8%AF%A2%E7%BB%93%E7%82%B9%E7%9A%84%E5%A4%9A%E5%B1%82%E5%85%B3%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<p>从一个节点，通过直接关系，连接到另外一个节点，这个过程叫遍历，经过的节点和关系的组合叫做路径（Path），路径是由节点和关系的有序组合。</p><p>(a)—&gt;(b)：是步长为1的路径，节点a和b之间有关系直接关联；<br>(a)—&gt;(c)—&gt;(b)：是步长为2的路径，从节点a，经过两个关系和一个节点，到达节点b；</p><h3 id="问题重现"><a href="#问题重现" class="headerlink" title="问题重现"></a>问题重现</h3><p><strong>studAlumnus结点</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Node(&quot;studAlumnus&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudAlumnus</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String SNumber;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String graduateYear;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;导师&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> Teacher instructor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;本科院校&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> College UCollege;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;本科专业&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> Major UMajor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;研究生院校&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> College MCollege;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;研究生专业&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> Major MMajor;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>college结点</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Node(&quot;college&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">College</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Relationship(type = &quot;开设&quot;, direction = Relationship.Direction.OUTGOING)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;College&gt; majors;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>查询</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;MATCH (c:college)&lt;-[r]-(s:studAlumnus)\n&quot; +</span></span><br><span class="line"><span class="meta">        &quot;WHERE c.name IN $collegeNames\n&quot; +</span></span><br><span class="line"><span class="meta">        &quot;WITH s\n&quot; +</span></span><br><span class="line"><span class="meta">        &quot;MATCH (s)-[r2]-(relatedNode)\n&quot;+</span></span><br><span class="line"><span class="meta">        &quot;RETURN s, r2, relatedNode&quot;)</span></span><br><span class="line">List&lt;StudAlumnus&gt; <span class="title function_">relatedToCollege</span><span class="params">(<span class="meta">@Param(&quot;collegeNames&quot;)</span> List&lt;String&gt; collegeNames)</span>;</span><br></pre></td></tr></table></figure></p><p><strong>我需要输入一个院校名称列表，查询和这些院校有关联的所有学生。</strong><br>如果使用<code>MATCH (c:college)&lt;-[r]-(s:studAlumnus) WHERE c.name IN $collegeNames RETURN s</code>进行查询，会发现查询得到的studAlumnus结点对象中所有@Relationship连接的下一个结点值都为空，<strong>原因为没有进行多层关系查询</strong>，(c)&lt;—(s)是步长为1的路径，故能查询到学生结点的信息，而(c)&lt;—(s)&lt;—(major)是步长为2的路径，查询不到下一层的结点，故学生结点对象中所有@Relationship连接的下一个结点值都为空。</p><h3 id="多层查询的正确写法"><a href="#多层查询的正确写法" class="headerlink" title="多层查询的正确写法"></a>多层查询的正确写法</h3><h4 id="直接拼接关系节点查询"><a href="#直接拼接关系节点查询" class="headerlink" title="直接拼接关系节点查询"></a>直接拼接关系节点查询</h4><p><code>MATCH (m:major)-[re1]-&gt;(s:studStudAlumnus)-[re2]-&gt;(c:college&#123;name:&#39;江西财经大学&#39;&#125;) return m,re1,s,re2,c</code></p><h3 id="使用with关键字"><a href="#使用with关键字" class="headerlink" title="使用with关键字"></a>使用with关键字</h3><p>问题重现中的解决方案<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (c:college)&lt;-[r]-(s:studAlumnus) WHERE c.name IN $collegeNames</span><br><span class="line">WITH s MATCH (s)-[r2]-(relatedNode)</span><br><span class="line">RETURN s, r2, relatedNode&quot;</span><br></pre></td></tr></table></figure></p><h3 id="使用深度运算符"><a href="#使用深度运算符" class="headerlink" title="使用深度运算符"></a>使用深度运算符</h3><p>当实现多深度关系节点查询时，可变数量的关系-&gt;节点可以使用-[:TYPE*minHops..maxHops]-&gt;。</p><p>如果在1到3的关系中存在路径，将返回开始点和结束点。</p><p>match data=(na:Industry{name:’xx有限公司’})-[*1..3]-&gt;(nb:Industry) return data</p><p>Cypher语言支持变长路径的模式，变长路径的表示方式是：[*N..M]，N和M表示路径长度的最小值和最大值。</p><p>(a)-[<em>2]-&gt;(b)：表示路径长度为2，起始节点是a，终止节点是b；<br>(a)-[</em>3..5]-&gt;(b)：表示路径长度的最小值是3，最大值是5，起始节点是a，终止节点是b；<br>(a)-[<em>..5]-&gt;(b)：表示路径长度的最大值是5，起始节点是a，终止节点是b；<br>(a)-[</em>3..]-&gt;(b)：表示路径长度的最小值是3，起始节点是a，终止节点是b；<br>(a)-[*]-&gt;(b)：表示不限制路径长度，起始节点是a，终止节点是b；</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> neo4j </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springboot集成Redisson限流器</title>
      <link href="/2024/04/03/tools-redisson%E9%99%90%E6%B5%81%E5%99%A8/"/>
      <url>/2024/04/03/tools-redisson%E9%99%90%E6%B5%81%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="Redisson限流器"><a href="#Redisson限流器" class="headerlink" title="Redisson限流器"></a>Redisson限流器</h3><h4 id="RedisLimiterManager"><a href="#RedisLimiterManager" class="headerlink" title="RedisLimiterManager"></a>RedisLimiterManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.model.enums.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RRateLimiter;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RateIntervalUnit;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RateType;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RedisLimiter 限流基础服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisLimiterManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 限流操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 区分不同的限流器，比如不同的用户 id 应该分别统计</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRateLimit</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个名称为user_limiter的限流器，每秒最多访问 2 次</span></span><br><span class="line">        <span class="type">RRateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> redissonClient.getRateLimiter(key);</span><br><span class="line">        rateLimiter.trySetRate(RateType.OVERALL, <span class="number">2</span>, <span class="number">1</span>, RateIntervalUnit.SECONDS);</span><br><span class="line">        <span class="comment">// 每当一个操作来了后，请求一个令牌</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">canOp</span> <span class="operator">=</span> rateLimiter.tryAcquire(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (!canOp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.TOO_MANY_REQUEST);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="pom坐标"><a href="#pom坐标" class="headerlink" title="pom坐标"></a>pom坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.redisson.Redisson;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.redisson.config.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer()</span><br><span class="line">                .setDatabase(database)</span><br><span class="line">                .setAddress(<span class="string">&quot;redis://&quot;</span> + host + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">        <span class="type">RedissonClient</span> <span class="variable">redisson</span> <span class="operator">=</span> Redisson.create(config);</span><br><span class="line">        <span class="keyword">return</span> redisson;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="限流算法"><a href="#限流算法" class="headerlink" title="限流算法"></a>限流算法</h3><p>在网上看了些限流算法，主要有4种。</p><h4 id="固定窗口算法"><a href="#固定窗口算法" class="headerlink" title="固定窗口算法"></a>固定窗口算法</h4><p>首先维护一个计数器，将单位时间段当做一个窗口，计数器记录这个窗口接收请求的次数。</p><p>当次数少于限流阀值，就允许访问，并且计数器+1<br>当次数大于限流阀值，就拒绝访问。<br>当前的时间窗口过去之后，计数器清零。<br>假设单位时间是1秒，限流阀值为3。在单位时间1秒内，每来一个请求,计数器就加1，如果计数器累加的次数超过限流阀值3，后续的请求全部拒绝。等到1s结束后，计数器清0，重新开始计数。</p><p><strong>问题 1：窗口临界值，导致双倍阈值</strong><br>假设限流阀值为5个请求，单位时间窗口是1s,如果我们在单位时间内的前0.8-1s和1-1.2s，分别并发5个请求。虽然都没有超过阀值，但是如果算0.8-1.2s,则并发数高达10，已经超过单位时间1s不超过5阀值的定义啦，通过的请求达到了阈值的两倍。</p><p><strong>为了解决问题2中窗口临界值的问题，引入了滑动窗口限流。滑动窗口限流解决固定窗口临界值的问题，可以保证在任意时间窗口内都不会超过阈值。</strong></p><p><strong>问题 2：集中流量，打满阈值，后续服务不可用</strong><br>比如窗口大小为1s，限流大小为100，然后恰好在某个窗口的第1ms来了100个请求，然后第2ms-999ms的请求就都会被拒绝，这段时间用户会感觉系统服务不可用。</p><h4 id="滑动窗口算法"><a href="#滑动窗口算法" class="headerlink" title="滑动窗口算法"></a>滑动窗口算法</h4><p>相对于固定窗口，滑动窗口除了需要引入计数器之外，还需要记录时间窗口内每个请求到达的时间点，因此对内存的占用会比较多。</p><p>规则如下，假设时间窗口为 1 秒：</p><p>记录每次请求的时间。<br>统计每次请求的时间 至 往前推1秒这个时间窗口内请求数，并且 1 秒前的数据可以删除。<br>统计的请求数小于阈值就记录这个请求的时间，并允许通过，反之拒绝。<br>滑动窗口算法就是固定窗口的升级版。将计时窗口划分成一个小窗口，滑动窗口算法就退化成了固定窗口算法。而滑动窗口算法其实就是对请求数进行了更细粒度的限流，窗口划分的越多，则限流越精准。</p><p>但是滑动窗口和固定窗口都无法解决短时间之内集中流量的突击，就和前面介绍的一样。</p><p>接下来再说说漏桶，它可以解决时间窗口类的痛点，使得流量更加的平滑。</p><h4 id="漏桶算法"><a href="#漏桶算法" class="headerlink" title="漏桶算法"></a>漏桶算法</h4><p>漏桶算法面对限流，就更加的柔性，不存在直接的粗暴拒绝。</p><p>它的原理很简单，可以认为就是注水漏水的过程。往漏桶中以任意速率流入水，以固定的速率流出水。当水超过桶的容量时，会被溢出，也就是被丢弃。因为桶容量是不变的，保证了整体的速率。</p><p>流入的水滴，可以看作是访问系统的请求，这个流入速率是不确定的。<br>桶的容量一般表示系统所能处理的请求数。<br>如果桶的容量满了，就达到限流的阀值，就会丢弃水滴（拒绝请求）<br>流出的水滴，是恒定过滤的，对应服务按照固定的速率处理请求。<br>看到这想到啥，是不是 和消息队列思想有点像，削峰填谷。经过漏洞这么一过滤，请求就能平滑的流出，看起来很像很挺完美的？实际上它的优点也即缺点。</p><p><strong>问题 3: 无法应对流量突发</strong><br>面对突发请求，服务的处理速度和平时是一样的，这其实不是我们想要的，在面对突发流量我们希望在系统平稳的同时，提升用户体验即能更快的处理请求，而不是和正常流量一样，循规蹈矩的处理（看看，之前滑动窗口说流量不够平滑，现在太平滑了又不行，难搞啊）。</p><p>而接下来我们要谈的令牌桶算法能够在一定程度上解决流量突发的问题。</p><h4 id="令牌桶算法"><a href="#令牌桶算法" class="headerlink" title="令牌桶算法"></a>令牌桶算法</h4><p>令牌桶算法是<strong>对漏斗算法的一种改进</strong>，除了能够起到限流的作用外，还允许一定程度的流量突发。</p><p>令牌桶算法原理：</p><p>有一个令牌管理员，根据限流大小，定速往令牌桶里放令牌。<br>如果令牌数量满了，超过令牌桶容量的限制，那就丢弃。<br>系统在接受到一个用户请求时，都会先去令牌桶要一个令牌。如果拿到令牌，那么就处理这个请求的业务逻辑；<br>如果拿不到令牌，就直接拒绝这个请求。<br>可以看出令牌桶在应对突发流量的时候，桶内假如有 100 个令牌，那么这 100 个令牌可以马上被取走，而<strong>不像漏桶那样匀速的消费</strong>。所以在应对突发流量的时候令牌桶表现的更佳。</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> 限流 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线程池和阻塞队列实现异步 | 多个阻塞队列的应用</title>
      <link href="/2024/04/02/tools-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5/"/>
      <url>/2024/04/02/tools-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="线程池和阻塞队列实现异步"><a href="#线程池和阻塞队列实现异步" class="headerlink" title="线程池和阻塞队列实现异步"></a>线程池和阻塞队列实现异步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.formula.functions.T;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolExecutorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThreadPoolExecutor <span class="title function_">threadPoolExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadFactory</span> <span class="variable">threadFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(<span class="meta">@NotNull</span> Runnable r)</span> &#123;</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                thread.setName(<span class="string">&quot;线程&quot;</span> + count);</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">2</span>, <span class="number">4</span>, <span class="number">100</span>, TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">4</span>), threadFactory);</span><br><span class="line">        <span class="keyword">return</span> threadPoolExecutor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>corePoolSize：线程池维护线程的最少数量 （core : 核心）</li><li>maximumPoolSize：线程池维护线程的最大数量，显然必须&gt;=1</li><li>keepAliveTime：线程池维护的多余的线程所允许的空闲时间，最长可以空闲多久，时间到了，如果超过 corePoolSize 的线程一直空闲，他们就会被销毁。</li><li>unit：线程池维护线程所允许的空闲时间的单位</li><li>workQueue：线程池所使用的缓冲队列，已经提交但是没有执行的任务会放进这里</li><li>threadFactory：生成线程池种工作线程的线程工厂，一般使用默认</li><li>handler：线程池对拒绝任务的处理策略，当队列满且工作线程已经达到maximumPoolSize。</li></ul><p><img src="https://s3.bmp.ovh/imgs/2024/04/04/5c98ec5f239f00d6.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 先修改图表任务状态为 “执行中”。等执行成功后，修改为 “已完成”、保存执行结果；执行失败后，状态修改为 “失败”，记录任务失败信息。</span></span><br><span class="line">            <span class="type">Chart</span> <span class="variable">updateChart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chart</span>();</span><br><span class="line">            updateChart.setId(chart.getId());</span><br><span class="line">            updateChart.setStatus(<span class="string">&quot;running&quot;</span>);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> chartService.updateById(updateChart);</span><br><span class="line">            <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">                handleChartUpdateError(chart.getId(), <span class="string">&quot;更新图表执行中状态失败&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 调用 AI</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sparkManager.sendMesToAIUseXingHuo(userInput.toString());</span><br><span class="line">            String[] splits = result.split(<span class="string">&quot;~~~~&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (splits.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                handleChartUpdateError(chart.getId(), <span class="string">&quot;AI 生成错误&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">genChart</span> <span class="operator">=</span> splits[<span class="number">1</span>].trim();</span><br><span class="line">            <span class="type">String</span> <span class="variable">genResult</span> <span class="operator">=</span> splits[<span class="number">2</span>].trim();</span><br><span class="line">            <span class="type">Chart</span> <span class="variable">updateChartResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chart</span>();</span><br><span class="line">            updateChartResult.setId(chart.getId());</span><br><span class="line">            updateChartResult.setGenChart(genChart);</span><br><span class="line">            updateChartResult.setGenResult(genResult);</span><br><span class="line">            <span class="comment">// todo 定义状态为枚举值</span></span><br><span class="line">            updateChartResult.setStatus(<span class="string">&quot;succeed&quot;</span>);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">updateResult</span> <span class="operator">=</span> chartService.updateById(updateChartResult);</span><br><span class="line">            <span class="keyword">if</span> (!updateResult) &#123;</span><br><span class="line">                handleChartUpdateError(chart.getId(), <span class="string">&quot;更新图表成功状态失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br></pre></td></tr></table></figure><h3 id="多个阻塞队列的应用"><a href="#多个阻塞队列的应用" class="headerlink" title="多个阻塞队列的应用"></a>多个阻塞队列的应用</h3><p>设置普通用户队列和VIP用户队列，两类用户在不同的队列中等待且使用的AIGC配置不一样。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 讯飞星火配置</span><br><span class="line">xunfei:</span><br><span class="line">  client:</span><br><span class="line">    appid: 98349799</span><br><span class="line">    apiSecret: Njc5********FmZGIzZjg5ZDcw</span><br><span class="line">    apiKey: 7e5841e4844c2********fef838d61fd73</span><br><span class="line">    appidVIP: 2d****e473</span><br><span class="line">    apiSecretVIP: ZTVmN2********k5MDg1M2UzMDAzNmJm</span><br><span class="line">    apiKeyVIP: ec112c36ff3********a90ff72d42b6</span><br></pre></td></tr></table></figure><p>讯飞星火配置类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;xunfei.client&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XunFeiConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appid;</span><br><span class="line">    <span class="keyword">private</span> String apiSecret;</span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    <span class="keyword">private</span> String appidVIP;</span><br><span class="line">    <span class="keyword">private</span> String apiSecretVIP;</span><br><span class="line">    <span class="keyword">private</span> String apiKeyVIP;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 普通用户使用的接口</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SparkClient <span class="title function_">sparkClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SparkClient</span> <span class="variable">sparkClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SparkClient</span>();</span><br><span class="line">        sparkClient.apiKey = apiKey;</span><br><span class="line">        sparkClient.apiSecret = apiSecret;</span><br><span class="line">        sparkClient.appid = appid;</span><br><span class="line">        <span class="keyword">return</span> sparkClient;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// vip使用的接口</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SparkClient <span class="title function_">sparkClientVIP</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SparkClient</span> <span class="variable">sparkClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SparkClient</span>();</span><br><span class="line">        sparkClient.apiKey = apiKeyVIP;</span><br><span class="line">        sparkClient.apiSecret = apiSecretVIP;</span><br><span class="line">        sparkClient.appid = appidVIP;</span><br><span class="line">        <span class="keyword">return</span> sparkClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>控制器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/chart&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChartController</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChartService chartService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SparkManager sparkManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisLimiterManager redisLimiterManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor_VIP;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/gen/async&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BaseResponse&lt;BiResponse&gt; <span class="title function_">genChartByAiAsync</span><span class="params">(<span class="meta">@RequestPart(&quot;chartData&quot;)</span> MultipartFile multipartFile,</span></span><br><span class="line"><span class="params">                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userService.getLoginUser(request);</span><br><span class="line">        <span class="comment">// 限流判断，每个用户一个限流器</span></span><br><span class="line">        redisLimiterManager.doRateLimit(<span class="string">&quot;genChartByAi_&quot;</span> + loginUser.getId());</span><br><span class="line">        <span class="comment">// 额度用尽</span></span><br><span class="line">        ThrowUtils.throwIf(loginUser.getLimitAmount() &lt;= <span class="number">0</span>, ErrorCode.NO_AUTH_ERROR,<span class="string">&quot;今日额度用尽&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> genChartByAiRequest.getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">goal</span> <span class="operator">=</span> genChartByAiRequest.getGoal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">chartType</span> <span class="operator">=</span> genChartByAiRequest.getChartType();</span><br><span class="line">        <span class="comment">// 校验</span></span><br><span class="line">        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, <span class="string">&quot;目标为空&quot;</span>);</span><br><span class="line">        ThrowUtils.throwIf(StringUtils.isNotBlank(name) &amp;&amp; name.length() &gt; <span class="number">100</span>, ErrorCode.PARAMS_ERROR, <span class="string">&quot;名称过长&quot;</span>);</span><br><span class="line">        <span class="comment">// 校验文件</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> multipartFile.getSize();</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> multipartFile.getOriginalFilename();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">long</span> <span class="variable">ONE_MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024L</span>;</span><br><span class="line">        ThrowUtils.throwIf(size &gt; ONE_MB, ErrorCode.PARAMS_ERROR, <span class="string">&quot;文件过大&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> FileUtil.getSuffix(originalFilename);</span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; validFileSuffixList = Arrays.asList(<span class="string">&quot;txt&quot;</span>, <span class="string">&quot;xlsx&quot;</span>, <span class="string">&quot;xls&quot;</span>, <span class="string">&quot;csv&quot;</span>);</span><br><span class="line">        ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, <span class="string">&quot;文件后缀非法&quot;</span>);</span><br><span class="line">        <span class="comment">// 构造用户输入</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">userInput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        userInput.append(<span class="string">&quot;分析需求：&quot;</span>).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="comment">// 拼接分析目标</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userGoal</span> <span class="operator">=</span> goal;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(chartType)) &#123;</span><br><span class="line">            userGoal += <span class="string">&quot;,请使用&quot;</span> + chartType;</span><br><span class="line">        &#125;</span><br><span class="line">        userInput.append(userGoal).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        userInput.append(<span class="string">&quot;原始数据：&quot;</span>).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="comment">// 拼接数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strData</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (suffix.equals(<span class="string">&quot;csv&quot;</span>))&#123;</span><br><span class="line">            strData = FileConvertUtils.csvFileToString(multipartFile);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (suffix.equals(<span class="string">&quot;txt&quot;</span>)) &#123;</span><br><span class="line">            strData = FileConvertUtils.txtFileToString(multipartFile);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            strData = FileConvertUtils.excelToString(multipartFile);</span><br><span class="line">        &#125;</span><br><span class="line">        userInput.append(strData).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 插入到数据库</span></span><br><span class="line">        <span class="type">Chart</span> <span class="variable">chart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chart</span>();</span><br><span class="line">        chart.setName(name);</span><br><span class="line">        chart.setGoal(goal);</span><br><span class="line">        chart.setChartData(strData);</span><br><span class="line">        chart.setChartType(chartType);</span><br><span class="line">        chart.setStatus(<span class="string">&quot;wait&quot;</span>);</span><br><span class="line">        chart.setUserId(loginUser.getId());</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">saveResult</span> <span class="operator">=</span> chartService.save(chart);</span><br><span class="line">        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, <span class="string">&quot;图表保存失败&quot;</span>);</span><br><span class="line">        <span class="comment">// 异步生成</span></span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 先修改图表任务状态为 “执行中”。等执行成功后，修改为 “已完成”、保存执行结果；执行失败后，状态修改为 “失败”，记录任务失败信息。</span></span><br><span class="line">            <span class="type">Chart</span> <span class="variable">updateChart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chart</span>();</span><br><span class="line">            updateChart.setId(chart.getId());</span><br><span class="line">            updateChart.setStatus(<span class="string">&quot;running&quot;</span>);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> chartService.updateById(updateChart);</span><br><span class="line">            <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">                handleChartUpdateError(chart.getId(), <span class="string">&quot;更新图表执行中状态失败&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 用户额度减一</span></span><br><span class="line">            userService.decLimitAmount(loginUser.getId());</span><br><span class="line">            <span class="comment">// 调用 AI</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sparkManager.sendMesToAIUseXingHuo(userInput.toString(), loginUser.getUserRole());</span><br><span class="line">                String[] splits = result.split(<span class="string">&quot;~~~~&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (splits.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                    handleChartUpdateError(chart.getId(), <span class="string">&quot;AI 生成错误&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">String</span> <span class="variable">genChart</span> <span class="operator">=</span> splits[<span class="number">1</span>].trim();</span><br><span class="line">                <span class="type">String</span> <span class="variable">genResult</span> <span class="operator">=</span> splits[<span class="number">2</span>].trim();</span><br><span class="line">                <span class="type">Chart</span> <span class="variable">updateChartResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chart</span>();</span><br><span class="line">                updateChartResult.setId(chart.getId());</span><br><span class="line">                updateChartResult.setGenChart(genChart);</span><br><span class="line">                updateChartResult.setGenResult(genResult);</span><br><span class="line">                updateChartResult.setStatus(<span class="string">&quot;succeed&quot;</span>);</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">updateResult</span> <span class="operator">=</span> chartService.updateById(updateChartResult);</span><br><span class="line">                <span class="keyword">if</span> (!updateResult) &#123;</span><br><span class="line">                    handleChartUpdateError(chart.getId(), <span class="string">&quot;更新图表成功状态失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SparkException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                handleChartUpdateError(chart.getId(), e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,  loginUser.getUserRole().equals(<span class="string">&quot;user&quot;</span>) ? threadPoolExecutor: threadPoolExecutor_VIP );</span><br><span class="line"></span><br><span class="line">        <span class="type">BiResponse</span> <span class="variable">biResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BiResponse</span>();</span><br><span class="line">        biResponse.setChartId(chart.getId());</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.success(biResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 多线程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java将excel\txt\csv文件内容转换为字符串对象</title>
      <link href="/2024/04/02/tools-%E8%AF%BB%E5%8F%96excel_csv_txt%E8%BD%AC%E4%B8%BAstring/"/>
      <url>/2024/04/02/tools-%E8%AF%BB%E5%8F%96excel_csv_txt%E8%BD%AC%E4%B8%BAstring/</url>
      
        <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileConvertUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * excel 转 string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">excelToString</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        List&lt;Map&lt;Integer, String&gt;&gt; list = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ExcelTypeEnum</span> <span class="variable">excelType</span> <span class="operator">=</span> multipartFile.getOriginalFilename().endsWith(<span class="string">&quot;.xls&quot;</span>) ?</span><br><span class="line">                    ExcelTypeEnum.XLS : ExcelTypeEnum.XLSX;</span><br><span class="line">            list = EasyExcel.read(multipartFile.getInputStream())</span><br><span class="line">                    .excelType(excelType)</span><br><span class="line">                    .sheet()</span><br><span class="line">                    .doReadSync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;表格错误&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (CollUtil.isEmpty(list)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 转换为 string</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            LinkedHashMap&lt;Integer, String&gt; dataMap = (LinkedHashMap) list.get(i);</span><br><span class="line">            List&lt;String&gt; dataList = dataMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());</span><br><span class="line">            stringBuilder.append(StringUtils.join(dataList, <span class="string">&quot;,&quot;</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * csv 转 string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">csvFileToString</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> multipartFile.getInputStream()) &#123;</span><br><span class="line">            List&lt;String&gt; rows = IOUtils.readLines(inputStream, StandardCharsets.UTF_8);</span><br><span class="line">            <span class="keyword">return</span> String.join(<span class="string">&quot;\n&quot;</span>, rows);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * txt 转 string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">txtFileToString</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes, StandardCharsets.UTF_8);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>easyExcel读取表格转List工具类</title>
      <link href="/2024/03/29/tools-easyExcel%E6%96%87%E4%BB%B6%E8%BD%AClist/"/>
      <url>/2024/03/29/tools-easyExcel%E6%96%87%E4%BB%B6%E8%BD%AClist/</url>
      
        <content type="html"><![CDATA[<p><strong>实体类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.academiclink.pojo.form.nodeForm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.annotation.ExcelProperty;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaveTeacher</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;工号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String TNumber;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;工作院校&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String workCollege;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;本科毕业院校&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String UCollege;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;硕士毕业院校&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String MCollege;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;博士毕业院校&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String DCollege;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;研究方向&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String direction;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;专业代码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String major;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;邮箱&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>工具类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.academiclink.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.event.AnalysisEventListener;</span><br><span class="line"><span class="keyword">import</span> com.example.academiclink.pojo.form.nodeForm.SaveTeacher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;SaveTeacher&gt; <span class="title function_">convertExcelToSaveTeacherList</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        List&lt;SaveTeacher&gt; teacherList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义监听器，用于处理每一行数据</span></span><br><span class="line">        AnalysisEventListener&lt;SaveTeacher&gt; listener = <span class="keyword">new</span> <span class="title class_">AnalysisEventListener</span>&lt;SaveTeacher&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(SaveTeacher teacherForm, AnalysisContext context)</span> &#123;</span><br><span class="line">                teacherList.add(teacherForm);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">                <span class="comment">// 解析完成后的操作，这里可以留空</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取 Excel 文件</span></span><br><span class="line">        EasyExcel.read(file.getInputStream(), SaveTeacher.class, listener).sheet().doRead();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> teacherList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> easyExcel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisTemplate调用increment报错问题</title>
      <link href="/2024/03/09/RedisTemplate%E8%B0%83%E7%94%A8increment%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/09/RedisTemplate%E8%B0%83%E7%94%A8increment%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="RedisTemplate调用increment报错问题"><a href="#RedisTemplate调用increment报错问题" class="headerlink" title="RedisTemplate调用increment报错问题"></a>RedisTemplate调用increment报错问题</h3><p><strong>问题描述：</strong></p><p>使用spring redis的increment方法时，报错：nested exception is redis.clients.jedis.exceptions.JedisDataException: ERR value is not an integer or out of range</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForValue().increment(key, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p><strong>修正：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public Long incr(String key, long delta)&#123;</span><br><span class="line">    ValueOperations&lt;String, String&gt; operations = commonRedisTemplate.opsForValue();</span><br><span class="line">    commonRedisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">    commonRedisTemplate.setValueSerializer(new StringRedisSerializer());</span><br><span class="line">    return operations.increment(key, delta);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>错误原因：</strong></p><p>key对应的值不为数字，不能进行递增操作。通过查看RedisTemplate源码发现，其默认的序列化器为JdkSerializationRedisSerializer，猜想是否是序列化器进行序列化的时候，将key对应的value序列化为了字符串。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   boolean defaultUsed = false;</span><br><span class="line">   if (defaultSerializer == null) &#123;</span><br><span class="line">       defaultSerializer = new JdkSerializationRedisSerializer(</span><br><span class="line">       classLoader != null ? classLoader : this.getClass().getClassLoader());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   if (enableDefaultSerializer) &#123;</span><br><span class="line">       if (keySerializer == null) &#123;</span><br><span class="line">           keySerializer = defaultSerializer;</span><br><span class="line">           defaultUsed = true;</span><br><span class="line">       &#125;</span><br><span class="line">   if (valueSerializer == null) &#123;</span><br><span class="line">       valueSerializer = defaultSerializer;</span><br><span class="line">       defaultUsed = true;</span><br><span class="line">   &#125;</span><br><span class="line">   if (hashKeySerializer == null) &#123;</span><br><span class="line">       hashKeySerializer = defaultSerializer;</span><br><span class="line">       defaultUsed = true;</span><br><span class="line">   &#125;</span><br><span class="line">   if (hashValueSerializer == null) &#123;</span><br><span class="line">       hashValueSerializer = defaultSerializer;</span><br><span class="line">   defaultUsed = true;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>GenericJackson2JsonRedisSerializer、Jackson2JsonRedisSerializer是先将对象转为json，然后再保存到redis，所以，1在redis中是字符串1，所以无法进行加1。</p></li><li><p>JdkSerializationRedisSerializer使用的jdk对象序列化，序列化后的值有类信息、版本号等，所以是一个包含很多字母的字符串，所以根本无法加1。</p></li><li><p>GenericToStringSerializer、StringRedisSerializer将字符串的值直接转为字节数组，所以保存到redis中是数字，所以可以进行加1</p></li></ol><p><strong>完整代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类：实现限流校验</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessLimitAspect</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long <span class="title function_">incr</span><span class="params">(String key, <span class="type">long</span> delta)</span>&#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> operations.increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这里我们使用注解的形式</span></span><br><span class="line"><span class="comment">     * 当然，我们也可以通过切点表达式直接指定需要拦截的package,需要拦截的class 以及 method</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.rexlee.coursehelper_springboot.annotation.RateLimit)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">limitPointCut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;limitPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 获取被注解的方法</span></span><br><span class="line">        <span class="type">MethodInvocationProceedingJoinPoint</span> <span class="variable">mjp</span> <span class="operator">=</span> (MethodInvocationProceedingJoinPoint) pjp;</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) mjp.getSignature();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取方法上的注解</span></span><br><span class="line">        <span class="type">RateLimit</span> <span class="variable">rateLimit</span> <span class="operator">=</span> method.getAnnotation(RateLimit.class);</span><br><span class="line">        <span class="keyword">if</span> (rateLimit == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果没有注解，则继续调用，不做任何处理</span></span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 代码走到这里，说明有 RateLimit 注解，那么就需要做限流校验了</span></span><br><span class="line"><span class="comment">         *  1、这里可以使用Redis的API做计数校验</span></span><br><span class="line"><span class="comment">         *  2、这里也可以使用Lua脚本做计数校验，都可以</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//获取request对象</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> attributes.getRequest();</span><br><span class="line">        <span class="comment">// 获取请求IP地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> getIpAddr(request);</span><br><span class="line">        <span class="comment">// 请求url路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        <span class="comment">//存到redis中的key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;RateLimit:&quot;</span> + ip + <span class="string">&quot;:&quot;</span> + uri;</span><br><span class="line">        <span class="comment">// 缓存中存在key，在限定访问周期内已经调用过当前接口</span></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            <span class="comment">// 超出访问次数限制</span></span><br><span class="line">            <span class="keyword">if</span> (Integer.parseInt(redisTemplate.opsForValue().get(key)) &gt; rateLimit.count()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RateLimitException</span>(rateLimit.msg());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 访问次数自增1</span></span><br><span class="line">            incr(key,<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//redisTemplate.opsForValue().increment(key, 1);</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第一次设置数据,过期时间为注解确定的访问周期</span></span><br><span class="line">            redisTemplate.opsForValue().set(key, <span class="string">&quot;1&quot;</span>, rateLimit.cycle(), TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//获取请求的归属IP地址</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getIpAddr</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ipAddress = request.getHeader(<span class="string">&quot;x-forwarded-for&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (ipAddress == <span class="literal">null</span> || ipAddress.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getHeader(<span class="string">&quot;Proxy-Client-IP&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ipAddress == <span class="literal">null</span> || ipAddress.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getHeader(<span class="string">&quot;WL-Proxy-Client-IP&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ipAddress == <span class="literal">null</span> || ipAddress.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getRemoteAddr();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照&#x27;,&#x27;分割</span></span><br><span class="line">            <span class="keyword">if</span> (ipAddress != <span class="literal">null</span> &amp;&amp; ipAddress.length() &gt; <span class="number">15</span>) &#123;</span><br><span class="line">                <span class="comment">// = 15</span></span><br><span class="line">                <span class="keyword">if</span> (ipAddress.indexOf(<span class="string">&quot;,&quot;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    ipAddress = ipAddress.substring(<span class="number">0</span>, ipAddress.indexOf(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            ipAddress = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ipAddress;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考链接：<a href="https://juejin.cn/post/6844903681926791182">https://juejin.cn/post/6844903681926791182</a><br>来源：稀土掘金</p>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue引入第三方畅言云评</title>
      <link href="/2024/03/07/Vue%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E7%95%85%E8%A8%80%E4%BA%91%E8%AF%84/"/>
      <url>/2024/03/07/Vue%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E7%95%85%E8%A8%80%E4%BA%91%E8%AF%84/</url>
      
        <content type="html"><![CDATA[<h3 id="Vue引入第三方畅言云评"><a href="#Vue引入第三方畅言云评" class="headerlink" title="Vue引入第三方畅言云评"></a>Vue引入第三方畅言云评</h3><p>针对官网引入方法在Vue中不生效的解决：</p><p>替换成如下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;SOHUCS&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> windows = <span class="variable language_">window</span></span><br><span class="line">    windows.<span class="property">changyan</span> = <span class="literal">undefined</span></span><br><span class="line">    windows.<span class="property">cyan</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    script.<span class="property">src</span> = <span class="string">&#x27;https://changyan.sohu.com/upload/changyan.js&#x27;</span></span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      windows.<span class="property">changyan</span>.<span class="property">api</span>.<span class="title function_">config</span>(&#123; <span class="attr">appid</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">conf</span>: <span class="string">&#x27;xxxxx&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> sc = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    sc.<span class="property">src</span>=<span class="string">&quot;https://cy-cdn.kuaizhan.com/js/??lib/jquery.js,changyan.labs.https.js?appid=cyxbquUKx&quot;</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(sc)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springboot接口防刷限流，Redis、AOP实现</title>
      <link href="/2024/03/07/tools-%E9%98%B2%E6%AD%A2%E8%AF%B7%E6%B1%82%E6%94%BB%E5%87%BB%E6%8E%A5%E5%8F%A3AOP%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/03/07/tools-%E9%98%B2%E6%AD%A2%E8%AF%B7%E6%B1%82%E6%94%BB%E5%87%BB%E6%8E%A5%E5%8F%A3AOP%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="springboot接口服务，防刷、防止请求攻击，AOP实现"><a href="#springboot接口服务，防刷、防止请求攻击，AOP实现" class="headerlink" title="springboot接口服务，防刷、防止请求攻击，AOP实现"></a>springboot接口服务，防刷、防止请求攻击，AOP实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package org.jeecg.common.aspect.annotation;</span><br><span class="line"> </span><br><span class="line">import java.lang.annotation.*;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * 用于防刷限流的注解</span><br><span class="line"> *      默认是5秒内只能调用一次</span><br><span class="line"> */</span><br><span class="line">@Target(&#123; ElementType.METHOD &#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface RateLimit &#123;</span><br><span class="line"> </span><br><span class="line">    /** 限流的key */</span><br><span class="line">    String key() default &quot;limit:&quot;;</span><br><span class="line"> </span><br><span class="line">    /** 周期,单位是秒 */</span><br><span class="line">    int cycle() default 5;</span><br><span class="line"> </span><br><span class="line">    /** 请求次数 */</span><br><span class="line">    int count() default 1;</span><br><span class="line"> </span><br><span class="line">    /** 默认提示信息 */</span><br><span class="line">    String msg() default &quot;请勿重复点击&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="切面类"><a href="#切面类" class="headerlink" title="切面类"></a>切面类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">package com.rexlee.coursehelper_springboot.interceptor;</span><br><span class="line"> </span><br><span class="line">import com.rexlee.coursehelper_springboot.annotation.RateLimit;</span><br><span class="line">import com.rexlee.coursehelper_springboot.exception.RateLimitException;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.aspectj.lang.annotation.Pointcut;</span><br><span class="line">import org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line">import org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.core.ValueOperations;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line">import org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * 切面类：实现限流校验</span><br><span class="line"> */</span><br><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class AccessLimitAspect &#123;</span><br><span class="line"> </span><br><span class="line">    @Resource</span><br><span class="line">    private RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    private Long incr(String key, long delta)&#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new StringRedisSerializer());</span><br><span class="line">        return operations.increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 这里我们使用注解的形式</span><br><span class="line">     * 当然，我们也可以通过切点表达式直接指定需要拦截的package,需要拦截的class 以及 method</span><br><span class="line">     */</span><br><span class="line">    @Pointcut(&quot;@annotation(com.rexlee.coursehelper_springboot.annotation.RateLimit)&quot;)</span><br><span class="line">    public void limitPointCut() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * 环绕通知</span><br><span class="line">     */</span><br><span class="line">    @Around(&quot;limitPointCut()&quot;)</span><br><span class="line">    public Object around(ProceedingJoinPoint pjp) throws Throwable &#123;</span><br><span class="line">        // 获取被注解的方法</span><br><span class="line">        MethodInvocationProceedingJoinPoint mjp = (MethodInvocationProceedingJoinPoint) pjp;</span><br><span class="line">        MethodSignature signature = (MethodSignature) mjp.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line"> </span><br><span class="line">        // 获取方法上的注解</span><br><span class="line">        RateLimit rateLimit = method.getAnnotation(RateLimit.class);</span><br><span class="line">        if (rateLimit == null) &#123;</span><br><span class="line">            // 如果没有注解，则继续调用，不做任何处理</span><br><span class="line">            return pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line">        /**</span><br><span class="line">         * 代码走到这里，说明有 RateLimit 注解，那么就需要做限流校验了</span><br><span class="line">         *  1、这里可以使用Redis的API做计数校验</span><br><span class="line">         *  2、这里也可以使用Lua脚本做计数校验，都可以</span><br><span class="line">         */</span><br><span class="line">        //获取request对象</span><br><span class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = attributes.getRequest();</span><br><span class="line">        // 获取请求IP地址</span><br><span class="line">        String ip = getIpAddr(request);</span><br><span class="line">        // 请求url路径</span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        //存到redis中的key</span><br><span class="line">        String key = &quot;RateLimit:&quot; + ip + &quot;:&quot; + uri;</span><br><span class="line">        // 缓存中存在key，在限定访问周期内已经调用过当前接口</span><br><span class="line">        if (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            // 超出访问次数限制</span><br><span class="line">            if (Integer.parseInt(redisTemplate.opsForValue().get(key)) &gt; rateLimit.count()) &#123;</span><br><span class="line">                throw new RateLimitException(rateLimit.msg());</span><br><span class="line">            &#125;</span><br><span class="line">            // 访问次数自增1</span><br><span class="line">            incr(key,1);</span><br><span class="line">            //redisTemplate.opsForValue().increment(key, 1);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 第一次设置数据,过期时间为注解确定的访问周期</span><br><span class="line">            redisTemplate.opsForValue().set(key, &quot;1&quot;, rateLimit.cycle(), TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">        return pjp.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    //获取请求的归属IP地址</span><br><span class="line">    private String getIpAddr(HttpServletRequest request) &#123;</span><br><span class="line">        String ipAddress = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            ipAddress = request.getHeader(&quot;x-forwarded-for&quot;);</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getHeader(&quot;Proxy-Client-IP&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getHeader(&quot;WL-Proxy-Client-IP&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span class="line">                ipAddress = request.getRemoteAddr();</span><br><span class="line">            &#125;</span><br><span class="line">            // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照&#x27;,&#x27;分割</span><br><span class="line">            if (ipAddress != null &amp;&amp; ipAddress.length() &gt; 15) &#123;</span><br><span class="line">                // = 15</span><br><span class="line">                if (ipAddress.indexOf(&quot;,&quot;) &gt; 0) &#123;</span><br><span class="line">                    ipAddress = ipAddress.substring(0, ipAddress.indexOf(&quot;,&quot;));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            ipAddress = &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return ipAddress;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RedisUtil工具类"><a href="#RedisUtil工具类" class="headerlink" title="RedisUtil工具类"></a>RedisUtil工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rexlee.coursehelper_springboot.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.RedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取锁</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> expireTime：单位-秒</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getLock</span><span class="params">(String lockKey, Object value, <span class="type">int</span> expireTime)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;setNx&#x27;,KEYS[1],ARGV[1]) then if redis.call(&#x27;get&#x27;,KEYS[1])==ARGV[1] then return redis.call(&#x27;expire&#x27;,KEYS[1],ARGV[2]) else return 0 end end&quot;</span>;</span><br><span class="line">RedisScript&lt;String&gt; redisScript = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, String.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(redisScript, Collections.singletonList(lockKey), value, expireTime);</span><br><span class="line"><span class="keyword">if</span> (SUCCESS.equals(result)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 释放锁</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">releaseLock</span><span class="params">(String lockKey, String value)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">RedisScript&lt;String&gt; redisScript = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, String.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(redisScript, Collections.singletonList(lockKey), value);</span><br><span class="line"><span class="keyword">if</span> (SUCCESS.equals(result)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** common start ****************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定缓存失效时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">expire</span><span class="params">(String key, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getExpire</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断key是否存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String... key)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (key != <span class="literal">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">redisTemplate.delete((Collection&lt;String&gt;) CollectionUtils.arrayToList(key));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************** common end ****************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** String start ****************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通缓存获取</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> key == <span class="literal">null</span> ? <span class="literal">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通缓存放入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">set</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForValue().set(key, value);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">set</span><span class="params">(String key, Object value, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">set(key, value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递增</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> delta 要增加几(大于0)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">incr</span><span class="params">(String key, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;递增因子必须大于0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递减</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> delta 要减少几(小于0)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">decr</span><span class="params">(String key, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;递减因子必须大于0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************** String end ****************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** Map start ****************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashGet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">hget</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title function_">hmget</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashSet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashSet 并设置时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">expire(key, time);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hset</span><span class="params">(String key, String item, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hset</span><span class="params">(String key, String item, Object value, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">expire(key, time);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除hash表中的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hdel</span><span class="params">(String key, Object... item)</span> &#123;</span><br><span class="line">redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hHasKey</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> by 要增加几(大于0)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hincr</span><span class="params">(String key, String item, <span class="type">long</span> by)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hash递减</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> by 要减少记(小于0)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hdecr</span><span class="params">(String key, String item, <span class="type">long</span> by)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** Map end ****************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** Set start ****************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">sGet</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sHasKey</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数据放入set缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sSet</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将set数据放入缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sSetAndTime</span><span class="params">(String key, <span class="type">long</span> time, Object... values)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">expire(key, time);</span><br><span class="line"><span class="keyword">return</span> count;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取set缓存的长度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sGetSetSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除值为value的</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">setRemove</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForSet().remove(key, values);</span><br><span class="line"><span class="keyword">return</span> count;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** Set end ****************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** List start ****************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取list缓存的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> end 结束 0 到 -1代表所有值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">lGet</span><span class="params">(String key, <span class="type">long</span> start, <span class="type">long</span> end)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取list缓存的长度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">lGetListSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">lGetIndex</span><span class="params">(String key, <span class="type">long</span> index)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将list放入缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lSet</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将list放入缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lSet</span><span class="params">(String key, Object value, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">expire(key, time);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将list放入缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将list放入缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="type">long</span> time)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line"><span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">expire(key, time);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lUpdateIndex</span><span class="params">(String key, <span class="type">long</span> index, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">redisTemplate.opsForList().set(key, index, value);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除N个值为value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">lRemove</span><span class="params">(String key, <span class="type">long</span> count, Object value)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">remove</span> <span class="operator">=</span> redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line"><span class="keyword">return</span> remove;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************** List end ****************/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> 限流 </tag>
            
            <tag> aop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排错记录：maven打包失败 | mysql权限</title>
      <link href="/2024/03/06/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/06/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p><strong>mvn package 打包失败</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">There are test failures.</span><br><span class="line"></span><br><span class="line">java.lang.IllegalStateException: Failed to load ApplicationContext</span><br><span class="line">Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;commentsController&#x27;: Unsatisfied dependency expressed through field &#x27;commentsService&#x27;; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;commentsServiceImpl&#x27;: Unsatisfied dependency expressed through field &#x27;baseMapper&#x27;; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;commentsMapper&#x27; defined in file </span><br><span class="line">......</span><br><span class="line">Caused by: org.springframework.boot.autoconfigure.jdbc.DataSourceProperties$DataSourceBeanCreationException: Failed to determine a suitable driver class</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] Results:</span><br><span class="line">[INFO] </span><br><span class="line">[ERROR] Errors: </span><br><span class="line">[ERROR]   CoursehelperSpringbootApplicationTests.contextLoads » IllegalState Failed to l...</span><br><span class="line">[INFO] </span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0</span><br><span class="line">[INFO] </span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>先mvn clean后本地运行项目</li><li>运行起来后会生成一个target目录</li><li>此时mvn test能通过 mvn package打包成功</li></ol><p><strong>Could not get JDBC Connection</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.jdbc.CannotGetJdbcConnectionException:</span><br><span class="line">Could not get JDBC Connection; nested exception is org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (Could not create connection to database server.)</span><br><span class="line">The error may exist in mappers/AdminDao.xml</span><br><span class="line">The error may involve dao.admin.AdminDao.login</span><br><span class="line">The error occurred while executing a query……</span><br></pre></td></tr></table></figure></p><ol><li>检查配置信息</li><li>检查驱动版本和mysql版本是否对应</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2024-03-06 20:47:16.007 ERROR 47260 --- [nio-8181-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)</span><br><span class="line">### The error may exist in file [D:\Java_code\CourseHelper\coursehelper_springboot\target\classes\com\rexlee\coursehelper_springboot\mapper\xml\CommentsMapper.xml]</span><br><span class="line">### The error may involve com.rexlee.coursehelper_springboot.mapper.CommentsMapper.selectAllCourse</span><br><span class="line">### The error occurred while executing a query</span><br><span class="line">### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)] with root cause</span><br><span class="line"></span><br><span class="line">java.sql.SQLException: Access denied for user &#x27;root&#x27;@&#x27;182.106.212.146&#x27; (using password: YES)</span><br><span class="line">at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:957) ~[mysql-connector-java-5.1.38.jar:5.1.38]......</span><br></pre></td></tr></table></figure><ol><li><p>程序中数据库用户名和密码与数据库不一致；</p></li><li><p>数据库权限不够；</p><p>权限不足解决方案：</p><p>grant语句正确的修改数据库对应的权限：</p><p>为root用户下的safemanage数据库中所有表赋予全部权限：</p><p>GRANT ALL PRIVILEGES ON safemanage.* TO root@’127.0.0.1’ IDENTIFIED BY ‘root’;<br>为root用户下的safemanage数据库中user表赋予全部权限：</p><p>GRANT ALL PRIVILEGES ON safemanage.user TO root@’127.0.0.1’ IDENTIFIED BY ‘root’;</p></li></ol><p>   宝塔面板可在phpAdmin-用户中编辑用户权限</p><p>   <strong>记得重启mysql服务</strong></p>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Slf4j+AOP请求日志模板</title>
      <link href="/2024/03/01/tools-%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97%E6%A8%A1%E6%9D%BF/"/>
      <url>/2024/03/01/tools-%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求响应日志 AOP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行拦截</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.yupi.springbootinit.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doInterceptor</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 计时</span></span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        <span class="comment">// 获取请求路径</span></span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.currentRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class="line">        <span class="comment">// 生成请求唯一 id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> httpServletRequest.getRequestURI();</span><br><span class="line">        <span class="comment">// 获取请求参数</span></span><br><span class="line">        Object[] args = point.getArgs();</span><br><span class="line">        <span class="type">String</span> <span class="variable">reqParam</span> <span class="operator">=</span> <span class="string">&quot;[&quot;</span> + StringUtils.join(args, <span class="string">&quot;, &quot;</span>) + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        <span class="comment">// 输出请求日志</span></span><br><span class="line">        log.info(<span class="string">&quot;request start，id: &#123;&#125;, path: &#123;&#125;, ip: &#123;&#125;, params: &#123;&#125;&quot;</span>, requestId, url,</span><br><span class="line">                httpServletRequest.getRemoteHost(), reqParam);</span><br><span class="line">        <span class="comment">// 执行原方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">        <span class="comment">// 输出响应日志</span></span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalTimeMillis</span> <span class="operator">=</span> stopWatch.getTotalTimeMillis();</span><br><span class="line">        log.info(<span class="string">&quot;request end, id: &#123;&#125;, cost: &#123;&#125;ms&quot;</span>, requestId, totalTimeMillis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aop </tag>
            
            <tag> slf4j </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AOP+自定义注解实现简单权限校验模板</title>
      <link href="/2024/03/01/tools-%E7%AE%80%E5%8D%95%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E6%A8%A1%E6%9D%BF/"/>
      <url>/2024/03/01/tools-%E7%AE%80%E5%8D%95%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h4 id="annotation"><a href="#annotation" class="headerlink" title="annotation"></a>annotation</h4><p>AuthCheck.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限校验</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AuthCheck &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须有某个角色</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">mustRole</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h4 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h4><p>UserRoleEnum.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.model.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ObjectUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户角色枚举</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserRoleEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    USER(<span class="string">&quot;用户&quot;</span>, <span class="string">&quot;user&quot;</span>),</span><br><span class="line">    ADMIN(<span class="string">&quot;管理员&quot;</span>, <span class="string">&quot;admin&quot;</span>),</span><br><span class="line">    BAN(<span class="string">&quot;被封号&quot;</span>, <span class="string">&quot;ban&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">    UserRoleEnum(String text, String value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.text = text;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取值列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(values()).map(item -&gt; item.value).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 value 获取枚举</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserRoleEnum <span class="title function_">getEnumByValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (UserRoleEnum anEnum : UserRoleEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (anEnum.value.equals(value)) &#123;</span><br><span class="line">                <span class="keyword">return</span> anEnum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h4 id="aop"><a href="#aop" class="headerlink" title="aop"></a>aop</h4><p>AuthInterceptor.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.springbootinit.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.annotation.AuthCheck;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.common.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.model.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.model.enums.UserRoleEnum;</span><br><span class="line"><span class="keyword">import</span> com.yupi.springbootinit.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限校验 AOP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行拦截</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authCheck</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(authCheck)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doInterceptor</span><span class="params">(ProceedingJoinPoint joinPoint, AuthCheck authCheck)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mustRole</span> <span class="operator">=</span> authCheck.mustRole();</span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.currentRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class="line">        <span class="comment">// 当前登录用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userService.getLoginUser(request);</span><br><span class="line">        <span class="comment">// 必须有该权限才通过</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(mustRole)) &#123;</span><br><span class="line">            <span class="type">UserRoleEnum</span> <span class="variable">mustUserRoleEnum</span> <span class="operator">=</span> UserRoleEnum.getEnumByValue(mustRole);</span><br><span class="line">            <span class="keyword">if</span> (mustUserRoleEnum == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userRole</span> <span class="operator">=</span> loginUser.getUserRole();</span><br><span class="line">            <span class="comment">// 如果被封号，直接拒绝</span></span><br><span class="line">            <span class="keyword">if</span> (UserRoleEnum.BAN.equals(mustUserRoleEnum)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 必须有管理员权限</span></span><br><span class="line">            <span class="keyword">if</span> (UserRoleEnum.ADMIN.equals(mustUserRoleEnum)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mustRole.equals(userRole)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 通过权限校验，放行</span></span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> aop </tag>
            
            <tag> 权限校验 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据分析-微信聊天记录可视化分析</title>
      <link href="/2024/02/06/%5B%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%5D%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2024/02/06/%5B%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%5D%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><strong>大致效果：</strong><br><img src="https://s3.bmp.ovh/imgs/2024/02/08/a051816056755cb2.png" alt=""></p><h3 id="数据来源"><a href="#数据来源" class="headerlink" title="数据来源"></a>数据来源</h3><p>用github“留痕”工具导出微信聊天记录txt文档<br>指路：<a href="https://github.com/LC044/WeChatMsg">https://github.com/LC044/WeChatMsg</a><br><img src="https://i0.hdslb.com/bfs/new_dyn/f430a6c20f99b89806d8b07c7619622a352904479.jpg" alt=""></p><h3 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h3><p>主要采用pyecharts、jieba库</p><h4 id="词云图"><a href="#词云图" class="headerlink" title="词云图"></a>词云图</h4><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/b8e5b08be1d21da1.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> options <span class="keyword">as</span> opts</span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> WordCloud</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取txt文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    text = file.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分词</span></span><br><span class="line">jieba.load_userdict(<span class="string">&#x27;custom_dict.txt&#x27;</span>)  <span class="comment"># 加载自定义词典</span></span><br><span class="line">words = jieba.cut(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停用词</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stopwords.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    stop_words = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> file.readlines()]</span><br><span class="line"><span class="comment"># 去除长度小于2的词语和停用词</span></span><br><span class="line">words = [word <span class="keyword">for</span> word <span class="keyword">in</span> words <span class="keyword">if</span> <span class="built_in">len</span>(word) &gt;= <span class="number">2</span> <span class="keyword">and</span> word <span class="keyword">not</span> <span class="keyword">in</span> stop_words]</span><br><span class="line"><span class="comment"># 去除符号和数字</span></span><br><span class="line">words = [re.sub(<span class="string">r&#x27;[^\u4e00-\u9fa5]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, word) <span class="keyword">for</span> word <span class="keyword">in</span> words]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计词频</span></span><br><span class="line">word_counts = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    <span class="keyword">if</span> word != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> word_counts:</span><br><span class="line">            word_counts[word] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            word_counts[word] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按词频排序</span></span><br><span class="line">sorted_words = <span class="built_in">sorted</span>(word_counts.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取前200个词</span></span><br><span class="line">top_words = sorted_words[:<span class="number">200</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换成pyecharts需要的数据格式</span></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> word, count <span class="keyword">in</span> top_words:</span><br><span class="line">    data.append((word, count))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw</span> ():</span><br><span class="line">    wc = (</span><br><span class="line">        WordCloud()</span><br><span class="line">            .add(series_name=<span class="string">&quot;聊天记录词云图&quot;</span>, data_pair=data, word_size_range=[<span class="number">10</span>, <span class="number">50</span>])</span><br><span class="line">            .set_global_opts(</span><br><span class="line">            tooltip_opts=opts.TooltipOpts(is_show=<span class="literal">True</span>),</span><br><span class="line">        )</span><br><span class="line">        .render(<span class="string">&quot;wordcloud.html&quot;</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">draw()</span><br></pre></td></tr></table></figure></p><h4 id="部分词频统计"><a href="#部分词频统计" class="headerlink" title="部分词频统计"></a>部分词频统计</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取txt文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    text = file.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分词</span></span><br><span class="line">jieba.load_userdict(<span class="string">&#x27;custom_dict2.txt&#x27;</span>)  <span class="comment"># 加载自定义词典</span></span><br><span class="line">words = jieba.lcut(text)</span><br><span class="line"></span><br><span class="line">word_counts = &#123;<span class="string">&#x27;表情包&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;语音&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;图片&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    <span class="keyword">if</span> word <span class="keyword">in</span> [<span class="string">&#x27;表情包&#x27;</span>, <span class="string">&#x27;语音&#x27;</span>, <span class="string">&#x27;图片&#x27;</span>]:</span><br><span class="line">        word_counts[word] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(word_counts)</span><br></pre></td></tr></table></figure><h4 id="统计聊天频次和活跃日期、时间"><a href="#统计聊天频次和活跃日期、时间" class="headerlink" title="统计聊天频次和活跃日期、时间"></a>统计聊天频次和活跃日期、时间</h4><p>聊天数据大致结构为<br>2023-03-19 22:50:27 昵称<br>聊天信息<br>…</p><p>2023-03-19 22:50:29 昵称<br>聊天信息</p><p><strong>可通过时间信息提取出聊天频次，活跃时间等信息</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">dates = &#123;&#125;</span><br><span class="line">counts = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">times = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines = file.readlines()</span><br><span class="line"></span><br><span class="line">date_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取信息</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    <span class="keyword">match</span> = date_pattern.<span class="keyword">match</span>(line)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        date = line[:<span class="number">10</span>]</span><br><span class="line">        time = line[<span class="number">11</span>:<span class="number">16</span>]</span><br><span class="line">        nickname = line[<span class="number">20</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> date <span class="keyword">in</span> dates:</span><br><span class="line">            dates[date] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dates[date] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> time <span class="keyword">in</span> times:</span><br><span class="line">            times[time] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            times[time] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> nickname == <span class="string">&#x27;乖乖茜茜&#x27;</span>:</span><br><span class="line">            counts[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            counts[<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t, count <span class="keyword">in</span> times.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;t&#125;</span>: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">data = [[datetime.datetime.strptime(date, <span class="string">&quot;%Y-%m-%d&quot;</span>).date(), count] <span class="keyword">for</span> date, count <span class="keyword">in</span> dates.items()]</span><br></pre></td></tr></table></figure></p><h4 id="绘制聊天时刻分布图"><a href="#绘制聊天时刻分布图" class="headerlink" title="绘制聊天时刻分布图"></a>绘制聊天时刻分布图</h4><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/e857dc3204b1eab7.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">draw_frequency_bar</span>(<span class="params">times</span>):</span><br><span class="line">    sorted_times = <span class="built_in">sorted</span>(times.items(), key=<span class="keyword">lambda</span> x: datetime.datetime.strptime(x[<span class="number">0</span>], <span class="string">&quot;%H:%M&quot;</span>))</span><br><span class="line">    x_data = [x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sorted_times]</span><br><span class="line">    y_data = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sorted_times]</span><br><span class="line">    bar = (</span><br><span class="line">        Bar()</span><br><span class="line">            .add_xaxis(x_data)</span><br><span class="line">            .add_yaxis(<span class="string">&quot;&quot;</span>, y_data)</span><br><span class="line">            .set_global_opts(</span><br><span class="line">            title_opts=opts.TitleOpts(title=<span class="string">&quot;聊天时刻分布图&quot;</span>),</span><br><span class="line">            xaxis_opts=opts.AxisOpts(name=<span class="string">&quot;时间&quot;</span>),</span><br><span class="line">            yaxis_opts=opts.AxisOpts(name=<span class="string">&quot;频次&quot;</span>),</span><br><span class="line">        )</span><br><span class="line">            .set_series_opts(label_opts=opts.LabelOpts(is_show=<span class="literal">False</span>))</span><br><span class="line">    )</span><br><span class="line">    bar.render(<span class="string">&quot;frequency_bar.html&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="绘制饼图"><a href="#绘制饼图" class="headerlink" title="绘制饼图"></a>绘制饼图</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">draw_pie</span>(<span class="params">counts</span>):</span><br><span class="line">    labels = [<span class="string">&#x27;CQF&#x27;</span>, <span class="string">&#x27;LRX&#x27;</span>]</span><br><span class="line">    pie = (</span><br><span class="line">        Pie()</span><br><span class="line">            .add(</span><br><span class="line">            series_name=<span class="string">&quot;聊天条数&quot;</span>,</span><br><span class="line">            data_pair=[(labels[i], counts[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))],</span><br><span class="line">            radius=[<span class="string">&quot;30%&quot;</span>, <span class="string">&quot;75%&quot;</span>],</span><br><span class="line">            center=[<span class="string">&quot;50%&quot;</span>, <span class="string">&quot;50%&quot;</span>],</span><br><span class="line">            label_opts=opts.LabelOpts(</span><br><span class="line">                position=<span class="string">&quot;inside&quot;</span>,</span><br><span class="line">                formatter=<span class="string">&quot;&#123;b&#125;: &#123;c&#125;&quot;</span>,</span><br><span class="line">                font_size=<span class="number">12</span>,</span><br><span class="line">                rich=&#123;</span><br><span class="line">                    <span class="string">&quot;a&quot;</span>: &#123;<span class="string">&quot;color&quot;</span>: <span class="string">&quot;#999&quot;</span>, <span class="string">&quot;lineHeight&quot;</span>: <span class="number">22</span>, <span class="string">&quot;align&quot;</span>: <span class="string">&quot;center&quot;</span>&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">            .set_global_opts(</span><br><span class="line">            legend_opts=opts.LegendOpts(</span><br><span class="line">                is_show=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    pie.render(<span class="string">&quot;pie.html&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="绘制日历图"><a href="#绘制日历图" class="headerlink" title="绘制日历图"></a>绘制日历图</h4><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/b5981ee51a11eb13.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绘制日历图</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw_calendar</span>(<span class="params">dates</span>):</span><br><span class="line">    calendar = (</span><br><span class="line">        Calendar()</span><br><span class="line">            .add(<span class="string">&quot;&quot;</span>, dates, calendar_opts=opts.CalendarOpts(range_=[<span class="string">&quot;2023-03&quot;</span>, <span class="string">&quot;2024-02&quot;</span>]))</span><br><span class="line"></span><br><span class="line">            .set_global_opts(</span><br><span class="line">            title_opts=opts.TitleOpts(title=<span class="string">&quot;日历图&quot;</span>),</span><br><span class="line">            visualmap_opts=opts.VisualMapOpts(</span><br><span class="line">                max_=<span class="built_in">max</span>(dates, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])[<span class="number">1</span>],</span><br><span class="line">                min_=<span class="number">0</span>,</span><br><span class="line">                orient=<span class="string">&quot;horizontal&quot;</span>,</span><br><span class="line">                is_piecewise=<span class="literal">True</span>,</span><br><span class="line">                pos_top=<span class="string">&quot;230px&quot;</span>,</span><br><span class="line">                pos_left=<span class="string">&quot;100px&quot;</span>,</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    calendar.render(<span class="string">&quot;calendar.html&quot;</span>)</span><br></pre></td></tr></table></figure></p><h3 id="生成年度报告"><a href="#生成年度报告" class="headerlink" title="生成年度报告"></a>生成年度报告</h3><p>用WeChatMsg工具生成年度报告模板，在此基础上修改样式，添加上述生成的ECharts图表。<br>代码仓库：<br><a href="https://gitee.com/sheepFly03/wechart-report">https://gitee.com/sheepFly03/wechart-report</a></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> 数据分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据分析-奥运会数据集可视化分析</title>
      <link href="/2024/01/06/%5B%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%5D%E5%A5%A5%E8%BF%90%E4%BC%9A%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
      <url>/2024/01/06/%5B%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%5D%E5%A5%A5%E8%BF%90%E4%BC%9A%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a><strong>1 概述</strong></h1><p>奥运会作为世界上最大的体育盛会之一，汇集了来自全球各地的顶尖运动员，每届奥运会都是一个重大的国际体育赛事。随着时间的推移，奥运会的规模、参与国家和地区的数量以及参赛项目的种类都在不断增加和改变。这使得历届奥运会的数据集成为一个非常有价值的资源，供研究人员进行深入的数据分析和探索。</p><p>通过对历届奥运会的数据集进行分析，我们可以深入了解奥运会的发展历程、规模的变化以及参赛项目的演变。这有助于回顾奥林匹克运动的历史，并为未来的奥运会提供经验和参考。同时，我们可以揭示运动员、国家和地区在各个项目中的表现趋势和模式。这有助于发现成功的体育训练方法、优势国家和地区的特点，以及不同项目之间的关联性。</p><h1 id="2-数据描述"><a href="#2-数据描述" class="headerlink" title="2 数据描述"></a><strong>2 数据描述</strong></h1><h2 id="2-1-数据来源"><a href="#2-1-数据来源" class="headerlink" title="2.1 数据来源"></a>2.1 数据来源</h2><p>数据集源自于kaggle平台用户分享，基于证书 CC0: Public Domain 发布，具体信息内容源自<a href="http://www.sports-reference.com/">Sports Reference</a>。</p><p>该数据集整理了从1896年雅典奥运会至2016年里约热内卢奥运会120年的奥林匹克运动会的历史数据。</p><h2 id="2-2-数据特点"><a href="#2-2-数据特点" class="headerlink" title="2.2 数据特点"></a>2.2 数据特点</h2><p>该数据集包含两个文件：</p><ul><li>athlete_events.csv：参赛运动员基本生物数据和奖牌结果</li><li>noc_regions.csv：国家奥委会3个字母的代码与对应国家信息</li></ul><p>需要注意的是，在1896年-1992年期间，冬季奥运会与夏季奥运会都是在同一年举行的。在这之后，冬季与夏季的奥运会被错开举办，冬季奥运会从1994年开始4年举办一次，夏季奥运会从1996开始4年举办一次。</p><h2 id="2-3-属性描述"><a href="#2-3-属性描述" class="headerlink" title="2.3 属性描述"></a>2.3 属性描述</h2><p>文件athlete_events.csv中包含15个字段，每一行代表的是一个参加个人比赛运动员，具体信息如下：</p><p>表1 athlete_events属性描述</p><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>No</strong></th><th style="text-align:left"><strong>属性</strong></th><th style="text-align:left"><strong>数据类型</strong></th><th style="text-align:left"><strong>字段描述</strong></th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">ID</td><td style="text-align:left">Integer</td><td style="text-align:left">给每个运动员的唯一ID</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">Name</td><td style="text-align:left">String</td><td style="text-align:left">运动员名字</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">Sex</td><td style="text-align:left">Integer</td><td style="text-align:left">性别</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">Age</td><td style="text-align:left">Float</td><td style="text-align:left">年龄</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">Height</td><td style="text-align:left">Float</td><td style="text-align:left">身高</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left">Weight</td><td style="text-align:left">Float</td><td style="text-align:left">体重</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left">Team</td><td style="text-align:left">String</td><td style="text-align:left">所代表的国家队</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left">NOC</td><td style="text-align:left">String</td><td style="text-align:left">国家奥委会3个字母的代码</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left">Games</td><td style="text-align:left">String</td><td style="text-align:left">年份与季节</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left">Year</td><td style="text-align:left">Integer</td><td style="text-align:left">比赛年份</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left">Season</td><td style="text-align:left">String</td><td style="text-align:left">比赛季节</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left">City</td><td style="text-align:left">String</td><td style="text-align:left">举办城市</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left">Sport</td><td style="text-align:left">String</td><td style="text-align:left">运动类别</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left">Event</td><td style="text-align:left">String</td><td style="text-align:left">比赛项目</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left">Medal</td><td style="text-align:left">Sring</td><td style="text-align:left">奖牌</td></tr></tbody></table></div><p>文件noc_regions.csv中包含3个字段，具体信息如下：</p><p>表2 noc_regions属性描述</p><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>No</strong></th><th style="text-align:left"><strong>属性</strong></th><th style="text-align:left"><strong>数据类型</strong></th><th style="text-align:left"><strong>字段描述</strong></th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">NOC</td><td style="text-align:left">String</td><td style="text-align:left">国家奥委会3个字母的代码</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">Region</td><td style="text-align:left">String</td><td style="text-align:left">国家</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">Notes</td><td style="text-align:left">String</td><td style="text-align:left">地区</td></tr></tbody></table></div><h2 id="2-4-合并数据集"><a href="#2-4-合并数据集" class="headerlink" title="2.4 合并数据集"></a><a name="_toc155260363"></a>2.4 合并数据集</h2><p>将参赛运动员基本生物数据和奖牌结果与国家信息两个数据集进行合并。使用pd.merge()函数按照‘NOC’列并采用左连接的方式两个数据集进行连接。即以athlete_data为基础，将noc_region中的相应数据合并到athlete_data中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">athlete_data = pd.read_csv(<span class="string">&#x27;athlete_events.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">noc_region = pd.read_csv(<span class="string">&#x27;noc_regions.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = pd.merge(athlete_data, noc_region, on=<span class="string">&#x27;NOC&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/69d16ad31f1691e9.png" alt=""></p><p>图1 athlete_data属性描述</p><h1 id="3-数据分析内容"><a href="#3-数据分析内容" class="headerlink" title="3 数据分析内容"></a>3 <strong>数据分析内容</strong></h1><p>（1）统计2016年夏季奥运会与2014年冬季奥运会各项运动产生金牌占比；</p><p>（2）分析历届奥运会总参数人数变化趋势，用折线图表示；</p><p>（3）统计历史上所有运动员中获得过奖牌/金牌的比例；</p><p>（4）统计历史上获得最多金牌的前十名运动员；</p><p>（5）统计分析我国历届奥运会参数人数变化；</p><p>（6）统计我国历届奥运会获得的奖牌数；</p><p>（7）从奖牌数量统计结果中分析我国优势项目。</p><h1 id="4-数据分析图表"><a href="#4-数据分析图表" class="headerlink" title="4 数据分析图表"></a><strong>4 数据分析图表</strong></h1><p>（1）2016年夏季奥运会与2014年冬季奥运会各项运动产生金牌占比：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/0b99909a2aed4bbe.png" alt=""></p><p>图2 各项运动产生金牌占比</p><p>（2）历届奥运会总参数人数变化趋势：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/bebad4dee8162884.png" alt=""></p><p>图3 历届奥运会参数人数</p><p>（3）历史上所有运动员中获得过奖牌/金牌的比例：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/08/b33063935ba25381.png" alt=""></p><p>图4 奖牌/金牌获奖比例</p><p>（4）获得最多金牌的前十名运动员：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/14/357e4501cded4488.png" alt=""></p><p>图 5 获得金牌数量最多的前十名运动员</p><p>（5）我国历届奥运会参数人数：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/14/f1d97754058269d4.png" alt=""></p><p>图 6 中国历届奥运会参赛人数</p><p>（6）我国历届奥运会获得的奖牌数：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/14/189ccf0db65eb6e2.png" alt=""></p><p>图 7 中国历届奥运会获得的奖牌数</p><p>（7）我国优势项目词云图：</p><p><img src="https://s3.bmp.ovh/imgs/2024/02/14/1c4afc6826026e7e.png" alt=""></p><p>图 8 中国优势项目</p><h1 id="5-数据分析结果"><a href="#5-数据分析结果" class="headerlink" title="5 数据分析结果"></a><strong>5 数据分析结果</strong></h1><p><strong>（1）各运动项目产生的金牌占比</strong></p><p>基于2016年夏奥会和2014年冬奥会统计，田径和游泳是大项，在2016年夏奥会上分别产生了47和34枚金牌；</p><p><strong>（2）历年参赛人数趋势</strong></p><p>从人数来看，每届夏奥会参赛人数都是冬奥会的4-5倍；整体参赛人数是上涨趋势，但由于历史原因也出现过波动，如1916年、1940年、1944年曾因一战，二战停办，1980年莫斯科奥运会层遭遇65个国家抵制。</p><p><strong>（3）获得金牌/奖牌比例</strong></p><p>整个奥运会（包括夏季，冬季奥运会）历史上参赛人数为134732，获得过金牌的运动员只有10413，占比7.7%;</p><p>获得过奖牌（包括金银铜）的运动员有28202人，占比20.93%。</p><p><strong>（4）获得金牌最多的运动员</strong></p><p>排在第一的是美国泳坛名将「菲尔普斯」，截止2016年奥运会总共获得了23枚金牌；博尔特累计获得8枚奥运会金牌。</p><p><strong>（5）我国参赛人数趋势</strong></p><p>从人数上来看，我国两季奥运会参赛人数总体呈现上升趋势；其中，2008年夏季奥运会参赛人数最多，原因为此届夏奥会在我国首都北京举办。</p><p><strong>（6）我国历届奥运会获得的奖牌数分析</strong></p><p>夏季奥运会：1984年7月29日，在第23届洛杉矶奥运会上，射击运动员许海峰获得自选手枪慢射金牌，为中国实现奥运金牌“零的突破”。从图像上看，我国夏季奥运会获得的奖牌数量从1984年开始逐渐呈增长趋势，2008年北京奥运会获得奖牌数量最多，自2000年起，我国金牌数量明显增多。总体上看，奖牌数量增长趋势和参数人数趋势呈正比；</p><p>冬季奥运会：1992年2月10日，在阿尔贝维尔冬奥会上，叶乔波获得短道速滑女子500米银牌，这是中国第一枚冬奥会奖牌。2002年盐湖城冬奥会，杨扬夺得冬奥会女子短道速滑500米比赛的金牌，成为中国第一位冬奥会冠军。此后奖牌数量相对稳定，与参数人数趋势一致。</p><p><strong>（7）分析我国优势项目</strong></p><p>将我国历届获得金牌的运动项目绘制成词云图，出现频次越高在图中表现为字体越大。从词云图中分析可知，我国优势项目有跳水，体操，射击，举重，乒乓球，羽毛球等。</p><h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6 总结"></a><strong>6 总结</strong></h1><p>通过对历届奥运会数据进行可视化呈现和分析，我们能够发现，尽管历史上出现过一些波动和特殊情况，如战争和抵制等，导致奥运会停办或参赛国家减少，但整体上，奥运会参赛人数逐年增加。夏季奥运会的参赛人数通常是冬季奥运会的4-5倍。这表明夏季奥运会在全球范围内的影响力更大，吸引了更多的国家和运动员参与。中国在一些特定的项目上具有明显的优势，参赛人数和奖牌数量总体上也呈增长趋势，这表明中国在奥运会上的竞争力不断提升。未来，我们可以期待中国运动员在奥运会上继续取得更多的成就，并在更多的项目上展现出优秀的表现。</p><p>通过本次数据分析，我对Python数据分析的基础知识有了更全面的了解。我认识到Python在有效的数据分析项目中的作用，能够生成准确的可视化结果。同时，我在编写数据分析代码方面的熟练程度也有所提高，意识到在某些复杂的数据情况下，我仍然存在一些困惑和不足。因此，在接下来的学习中，我将更加深入地学习Python这门科学技术，不仅仅局限于片面的知识，我希望能够更好地掌握Python，以便更好地应用它来辅助我的工作和学习。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据并关联数据集</span></span><br><span class="line">athlete_data = pd.read_csv(<span class="string">&#x27;athlete_events.csv&#x27;</span>)</span><br><span class="line">noc_region = pd.read_csv(<span class="string">&#x27;noc_regions.csv&#x27;</span>)</span><br><span class="line">data = pd.merge(athlete_data, noc_region, on=<span class="string">&#x27;NOC&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">data.head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置字体格式</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step1</span>():</span><br><span class="line">    fig, axes = plt.subplots(nrows=<span class="number">1</span>, ncols=<span class="number">2</span>, figsize=(<span class="number">12</span>, <span class="number">6</span>))</span><br><span class="line">    <span class="comment"># 2016年夏季奥运会金牌占比</span></span><br><span class="line">    temp = data[(data[<span class="string">&#x27;Medal&#x27;</span>]==<span class="string">&#x27;Gold&#x27;</span>) &amp; (data[<span class="string">&#x27;Year&#x27;</span>]==<span class="number">2016</span>) &amp; (data[<span class="string">&#x27;Season&#x27;</span>]==<span class="string">&#x27;Summer&#x27;</span>)]</span><br><span class="line">    event_medal = temp.groupby([<span class="string">&#x27;Sport&#x27;</span>])[<span class="string">&#x27;Event&#x27;</span>].nunique().reset_index()</span><br><span class="line">    event_medal.columns = [<span class="string">&#x27;Sport&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    event_medal = event_medal.sort_values(by=<span class="string">&quot;Nums&quot;</span> , ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">0</span>].pie(event_medal[<span class="string">&#x27;Nums&#x27;</span>], labels=event_medal[<span class="string">&#x27;Sport&#x27;</span>], autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>, startangle=<span class="number">90</span>)</span><br><span class="line">    axes[<span class="number">0</span>].set_title(<span class="string">&#x27;2016年夏季奥运会各项运动产生金牌占比&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2014年冬季奥运会金牌占比</span></span><br><span class="line">    temp = data[(data[<span class="string">&#x27;Medal&#x27;</span>]==<span class="string">&#x27;Gold&#x27;</span>) &amp; (data[<span class="string">&#x27;Year&#x27;</span>]==<span class="number">2014</span>) &amp; (data[<span class="string">&#x27;Season&#x27;</span>]==<span class="string">&#x27;Winter&#x27;</span>)]</span><br><span class="line">    event_medal = temp.groupby([<span class="string">&#x27;Sport&#x27;</span>])[<span class="string">&#x27;Event&#x27;</span>].nunique().reset_index()</span><br><span class="line">    event_medal.columns = [<span class="string">&#x27;Sport&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    event_medal = event_medal.sort_values(by=<span class="string">&quot;Nums&quot;</span> , ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">1</span>].pie(event_medal[<span class="string">&#x27;Nums&#x27;</span>], labels=event_medal[<span class="string">&#x27;Sport&#x27;</span>], autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>, startangle=<span class="number">90</span>)</span><br><span class="line">    axes[<span class="number">1</span>].set_title(<span class="string">&#x27;2014年冬季奥运会各项运动产生金牌占比&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调整子图间的间距</span></span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    <span class="comment"># 显示图像</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2</span>():</span><br><span class="line">    athlete = data.groupby([<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>])[<span class="string">&#x27;Name&#x27;</span>].nunique().reset_index()</span><br><span class="line">    athlete.columns = [<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    athlete = athlete.sort_values(by=<span class="string">&quot;Year&quot;</span>, ascending=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#夏季奥运会，将参赛人数存储在y1_list中; 冬季奥运会，将参赛人数存储在y2_list中</span></span><br><span class="line">    athlete = athlete[athlete[<span class="string">&#x27;Year&#x27;</span>].between(<span class="number">1904</span>, <span class="number">2016</span>)]</span><br><span class="line">    x_list = athlete[<span class="string">&#x27;Year&#x27;</span>]</span><br><span class="line">    y1_list, y2_list = [], []</span><br><span class="line">    <span class="keyword">for</span> _, row <span class="keyword">in</span> athlete.iterrows():</span><br><span class="line">        <span class="keyword">if</span> row[<span class="string">&#x27;Season&#x27;</span>] == <span class="string">&#x27;Summer&#x27;</span>:</span><br><span class="line">            y1_list.append(row[<span class="string">&#x27;Nums&#x27;</span>])</span><br><span class="line">            y2_list.append(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y2_list.append(row[<span class="string">&#x27;Nums&#x27;</span>])</span><br><span class="line">            y1_list.append(<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># 创建画布</span></span><br><span class="line">    fig, ax = plt.subplots(figsize=(<span class="number">12</span>, <span class="number">8</span>))</span><br><span class="line">    <span class="comment"># 忽略y1_list中的None值</span></span><br><span class="line">    y1_list_filtered = [y <span class="keyword">for</span> y <span class="keyword">in</span> y1_list <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    x_list_filtered = [x <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(x_list, y1_list) <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    <span class="comment"># 绘制夏季奥运会参赛人数折线图</span></span><br><span class="line">    ax.plot(x_list_filtered, y1_list_filtered, color=<span class="string">&#x27;green&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>, linestyle=<span class="string">&#x27;-&#x27;</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 忽略y2_list中的None值</span></span><br><span class="line">    y2_list_filtered = [y <span class="keyword">for</span> y <span class="keyword">in</span> y2_list <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    x_list_filtered = [x <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(x_list, y2_list) <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    <span class="comment"># 绘制冬季奥运会参赛人数折线图</span></span><br><span class="line">    ax.plot(x_list_filtered, y2_list_filtered, color=<span class="string">&#x27;red&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>, linestyle=<span class="string">&#x27;-&#x27;</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 添加第一次世界大战和第二次世界大战的标记区域</span></span><br><span class="line">    ax.axvspan(<span class="number">1914</span>, <span class="number">1918</span>, alpha=<span class="number">0.3</span>, color=<span class="string">&#x27;gray&#x27;</span>, label=<span class="string">&#x27;第一次世界大战&#x27;</span>)</span><br><span class="line">    ax.axvspan(<span class="number">1939</span>, <span class="number">1945</span>, alpha=<span class="number">0.6</span>, color=<span class="string">&#x27;gray&#x27;</span>, label=<span class="string">&#x27;第二次世界大战&#x27;</span>)</span><br><span class="line">    ax.set_title(<span class="string">&#x27;历届奥运会参赛人数&#x27;</span>, fontsize=<span class="number">16</span>)</span><br><span class="line">    ax.set_xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">&#x27;参赛人数&#x27;</span>)</span><br><span class="line">    ax.legend()</span><br><span class="line">    plt.xticks(rotation=<span class="number">45</span>)</span><br><span class="line">    plt.yticks()</span><br><span class="line">    <span class="comment"># 显示图像</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step3</span>():</span><br><span class="line">    total_athlete = <span class="built_in">len</span>(<span class="built_in">set</span>(data[<span class="string">&#x27;Name&#x27;</span>]))</span><br><span class="line">    medal_athlete = <span class="built_in">len</span>(<span class="built_in">set</span>(data[<span class="string">&#x27;Name&#x27;</span>][data[<span class="string">&#x27;Medal&#x27;</span>].isin([<span class="string">&#x27;Gold&#x27;</span>, <span class="string">&#x27;Silver&#x27;</span>, <span class="string">&#x27;Bronze&#x27;</span>])]))</span><br><span class="line">    gold_athlete = <span class="built_in">len</span>(<span class="built_in">set</span>(data[<span class="string">&#x27;Name&#x27;</span>][data[<span class="string">&#x27;Medal&#x27;</span>] == <span class="string">&#x27;Gold&#x27;</span>]))</span><br><span class="line">    <span class="comment"># 计算比例</span></span><br><span class="line">    medal_ratio = medal_athlete / total_athlete</span><br><span class="line">    gold_ratio = gold_athlete / total_athlete</span><br><span class="line">    <span class="comment"># 创建画布</span></span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">12</span>, <span class="number">6</span>))</span><br><span class="line">    <span class="comment"># 绘制获得奖牌比例</span></span><br><span class="line">    axs[<span class="number">0</span>].pie([medal_ratio, <span class="number">1</span> - medal_ratio], colors=[<span class="string">&#x27;#4682B4&#x27;</span>, <span class="string">&#x27;#D3D3D3&#x27;</span>], startangle=<span class="number">90</span>, counterclock=<span class="literal">False</span>)</span><br><span class="line">    axs[<span class="number">0</span>].text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="string">f&#x27;<span class="subst">&#123;medal_ratio:<span class="number">.2</span>%&#125;</span>&#x27;</span>, fontsize=<span class="number">20</span>, color=<span class="string">&#x27;white&#x27;</span>, ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">    axs[<span class="number">0</span>].set_title(<span class="string">&#x27;获得过奖牌比例&#x27;</span>)</span><br><span class="line">    <span class="comment"># 绘制获得金牌比例</span></span><br><span class="line">    axs[<span class="number">1</span>].pie([gold_ratio, <span class="number">1</span> - gold_ratio], colors=[<span class="string">&#x27;#FFD700&#x27;</span>, <span class="string">&#x27;#D3D3D3&#x27;</span>], startangle=<span class="number">90</span>, counterclock=<span class="literal">False</span>)</span><br><span class="line">    axs[<span class="number">1</span>].text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="string">f&#x27;<span class="subst">&#123;gold_ratio:<span class="number">.2</span>%&#125;</span>&#x27;</span>, fontsize=<span class="number">20</span>, color=<span class="string">&#x27;white&#x27;</span>, ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">    axs[<span class="number">1</span>].set_title(<span class="string">&#x27;获得过金牌比例&#x27;</span>)</span><br><span class="line">    <span class="comment"># 显示图表</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step4</span>():</span><br><span class="line">    temp = data[(data[<span class="string">&#x27;Medal&#x27;</span>] == <span class="string">&#x27;Gold&#x27;</span>)]</span><br><span class="line">    athlete = temp.groupby([<span class="string">&#x27;Name&#x27;</span>])[<span class="string">&#x27;Medal&#x27;</span>].count().reset_index()</span><br><span class="line">    athlete.columns = [<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    athlete = athlete.sort_values(by=<span class="string">&quot;Nums&quot;</span>, ascending=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选择最多金牌的前10名运动员</span></span><br><span class="line">    top_10_athletes = athlete.tail(<span class="number">10</span>).sort_values(<span class="string">&#x27;Nums&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 创建画布</span></span><br><span class="line">    fig, ax = plt.subplots(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">    <span class="comment"># 绘制柱状图</span></span><br><span class="line">    ax.barh(np.arange(<span class="built_in">len</span>(top_10_athletes)), top_10_athletes[<span class="string">&#x27;Nums&#x27;</span>], height=<span class="number">0.5</span>, color=<span class="string">&#x27;#FF6347&#x27;</span>)</span><br><span class="line">    <span class="comment"># 设置 y 轴标签</span></span><br><span class="line">    ax.set_yticks(np.arange(<span class="built_in">len</span>(top_10_athletes)))</span><br><span class="line">    ax.set_yticklabels([x.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\n&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> top_10_athletes[<span class="string">&#x27;Name&#x27;</span>]])</span><br><span class="line">    ax.tick_params(axis=<span class="string">&#x27;y&#x27;</span>, labelsize=<span class="number">8</span>)</span><br><span class="line">    <span class="comment"># 设置 x 轴标签和标题</span></span><br><span class="line">    ax.set_xlabel(<span class="string">&#x27;获得金牌数量&#x27;</span>)</span><br><span class="line">    ax.set_title(<span class="string">&#x27;获得金牌数量最多的运动员&#x27;</span>)</span><br><span class="line">    <span class="comment"># 反转 y 轴</span></span><br><span class="line">    ax.invert_yaxis()</span><br><span class="line">    <span class="comment"># 隐藏坐标轴线和刻度</span></span><br><span class="line">    ax.spines[<span class="string">&#x27;top&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax.spines[<span class="string">&#x27;right&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax.tick_params(axis=<span class="string">&#x27;both&#x27;</span>, which=<span class="string">&#x27;both&#x27;</span>, length=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 添加数据标签</span></span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(top_10_athletes[<span class="string">&#x27;Nums&#x27;</span>]):</span><br><span class="line">        ax.text(num, i, <span class="built_in">str</span>(num), ha=<span class="string">&#x27;left&#x27;</span>, va=<span class="string">&#x27;center&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    <span class="comment"># 显示图表</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"></span><br><span class="line">athlete_data = pd.read_csv(<span class="string">&#x27;athlete_events.csv&#x27;</span>)</span><br><span class="line">noc_region = pd.read_csv(<span class="string">&#x27;noc_regions.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关联代表国家</span></span><br><span class="line">data = pd.merge(athlete_data, noc_region, on=<span class="string">&#x27;NOC&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">data.head()</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">CN_data = data[data.region == <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(CN_data.head())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step1</span>():</span><br><span class="line">    <span class="comment"># 数据准备</span></span><br><span class="line">    athlete = CN_data.groupby([<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>])[<span class="string">&#x27;Name&#x27;</span>].nunique().reset_index()</span><br><span class="line">    athlete.columns = [<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    athlete = athlete.sort_values(by=<span class="string">&quot;Year&quot;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">    year_summer = [row[<span class="string">&#x27;Year&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> athlete[athlete.Season == <span class="string">&#x27;Summer&#x27;</span>].iterrows()]</span><br><span class="line">    nums_summer = [row[<span class="string">&#x27;Nums&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> athlete[athlete.Season == <span class="string">&#x27;Summer&#x27;</span>].iterrows()]</span><br><span class="line">    year_winter = [row[<span class="string">&#x27;Year&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> athlete[athlete.Season == <span class="string">&#x27;Winter&#x27;</span>].iterrows()]</span><br><span class="line">    nums_winter = [row[<span class="string">&#x27;Nums&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> athlete[athlete.Season == <span class="string">&#x27;Winter&#x27;</span>].iterrows()]</span><br><span class="line">    <span class="comment"># 创建画布和子图</span></span><br><span class="line">    fig, (ax1, ax2) = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=(<span class="number">10</span>, <span class="number">8</span>))</span><br><span class="line">    <span class="comment"># 绘制夏奥会参赛人数柱状图</span></span><br><span class="line">    ax1.bar(year_summer, nums_summer)</span><br><span class="line">    ax1.set_xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">    ax1.set_ylabel(<span class="string">&#x27;参赛人数&#x27;</span>)</span><br><span class="line">    ax1.set_title(<span class="string">&#x27;中国历年奥运会参赛人数-夏奥会&#x27;</span>)</span><br><span class="line">    ax1.set_xticks(year_summer)</span><br><span class="line">    ax1.tick_params(axis=<span class="string">&#x27;x&#x27;</span>, rotation=<span class="number">45</span>)</span><br><span class="line">    ax1.spines[<span class="string">&#x27;top&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax1.spines[<span class="string">&#x27;right&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax1.grid(axis=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="comment"># 显示人数标签</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(year_summer)):</span><br><span class="line">        ax1.text(year_summer[i], nums_summer[i], <span class="built_in">str</span>(nums_summer[i]), ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">    <span class="comment"># 绘制冬奥会参赛人数柱状图</span></span><br><span class="line">    ax2.bar(year_winter, nums_winter)</span><br><span class="line">    ax2.set_xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="string">&#x27;参赛人数&#x27;</span>)</span><br><span class="line">    ax2.set_title(<span class="string">&#x27;中国历年奥运会参赛人数-冬奥会&#x27;</span>)</span><br><span class="line">    ax2.set_xticks(year_winter)</span><br><span class="line">    ax2.tick_params(axis=<span class="string">&#x27;x&#x27;</span>, rotation=<span class="number">45</span>)</span><br><span class="line">    ax2.spines[<span class="string">&#x27;top&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax2.spines[<span class="string">&#x27;right&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">    ax2.grid(axis=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="comment"># 显示人数标签</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(year_winter)):</span><br><span class="line">        ax2.text(year_winter[i], nums_winter[i], <span class="built_in">str</span>(nums_winter[i]), ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调整子图之间的间距</span></span><br><span class="line">    plt.subplots_adjust(hspace=<span class="number">0.6</span>)</span><br><span class="line">    <span class="comment"># 显示图表</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2</span>():</span><br><span class="line">    <span class="comment"># 统计夏季奥运会奖牌情况</span></span><br><span class="line">    CN_medals = CN_data.groupby([<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>, <span class="string">&#x27;Medal&#x27;</span>])[<span class="string">&#x27;Event&#x27;</span>].nunique().reset_index()</span><br><span class="line">    CN_medals.columns = [<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Season&#x27;</span>, <span class="string">&#x27;Medal&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(CN_medals)</span><br><span class="line">    CN_medals = CN_medals.sort_values(by=<span class="string">&quot;Year&quot;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">    years_summer = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>([row[<span class="string">&#x27;Year&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_medals[CN_medals.Season == <span class="string">&#x27;Summer&#x27;</span>].iterrows()])), reverse=<span class="literal">True</span>)</span><br><span class="line">    gold_summer = [row[<span class="string">&#x27;Nums&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_medals[(CN_medals.Season == <span class="string">&#x27;Summer&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Gold&#x27;</span>)].iterrows()]</span><br><span class="line">    silver_summer = [row[<span class="string">&#x27;Nums&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_medals[(CN_medals.Season == <span class="string">&#x27;Summer&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Silver&#x27;</span>)].iterrows()]</span><br><span class="line">    bronze_summer = [row[<span class="string">&#x27;Nums&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_medals[(CN_medals.Season == <span class="string">&#x27;Summer&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Bronze&#x27;</span>)].iterrows()]</span><br><span class="line">    <span class="comment"># 统计冬季奥运会奖牌情况</span></span><br><span class="line">    gold_winter = []</span><br><span class="line">    silver_winter = []</span><br><span class="line">    bronze_winter = []</span><br><span class="line">    years_winter = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>([row[<span class="string">&#x27;Year&#x27;</span>] <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_medals[CN_medals.Season == <span class="string">&#x27;Winter&#x27;</span>].iterrows()])),reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> year <span class="keyword">in</span> years_winter:</span><br><span class="line">        gold = <span class="number">0</span></span><br><span class="line">        silver = <span class="number">0</span></span><br><span class="line">        bronze = <span class="number">0</span></span><br><span class="line">        gold_row = CN_medals[(CN_medals.Season == <span class="string">&#x27;Winter&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Gold&#x27;</span>) &amp; (CN_medals.Year == year)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(gold_row) &gt; <span class="number">0</span>:</span><br><span class="line">            gold = gold_row.iloc[<span class="number">0</span>][<span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">        silver_row = CN_medals[(CN_medals.Season == <span class="string">&#x27;Winter&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Silver&#x27;</span>) &amp; (CN_medals.Year == year)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(silver_row) &gt; <span class="number">0</span>:</span><br><span class="line">            silver = silver_row.iloc[<span class="number">0</span>][<span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">        bronze_row = CN_medals[(CN_medals.Season == <span class="string">&#x27;Winter&#x27;</span>) &amp; (CN_medals.Medal == <span class="string">&#x27;Bronze&#x27;</span>) &amp; (CN_medals.Year == year)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bronze_row) &gt; <span class="number">0</span>:</span><br><span class="line">            bronze = bronze_row.iloc[<span class="number">0</span>][<span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">        gold_winter.append(gold)</span><br><span class="line">        silver_winter.append(silver)</span><br><span class="line">        bronze_winter.append(bronze)</span><br><span class="line">    <span class="comment"># 创建画布和子图</span></span><br><span class="line">    fig, (ax1, ax2) = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=(<span class="number">10</span>, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">    ax1.bar(years_summer, gold_summer, label=<span class="string">&#x27;Gold&#x27;</span>, color=<span class="string">&#x27;#FFD700&#x27;</span>)</span><br><span class="line">    ax1.bar(years_summer, silver_summer, bottom=gold_summer, label=<span class="string">&#x27;Silver&#x27;</span>, color=<span class="string">&#x27;#C0C0C0&#x27;</span>)</span><br><span class="line">    ax1.bar(years_summer, bronze_summer, bottom=np.add(gold_summer, silver_summer), label=<span class="string">&#x27;Bronze&#x27;</span>, color=<span class="string">&#x27;#DAA520&#x27;</span>)</span><br><span class="line">    ax1.set_title(<span class="string">&#x27;中国历年奥运会获得奖牌数数-夏奥会&#x27;</span>)</span><br><span class="line">    ax1.set_xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">    ax1.set_ylabel(<span class="string">&#x27;奖牌数&#x27;</span>)</span><br><span class="line">    ax1.set_xticks(years_summer)</span><br><span class="line">    ax1.legend()</span><br><span class="line">    <span class="keyword">for</span> year, gold, silver, bronze <span class="keyword">in</span> <span class="built_in">zip</span>(years_summer, gold_summer, silver_summer, bronze_summer):</span><br><span class="line">        ax1.text(year, gold + silver + bronze + <span class="number">1</span>, <span class="built_in">str</span>(gold + silver + bronze), ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ax2.bar(years_winter, gold_winter, label=<span class="string">&#x27;Gold&#x27;</span>, color=<span class="string">&#x27;#FFD700&#x27;</span>)</span><br><span class="line">    ax2.bar(years_winter, silver_winter, bottom=gold_winter, label=<span class="string">&#x27;Silver&#x27;</span>, color=<span class="string">&#x27;#C0C0C0&#x27;</span>)</span><br><span class="line">    ax2.bar(years_winter, bronze_winter, bottom=np.add(gold_winter, silver_winter), label=<span class="string">&#x27;Bronze&#x27;</span>, color=<span class="string">&#x27;#DAA520&#x27;</span>)</span><br><span class="line">    ax2.set_title(<span class="string">&#x27;中国历年奥运会获得奖牌数-冬奥会&#x27;</span>)</span><br><span class="line">    ax2.set_xlabel(<span class="string">&#x27;年份&#x27;</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="string">&#x27;奖牌数&#x27;</span>)</span><br><span class="line">    ax2.set_xticks(years_winter)</span><br><span class="line">    ax2.legend()</span><br><span class="line">    <span class="keyword">for</span> year, gold, silver, bronze <span class="keyword">in</span> <span class="built_in">zip</span>(years_winter, gold_winter, silver_winter, bronze_winter):</span><br><span class="line">        ax2.text(year, gold + silver + bronze + <span class="number">0.5</span>, <span class="built_in">str</span>(gold + silver + bronze), ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调整子图之间的间距</span></span><br><span class="line">    plt.subplots_adjust(hspace=<span class="number">0.4</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step3</span>():</span><br><span class="line">    CN_events = CN_data[CN_data.Medal == <span class="string">&#x27;Gold&#x27;</span>].groupby([<span class="string">&#x27;Year&#x27;</span>, <span class="string">&#x27;Sport&#x27;</span>])[<span class="string">&#x27;Event&#x27;</span>].nunique().reset_index()</span><br><span class="line">    CN_events = CN_events.groupby([<span class="string">&#x27;Sport&#x27;</span>])[<span class="string">&#x27;Event&#x27;</span>].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">    CN_events.columns = [<span class="string">&#x27;Sport&#x27;</span>, <span class="string">&#x27;Nums&#x27;</span>]</span><br><span class="line">    data_pair = [(row[<span class="string">&#x27;Sport&#x27;</span>], row[<span class="string">&#x27;Nums&#x27;</span>]) <span class="keyword">for</span> _, row <span class="keyword">in</span> CN_events.iterrows()]</span><br><span class="line">    <span class="comment"># 创建词云对象</span></span><br><span class="line">    wc = WordCloud(width=<span class="number">1000</span>, height=<span class="number">600</span>, background_color=<span class="string">&#x27;white&#x27;</span>, colormap=<span class="string">&#x27;viridis&#x27;</span>,random_state=<span class="number">42</span>)</span><br><span class="line">    <span class="comment"># 生成词云图</span></span><br><span class="line">    wc.generate_from_frequencies(<span class="built_in">dict</span>(data_pair))</span><br><span class="line">    <span class="comment"># 绘制词云图</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">12</span>, <span class="number">6</span>))</span><br><span class="line">    plt.imshow(wc, interpolation=<span class="string">&#x27;bilinear&#x27;</span>)</span><br><span class="line">    plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;中国获得过金牌运动项目&#x27;</span>, fontsize=<span class="number">20</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> 数据分析 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web与restful大作业 | 试衣间</title>
      <link href="/2023/12/20/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E6%A2%A6%E6%83%B3%E8%AF%95%E8%A1%A3%E9%97%B4/"/>
      <url>/2023/12/20/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E6%A2%A6%E6%83%B3%E8%AF%95%E8%A1%A3%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<p><strong>web与restful技术-大作业</strong></p><ul><li>JQuery</li><li>Hibernate</li></ul><p><strong>Gitee</strong></p><ul><li><a href="https://gitee.com/sheepFly03/suit">https://gitee.com/sheepFly03/suit</a></li></ul><p><strong>功能点</strong><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/0f9a7cdb040ff4ff.jpg" alt=""></p><p><strong>展示(admin)</strong><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/6f1fe54824861659.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/6437b3648ce2f29d.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/3c8ecd50cce6450b.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/e2c8a78635dfc735.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2024/01/10/f9b9f86495a0adf6.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web与restful作业 | 权利游戏(预处理拦截器-权限控制)</title>
      <link href="/2023/11/22/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E6%9D%83%E5%88%A9%E6%B8%B8%E6%88%8F/"/>
      <url>/2023/11/22/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E6%9D%83%E5%88%A9%E6%B8%B8%E6%88%8F/</url>
      
        <content type="html"><![CDATA[<p><img src="https://s3.bmp.ovh/imgs/2024/01/10/60c0f960e202b1d6.png" alt=""></p><h3 id="预处理拦截器"><a href="#预处理拦截器" class="headerlink" title="预处理拦截器"></a>预处理拦截器</h3><h4 id="PreProcessInterceptor接口-preProcess方法"><a href="#PreProcessInterceptor接口-preProcess方法" class="headerlink" title="PreProcessInterceptor接口-preProcess方法"></a>PreProcessInterceptor接口-preProcess方法</h4><p><strong>方法定义</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ServerResponse <span class="title function_">preProcess</span><span class="params">(HttpRequest httpRequest, ResourceMethodInvoker resourceMethodInvoker)</span> </span><br></pre></td></tr></table></figure><p><strong>参数详解</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest httpRequest <span class="comment">//介于Resteasy JAX-RS基本实现和实际HTTP传输间的桥接接口；</span></span><br><span class="line"></span><br><span class="line">ResourceMethodInvoker resourceMethodInvoker <span class="comment">//资源方法调用器。</span></span><br></pre></td></tr></table></figure><p><strong>返回值</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自javax.ws.rs.core.Response。</span><br></pre></td></tr></table></figure></p><h4 id="PreProcessInterceptor案例"><a href="#PreProcessInterceptor案例" class="headerlink" title="PreProcessInterceptor案例"></a>PreProcessInterceptor案例</h4><p><strong>API代码</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@POST</span>  </span><br><span class="line"><span class="meta">@Path(&quot;/test&quot;)</span>  </span><br><span class="line"><span class="meta">@Permission(&quot;login&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">reader</span><span class="params">(String input,String anotherValue)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> input+<span class="string">&quot;,&quot;</span>+anotherValue;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><br><strong>PreProcessInterceptor代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.interceptor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;  </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;  </span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Context;  </span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response;  </span><br><span class="line"><span class="keyword">import</span> org.jboss.resteasy.core.Headers;  </span><br><span class="line"><span class="keyword">import</span> org.jboss.resteasy.core.ResourceMethodInvoker;  </span><br><span class="line"><span class="keyword">import</span> org.jboss.resteasy.core.ServerResponse;  </span><br><span class="line"><span class="keyword">import</span> org.jboss.resteasy.spi.HttpRequest;  </span><br><span class="line"><span class="keyword">import</span> org.jboss.resteasy.spi.interception.PreProcessInterceptor;  </span><br><span class="line"><span class="keyword">import</span> restful.annotation.Permission;  </span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Interceptor4PreProcess</span> <span class="keyword">implements</span> <span class="title class_">PreProcessInterceptor</span> &#123;  </span><br><span class="line">    <span class="meta">@Context</span> HttpServletRequest request;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">preProcess</span><span class="params">(HttpRequest httpRequest,   </span></span><br><span class="line"><span class="params">ResourceMethodInvoker resourceMethodInvoker)</span> &#123;  </span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> resourceMethodInvoker.getMethod();  </span><br><span class="line">        Annotation[] annotations  = method.getDeclaredAnnotations();</span><br><span class="line">        <span class="keyword">for</span>(Annotation annotation : annotations) &#123; </span><br><span class="line">            <span class="type">String</span> <span class="variable">permissionValue</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>; </span><br><span class="line">            <span class="keyword">if</span>(annotation <span class="keyword">instanceof</span> Permission) &#123; </span><br><span class="line">                permissionValue = ((Permission)annotation).value(); </span><br><span class="line">            &#125; </span><br><span class="line">            System.out.printf(<span class="string">&quot;%s\t permission value = %s\n&quot;</span>, </span><br><span class="line">                annotation.toString(),permissionValue); </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(method.isAnnotationPresent(Permission.class)) &#123; </span><br><span class="line">            <span class="type">Annotation</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(Permission.class); </span><br><span class="line">            <span class="type">String</span> <span class="variable">permissionValue</span> <span class="operator">=</span> ((Permission)annotation).value(); </span><br><span class="line">            System.out.printf(<span class="string">&quot;%s\t permission value = %s\n&quot;</span>, </span><br><span class="line">                    annotation.toString(),permissionValue); </span><br><span class="line">            <span class="keyword">if</span>(permissionValue.equals(<span class="string">&quot;login&quot;</span>)) &#123; </span><br><span class="line">                <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>)==<span class="literal">null</span>) &#123; </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerResponse</span>(<span class="string">&quot;用户未登录，请先登录！&quot;</span>, <span class="number">404</span>, </span><br><span class="line"> <span class="keyword">new</span> <span class="title class_">Headers</span>&lt;Object&gt;()); </span><br><span class="line">                &#125;; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;preProcess:\t %s\t %s\t %s\t (&quot;</span>,  </span><br><span class="line">                Modifier.toString(method.getModifiers()),method.getReturnType(),  </span><br><span class="line">method.getName());  </span><br><span class="line">        Parameter[] parameters = method.getParameters();  </span><br><span class="line">        <span class="keyword">for</span>(Parameter parameter : parameters) &#123;  </span><br><span class="line">            System.out.printf(<span class="string">&quot;\t[%s\t %s]\t&quot;</span>,  </span><br><span class="line">                    parameter.getType(),  </span><br><span class="line">                    parameter.getName());  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">&quot;)\n&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">restful.annotation.Permission (Annotation)</span><br><span class="line"><span class="keyword">package</span> restful.annotation;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;  </span><br><span class="line"><span class="meta">@java</span>.lang.annotation.Retention(value=RetentionPolicy.RUNTIME)  </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Permission&#123;  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p><strong>web.xml部分节点配置</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>resteasy.resources<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>restful.api.InterceptorAPI<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>resteasy.providers<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        restful.interceptor.Interceptor4Reader,  </span><br><span class="line">        restful.interceptor.Interceptor4Writer,  </span><br><span class="line">        restful.interceptor.Interceptor4PreProcess  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Resteasy<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/interceptor/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="权利游戏"><a href="#权利游戏" class="headerlink" title="权利游戏"></a>权利游戏</h3><p>按一定顺序依次打开箱子回答问题，回答正确第一个箱子的问题可获得第二个箱子的打开权限，以此类推。<br><img src="https://s3.bmp.ovh/imgs/2024/01/10/da5bf22eb0199dd3.png" alt=""></p><p><strong>API示例</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Path(&quot;/box&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameAPI</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Context</span> HttpServletRequest request;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String,String&gt; powerList = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/ini&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">ini</span><span class="params">(<span class="meta">@FormParam(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">GameAPI.username = username;</span><br><span class="line">powerList.put(<span class="string">&quot;box1&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">request.getSession().setAttribute(<span class="string">&quot;powerList&quot;</span>, powerList);</span><br><span class="line">request.getSession().setAttribute(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>,username+<span class="string">&quot;,你胆敢来挑战我？那就试试吧！&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/question1&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span></span><br><span class="line"><span class="meta">@BoxPower(&quot;box1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">question1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>, <span class="string">&quot;困了可以睡觉吗？（可以/不可以）&quot;</span>, <span class="string">&quot;/box/answer1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/answer1&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span></span><br><span class="line"><span class="meta">@BoxPower(&quot;box1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">answer1</span><span class="params">(<span class="meta">@FormParam(&quot;answer&quot;)</span> String answer)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (answer.equals(<span class="string">&quot;可以&quot;</span>)) &#123;</span><br><span class="line">powerList.put(<span class="string">&quot;box2&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">request.getSession().setAttribute(<span class="string">&quot;powerList&quot;</span>, powerList);</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>, <span class="string">&quot;算你运气好&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(-<span class="number">10</span>, <span class="string">&quot;你真是个衰仔!&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/finish&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span></span><br><span class="line"><span class="meta">@BoxPower(&quot;finish&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">finish</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>, GameAPI.username+<span class="string">&quot;，恭喜你拿到钥匙&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">**预处理拦截器**</span><br><span class="line">```java</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Interceptor4PreProcess</span> <span class="keyword">implements</span> <span class="title class_">PreProcessInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Context</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ServerResponse <span class="title function_">preProcess</span><span class="params">(HttpRequest httpRequest, ResourceMethodInvoker resourceMethodInvoker)</span> &#123;</span><br><span class="line"><span class="comment">//serve progress</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">HashMap&lt;String, String&gt; map = (HashMap&lt;String, String&gt;)session.getAttribute(<span class="string">&quot;powerList&quot;</span>);</span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> resourceMethodInvoker.getMethod();</span><br><span class="line"><span class="keyword">if</span> (method.isAnnotationPresent(BoxPower.class)) &#123;</span><br><span class="line"><span class="type">Annotation</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(BoxPower.class);</span><br><span class="line"><span class="type">String</span> <span class="variable">boxName</span> <span class="operator">=</span> ((BoxPower)annotation).value();</span><br><span class="line"><span class="keyword">if</span> (map == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(-<span class="number">20</span>, <span class="string">&quot;无名之辈也敢来挑战?&quot;</span>,<span class="string">&quot;/box/ini&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerResponse</span>(result,<span class="number">200</span>,<span class="keyword">new</span> <span class="title class_">Headers</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (map.get(boxName) == <span class="literal">null</span>) &#123;<span class="comment">//no power</span></span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(-<span class="number">10</span>, <span class="string">&quot;你想投机取巧, 还是乖乖地按顺序回答我的问题!&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerResponse</span>(result,<span class="number">200</span>,<span class="keyword">new</span> <span class="title class_">Headers</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>JQuery核心代码</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> openBoxSnd = $(<span class="string">&quot;#openBoxSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> keyGlowSnd = $(<span class="string">&quot;#keyGlowSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> hahaSnd = $(<span class="string">&quot;#hahaSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> growlSnd = $(<span class="string">&quot;#growlSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> beginSnd = $(<span class="string">&quot;#beginSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> surpriseSnd = $(<span class="string">&quot;#surpriseSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> heavyCloseSnd= $(<span class="string">&quot;#heavyCloseSnd&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> boxContainer = $(<span class="string">&quot;#boxContainer&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> boxIndex = <span class="number">1</span>;boxIndex&lt;<span class="number">6</span>;boxIndex++)&#123;</span><br><span class="line">            <span class="keyword">var</span> box = $(<span class="string">&quot;&lt;div&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> boxData = boxs[boxIndex-<span class="number">1</span>];</span><br><span class="line">            box.<span class="title function_">addClass</span>(<span class="string">&quot;box&quot;</span>);</span><br><span class="line">            box.<span class="title function_">css</span>(<span class="string">&quot;zIndex&quot;</span>,boxIndex*<span class="number">10</span>);</span><br><span class="line">            box.<span class="title function_">css</span>(<span class="string">&quot;top&quot;</span>,boxData.<span class="property">top</span>);</span><br><span class="line">            box.<span class="title function_">css</span>(<span class="string">&quot;left&quot;</span>,boxData.<span class="property">left</span>);</span><br><span class="line">            box.<span class="title function_">css</span>(<span class="string">&quot;background-image&quot;</span>,<span class="string">&quot;url(../css/images/box&quot;</span>+boxIndex+<span class="string">&quot;.png)&quot;</span>);</span><br><span class="line">            box.<span class="title function_">attr</span>(<span class="string">&quot;boxIndex&quot;</span>,boxIndex);</span><br><span class="line">            box.<span class="title function_">attr</span>(<span class="string">&quot;question&quot;</span>,boxData.<span class="property">question</span>);</span><br><span class="line">            box.<span class="title function_">hover</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                $(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&quot;background-image&quot;</span>,<span class="string">&quot;url(../css/images/box&quot;</span>+$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;boxIndex&quot;</span>)+<span class="string">&quot;glow.png)&quot;</span>);</span><br><span class="line">            &#125;,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                $(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&quot;background-image&quot;</span>,<span class="string">&quot;url(../css/images/box&quot;</span>+$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;boxIndex&quot;</span>)+<span class="string">&quot;.png)&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            box.<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                curBox = $(<span class="variable language_">this</span>);</span><br><span class="line">                <span class="title function_">request</span>(<span class="string">&quot;post&quot;</span>,curBox.<span class="title function_">attr</span>(<span class="string">&quot;question&quot;</span>),&#123;&#125;,boxGetQuestionSuccess,serverError,<span class="literal">false</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            boxContainer.<span class="title function_">append</span>(box);</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="variable language_">window</span>).<span class="title function_">resize</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">method,url,data,successCallBack,errorCallBack,<span class="keyword">async</span></span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">async</span>:<span class="keyword">async</span>,</span><br><span class="line">            <span class="attr">data</span>: data,</span><br><span class="line">            <span class="attr">method</span>: method</span><br><span class="line">        &#125;).<span class="title function_">success</span>(successCallBack).<span class="title function_">error</span>(errorCallBack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">boxGetQuestionSuccess</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;boxGetQuestionSuccess&quot;</span>,data);</span><br><span class="line">        <span class="keyword">if</span>(data.<span class="property">code</span>==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> answer = <span class="title function_">prompt</span>(data.<span class="property">description</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(answer)&#123;</span><br><span class="line">                <span class="title function_">request</span>(<span class="string">&quot;post&quot;</span>,<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>+data.<span class="property">nextAction</span>,&#123;<span class="string">&quot;answer&quot;</span>:answer&#125;,boxGetAnswerSuccess,serverError,<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(data.<span class="property">code</span>==-<span class="number">20</span>)&#123;</span><br><span class="line">        growlSnd.<span class="title function_">play</span>();</span><br><span class="line">        <span class="title function_">showMessage</span>(data);  </span><br><span class="line">            <span class="keyword">var</span> username = <span class="title function_">prompt</span>(<span class="string">&quot;你的名字，不要欺骗我的智慧：&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(username)&#123;</span><br><span class="line">            <span class="title function_">request</span>(<span class="string">&quot;post&quot;</span>,<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>+data.<span class="property">nextAction</span>,&#123;<span class="string">&quot;username&quot;</span>:username&#125;,showMessage,serverError,<span class="literal">true</span>);</span><br><span class="line">            beginSnd.<span class="title function_">play</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(data.<span class="property">code</span>==-<span class="number">10</span>)&#123;</span><br><span class="line">        hahaSnd.<span class="title function_">play</span>(); </span><br><span class="line">        <span class="title function_">showMessage</span>(data);         </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">boxGetAnswerSuccess</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;boxGetAnswerSuccess&quot;</span>,data);</span><br><span class="line">        <span class="keyword">if</span>(data.<span class="property">code</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        surpriseSnd.<span class="title function_">play</span>();</span><br><span class="line">        curBox.<span class="title function_">off</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">off</span>(<span class="string">&quot;mouseenter&quot;</span>).<span class="title function_">unbind</span>(<span class="string">&quot;mouseleave&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">css</span>(<span class="string">&quot;background-image&quot;</span>, <span class="string">&quot;url(../css/images/box&quot;</span> + curBox.<span class="title function_">attr</span>(<span class="string">&quot;boxIndex&quot;</span>) + <span class="string">&quot;open.png)&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">css</span>(<span class="string">&quot;cursor&quot;</span>, <span class="string">&quot;default&quot;</span>);            </span><br><span class="line">            <span class="title function_">showMessage</span>(data);</span><br><span class="line">            openBoxSnd.<span class="title function_">play</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(data.<span class="property">code</span>==-<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="title function_">showMessage</span>(data);</span><br><span class="line">        hahaSnd.<span class="title function_">play</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(data.<span class="property">code</span>==<span class="number">10</span>)&#123;</span><br><span class="line">        surpriseSnd.<span class="title function_">play</span>();</span><br><span class="line">        curBox.<span class="title function_">off</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">off</span>(<span class="string">&quot;mouseenter&quot;</span>).<span class="title function_">unbind</span>(<span class="string">&quot;mouseleave&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">css</span>(<span class="string">&quot;background-image&quot;</span>, <span class="string">&quot;url(../css/images/box&quot;</span> + curBox.<span class="title function_">attr</span>(<span class="string">&quot;boxIndex&quot;</span>) + <span class="string">&quot;open.png)&quot;</span>);</span><br><span class="line">            curBox.<span class="title function_">css</span>(<span class="string">&quot;cursor&quot;</span>, <span class="string">&quot;default&quot;</span>);</span><br><span class="line">            <span class="title function_">showMessage</span>(data);</span><br><span class="line">            heavyCloseSnd.<span class="title function_">play</span>();</span><br><span class="line">        <span class="title function_">request</span>(<span class="string">&quot;post&quot;</span>,<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>+data.<span class="property">nextAction</span>,&#123;&#125;,showMessage,serverError,<span class="literal">true</span>);</span><br><span class="line">        $(<span class="string">&quot;#keyGlow&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>,<span class="string">&quot;block&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#shining&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>,<span class="string">&quot;block&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#magicRing&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;filter&quot;</span>,<span class="string">&quot;blur(5px)&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;.box&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;filter&quot;</span>,<span class="string">&quot;blur(5px)&quot;</span>);</span><br><span class="line">        keyGlowSnd.<span class="title function_">play</span>();  </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;saveMeSnd.<span class="title function_">play</span>();&#125;,<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;showMessage&quot;</span>,data);</span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">description</span> != <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="title function_">alert</span>(data.<span class="property">description</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">serverError</span>(<span class="params">XMLHttpRequest, textStatus</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;responseText:&quot;</span>,<span class="title class_">XMLHttpRequest</span>.<span class="property">responseText</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;status:&quot;</span>,<span class="title class_">XMLHttpRequest</span>.<span class="property">status</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;textStatus:&quot;</span>,textStatus);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;readyState:&quot;</span>,<span class="title class_">XMLHttpRequest</span>.<span class="property">readyState</span>);</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;网络都出问题还想挖宝？按F12键看看发生了什么吧！&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web与restful作业 | 篡改Command（过滤器）</title>
      <link href="/2023/11/15/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E7%AF%A1%E6%94%B9Command/"/>
      <url>/2023/11/15/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E7%AF%A1%E6%94%B9Command/</url>
      
        <content type="html"><![CDATA[<blockquote><p>课程地址：<a href="https://www.icourse163.org/course/JXUFE-1206000802">https://www.icourse163.org/course/JXUFE-1206000802</a></p></blockquote><h3 id="基本过滤器"><a href="#基本过滤器" class="headerlink" title="基本过滤器"></a>基本过滤器</h3><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/4bc2aee5aac8dcdb.png" alt=""></p><blockquote><p>见<a href="https://sheepfly03.oschina.io/2023/11/14/SpringMVC_%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/">SpringMVC-模拟自动登录</a></p></blockquote><p><strong>Restful将基本Filter拆分为两个独立过滤器</strong></p><ul><li>请求过滤器：javax.ws.rs.container.ContainerRequestFilter</li><li>响应过滤器：javax.ws.rs.container.ContainerResponseFilter</li></ul><h3 id="ContainerRequestFilter"><a href="#ContainerRequestFilter" class="headerlink" title="ContainerRequestFilter"></a>ContainerRequestFilter</h3><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/48bb442896bfe51e.png" alt=""><br><a href="https://docs.oracle.com/javaee/7/api/javax/ws/rs/container/ContainerRequestContext.html">ContainerRequestContex官方文档</a></p><h3 id="ContainerResponseFilter"><a href="#ContainerResponseFilter" class="headerlink" title="ContainerResponseFilter"></a>ContainerResponseFilter</h3><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/fbe553db7b388efe.png" alt=""><br><a href="https://docs.oracle.com/javaee/7/api/javax/ws/rs/container/ContainerResponseContext.html">ContainerResponseContex官方文档</a></p><h3 id="案例：无间道"><a href="#案例：无间道" class="headerlink" title="案例：无间道"></a>案例：无间道</h3><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/91f31d207a0fab95.png" alt=""></p><ul><li><strong>使用请求过滤器进行权限控制，校验失败则伪装404错误</strong></li><li><strong>使用响应过滤器篡改session中的command（JSONArray）</strong></li></ul><h4 id="restful-api"><a href="#restful-api" class="headerlink" title="restful.api"></a>restful.api</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.api;</span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.FormParam;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.POST;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Context;</span><br><span class="line"><span class="keyword">import</span> restful.bean.Result;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/data&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Data</span> &#123;</span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line">    <span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span>    </span><br><span class="line">    <span class="meta">@Path(&quot;/readCommand&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">readCommand</span><span class="params">(<span class="meta">@Context</span> HttpServletRequest request,<span class="meta">@FormParam(&quot;command&quot;)</span> String command)</span> &#123;</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> JSONArray.fromObject(command);</span><br><span class="line">session.setAttribute(<span class="string">&quot;commands&quot;</span>, jsonArray);</span><br><span class="line">result.setCode(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">result.setNextAction(<span class="string">&quot;&quot;</span>);</span><br><span class="line">result.setDescription(<span class="string">&quot;指令成功接受！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.api;</span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.FormParam;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.POST;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Context;</span><br><span class="line"><span class="keyword">import</span> restful.bean.Result;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/data&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataHacked</span> &#123;</span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line">    <span class="meta">@Produces(&quot;application/json;charset=UTF-8&quot;)</span>    </span><br><span class="line">    <span class="meta">@Path(&quot;/refresh&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">refresh</span><span class="params">(<span class="meta">@Context</span> HttpServletRequest request,<span class="meta">@FormParam(&quot;refreshData&quot;)</span> String refreshData)</span> &#123;</span><br><span class="line"><span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> JSONArray.fromObject(refreshData);</span><br><span class="line">session.setAttribute(<span class="string">&quot;refreshData&quot;</span>, jsonArray);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="restful-bean"><a href="#restful-bean" class="headerlink" title="restful.bean"></a>restful.bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"><span class="keyword">private</span> String code;</span><br><span class="line"><span class="keyword">private</span> String description;</span><br><span class="line"><span class="keyword">private</span> String nextAction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> description;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.description = description;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getNextAction</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nextAction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextAction</span><span class="params">(String nextAction)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.nextAction = nextAction;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> restful.entity.Command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshResult</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Result opReturn;</span><br><span class="line"><span class="keyword">private</span> ArrayList&lt;Command&gt; dataReturn;</span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getOpReturn</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> opReturn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOpReturn</span><span class="params">(Result opReturn)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.opReturn = opReturn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> ArrayList&lt;Command&gt; <span class="title function_">getDataReturn</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> dataReturn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataReturn</span><span class="params">(ArrayList&lt;Command&gt; dataReturn)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.dataReturn = dataReturn;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="restful-filter"><a href="#restful-filter" class="headerlink" title="restful.filter"></a>restful.filter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerRequestContext;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerResponseContext;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerResponseFilter;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Context;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.MediaType;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> restful.bean.Result;</span><br><span class="line"><span class="keyword">import</span> restful.bean.RefreshResult;</span><br><span class="line"><span class="keyword">import</span> restful.entity.Command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataFilter</span> <span class="keyword">implements</span> <span class="title class_">ContainerRequestFilter</span>, ContainerResponseFilter &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="meta">@Context</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">URI</span> <span class="variable">invalidatedURI</span> <span class="operator">=</span> URI.create(<span class="string">&quot;/data/refresh&quot;</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">is404</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">(ContainerRequestContext containerRequestContext,</span></span><br><span class="line"><span class="params">ContainerResponseContext containerResponseContext)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">// 如果请求状态码不是404 &amp; URL为植入API</span></span><br><span class="line"><span class="keyword">if</span> (!is404 &amp;&amp; authoration(containerRequestContext)) &#123;</span><br><span class="line"><span class="comment">// 取session</span></span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">oldCommandsObject</span> <span class="operator">=</span> (JSONArray) request.getSession().getAttribute(<span class="string">&quot;commands&quot;</span>);</span><br><span class="line"><span class="type">JSONArray</span> <span class="variable">newCommandsObject</span> <span class="operator">=</span> (JSONArray) request.getSession().getAttribute(<span class="string">&quot;refreshData&quot;</span>);</span><br><span class="line">ArrayList&lt;Command&gt; reCommands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Math.min(oldCommandsObject.size(), newCommandsObject.size()); i++) &#123;</span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">newCommand</span> <span class="operator">=</span> newCommandsObject.getJSONObject(i);</span><br><span class="line"><span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Command</span>();</span><br><span class="line">oldCommandsObject.set(i, newCommand);<span class="comment">// 篡改指令</span></span><br><span class="line"><span class="comment">// 构建dataReturn</span></span><br><span class="line">command.setZoneCode((String) newCommand.get(<span class="string">&quot;zoneCode&quot;</span>));</span><br><span class="line">command.setTargetPosX((<span class="type">double</span>) newCommand.get(<span class="string">&quot;targetPosX&quot;</span>));</span><br><span class="line">command.setTargetPosY((<span class="type">double</span>) newCommand.get(<span class="string">&quot;targetPosY&quot;</span>));</span><br><span class="line">command.setTargetPosZ((<span class="type">double</span>) newCommand.get(<span class="string">&quot;targetPosZ&quot;</span>));</span><br><span class="line">command.setPower((<span class="type">int</span>) newCommand.get(<span class="string">&quot;power&quot;</span>));</span><br><span class="line">command.setDuration((<span class="type">int</span>) newCommand.get(<span class="string">&quot;duration&quot;</span>));</span><br><span class="line">reCommands.add(command);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 篡改指令</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">session.setAttribute(<span class="string">&quot;commands&quot;</span>, oldCommandsObject);</span><br><span class="line"><span class="comment">// 构建opReturn</span></span><br><span class="line"><span class="type">Result</span> <span class="variable">opResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">opResult.setCode(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">opResult.setNextAction(<span class="string">&quot;&quot;</span>);</span><br><span class="line">opResult.setDescription(<span class="string">&quot;指令成功接受！&quot;</span>);</span><br><span class="line"><span class="type">RefreshResult</span> <span class="variable">refreshResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefreshResult</span>();</span><br><span class="line">refreshResult.setOpReturn(opResult);</span><br><span class="line">refreshResult.setDataReturn(reCommands);</span><br><span class="line">containerResponseContext.setEntity(refreshResult);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">(ContainerRequestContext containerRequestContext)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">// URL为植入API</span></span><br><span class="line"><span class="keyword">if</span> (authoration(containerRequestContext)) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;s&quot;</span>));</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;x&quot;</span>));</span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;r&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (s % x != r) &#123;<span class="comment">// 无权</span></span><br><span class="line">containerRequestContext.abortWith(Response.status(Response.Status.NOT_FOUND).build());</span><br><span class="line">is404 = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">authoration</span><span class="params">(ContainerRequestContext containerRequestContext)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> containerRequestContext.getUriInfo().getPath();</span><br><span class="line"><span class="keyword">if</span> (url.equals(invalidatedURI.getPath())) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restful </tag>
            
            <tag> filter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC | 基于表单的单文件上传（头像上传与显示）</title>
      <link href="/2023/11/15/SpringMVC_%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2023/11/15/SpringMVC_%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="配置与依赖"><a href="#配置与依赖" class="headerlink" title="配置与依赖"></a>配置与依赖</h3><blockquote><p>pom.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>图片存放路径为<code>WEB-INF/img</code>，需解决拦截静态资源问题（也可使用 <a href="https://blog.csdn.net/qq_53843555/article/details/128270020">Tomcat虚拟路径</a>）</p></blockquote><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/04c0861feaa12e9f.png" alt=""></p><blockquote><p>web.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/img/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3><blockquote><p>Form表单使用<code>enctype=&quot;multipart/form-data&quot;</code></p><p>实体类参数：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MultipartFile avatar;</span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">avatarUrl</span> <span class="operator">=</span> <span class="string">&quot;img/default.png&quot;</span>; <span class="comment">// 默认头像</span></span><br></pre></td></tr></table></figure><blockquote><p>文件上传代码，用<strong>时间戳</strong>避免文件名重复问题：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>+System.currentTimeMillis()+registerForm.getAvatar().getOriginalFilename();</span><br><span class="line">registerForm.setAvatarUrl(<span class="string">&quot;img/&quot;</span>+fileName);</span><br><span class="line">System.out.println(<span class="string">&quot;上传的文件的名称是 : &quot;</span>+registerForm.getAvatarUrl());</span><br><span class="line"><span class="comment">//保存文件</span></span><br><span class="line">registerForm.getAvatar().transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\Java_code\\j2ee\\springMVC_demo\\web\\img\\&quot;</span>+fileName));</span><br><span class="line">System.out.println(<span class="string">&quot;上传完成&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>头像显示 </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%=basePath%&gt;img/xxxxx&quot;</span>/&gt;</span>&quot; alt=&quot;无&quot;/&gt;</span><br></pre></td></tr></table></figure><p><img src="https://s3.bmp.ovh/imgs/2023/11/15/4dcec705d363fad3.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC | 模拟自动登录(过滤器、Cookie)</title>
      <link href="/2023/11/14/SpringMVC_%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/"/>
      <url>/2023/11/14/SpringMVC_%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自动登录逻辑 用cookie保存信息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">auto</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;autoLogin&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(auto != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">ckName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;userName&quot;</span>,username);</span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">ckPwd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;pwd&quot;</span>, password);</span><br><span class="line">    ckName.setMaxAge(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);<span class="comment">//24h</span></span><br><span class="line">    ckPwd.setMaxAge(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">    ckName.setPath(<span class="string">&quot;/index&quot;</span>);</span><br><span class="line">    ckPwd.setPath(<span class="string">&quot;/index&quot;</span>);</span><br><span class="line">    resp.addCookie(ckName);</span><br><span class="line">    resp.addCookie(ckPwd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>AutoLoginFilter</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.j2ee.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.j2ee.domain.LoginForm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.j2ee.service.impl.UserServiceImpl.isCheckedUser;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoLoginFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getValueByName</span><span class="params">(Cookie[] cs, String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; cs != <span class="literal">null</span> &amp;&amp; i &lt; cs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cs[i].getName().equals(name))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> cs[i].getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//session中有记录 这个用户没有离开</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest)request;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">LoginForm</span> <span class="variable">user</span> <span class="operator">=</span> (LoginForm)session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//用户已离开页面</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Cookie[] cs = req.getCookies();</span><br><span class="line">            <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> getValueByName(cs, <span class="string">&quot;userName&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> getValueByName(cs,<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">            <span class="comment">//cookie中如果存在用户名和密码，自动登录并创建session，否则跳转到登录页面</span></span><br><span class="line">            <span class="keyword">if</span>(userName != <span class="literal">null</span> &amp;&amp; pwd != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">LoginForm</span> <span class="variable">checkUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginForm</span>();</span><br><span class="line">                checkUser.setUsername(userName);</span><br><span class="line">                checkUser.setPassword(pwd);</span><br><span class="line">                <span class="keyword">if</span>(isCheckedUser(checkUser)) &#123;</span><br><span class="line">                    session.setAttribute(<span class="string">&quot;user&quot;</span>, checkUser);</span><br><span class="line">                &#125;</span><br><span class="line">                chain.doFilter(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                chain.doFilter(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript | 省市区/县三级联动</title>
      <link href="/2023/11/14/JS_%E7%9C%81%E5%B8%82%E5%8C%BA%E4%B8%89%E7%BA%A7%E8%81%94%E5%8A%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>/2023/11/14/JS_%E7%9C%81%E5%B8%82%E5%8C%BA%E4%B8%89%E7%BA%A7%E8%81%94%E5%8A%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><img src="https://s3.bmp.ovh/imgs/2023/11/15/0e169dafc44f62d0.png" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">单位地址：</span><br><span class="line">&lt;%--自动加载省份 showProv--%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;prov&quot;</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;showCity(this)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span> <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;showArea(this)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span> <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;country&quot;</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span> <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="city-select-js"><a href="#city-select-js" class="headerlink" title="city_select.js"></a>city_select.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*根据id获取对象*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> prov = $(<span class="string">&#x27;prov&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> city = $(<span class="string">&#x27;city&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> country = $(<span class="string">&#x27;country&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*用于保存当前所选的省市区*/</span></span><br><span class="line"><span class="keyword">var</span> current = &#123;</span><br><span class="line">    <span class="attr">prov</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">country</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*自动加载省份列表*/</span></span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">showProv</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> len = area_data.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> provOpt = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span><br><span class="line">        provOpt.<span class="property">innerText</span> = area_data[i][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        provOpt.<span class="property">index</span> <span class="comment">//记录下标</span></span><br><span class="line">        provOpt.<span class="property">value</span> = area_data[i][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        prov.<span class="title function_">appendChild</span>(provOpt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*根据所选的省份来显示城市列表*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showCity</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">//读取 province数组所选择的省份下标</span></span><br><span class="line">    <span class="keyword">var</span> val = obj.<span class="property">options</span>[obj.<span class="property">selectedIndex</span>].<span class="property">index</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">options</span>[obj.<span class="property">selectedIndex</span>].<span class="property">value</span>);</span><br><span class="line">    current.<span class="property">prov</span> = val;</span><br><span class="line">    <span class="keyword">if</span> (val !== <span class="literal">null</span>) &#123;</span><br><span class="line">        city.<span class="property">length</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> cityLen = area_data[val][<span class="string">&#x27;city&#x27;</span>].<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; cityLen; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> cityOpt = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span><br><span class="line">            cityOpt.<span class="property">innerText</span> = area_data[val][<span class="string">&#x27;city&#x27;</span>][j].<span class="property">name</span>;</span><br><span class="line">            cityOpt.<span class="property">index</span> = j <span class="comment">//记录下标</span></span><br><span class="line">            cityOpt.<span class="property">value</span> = area_data[val][<span class="string">&#x27;city&#x27;</span>][j].<span class="property">name</span>;</span><br><span class="line">            city.<span class="title function_">appendChild</span>(cityOpt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">showArea</span>(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*根据所选的城市来显示县区列表*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showArea</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = obj.<span class="property">options</span>[obj.<span class="property">selectedIndex</span>].<span class="property">index</span> - <span class="number">1</span>;</span><br><span class="line">    current.<span class="property">city</span> = val;</span><br><span class="line">    <span class="keyword">if</span> (val !== <span class="literal">null</span>) &#123;</span><br><span class="line">        country.<span class="property">length</span> = <span class="number">1</span>; <span class="comment">//清空之前的内容只留第一个默认选项</span></span><br><span class="line">        <span class="keyword">var</span> countryLen = area_data[current.<span class="property">prov</span>][<span class="string">&quot;city&quot;</span>][val].<span class="property">area</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; countryLen; k++) &#123;</span><br><span class="line">            <span class="keyword">var</span> countryOpt = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span><br><span class="line">            countryOpt.<span class="property">innerText</span> = area_data[current.<span class="property">prov</span>][<span class="string">&quot;city&quot;</span>][val].<span class="property">area</span>[k];</span><br><span class="line">            countryOpt.<span class="property">value</span> = area_data[current.<span class="property">prov</span>][<span class="string">&quot;city&quot;</span>][val].<span class="property">area</span>[k];</span><br><span class="line">            country.<span class="title function_">appendChild</span>(countryOpt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*选择县区之后的处理函数*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">selectCountry</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    current.<span class="property">country</span> = obj.<span class="property">options</span>[obj.<span class="property">selectedIndex</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> ((current.<span class="property">city</span> != <span class="literal">null</span>) &amp;&amp; (current.<span class="property">country</span> != <span class="literal">null</span>)) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="area-json-js-部分数据示例"><a href="#area-json-js-部分数据示例" class="headerlink" title="area_json.js 部分数据示例"></a>area_json.js 部分数据示例</h4><p>```js<br>var area_data = [<br>    {<br>        “name”: “北京市”,<br>        “city”: [<br>            {<br>                “name”: “北京市”,<br>                “area”: [<br>                    “东城区”,<br>                    “西城区”,<br>                    “崇文区”,<br>                    “宣武区”,<br>                    “朝阳区”,<br>                    “丰台区”,<br>                    “石景山区”,<br>                    “海淀区”,<br>                    “门头沟区”,<br>                    “房山区”,<br>                    “通州区”,<br>                    “顺义区”,<br>                    “昌平区”,<br>                    “大兴区”,<br>                    “平谷区”,<br>                    “怀柔区”,<br>                    “密云县”,<br>                    “延庆县”<br>                ]<br>            }<br>        ]<br>    },<br>    {<br>        “name”: “天津市”,<br>        “city”: [<br>            {<br>                “name”: “天津市”,<br>                “area”: [<br>                    “和平区”,<br>                    “河东区”,<br>                    “河西区”,<br>                    “南开区”,<br>                    “河北区”,<br>                    “红桥区”,<br>                    “塘沽区”,<br>                    “汉沽区”,<br>                    “大港区”,<br>                    “东丽区”,<br>                    “西青区”,<br>                    “津南区”,<br>                    “北辰区”,<br>                    “武清区”,<br>                    “宝坻区”,<br>                    “宁河县”,<br>                    “静海县”,<br>                    “蓟  县”<br>                ]<br>            }<br>        ]<br>    },<br>    {<br>        “name”: “河北省”,<br>        “city”: [<br>            {<br>                “name”: “石家庄市”,<br>                “area”: [<br>                    “长安区”,<br>                    “桥东区”,<br>                    “桥西区”,<br>                    “新华区”,<br>                    “郊  区”,<br>                    “井陉矿区”,<br>                    “井陉县”,<br>                    “正定县”,<br>                    “栾城县”,<br>                    “行唐县”,<br>                    “灵寿县”,<br>                    “高邑县”,<br>                    “深泽县”,<br>                    “赞皇县”,<br>                    “无极县”,<br>                    “平山县”,<br>                    “元氏县”,<br>                    “赵  县”,<br>                    “辛集市”,<br>                    “藁”,<br>                    “晋州市”,<br>                    “新乐市”,<br>                    “鹿泉市”<br>                ]<br>            },<br>            {<br>                “name”: “唐山市”,<br>                “area”: [<br>                    “路南区”,<br>                    “路北区”,<br>                    “古冶区”,<br>                    “开平区”,<br>                    “新  区”,<br>                    “丰润县”,<br>                    “滦  县”,<br>                    “滦南县”,<br>                    “乐亭县”,<br>                    “迁西县”,<br>                    “玉田县”,<br>                    “唐海县”,<br>                    “遵化市”,<br>                    “丰南市”,<br>                    “迁安市”<br>                ]<br>            },<br>            {<br>                “name”: “秦皇岛市”,<br>                “area”: [<br>                    “海港区”,<br>                    “山海关区”,<br>                    “北戴河区”,<br>                    “青龙满族自治县”,<br>                    “昌黎县”,<br>                    “抚宁县”,<br>                    “卢龙县”<br>                ]<br>            },<br>            {<br>                “name”: “邯郸市”,<br>                “area”: [<br>                    “邯山区”,<br>                    “丛台区”,<br>                    “复兴区”,<br>                    “峰峰矿区”,<br>                    “邯郸县”,<br>                    “临漳县”,<br>                    “成安县”,<br>                    “大名县”,<br>                    “涉  县”,<br>                    “磁  县”,<br>                    “肥乡县”,<br>                    “永年县”,<br>                    “邱  县”,<br>                    “鸡泽县”,<br>                    “广平县”,<br>                    “馆陶县”,<br>                    “魏  县”,<br>                    “曲周县”,<br>                    “武安市”<br>                ]<br>            },<br>            {<br>                “name”: “邢台市”,<br>                “area”: [<br>                    “桥东区”,<br>                    “桥西区”,<br>                    “邢台县”,<br>                    “临城县”,<br>                    “内丘县”,<br>                    “柏乡县”,<br>                    “隆尧县”,<br>                    “任  县”,<br>                    “南和县”,<br>                    “宁晋县”,<br>                    “巨鹿县”,<br>                    “新河县”,<br>                    “广宗县”,<br>                    “平乡县”,<br>                    “威  县”,<br>                    “清河县”,<br>                    “临西县”,<br>                    “南宫市”,<br>                    “沙河市”<br>                ]<br>            },<br>            {<br>                “name”: “保定市”,<br>                “area”: [<br>                    “新市区”,<br>                    “北市区”,<br>                    “南市区”,<br>                    “满城县”,<br>                    “清苑县”,<br>                    “涞水县”,<br>                    “阜平县”,<br>                    “徐水县”,<br>                    “定兴县”,<br>                    “唐  县”,<br>                    “高阳县”,<br>                    “容城县”,<br>                    “涞源县”,<br>                    “望都县”,<br>                    “安新县”,<br>                    “易  县”,<br>                    “曲阳县”,<br>                    “蠡  县”,<br>                    “顺平县”,<br>                    “博野”,<br>                    “雄县”,<br>                    “涿州市”,<br>                    “定州市”,<br>                    “安国市”,<br>                    “高碑店市”<br>                ]<br>            },<br>            {<br>                “name”: “张家口”,<br>                “area”: [<br>                    “桥东区”,<br>                    “桥西区”,<br>                    “宣化区”,<br>                    “下花园区”,<br>                    “宣化县”,<br>                    “张北县”,<br>                    “康保县”,<br>                    “沽源县”,<br>                    “尚义县”,<br>                    “蔚  县”,<br>                    “阳原县”,<br>                    “怀安县”,<br>                    “万全县”,<br>                    “怀来县”,<br>                    “涿鹿县”,<br>                    “赤城县”,<br>                    “崇礼县”<br>                ]<br>            },<br>            {<br>                “name”: “承德市”,<br>                “area”: [<br>                    “双桥区”,<br>                    “双滦区”,<br>                    “鹰手营子矿区”,<br>                    “承德县”,<br>                    “兴隆县”,<br>                    “平泉县”,<br>                    “滦平县”,<br>                    “隆化县”,<br>                    “丰宁满族自治县”,<br>                    “宽城满族自治县”,<br>                    “围场满族蒙古族自治县”<br>                ]<br>            },<br>            {<br>                “name”: “沧州市”,<br>                “area”: [<br>                    “新华区”,<br>                    “运河区”,<br>                    “沧  县”,<br>                    “青  县”,<br>                    “东光县”,<br>                    “海兴县”,<br>                    “盐山县”,<br>                    “肃宁县”,<br>                    “南皮县”,<br>                    “吴桥县”,<br>                    “献  县”,<br>                    “孟村回族自治县”,<br>                    “泊头市”,<br>                    “任丘市”,<br>                    “黄骅市”,<br>                    “河间市”<br>                ]<br>            },<br>            {<br>                “name”: “廊坊市”,<br>                “area”: [<br>                    “安次区”,<br>                    “固安县”,<br>                    “永清县”,<br>                    “香河县”,<br>                    “大城县”,<br>                    “文安县”,<br>                    “大厂回族自治县”,<br>                    “霸州市”,<br>                    “三河市”<br>                ]<br>            },<br>            {<br>                “name”: “衡水市”,<br>                “area”: [<br>                    “桃城区”,<br>                    “枣强县”,<br>                    “武邑县”,<br>                    “武强县”,<br>                    “饶阳县”,<br>                    “安平县”,<br>                    “故城县”,<br>                    “景  县”,<br>                    “阜城县”,<br>                    “冀州市”,<br>                    “深州市”<br>                ]<br>            }<br>        ]<br>    },</p><pre><code>......&#123;    &quot;name&quot;: &quot;香港&quot;,    &quot;city&quot;: [        &#123;            &quot;name&quot;: &quot;香港&quot;,            &quot;area&quot;: [                &quot;深水埗区&quot;,                &quot;油尖旺区&quot;,                &quot;九龙城区&quot;,                &quot;黄大仙区&quot;,                &quot;观塘区&quot;,                &quot;北区&quot;,                &quot;大埔区&quot;,                &quot;沙田区&quot;,                &quot;西贡区&quot;,                &quot;元朗区&quot;,                &quot;屯门区&quot;,                &quot;荃湾区&quot;,                &quot;葵青区&quot;,                &quot;离岛区&quot;,                &quot;中西区&quot;,                &quot;湾仔区&quot;,                &quot;东区&quot;,                &quot;南区&quot;,                &quot;其他&quot;            ]        &#125;    ]&#125;</code></pre><p>]</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC | 关于使用SpringMVC从前端页面引入js/css等资源被拦截的问题</title>
      <link href="/2023/11/10/SpringMVC_jsp%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5js/"/>
      <url>/2023/11/10/SpringMVC_jsp%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5js/</url>
      
        <content type="html"><![CDATA[<p><strong>项目结构如下，我需要在<code>WEB-INF/jsp</code>文件夹下的一个jsp页面中引入<code>web/js</code>文件夹中的js文件</strong></p><p><img src="https://s3.bmp.ovh/imgs/2023/11/09/1eae651efed27064.png" alt=""></p><p><img src="https://s3.bmp.ovh/imgs/2023/11/09/0c2e47868bcbee3f.png" alt=""></p><h3 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h3><p>要想访问静态资源，路径必须是 <a href="http://localhost:8081/js/xx.js">http://localhost:8081/js/xx.js</a> 才能访问。<br>可采用<strong>基址+相对路径=绝对路径</strong>的方式解决<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + &quot;://&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + path + &quot;/&quot;;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></p><p><strong>注意：引入js必须放在body内，form表单后，可能跟页面渲染顺序有关。不然会找不到标签</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;%=basePath%&gt;/js/area_json.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;%=basePath%&gt;/js/city_select.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="拦截静态资源问题"><a href="#拦截静态资源问题" class="headerlink" title="拦截静态资源问题"></a>拦截静态资源问题</h3><p>不做任何配置情况下静态资源会被SpringMVC拦截导致访问不了<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span> 拦截所有请求(html、css、js....)，不包括.jsp</span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span> 拦截所有请求，包括.jsp</span><br></pre></td></tr></table></figure></p><p>此时控制台会出现类似 <code>Unexpected token &#39;＜&#39;</code>、<code>net::ERR_ABORTED 404 (Not Found)</code>等报错信息</p><p><strong>解决方案</strong><br>首先，你要保证你的css、js等静态资源加载路径没问题，再来解决资源被拦截，否则，你解决资源被拦截最终还是404，或者页面无效果。</p><p>三种方法</p><ol><li>在web.xml，重新配置<code>&lt;servlet-mapping&gt;</code>让其通过<code>web.xml</code>针对文件后缀，对客户端请求的静态资源的请求交由默认的servlet进行处理</li><li>在springmvc.xml配置中，配置<code>&lt;mvc:default-servlet-handler/&gt;</code></li><li>在springmvc.xml配置文件中，配置<code>&lt;mvc:resources mapping=&quot;/xx/**&quot; location=&quot;xxx&quot;/&gt;</code></li></ol><h3 id="过滤器问题（未登录时确保能够访问js）"><a href="#过滤器问题（未登录时确保能够访问js）" class="headerlink" title="过滤器问题（未登录时确保能够访问js）"></a>过滤器问题（未登录时确保能够访问js）</h3><blockquote><p>LoginFilter.java</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span><br><span class="line"><span class="params">                         FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> req.getServletPath(); <span class="comment">//获取客户端所请求的脚本文件的文件路径</span></span><br><span class="line">    <span class="keyword">if</span>( ......servletPath.startsWith(<span class="string">&quot;/js/&quot;</span>)) <span class="comment">//匹配/js路径下的所有文件</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;&lt;%=basePath%&gt;/js/area_json.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%=basePath%&gt;/js/city_select.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>web.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web与restful作业 |蒙娜丽莎的微笑（LSB算法、Provider消息处理）</title>
      <link href="/2023/11/09/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E8%92%99%E5%A8%9C%E4%B8%BD%E8%8E%8E/"/>
      <url>/2023/11/09/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E8%92%99%E5%A8%9C%E4%B8%BD%E8%8E%8E/</url>
      
        <content type="html"><![CDATA[<blockquote><p>课程地址：<a href="https://www.icourse163.org/course/JXUFE-1206000802">https://www.icourse163.org/course/JXUFE-1206000802</a></p></blockquote><h2 id="如何读取、写入消息体"><a href="#如何读取、写入消息体" class="headerlink" title="如何读取、写入消息体"></a>如何读取、写入消息体</h2><p><img src="https://s3.bmp.ovh/imgs/2023/11/08/c2683534a0c3d8ab.png" alt=""></p><h3 id="MessageBodyReader接口"><a href="#MessageBodyReader接口" class="headerlink" title="MessageBodyReader接口"></a>MessageBodyReader接口</h3><p><strong>将获得的数据转换为要求的数据</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isbn=5214589</span><br><span class="line">caption=大学语文</span><br><span class="line">price=10.25</span><br></pre></td></tr></table></figure><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;isbn&quot;</span><span class="punctuation">:</span><span class="string">&quot;5214589&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caption&quot;</span><span class="punctuation">:</span><span class="string">&quot;大学语文&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">10.25</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><img src="https://s3.bmp.ovh/imgs/2023/11/08/71677927e4e9d1eb.png" alt=""></p><h3 id="MessageBodyWriter接口"><a href="#MessageBodyWriter接口" class="headerlink" title="MessageBodyWriter接口"></a>MessageBodyWriter接口</h3><p><strong>将数据写入响应报文包体前的工作</strong><br><img src="https://s3.bmp.ovh/imgs/2023/11/09/30ca927ee4e9e4db.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2023/11/09/fe3abd1b7c93e9b3.png" alt=""></p><h2 id="案例：蒙娜丽莎的微笑"><a href="#案例：蒙娜丽莎的微笑" class="headerlink" title="案例：蒙娜丽莎的微笑"></a>案例：蒙娜丽莎的微笑</h2><p><strong>从蒙娜丽莎画像 (bmp24位、1000*1531像素) 中提取隐藏的信息</strong></p><p><strong>信息隐写过程如下(LSB算法)：</strong></p><p><img src="https://s3.bmp.ovh/imgs/2023/11/04/0e992d3dd08db8bd.jpg" alt=""></p><h3 id="部分代码"><a href="#部分代码" class="headerlink" title="部分代码"></a>部分代码</h3><blockquote><p>restful.provider.Bmp24BitDecodeProvider.java</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Consumes;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.WebApplicationException;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.MediaType;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.MultivaluedMap;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.ext.MessageBodyReader;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.ext.MessageBodyWriter;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.ext.Provider;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> restful.utils.SimpleUploadUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Provider</span></span><br><span class="line"><span class="meta">@Consumes(&quot;monaLisa/input&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;monaLisa/output&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bmp24BitDecodeProvider</span> <span class="keyword">implements</span> <span class="title class_">MessageBodyReader</span>&lt;BufferedImage&gt;, MessageBodyWriter&lt;BufferedImage&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeTo</span><span class="params">(BufferedImage bufferedImage, Class&lt;?&gt; clazz, Type type, Annotation[] annotations, MediaType mediaType,</span></span><br><span class="line"><span class="params">MultivaluedMap&lt;String, Object&gt; multivaluedMap, OutputStream entityStream)</span></span><br><span class="line"><span class="keyword">throws</span> IOException, WebApplicationException &#123;</span><br><span class="line"><span class="comment">// bufferImage转byte数组</span></span><br><span class="line"><span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">ImageIO.write(bufferedImage, <span class="string">&quot;BMP&quot;</span>, outputStream);</span><br><span class="line">outputStream.flush();</span><br><span class="line"><span class="type">byte</span>[] byteArray = outputStream.toByteArray();</span><br><span class="line">outputStream.close();</span><br><span class="line">        <span class="comment">// byte数组转base64字符串</span></span><br><span class="line"><span class="type">String</span> <span class="variable">base64</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(byteArray);</span><br><span class="line"><span class="comment">// 向包体写入base64字符串</span></span><br><span class="line">entityStream.write(base64.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> BufferedImage <span class="title function_">readFrom</span><span class="params">(Class&lt;BufferedImage&gt; clazz, Type type, Annotation[] annotations, MediaType mediaType,</span></span><br><span class="line"><span class="params">MultivaluedMap&lt;String, String&gt; multivaluedMap, InputStream entityStream)</span></span><br><span class="line"><span class="keyword">throws</span> IOException, WebApplicationException &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(SimpleUploadUtils.getSingleFileBytsFromEntity(entityStream)); </span><br><span class="line"><span class="type">BufferedImage</span> <span class="variable">bufferedImage</span> <span class="operator">=</span>  ImageIO.read(byteArrayInputStream);</span><br><span class="line"><span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bufferedImage.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bufferedImage.getHeight(); </span><br><span class="line">        <span class="comment">// 逐行遍历每个像素并提取RGB值</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">dataStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; height; y++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">pixel</span> <span class="operator">=</span> bufferedImage.getRGB(x, y);</span><br><span class="line">                <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (pixel &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (pixel &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> pixel &amp; <span class="number">0xFF</span>;</span><br><span class="line">                <span class="comment">// RGB分量最低位</span></span><br><span class="line">                dataStream.append(red &amp; <span class="number">0b00000001</span>);</span><br><span class="line">                dataStream.append(green &amp; <span class="number">0b00000001</span>);</span><br><span class="line">                dataStream.append(blue &amp; <span class="number">0b00000001</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//提取信息A的长度信息（前4个字节）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lengthStr</span> <span class="operator">=</span> dataStream.substring(<span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">lengthBits</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(lengthStr).reverse();</span><br><span class="line">        <span class="comment">//单位字节</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> Integer.parseInt(lengthBits.toString(), <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 提取信息A自身的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">tempStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">messageBin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">32</span>; i &lt; <span class="number">32</span>+length*<span class="number">8</span>; i+=<span class="number">8</span>)&#123;</span><br><span class="line">        tempStr = dataStream.substring(i, i + <span class="number">8</span>);<span class="comment">//提取8位</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">tempBits</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(tempStr).reverse();<span class="comment">//反转</span></span><br><span class="line">        messageBin.append(tempBits);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将二进制字符串转换为字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] messageByteArray = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; messageBin.length(); i += <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">binString</span> <span class="operator">=</span> messageBin.substring(i, i + <span class="number">8</span>);</span><br><span class="line">            <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> (<span class="type">byte</span>) Integer.parseInt(binString, <span class="number">2</span>);</span><br><span class="line">            messageByteArray[i / <span class="number">8</span>] = b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建新的bufferImage</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(messageByteArray);</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">secretImage</span> <span class="operator">=</span> ImageIO.read(inputStream);</span><br><span class="line">        inputStream.close();</span><br><span class="line"><span class="keyword">return</span> secretImage;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getSize</span><span class="params">(BufferedImage arg0, Class&lt;?&gt; arg1, Type arg2, Annotation[] arg3, MediaType arg4)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWriteable</span><span class="params">(Class&lt;?&gt; arg0, Type arg1, Annotation[] arg2, MediaType arg3)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> arg1 == BufferedImage.class;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isReadable</span><span class="params">(Class&lt;?&gt; arg0, Type arg1, Annotation[] arg2, MediaType arg3)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> arg1 == BufferedImage.class;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>uncover.jsp</p></blockquote><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line"><span class="type">String</span> <span class="variable">basePath</span> <span class="operator">=</span> request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path;</span><br><span class="line">%&gt;    </span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;&lt;%=basePath%&gt;/js/jquery-3.1.0.min.js&quot;</span>&gt;&lt;/script&gt; </span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;解密蒙拉丽莎&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">蒙拉丽莎<span class="number">24</span>位BMP：&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;monaLisaFile&quot;</span> id=<span class="string">&quot;monaLisaFile&quot;</span>&gt;&lt;button id=<span class="string">&quot;submitMonaLisa&quot;</span>&gt;开始解密&lt;/button&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;fileDownLoad&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(document).ready(function()&#123;</span><br><span class="line"> $(<span class="string">&quot;#submitMonaLisa&quot;</span>).click(function () &#123;</span><br><span class="line"> <span class="type">var</span> <span class="variable">formData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line"> <span class="type">var</span> <span class="variable">monaLisaFile</span> <span class="operator">=</span> document.getElementById(<span class="string">&quot;monaLisaFile&quot;</span>).files[<span class="number">0</span>]; </span><br><span class="line"> </span><br><span class="line">formData.append(<span class="string">&quot;file&quot;</span>, monaLisaFile);</span><br><span class="line"> </span><br><span class="line">             $.ajax(&#123;</span><br><span class="line">                 url: <span class="string">&quot;&lt;%=basePath%&gt;/monaLisa/uncover&quot;</span>,</span><br><span class="line">                 data: formData,</span><br><span class="line">                 type: <span class="string">&quot;post&quot;</span>,                 </span><br><span class="line">                 cache: <span class="literal">false</span>,</span><br><span class="line">                 processData: <span class="literal">false</span>,</span><br><span class="line">                 contentType: <span class="string">&quot;monaLisa/input&quot;</span>,</span><br><span class="line">                 success: function (data) &#123;</span><br><span class="line">                 </span><br><span class="line">                 $(<span class="string">&quot;#fileDownLoad&quot;</span>).html(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                 </span><br><span class="line">                 <span class="type">var</span> <span class="variable">downloadLink</span> <span class="operator">=</span> $(<span class="string">&quot;&lt;a&gt;&quot;</span>);</span><br><span class="line">                 downloadLink.attr(<span class="string">&#x27;href&#x27;</span>,<span class="string">&#x27;data:application/octet-stream;base64,&#x27;</span>+data);    </span><br><span class="line">                 downloadLink.attr(<span class="string">&#x27;target&#x27;</span>,<span class="string">&#x27;_blank&#x27;</span>);    </span><br><span class="line">                 downloadLink.text(<span class="string">&quot;下载解密后的文件&quot;</span>);</span><br><span class="line">                     $(<span class="string">&quot;#fileDownLoad&quot;</span>).append(downloadLink);</span><br><span class="line">                                    </span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;)</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>restful.api.MonaLisaDecode.java</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Consumes;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.GET;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.POST;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/monaLisa&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonaLisaDecode</span> &#123;</span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Consumes(&quot;monaLisa/input&quot;)</span></span><br><span class="line"><span class="meta">@Produces(&quot;monaLisa/output&quot;)</span></span><br><span class="line"><span class="meta">@Path(&quot;/uncover&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BufferedImage <span class="title function_">uncover</span><span class="params">(BufferedImage  bmp24bit)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">return</span> bmp24bit;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restful </tag>
            
            <tag> Provider消息处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web与restful作业 | 秘密信件(表单参数传输、信息加密)</title>
      <link href="/2023/11/02/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E7%A7%98%E5%AF%86%E4%BF%A1%E4%BB%B6/"/>
      <url>/2023/11/02/web%E4%B8%8Erestful%E6%8A%80%E6%9C%AF-%E7%A7%98%E5%AF%86%E4%BF%A1%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>课程地址：<a href="https://www.icourse163.org/course/JXUFE-1206000802">https://www.icourse163.org/course/JXUFE-1206000802</a></p></blockquote><h3 id="秘密的情书"><a href="#秘密的情书" class="headerlink" title="秘密的情书"></a>秘密的情书</h3><p><img src="https://s3.bmp.ovh/imgs/2023/11/04/0017c67c4b816eca.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2023/11/04/53eda080b5f98bf0.png" alt=""><br><img src="https://s3.bmp.ovh/imgs/2023/11/04/f65d1fc1ce0f1d2c.png" alt=""></p><h3 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cipher1=&quot;2770d0b53955accfd6b97b160c699ebe7e0aeb843f1fff9cfd9498e8c6ae50358ffd37174f3880efcab8523ef692fcdd&quot;</span><br></pre></td></tr></table></figure><p><img src="https://s3.bmp.ovh/imgs/2023/11/04/cd9892ce11ef3cad.png" alt=""></p><h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> restful.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.FormParam;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.POST;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/letter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LetterAPI</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/getCipherKey&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCipherKey</span><span class="params">(<span class="meta">@FormParam(value = &quot;cipherText&quot;)</span> String cipherText)</span> &#123;</span><br><span class="line"><span class="type">byte</span>[] keyBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[cipherText.length() / <span class="number">2</span>];</span><br><span class="line"><span class="comment">// 将cipher1字符串转换为cipherByte数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cipherText.length(); i += <span class="number">4</span>) &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">byte1</span> <span class="operator">=</span> cipherText.substring(i, i + <span class="number">2</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">byte2</span> <span class="operator">=</span> cipherText.substring(i + <span class="number">2</span>, i + <span class="number">4</span>);</span><br><span class="line"><span class="type">char</span> <span class="variable">char1</span> <span class="operator">=</span> (<span class="type">char</span>) Integer.parseInt(byte1, <span class="number">16</span>);</span><br><span class="line"><span class="type">char</span> <span class="variable">char2</span> <span class="operator">=</span> (<span class="type">char</span>) Integer.parseInt(byte2, <span class="number">16</span>);</span><br><span class="line">keyBytes[i / <span class="number">4</span>] = (<span class="type">byte</span>) (char1 ^ char2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(keyBytes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/createCipherKey&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">createCipherKey</span><span class="params">(<span class="meta">@FormParam(value = &quot;key&quot;)</span> String str, <span class="meta">@FormParam(value = &quot;number&quot;)</span> String key)</span> &#123;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">newkey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="comment">// 生成随机数加密</span></span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(<span class="number">69</span> - <span class="number">20</span> + <span class="number">1</span>) + <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(i) ^ key.charAt(i % key.length());</span><br><span class="line">c = c ^ x;</span><br><span class="line">newkey.append(String.format(<span class="string">&quot;%02x&quot;</span>, c));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newkey.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/createCipherText&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">createCipherText</span><span class="params">(<span class="meta">@FormParam(value = &quot;text&quot;)</span> String str, <span class="meta">@FormParam(value = &quot;key&quot;)</span> String key)</span> &#123;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">newkey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="comment">// 生成随机数加密</span></span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(<span class="number">69</span> - <span class="number">20</span> + <span class="number">1</span>) + <span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(i) ^ key.charAt(i % key.length());</span><br><span class="line">c = c ^ x;</span><br><span class="line">newkey.append(String.format(<span class="string">&quot;%02x&quot;</span>, c));</span><br><span class="line">&#125;</span><br><span class="line">newkey.append(x);<span class="comment">// 记录这个随机数</span></span><br><span class="line"><span class="keyword">return</span> newkey.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path(&quot;/decodeCipherText&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">decodeCipherText</span><span class="params">(<span class="meta">@FormParam(value = &quot;cipherText&quot;)</span> String cipherText,</span></span><br><span class="line"><span class="params"><span class="meta">@FormParam(value = &quot;key&quot;)</span> String key)</span> &#123;</span><br><span class="line"><span class="comment">// 取出随机数信息</span></span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> Integer.parseInt(cipherText.substring(cipherText.length() - <span class="number">2</span>));</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">decipheredText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cipherText.length() - <span class="number">2</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> Integer.parseInt(cipherText.substring(i, i + <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line">c = c ^ x;</span><br><span class="line">c = c ^ key.charAt(i / <span class="number">2</span> % key.length());</span><br><span class="line">decipheredText.append((<span class="type">char</span>) c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> decipheredText.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于通过内网穿透上线测试web项目</title>
      <link href="/2023/10/17/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
      <url>/2023/10/17/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>开发course compass项目时想要上线进行测试项目，但是又不想部署到服务器上</p><p>查阅发现可以通过内网穿透将自己的主机当成服务器，穿透得到一个公网ip，非本机用户可以通过此ip访问项目，非常适合进行项目测试</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NATAPP：https://natapp.cn/</span><br><span class="line">樱花穿透：https://www.natfrp.com/?page=panel&amp;module=download#index</span><br></pre></td></tr></table></figure><p>  <strong>由于樱花穿透使用http(s)需要认证 起初前后端都是使用的TCP协议通道，通道开启自动HTTPS。启动项目后发现前端出现以下类似报错：</strong><br>  <img src="https://img-blog.csdnimg.cn/6e929e9328b84e82b7a96442f02c43a7.png" alt=""></p><p>  <a href="https://blog.csdn.net/weixin_39255905/article/details/127434626">CSDN：VUE nginx 部署 SSL https访问 WebSocket 问题</a></p><p> <strong>后端可正常处理请求</strong></p><p> <strong>大概是https协议搞的鬼，于是我把前端项目的隧道换成了NATAPP的免费http协议通道。</strong><br> <strong>再次启动，搞定</strong></p>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Course Compass | 选课指南</title>
      <link href="/2023/10/15/CourseCompass%E9%80%89%E8%AF%BE%E6%8C%87%E5%8D%97/"/>
      <url>/2023/10/15/CourseCompass%E9%80%89%E8%AF%BE%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="选课指南"><a href="#选课指南" class="headerlink" title="选课指南"></a>选课指南</h2><ul><li>项目地址：<a href="https://gitee.com/sheepFly03/course-compass">https://gitee.com/sheepFly03/course-compass</a></li><li>后端：springboot、mybaties-plus</li><li>前端：Vue2、elementUI</li><li>数据库：mysql redis</li><li>实现功能：<ul><li>选课建议列表</li><li>分享建议</li><li>点赞、反馈</li><li>分级搜索</li><li>全局搜索（开发中）</li><li>websocket在线聊天室（开发中）</li></ul></li></ul><p><img src="https://z1.ax1x.com/2023/10/17/piPmLCR.png" alt=""><br><img src="https://z1.ax1x.com/2023/10/17/piPmb59.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> mybaties-plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>request.getSession().getAttribute(&quot;xxx&quot;)；获取值为空的问题</title>
      <link href="/2023/09/15/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E7%99%BB%E5%BD%95session%E8%8E%B7%E5%8F%96%E5%80%BC%E4%B8%BA%E7%A9%BA/"/>
      <url>/2023/09/15/%E6%8E%92%E9%94%99%E6%97%A5%E5%BF%97-%E7%99%BB%E5%BD%95session%E8%8E%B7%E5%8F%96%E5%80%BC%E4%B8%BA%E7%A9%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在登录的时候、储存用户的信息 request.getSession().setAttribute(“user”, user);登录成功后把用户信息存入SESSION，之后校验当前用户是否登录时通过request.getSession().getAttribute获取时始终是个空。</p><h3 id="原因分析："><a href="#原因分析：" class="headerlink" title="原因分析："></a>原因分析：</h3><p>跨域问题、我这里采用的是前后端分离技术。没有携带请求凭证（cookie、HTTP认证及客户端SSL证明）造成request.getSession()获取的是不同的sessionId。</p><h3 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h3><ol><li><p>后端配置<br><code>response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;http://127.0.0.1:8080&quot;);</code></p></li><li><p>前端配置<br><code>import axios from &#39;axios&#39;</code></p></li></ol><p><code>axios.defaults.withCredentials = true</code></p>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tools | 代码生成器</title>
      <link href="/2023/09/12/tools-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
      <url>/2023/09/12/tools-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="生成类"><a href="#生成类" class="headerlink" title="生成类"></a>生成类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码生成器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">//数据源</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSourceConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dataSourceConfig.setDbType(DbType.MYSQL);</span><br><span class="line">        dataSourceConfig.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSourceConfig.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/dormitory&quot;</span>);</span><br><span class="line">        dataSourceConfig.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSourceConfig.setPassword(<span class="string">&quot;lrx050014&quot;</span>);</span><br><span class="line">        autoGenerator.setDataSource(dataSourceConfig);</span><br><span class="line">        <span class="comment">//全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        globalConfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        globalConfig.setAuthor(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        globalConfig.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//去掉Service的I</span></span><br><span class="line">        globalConfig.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line">        <span class="comment">//包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        packageConfig.setParent(<span class="string">&quot;com.dormMS&quot;</span>);</span><br><span class="line">        packageConfig.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        packageConfig.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        packageConfig.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        packageConfig.setServiceImpl(<span class="string">&quot;service.impl&quot;</span>);</span><br><span class="line">        packageConfig.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        autoGenerator.setPackageInfo(packageConfig);</span><br><span class="line">        <span class="comment">//策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategyConfig.setInclude(<span class="string">&quot;absent&quot;</span>,<span class="string">&quot;building&quot;</span>,<span class="string">&quot;dormitory&quot;</span>,<span class="string">&quot;dormitory_admin&quot;</span>,<span class="string">&quot;moveout&quot;</span>,<span class="string">&quot;student&quot;</span>,<span class="string">&quot;system_admin&quot;</span>);</span><br><span class="line">        strategyConfig.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line">        <span class="comment">//启动</span></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis-Plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>宿舍管理系统 | springboot、mybaties-plus入门项目</title>
      <link href="/2023/08/31/DormMS%E5%AE%BF%E8%88%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/08/31/DormMS%E5%AE%BF%E8%88%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="DormMS宿舍管理系统"><a href="#DormMS宿舍管理系统" class="headerlink" title="DormMS宿舍管理系统"></a>DormMS宿舍管理系统</h2><ul><li>项目地址：<a href="https://gitee.com/sheepFly03/dorm-ms">https://gitee.com/sheepFly03/dorm-ms</a></li><li>后端：springboot、mybaties-plus</li><li>前端：Vue2、elementUI</li><li>数据库：mysql</li><li>实现功能：<ul><li>登录及权限设置（系统管理员、宿舍管理员）</li><li>首页展示日历、用户信息、系统公告</li><li>分页查询、模糊查询、多表查询</li><li>公告模块的增删改查（系统管理员）</li><li>宿管模块的增删改查（系统管理员）</li><li>学生模块的增删改查、迁出登记、缺勤登记、批量删除迁出、导出表格</li><li>楼宇及宿舍模块的增删改查</li><li>(更新) AOP实现系统日志</li><li>(更新) 头像文件上传 系统日志逆序展示</li><li>(更新) 登录验证码 重置密码</li></ul></li></ul><h3 id="项目展示"><a href="#项目展示" class="headerlink" title="项目展示"></a>项目展示</h3><p>登录<br><img src="https://s1.ax1x.com/2023/09/01/pP0alef.png" alt=""></p><p>系统管理员首页<br><img src="https://s1.ax1x.com/2023/09/01/pP0aAoD.png" alt=""><br>宿舍管理员首页<br><img src="https://s1.ax1x.com/2023/09/01/pP0wi5D.png" alt=""></p><p>公告展示：<br><img src="https://s1.ax1x.com/2023/09/01/pP0aDTU.png" alt=""></p><p>公告管理：<br><img src="https://s1.ax1x.com/2023/09/01/pP0aayq.png" alt=""></p><p>学生管理：<br><img src="https://s1.ax1x.com/2023/09/01/pP0dX8J.png" alt=""></p><h3 id="相关配置及代码片段"><a href="#相关配置及代码片段" class="headerlink" title="相关配置及代码片段"></a>相关配置及代码片段</h3><h4 id="CrosConfiguration-跨域问题"><a href="#CrosConfiguration-跨域问题" class="headerlink" title="CrosConfiguration(跨域问题)"></a>CrosConfiguration(跨域问题)</h4> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrosConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;HEAD&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PageConfiguration"><a href="#PageConfiguration" class="headerlink" title="PageConfiguration"></a>PageConfiguration</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="前端路由守卫"><a href="#前端路由守卫" class="headerlink" title="前端路由守卫"></a>前端路由守卫</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> systemAdmin = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;systemAdmin&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> dormitoryAdmin = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;dormitoryAdmin&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!(systemAdmin || dormitoryAdmin) &amp;&amp; to.<span class="property">path</span> !== <span class="string">&#x27;/login&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="JWT鉴权"><a href="#JWT鉴权" class="headerlink" title="JWT鉴权"></a>JWT鉴权</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jws;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名生成token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username  用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWT规则生成的token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">JwtToken</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + time))</span><br><span class="line">                .claim(<span class="string">&quot;username&quot;</span>, username)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, signature)</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken token字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果token有效返回true，否则返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(signature).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Http请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果token有效返回true，否则返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 从http请求头中获取token字符串</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(signature).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取会员id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Http请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 解析token后获得的用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUsernameByJwtToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(signature).parseClaimsJws(jwtToken);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String)claims.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageVO <span class="title function_">list</span><span class="params">(Integer page, Integer size)</span> &#123;</span><br><span class="line">    Page&lt;Dormitory&gt; dormitoryPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, size);</span><br><span class="line">    Page&lt;Dormitory&gt; resultPage = <span class="built_in">this</span>.dormitoryMapper.selectPage(dormitoryPage, <span class="literal">null</span>);</span><br><span class="line">    List&lt;DormitoryVO&gt; dormitoryVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Dormitory dormitory : resultPage.getRecords()) &#123;</span><br><span class="line">        <span class="type">DormitoryVO</span> <span class="variable">dormitoryVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DormitoryVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(dormitory, dormitoryVO);</span><br><span class="line">        <span class="type">Building</span> <span class="variable">building</span> <span class="operator">=</span> <span class="built_in">this</span>.buildingMapper.selectById(dormitory.getBuildingId());</span><br><span class="line">        dormitoryVO.setBuildingName(building.getName());</span><br><span class="line">         dormitoryVOList.add(dormitoryVO);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">PageVO</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVO</span>();</span><br><span class="line">    pageVO.setTotal(resultPage.getTotal());</span><br><span class="line">    pageVO.setData(dormitoryVOList);</span><br><span class="line">    <span class="keyword">return</span> pageVO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageVO <span class="title function_">search</span><span class="params">(SearchForm searchForm)</span> &#123;</span><br><span class="line">    Page&lt;Dormitory&gt; dormitoryPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(searchForm.getPage(), searchForm.getSize());</span><br><span class="line">    Page&lt;Dormitory&gt; resultPage = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (searchForm.getValue().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        resultPage = <span class="built_in">this</span>.dormitoryMapper.selectPage(dormitoryPage, <span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Dormitory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.like(searchForm.getKey(), searchForm.getValue());</span><br><span class="line">        resultPage = <span class="built_in">this</span>.dormitoryMapper.selectPage(dormitoryPage, queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;DormitoryVO&gt; dormitoryVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Dormitory dormitory : resultPage.getRecords()) &#123;</span><br><span class="line">        <span class="type">DormitoryVO</span> <span class="variable">dormitoryVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DormitoryVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(dormitory, dormitoryVO);</span><br><span class="line">        <span class="type">Building</span> <span class="variable">building</span> <span class="operator">=</span> <span class="built_in">this</span>.buildingMapper.selectById(dormitory.getBuildingId());</span><br><span class="line">        dormitoryVO.setBuildingName(building.getName());</span><br><span class="line">        dormitoryVOList.add(dormitoryVO);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">PageVO</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVO</span>();</span><br><span class="line">    pageVO.setTotal(resultPage.getTotal());</span><br><span class="line">    pageVO.setData(dormitoryVOList);</span><br><span class="line">    <span class="keyword">return</span> pageVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多表连接SQL分页查询"><a href="#多表连接SQL分页查询" class="headerlink" title="多表连接SQL分页查询"></a>多表连接SQL分页查询</h4><p>按宿舍名称查询学生：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.dormMS.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudByDormName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.dormMS.entity.Student&quot;</span>&gt;</span></span><br><span class="line">        SELECT *</span><br><span class="line">        FROM student, dormitory</span><br><span class="line">        WHERE student.dormitory_id = dormitory.id AND dormitory.`name` LIKE concat(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageVO <span class="title function_">search</span><span class="params">(SearchForm searchForm)</span> &#123;</span><br><span class="line">    Page&lt;Student&gt; studentPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(searchForm.getPage(), searchForm.getSize());</span><br><span class="line">    List&lt;Student&gt; studentList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Student&gt;();</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(searchForm.getValue().equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">        Page&lt;Student&gt; resultPage = <span class="built_in">this</span>.studentMapper.selectPage(studentPage, <span class="literal">null</span>);</span><br><span class="line">        total += resultPage.getTotal();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Student&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//按宿舍name查询学生</span></span><br><span class="line">        <span class="keyword">if</span> (searchForm.getKey().equals(<span class="string">&quot;dormitory&quot;</span>))&#123;</span><br><span class="line">            IPage&lt;Student&gt; resultPage = <span class="built_in">this</span>.studentMapper.findStudByDormName(studentPage, searchForm.getValue());</span><br><span class="line">            studentList = resultPage.getRecords();</span><br><span class="line">            total += resultPage.getTotal();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            queryWrapper.like(searchForm.getKey(), searchForm.getValue());</span><br><span class="line">            Page&lt;Student&gt; resultPage = <span class="built_in">this</span>.studentMapper.selectPage(studentPage, queryWrapper);</span><br><span class="line">            studentList = resultPage.getRecords();</span><br><span class="line">            total += resultPage.getTotal();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//VO转换</span></span><br><span class="line">    List&lt;StudentVO&gt; studentVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : studentList) &#123;</span><br><span class="line">        <span class="type">StudentVO</span> <span class="variable">studentVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(student, studentVO);</span><br><span class="line">        <span class="type">Dormitory</span> <span class="variable">dormitory</span> <span class="operator">=</span> <span class="built_in">this</span>.dormitoryMapper.selectById(student.getDormitoryId());</span><br><span class="line">        studentVO.setDormitoryName(dormitory.getName());</span><br><span class="line">        studentVOList.add(studentVO);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">PageVO</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVO</span>();</span><br><span class="line">    pageVO.setData(studentVOList);</span><br><span class="line">    pageVO.setTotal(total);</span><br><span class="line">    <span class="keyword">return</span> pageVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="hutool工具库导出表格"><a href="#hutool工具库导出表格" class="headerlink" title="hutool工具库导出表格"></a>hutool工具库导出表格</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResultVO <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">ResultVO</span> <span class="variable">resultVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultVO</span>&lt;&gt;();</span><br><span class="line">    resultVO.setCode(<span class="number">0</span>);</span><br><span class="line">    List&lt;Student&gt; list = <span class="built_in">this</span>.studentMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//VO转换</span></span><br><span class="line">    List&lt;StudentVO&gt; studentVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : list) &#123;</span><br><span class="line">        <span class="type">StudentVO</span> <span class="variable">studentVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(student, studentVO);</span><br><span class="line">        <span class="type">Dormitory</span> <span class="variable">dormitory</span> <span class="operator">=</span> <span class="built_in">this</span>.dormitoryMapper.selectById(student.getDormitoryId());</span><br><span class="line">        studentVO.setDormitoryName(dormitory.getName());</span><br><span class="line">        studentVOList.add(studentVO);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (studentVOList.isEmpty()) &#123;resultVO.setCode(-<span class="number">1</span>); <span class="keyword">return</span> resultVO;&#125;</span><br><span class="line">    <span class="comment">//存储处理后的数据</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; allStud = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(studentVOList.size());</span><br><span class="line">    <span class="keyword">for</span> (StudentVO stud : studentVOList)&#123;</span><br><span class="line">        Map&lt;String, Object&gt; row = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        row.put(<span class="string">&quot;学号&quot;</span>, stud.getNumber());</span><br><span class="line">        row.put(<span class="string">&quot;姓名&quot;</span>, stud.getName());</span><br><span class="line">        row.put(<span class="string">&quot;性别&quot;</span>, stud.getGender());</span><br><span class="line">        row.put(<span class="string">&quot;宿舍&quot;</span>, stud.getDormitoryName());</span><br><span class="line">        row.put(<span class="string">&quot;状态&quot;</span>, stud.getState());</span><br><span class="line">        row.put(<span class="string">&quot;创建日期&quot;</span>, stud.getCreateDate());</span><br><span class="line">        allStud.add(row);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//写文件</span></span><br><span class="line">    <span class="type">ExcelWriter</span> <span class="variable">writer</span> <span class="operator">=</span> ExcelUtil.getWriter(<span class="literal">true</span>);</span><br><span class="line">    writer.merge(<span class="number">6</span> - <span class="number">1</span>, <span class="string">&quot;学生入住信息表&quot;</span>);</span><br><span class="line">    writer.write(allStud, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//下载</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>,<span class="string">&quot;attachment;filename=students.xlsx&quot;</span>);</span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        out = response.getOutputStream();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    writer.flush(out, <span class="literal">true</span>);</span><br><span class="line">    writer.close();</span><br><span class="line">    IoUtil.close(System.out);</span><br><span class="line">    <span class="keyword">return</span> resultVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h4><p><a href="https://blog.csdn.net/qq_44392492/article/details/117234382?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=aop%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-117234382.142^v93^insert_down1&amp;spm=1018.2226.3001.4187">参考资料</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统日志</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SysLog &#123;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.entity.CurrentUser;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.mapper.SysLogMapper;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.vo.ResultVO;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SysLogMapper sysLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(value = &quot;@annotation(syslog)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint, SysLog syslog)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        com.dormMS.entity.<span class="type">SysLog</span> <span class="variable">sysLogEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.dormMS.entity.SysLog();</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作名称</span></span><br><span class="line">        sysLogEntity.setOperation(syslog.value());</span><br><span class="line">        <span class="comment">//操作时间戳</span></span><br><span class="line">        sysLogEntity.setTime(DateUtil.now());</span><br><span class="line">        <span class="comment">//请求的方法名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        sysLogEntity.setMethod(className + <span class="string">&quot;.&quot;</span> + methodName + <span class="string">&quot;()&quot;</span>);</span><br><span class="line">        <span class="comment">//请求的参数</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="type">String</span> <span class="variable">params</span> <span class="operator">=</span> Arrays.toString(args);</span><br><span class="line">        sysLogEntity.setParams(params);</span><br><span class="line">        <span class="comment">//ip</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">        sysLogEntity.setIp(request.getRemoteAddr());</span><br><span class="line"></span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CurrentUser</span>();</span><br><span class="line">        sysLogEntity.setUsername(currentUser.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果不返回的话前端就没有ResultVO了</span></span><br><span class="line">        <span class="type">ResultVO</span> <span class="variable">resultVO</span> <span class="operator">=</span> (ResultVO)joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        sysLogMapper.insert(sysLogEntity);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="头像文件上传与获取"><a href="#头像文件上传与获取" class="headerlink" title="头像文件上传与获取"></a>头像文件上传与获取</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.util.ResultVOUtil;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.vo.ResultVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/files&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    <span class="comment">// 文件上传路径</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/file/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultVO <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (FileController.class)&#123;</span><br><span class="line">            <span class="comment">//获取当前时间戳</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> System.currentTimeMillis()+<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="comment">//获取文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//如果没有文件夹则新建一个</span></span><br><span class="line">            <span class="keyword">if</span> (!FileUtil.isDirectory(filePath))&#123;</span><br><span class="line">                FileUtil.mkdir(filePath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//文件上传 时间戳-文件名</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtil.writeBytes(file.getBytes(), filePath + flag + <span class="string">&#x27;-&#x27;</span> + filename);</span><br><span class="line">                System.out.println(filename + <span class="string">&quot;文件上传成功&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1L</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.err.println(filename + <span class="string">&quot;文件上传失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ResultVOUtil.success(flag);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flag</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;flag&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">avatarPath</span><span class="params">(<span class="meta">@PathVariable</span> String flag, HttpServletResponse response)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!FileUtil.isDirectory(filePath))&#123;</span><br><span class="line">            FileUtil.mkdir(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">        OutputStream os;</span><br><span class="line">        List&lt;String&gt; filenames = FileUtil.listFileNames(filePath);</span><br><span class="line">        <span class="comment">// 根据时间戳找文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">avatar</span> <span class="operator">=</span> filenames.stream().filter(name -&gt; name.contains(flag)).findAny().orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotEmpty(avatar)) &#123;</span><br><span class="line">                response.addHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(avatar, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">                <span class="type">byte</span>[] bytes = FileUtil.readBytes(filePath + avatar);  <span class="comment">// 通过文件的路径读取文件字节流</span></span><br><span class="line">                os = response.getOutputStream();   <span class="comment">// 通过输出流返回文件</span></span><br><span class="line">                os.write(bytes);</span><br><span class="line">                os.flush();</span><br><span class="line">                os.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件下载失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="逆序展示系统日志"><a href="#逆序展示系统日志" class="headerlink" title="逆序展示系统日志"></a>逆序展示系统日志</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.dormMS.mapper.SysLogMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll_desc&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.dormMS.entity.SysLog&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM sys_log order by id desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dormMS.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.dormMS.entity.SysLog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysLogMapper</span>  <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SysLog&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> IPage&lt;SysLog&gt; <span class="title function_">selectAll_desc</span><span class="params">(IPage&lt;SysLog&gt; page)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageVO <span class="title function_">list</span><span class="params">(Integer page, Integer size)</span> &#123;</span><br><span class="line">        Page&lt;SysLog&gt; sysLogPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, size);</span><br><span class="line">        IPage&lt;SysLog&gt; resultPage = <span class="built_in">this</span>.sysLogMapper.selectAll_desc(sysLogPage);</span><br><span class="line"><span class="comment">//        Page&lt;SysLog&gt; sysLogPage = new Page&lt;&gt;(page, size);</span></span><br><span class="line"><span class="comment">//        Page&lt;SysLog&gt; resultPage = this.sysLogMapper.selectPage(sysLogPage, null);</span></span><br><span class="line">        <span class="type">PageVO</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVO</span>();</span><br><span class="line">        pageVO.setTotal(resultPage.getTotal());</span><br><span class="line">        pageVO.setData(resultPage.getRecords());</span><br><span class="line">        <span class="keyword">return</span> pageVO;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> mybaties-plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单的人事管理系统pms</title>
      <link href="/2023/07/10/pms/"/>
      <url>/2023/07/10/pms/</url>
      
        <content type="html"><![CDATA[<h2 id="简单的人事管理系统"><a href="#简单的人事管理系统" class="headerlink" title="简单的人事管理系统"></a>简单的人事管理系统</h2><ul><li>2023年7月小学期</li><li>项目地址：<a href="https://gitee.com/sheepFly03/pms">https://gitee.com/sheepFly03/pms</a></li><li>使用技术：<ul><li>界面使用JavaSwing及beautyeye_lnf美化包</li><li>数据库mysql</li><li>jdbc</li></ul></li></ul><p><img src="https://s1.ax1x.com/2023/08/20/pP8G1PJ.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8G82R.jpg" alt=""></p><h3 id="基本信息管理"><a href="#基本信息管理" class="headerlink" title="基本信息管理"></a>基本信息管理</h3><h4 id="增删改查人员信息"><a href="#增删改查人员信息" class="headerlink" title="增删改查人员信息"></a>增删改查人员信息</h4><p><img src="https://s1.ax1x.com/2023/08/20/pP8GYKx.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8GBPH.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8GaVO.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8GNqK.jpg" alt=""></p><h4 id="部门管理"><a href="#部门管理" class="headerlink" title="部门管理"></a>部门管理</h4><p><img src="https://s1.ax1x.com/2023/08/20/pP8GwIe.jpg" alt=""></p><h3 id="人员调动"><a href="#人员调动" class="headerlink" title="人员调动"></a>人员调动</h3><p><img src="https://s1.ax1x.com/2023/08/20/pP8GDGd.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8h4DP.jpg" alt=""></p><h3 id="人员考核管理"><a href="#人员考核管理" class="headerlink" title="人员考核管理"></a>人员考核管理</h3><p><img src="https://s1.ax1x.com/2023/08/20/pP8hTUS.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8h5Hf.jpg" alt=""></p><h3 id="薪资管理"><a href="#薪资管理" class="headerlink" title="薪资管理"></a>薪资管理</h3><p><img src="https://s1.ax1x.com/2023/08/20/pP8h74g.jpg" alt=""><br><img src="https://s1.ax1x.com/2023/08/20/pP8hoE8.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaSwing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018蓝桥杯C/C++ B组 国赛</title>
      <link href="/2023/06/07/%E8%93%9D%E6%A1%A5%E6%9D%AF2018%E5%9B%BD%E8%B5%9B/"/>
      <url>/2023/06/07/%E8%93%9D%E6%A1%A5%E6%9D%AF2018%E5%9B%BD%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="一、换零钞"><a href="#一、换零钞" class="headerlink" title="一、换零钞"></a>一、换零钞</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>X 星球的钞票的面额只有：100 元，5 元，2 元，1 元，共 4 种。</p><p>小明去 X 星旅游，他手里只有 2 张 100 元的 X 星币，太不方便，恰好路过 X 星银行就去换零钱。</p><p>小明有点强迫症，他坚持要求 200 元换出的零钞中 2 元的张数刚好是 1 元的张数的 10 倍，剩下的当然都是 5 元面额的。</p><p>银行的工作人员有点为难，你能帮助算出：在满足小明要求的前提下，最少要换给他多少张钞票吗？（5 元，2 元，1 元面额的必须都有，不能是 0）</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>数学题，设1元钞票张数为$n$，则2元钞票应有$10n$张，1元和2元钞票面值为$20n+n=21n$元。<br>$21n$应为5的倍数，剩下的钱全是5元钞票，张数即$(200-21n)/5$。<br>总张数为$40-21n/5+11n$，函数单调递减，当$n=5$时，张数最少为$74$</p><h2 id="二、激光样式"><a href="#二、激光样式" class="headerlink" title="二、激光样式"></a>二、激光样式</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>X 星球的盛大节日为增加气氛，用 30 台机光器一字排开，向太空中打出光柱。</p><p>安装调试的时候才发现，不知什么原因，相邻的两台激光器不能同时打开！ 国王很想知道，在目前这种 bug 存在的情况下，一共能打出多少种激光效果？</p><p>显然，如果只有 3 台机器，一共可以成 5 种样式：</p><ul><li>全都关上（sorry, 此时无声胜有声，这也算一种）；</li><li>开一台，共 3 种；</li><li>开两台，只 1 种。</li></ul><p>30 台就不好算了，国王只好请你帮忙了。</p><p>要求输出一个整数，表示 30 台激光器能形成的样式种数。</p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><p>对于第i台灯来说，如果它不开，那么它之前一个开不开都无所谓，因此有：</p><pre><code class="lang-dp[i][0]=dp[i-1][0]+dp[i-1][1]```">如果它开，那么它之前一个必须得关闭，因此有：```dp[i][1]=dp[i-1][0]</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="type">long</span> <span class="type">long</span> dp[<span class="number">35</span>][<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  dp[<span class="number">1</span>][<span class="number">0</span>] = dp[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">30</span>; ++ i)</span><br><span class="line">  &#123;</span><br><span class="line">    dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>] + dp[i - <span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">    dp[i][<span class="number">1</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; dp[<span class="number">30</span>][<span class="number">0</span>] + dp[<span class="number">30</span>][<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dp </tag>
            
            <tag> 递推 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>滑动窗口最大值</title>
      <link href="/2023/05/30/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/"/>
      <url>/2023/05/30/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="滑动窗口的最大值"><a href="#滑动窗口的最大值" class="headerlink" title="滑动窗口的最大值"></a>滑动窗口的最大值</h2><p>给定一个数组 nums，有一个大小为 k 的滑动窗口从数组的最左侧移动到数组的最右侧。你只可以看到在滑动窗口内的 k 个数字。滑动窗口每次只向右移动一位。</p><p>返回滑动窗口中的最大值。</p><p><img src="https://code-thinking.cdn.bcebos.com/pics/239.%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC.png" alt=""></p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><iframe src="//player.bilibili.com/player.html?aid=729559279&bvid=BV1XS4y1p7qj&cid=806301877&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height=550 width=700> </iframe><p><a href="https://blog.csdn.net/mataojie/article/details/122310752?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168544811516800226543452%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168544811516800226543452&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-122310752-null-null.142^v88^insert_down28v1,239^v2^insert_chatgpt&amp;utm_term=deque&amp;spm=1018.2226.3001.4187">关于deque</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">deque&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="comment">//比较当前要弹出的数值是否等于队列出口元素的数值，如果相等则弹出。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Pop</span><span class="params">(<span class="type">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="comment">//与队头元素相等</span></span><br><span class="line">    <span class="keyword">if</span>(!q.<span class="built_in">empty</span>() &amp;&amp; value == q.<span class="built_in">front</span>())&#123;</span><br><span class="line">        q.<span class="built_in">pop_front</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(<span class="type">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="comment">//push进来的值大于队尾</span></span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>() &amp;&amp; value &gt; q.<span class="built_in">back</span>())&#123;</span><br><span class="line">        q.<span class="built_in">pop_back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    q.<span class="built_in">push_back</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getMax</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q.<span class="built_in">front</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> nums[] = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">-1</span>, <span class="number">-3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line"><span class="type">int</span> k = <span class="number">3</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123; <span class="comment">// 先将前k的元素放进队列</span></span><br><span class="line">        <span class="built_in">Push</span>(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="built_in">getMax</span>());<span class="comment">//记录最大值</span></span><br><span class="line">    <span class="comment">//移动窗口（添加元素）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Pop</span>(nums[i - k]);</span><br><span class="line">        <span class="built_in">Push</span>(nums[i]);</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="built_in">getMax</span>());<span class="comment">//记录最大值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        cout &lt;&lt; v[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 单调队列 </tag>
            
            <tag> 滑动窗口 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023蓝桥杯C/C++ B组复盘（居然晋级国赛）</title>
      <link href="/2023/05/10/2023%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
      <url>/2023/05/10/2023%E8%93%9D%E6%A1%A5%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前段时间较忙，博客已经鸽了一个月了(咕咕~) 惭愧惭愧<br>还有一个月备考蓝桥杯国赛，先复盘一下上个月的省赛题目吧</p></blockquote><h2 id="A：日期统计（5分）"><a href="#A：日期统计（5分）" class="headerlink" title="A：日期统计（5分）"></a>A：日期统计（5分）</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小蓝现在有一个长度为100的数组，数组中的每个元素的值都在0到9的范围之内。数组中的元素从左至右如下所示：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5 6 8 6 9 1 6 1 2 4 9 1 9 8 2 3 6 4 7 7</span><br><span class="line">5 9 5 0 3 8 7 5 8 1 5 8 6 1 8 3 0 3 7 9</span><br><span class="line">2 7 0 5 8 8 5 7 0 9 9 1 9 4 4 6 8 6 3 3</span><br><span class="line">8 5 1 6 3 4 6 7 0 7 8 2 7 6 8 9 5 6 5 6</span><br><span class="line">1 4 0 1 0 0 9 4 8 0 9 1 2 8 5 0 2 5 3 3</span><br></pre></td></tr></table></figure><br>现在他想要从这个数组中寻找一些满足以下条件的子序列：</p><ol><li>子序列的长度为8；</li><li>这个子序列可以按照下标顺序组成一个yyyymmdd 格式的日期，并且要求这个日期是2023 年中的某一天的日期，例如20230902，20231223。yyyy 表示年份，mm 表示月份，dd 表示天数，当月份或者天数的长度只有一位时需要一个前导零补充。</li></ol><p>请你帮小蓝计算下按上述条件一共能找到多少个不同的2023 年的日期。<br>对于相同的日期你只需要统计一次即可。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>考试的时候想纯手算找出所有可能日期，奈何眼睛受不了（实在泰难受辣），还是挺难数的</p><p><strong>暴力枚举每个2023年的日期，查询是否能由给出的数字序列拼出来：</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> numbers[<span class="number">100</span>] = &#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">5</span>,</span><br><span class="line">                          <span class="number">8</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">5</span>,</span><br><span class="line">                          <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">                          <span class="number">8</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span> days[<span class="number">13</span>] = &#123;<span class="number">0</span>, <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= days[i]; j++) &#123;</span><br><span class="line">            string str = <span class="string">&quot;2023&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">10</span>)str += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            str += <span class="built_in">to_string</span>(i);</span><br><span class="line">            <span class="keyword">if</span> (j &lt; <span class="number">10</span>)str += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            str += <span class="built_in">to_string</span>(j);</span><br><span class="line">            <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>; l &lt; <span class="number">100</span> &amp;&amp; k &lt; <span class="number">8</span>; l++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (numbers[l] == str[k] - <span class="string">&#x27;0&#x27;</span>) k++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (k &gt;= <span class="number">8</span>) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h2 id="B：01-串的熵（5分）"><a href="#B：01-串的熵（5分）" class="headerlink" title="B：01 串的熵（5分）"></a>B：01 串的熵（5分）</h2><h3 id="问题描述-1"><a href="#问题描述-1" class="headerlink" title="问题描述"></a>问题描述</h3><p>对于一个长度为$n$的$01$串$S = x_1x_2x_3…x_n$，香农信息熵的定义为$H(S)=-\sum^n_1p(x_i)\log_2(p(x_i))$，其中$p(0), p(1)$表示在这个$01$串中0和1出现的占比。比如，对于$S = 100$ 来说，信息熵$H(S)=-\frac{1}{3}\log_2(\frac{1}{3})-\frac{2}{3}\log_2(\frac{2}{3})-\frac{2}{3}\log_2(\frac{2}{3})=1.3083$</p><p>对于一个长度为$23333333$的$01$串，如果其信息熵为$11625907.5798$且$0$出现次数比$1$少，那么这个$01$串中$0$出现了多少次？</p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><p>注意对数运算<br><strong>暴力枚举：</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> total = <span class="number">23333333</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> H = <span class="number">11625907.5798</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; total / <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="type">double</span> ans = <span class="number">0</span>;</span><br><span class="line">        ans -= <span class="number">1.0</span> * i * i / total * <span class="built_in">log2</span>(<span class="number">1.0</span> * i / total);</span><br><span class="line">        ans -= <span class="number">1.0</span> * (total - i) * (total - i) / total * <span class="built_in">log2</span>(<span class="number">1.0</span> * (total - i) / total);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(ans - H) &lt; <span class="number">1e-4</span>) &#123;</span><br><span class="line">            cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="C-冶炼金属（10分）"><a href="#C-冶炼金属（10分）" class="headerlink" title="C: 冶炼金属（10分）"></a>C: 冶炼金属（10分）</h2><h3 id="问题描述-2"><a href="#问题描述-2" class="headerlink" title="问题描述"></a>问题描述</h3><p>小蓝有一个神奇的炉子用于将普通金属 O 冶炼成为一种特殊金属 X。这个炉子有一个称作转换率的属性 V，V 是一个正整数，这意味着消耗 V 个普通金属 O 恰好可以冶炼出一个特殊金属 X，当普通金属 O 的数目不足 V 时，无法继续冶炼。</p><p>现在给出了 N 条冶炼记录，每条记录中包含两个整数 A 和 B ，这表示本次投入了 A 个普通金属 O ，最终冶炼出了 B 个特殊金属 X 。每条记录都是独立的，这意味着上一次没消耗完的普通金属 O 不会累加到下一次的冶炼当中。</p><p>根据这 N 条冶炼记录，请你推测出转换率 V 的最小值和最大值分别可能是多少，题目保证评测数据不存在无解的情况。</p><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行一个整数N，表示冶炼记录的数目。<br>接下来输入N行，每行两个整数A、B，含义如题目所述。</p><h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>输出两个整数，分别表示 V 可能的最小值和最大值，中间用空格分开。</p><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">75 3</span><br><span class="line">53 2</span><br><span class="line">59 2</span><br></pre></td></tr></table></figure><h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20 25</span><br></pre></td></tr></table></figure><h3 id="样例说明"><a href="#样例说明" class="headerlink" title="样例说明"></a>样例说明</h3><p>当V = 20时，有：$\lfloor \frac{75}{20}=3 \rfloor、\lfloor \frac{53}{20}=2 \rfloor、\lfloor \frac{59}{20}=2 \rfloor$，可以看到符合所有冶炼记录。<br>当V = 25时，有：$\lfloor \frac{75}{25}=3 \rfloor、\lfloor \frac{53}{25}=2 \rfloor、\lfloor \frac{59}{25}=2 \rfloor$，可以看到符合所有冶炼记录。<br>且再也找不到比20更小或者比25更大的符合条件的V值了。</p><h3 id="评测用例规模与约定"><a href="#评测用例规模与约定" class="headerlink" title="评测用例规模与约定"></a>评测用例规模与约定</h3><p>对于$30%$的评测用例，$1 ≤ N ≤ 10^2$<br>对于$60%$的评测用例，$1 ≤ N ≤ 10^3$<br>对于$100%$的评测用例，$1 ≤ N ≤ 10^4，1 ≤ B ≤ A ≤ 10^9$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">10005</span>];</span><br><span class="line"><span class="type">int</span> b[<span class="number">10005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> maxV = <span class="number">1000000005</span>, minV = <span class="number">-1</span>;</span><br><span class="line"><span class="type">int</span> ansmin = <span class="number">1000000005</span>, ansmax = <span class="number">-1</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a[i],&amp;b[i]);</span><br><span class="line">maxV = <span class="built_in">min</span>(maxV, a[i]/b[i]);</span><br><span class="line">minV = <span class="built_in">max</span>(minV, a[i]/(b[i]+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> V = maxV; V &gt;= minV; V--)&#123;</span><br><span class="line"><span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n ; i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] / V != b[i])&#123;</span><br><span class="line">flag = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line">ansmin = <span class="built_in">min</span>(ansmin, V);</span><br><span class="line">ansmax = <span class="built_in">max</span>(ansmax, V);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt;ansmin &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;ansmax;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>赛后<br>每两个a,b都能求出炼制效率的最小值l，和最大值，即一个可能区间[l,r]，所有区间的交集就是答案，每对数据都是在缩小区间<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">10005</span>];</span><br><span class="line"><span class="type">int</span> b[<span class="number">10005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> maxV = <span class="number">1000000005</span>, minV = <span class="number">-1</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a[i],&amp;b[i]);</span><br><span class="line">maxV = <span class="built_in">min</span>(maxV, a[i]/b[i]);</span><br><span class="line">minV = <span class="built_in">max</span>(minV, a[i]/(b[i]+<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt;minV &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;maxV;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="D-飞机降落（10分）"><a href="#D-飞机降落（10分）" class="headerlink" title="D: 飞机降落（10分）"></a>D: 飞机降落（10分）</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>有 N 架飞机准备降落到某个只有一条跑道的机场。</p><p>其中第 i 架飞机在$T_i$时刻到达机场上空，到达时它的剩余油料还可以继续盘旋$D_i$个单位时间，即它最早可以于$T_i$时刻开始降落，最晚可以于$T_i+D_i$时刻开始降落。</p><p>降落过程需要$L_i$个单位时间。</p><p>一架飞机降落完毕时，另一架飞机可以立即在同一时刻开始降落，但是不能在前一架飞机完成降落前开始降落。</p><p>请你判断 N 架飞机是否可以全部安全降落。</p><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入包含多组数据。</p><p>第一行包含一个整数 T，代表测试数据的组数。</p><p>对于每组数据，第一行包含一个整数 N。</p><p>以下 N 行，每行包含三个整数：$T_i，D_i 和 L_i$。</p><h3 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h3><p>对于每组数据，输出<code>YES</code>或者<code>NO</code>，代表是否可以全部安全降落。</p><h3 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h3><p>对于 30% 的数据，$N≤2$<br>对于 100% 的数据，$1≤T≤10，1≤N≤10，0≤T_i,D_i,L_i≤10^5$</p><h3 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br><span class="line">0 100 10</span><br><span class="line">10 10 10</span><br><span class="line">0 2 20</span><br><span class="line">3</span><br><span class="line">0 10 20</span><br><span class="line">10 10 20</span><br><span class="line">20 10 20</span><br></pre></td></tr></table></figure><h3 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YES</span><br><span class="line">NO</span><br></pre></td></tr></table></figure><h3 id="样例解释"><a href="#样例解释" class="headerlink" title="样例解释"></a>样例解释</h3><p>对于第一组数据，可以安排第 3 架飞机于 0 时刻开始降落，20 时刻完成降落。安排第 2 架飞机于 20 时刻开始降落，30 时刻完成降落。安排第 1 架飞机于 30 时刻开始降落，40 时刻完成降落。</p><p>对于第二组数据，无论如何安排，都会有飞机不能及时降落。</p><h3 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3><blockquote><p>待填坑 考试时只编程了30%的数据点</p></blockquote><h2 id="E-接龙数列（15分）"><a href="#E-接龙数列（15分）" class="headerlink" title="E: 接龙数列（15分）"></a>E: 接龙数列（15分）</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>对于一个长度为 K 的整数数列：A1,A2,…,AK，我们称之为接龙数列当且仅当 $A_i$ 的首位数字恰好等于 $A_i−1$的末位数字 (2≤ i ≤K)。</p><p>例如 12,23,35,56,61,11 是接龙数列；12,23,34,56 不是接龙数列，因为 56 的首位数字不等于 34 的末位数字。</p><p>所有长度为 1 的整数数列都是接龙数列。</p><p>现在给定一个长度为 N 的数列 A1,A2,…,AN，请你计算最少从中删除多少个数，可以使剩下的序列是接龙序列？</p><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含一个整数 N。<br>第二行包含 N 个整数 A1,A2,…,AN</p><h3 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h3><p>一个整数代表答案。</p><h3 id="数据范围-1"><a href="#数据范围-1" class="headerlink" title="数据范围"></a>数据范围</h3><p>对于 20% 的数据，1≤N≤20<br>对于 50% 的数据，1≤N≤10000<br>对于 100% 的数据，$1≤N≤10^5，1≤A_i≤10^9$。所有 $A_i$保证不包含前导 0</p><h3 id="输入样例：-1"><a href="#输入样例：-1" class="headerlink" title="输入样例："></a>输入样例：</h3><p>5<br>11 121 22 12 2023</p><h3 id="输出样例：-1"><a href="#输出样例：-1" class="headerlink" title="输出样例："></a>输出样例：</h3><p>1</p><h3 id="样例解释-1"><a href="#样例解释-1" class="headerlink" title="样例解释"></a>样例解释</h3><p>删除 22，剩余 11,121,12,2023 是接龙数列。</p><blockquote><p><a href="https://www.acwing.com/solution/content/184189/">解析文章</a><br><a href="https://www.bilibili.com/video/BV1kN411w7N6/?spm_id_from=333.999.0.0&amp;vd_source=4c4e06d9794ecf36566117b17c0bf46a">解析视频</a></p><iframe src="//player.bilibili.com/player.html?aid=312395382&bvid=BV1kN411w7N6&cid=1094551903&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height=550 width=700> </iframe></blockquote><p><strong>原始版dp 时间复杂度n方，超时</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> b[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">//f[i]表示以第i个数字为结尾的接龙数列的集合,属性为最长长度</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; str;</span><br><span class="line">        a[i] = str[<span class="number">0</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        b[i] = str[<span class="built_in">strlen</span>(str) - <span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        f[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//遍历到第i个数字之前</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i - <span class="number">1</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b[j] == a[i]) </span><br><span class="line">            f[i] = <span class="built_in">max</span>(f[i], f[j] + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        res = <span class="built_in">max</span>(res, f[i]);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; n - res &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>优化</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> b[N];</span><br><span class="line"><span class="type">int</span> g[<span class="number">10</span>];<span class="comment">//用于存储第i个数字之前以末尾数字k(0 &lt;= k &lt;= 9)为结尾的接龙序列的max</span></span><br><span class="line"><span class="comment">//即g[k]表示在第i个数字以前,为k为末尾的接龙序列的最大长度</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; str;</span><br><span class="line">        a[i] = str[<span class="number">0</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        b[i] = str[<span class="built_in">strlen</span>(str) - <span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        f[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//由于第i个数字的首位为a[i],那么只关心以a[i]为结尾的数字</span></span><br><span class="line">        f[i] = <span class="built_in">max</span>(f[i], g[a[i]] + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//由于第i个数字的末尾为b[i],那么就要更新g[b[i]</span></span><br><span class="line">        g[b[i]] = <span class="built_in">max</span>(g[b[i]], f[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        res = <span class="built_in">max</span>(res, f[i]);</span><br><span class="line">    cout &lt;&lt; n - res &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="F-岛屿个数（15分）"><a href="#F-岛屿个数（15分）" class="headerlink" title="F: 岛屿个数（15分）"></a>F: 岛屿个数（15分）</h2><blockquote><p>待填坑</p></blockquote><h2 id="G-子串简写（20分）"><a href="#G-子串简写（20分）" class="headerlink" title="G: 子串简写（20分）"></a>G: 子串简写（20分）</h2><h3 id="子串简写"><a href="#子串简写" class="headerlink" title="子串简写"></a>子串简写</h3><h3 id="问题描述-3"><a href="#问题描述-3" class="headerlink" title="问题描述"></a>问题描述</h3><p>程序猿圈子里正在流行一种很新的简写方法：对于一个字符串，只保留首尾字符，将首尾字符之间的所有字符用这部分的长度代替。例如internationalization简写成i18n，Kubernetes 简写成K8s, Lanqiao 简写成L5o 等。</p><p>在本题中，我们规定长度大于等于K的字符串都可以采用这种简写方法（长度小于K的字符串不配使用这种简写）。</p><p>给定一个字符串S SS 和两个字符$c_1和c_2$,<br>​请你计算S有多少个以$c_1$开头 以$c_2$结尾子串可以采用这种简写？</p><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含一个整数K。<br>第二行包含一个字符串S 和两个字符$c_1和c_2$。</p><h3 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h3><p>一个整数代表答案。</p><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><p>4<br>abababdb a b</p><h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><p>6</p><h3 id="样例说明-1"><a href="#样例说明-1" class="headerlink" title="样例说明"></a>样例说明</h3><p>符合条件的子串如下所示，中括号内是该子串：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[abab]abdb</span><br><span class="line">[ababab]db</span><br><span class="line">[abababdb]</span><br><span class="line">ab[abab]db</span><br><span class="line">ab[ababdb]</span><br><span class="line">abab[abdb]</span><br></pre></td></tr></table></figure></p><h3 id="评测用例规模与约定-1"><a href="#评测用例规模与约定-1" class="headerlink" title="评测用例规模与约定"></a>评测用例规模与约定</h3><p>对于30%的评测用例 2 &lt;= K &lt;= |S| &lt;= 10000。<br>对于100%的评测用例，2 ≤ K ≤ ∣S∣ ≤ 5 × 10^5。S只包含小写字母c1和c2都是小写字母。<br>∣S∣代表字符串S的长度。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> k;</span><br><span class="line">string s;</span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">cin&gt;&gt;k;</span><br><span class="line">cin&gt;&gt;s;</span><br><span class="line"><span class="type">char</span> a,b;</span><br><span class="line">cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">0</span>;l+k<span class="number">-1</span> &lt; s.<span class="built_in">size</span>(); l++)&#123;</span><br><span class="line"><span class="keyword">if</span>(s[l]!=a)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> r = l+k<span class="number">-1</span>; r &lt; s.<span class="built_in">size</span>(); r++)&#123;</span><br><span class="line"><span class="keyword">if</span>(s[r]!=b)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">ans++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout&lt;&lt;ans;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="H-整数删除（20分）"><a href="#H-整数删除（20分）" class="headerlink" title="H: 整数删除（20分）"></a>H: 整数删除（20分）</h2><h3 id="问题描述-4"><a href="#问题描述-4" class="headerlink" title="问题描述"></a>问题描述</h3><p>给定一个长度为N的整数数列：$A_1, A_2, …, A_N$。你要重复以下操作K次：<br>每次选择数列中最小的整数（如果最小值不止一个，选择最靠前的），将其删除。并把与它相邻的整数加上被删除的数值。<br>输出K次操作后的序列。</p><h3 id="输入格式-4"><a href="#输入格式-4" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含两个整数 N 和 K。<br>第二行包含N个整数，$A_1, A_2, A_3, …, A_N$</p><h3 id="输出格式-4"><a href="#输出格式-4" class="headerlink" title="输出格式"></a>输出格式</h3><p>输出N − K个整数，中间用一个空格隔开，代表K次操作后的序列。</p><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><p>5 3<br>1 4 2 8 7</p><h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><p>17 7</p><h3 id="样例说明-2"><a href="#样例说明-2" class="headerlink" title="样例说明"></a>样例说明</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数列变化如下，中括号里的数是当次操作中被选择的数：</span><br><span class="line">[1] 4 2 8 7</span><br><span class="line">5 [2] 8 7</span><br><span class="line">[7] 10 7</span><br><span class="line">17 7</span><br></pre></td></tr></table></figure><p>评测用例规模与约定<br>对于 20% 的评测用例，$1 ≤K ≤N ≤ 10^4$<br>对于 100% 的评测用例，$1 ≤K ≤N ≤ 5 ×10^5，0 ≤ A_i ≤ 10^8$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">500005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line">cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(k--)&#123;</span><br><span class="line"><span class="type">int</span> minn = <span class="number">100000001</span>;</span><br><span class="line"><span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] == <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] &lt; minn)&#123;</span><br><span class="line">minn = a[i];</span><br><span class="line">index = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = index<span class="number">-1</span>; j &gt; <span class="number">0</span>; j--)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[j] != <span class="number">-1</span>)&#123;</span><br><span class="line">a[j] += minn;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = index+<span class="number">1</span>; j &lt;= n; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[j] != <span class="number">-1</span>)&#123;</span><br><span class="line">a[j] += minn;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">a[index] = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] != <span class="number">-1</span>)</span><br><span class="line">cout&lt;&lt;a[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>未完待续</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
            <tag> dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019年蓝桥杯c++B组 | C：数列求值 | G：完全二叉树的权值</title>
      <link href="/2023/04/04/2019%E5%B9%B4%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
      <url>/2023/04/04/2019%E5%B9%B4%E8%93%9D%E6%A1%A5%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="数列求值（10分）"><a href="#数列求值（10分）" class="headerlink" title="数列求值（10分）"></a>数列求值（10分）</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定数列1,1,1,3,5,9,17,…，从第4项开始，每项都是前3项的和。求<br>第20190324项的最后4位数字。</p><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>用数组保存三项值，通过对3取余依次将数字加上去。应为保留最后四位数字，所以每次计算过后需要用10000取余，不然会溢出<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> num[<span class="number">4</span>] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">int</span> index = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">while</span>(index&lt;=<span class="number">20190324</span>)</span><br><span class="line">&#123;</span><br><span class="line">num[index%<span class="number">3</span>] = num[<span class="number">1</span>]+num[<span class="number">2</span>]+num[<span class="number">3</span>];</span><br><span class="line">num[index%<span class="number">3</span>]%=<span class="number">10000</span>;</span><br><span class="line">index++;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; num[index%<span class="number">3</span>] &lt;&lt;endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p><h2 id="完全二叉树的权值（20分）"><a href="#完全二叉树的权值（20分）" class="headerlink" title="完全二叉树的权值（20分）"></a>完全二叉树的权值（20分）</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一棵包含 N 个节点的完全二叉树，树上每个节点都有一个权值，按从上到下、从左到右的顺序依次是 $A_1 , A_2 , ··· A_N$ ，<br>如下图所示：现在小明要把相同深度的节点的权值加在一起，他想知道哪个深度的节点权值之和最大？如果有多个深度的权值和同为最大，请你输出其中最小的深度。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    A1</span><br><span class="line">   / \</span><br><span class="line">  A2  A3</span><br><span class="line"> / \  / \</span><br><span class="line">A4 A5 A6 A7</span><br></pre></td></tr></table></figure><br><code>注：根的深度是 1。</code></p><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含一个整数 N。<br>第二行包含 N 个整数 $A_1 , A_2 , ··· A_N$ 。</p><h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>输出一个整数代表答案。</p><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">1 6 5 4 3 2 1</span><br></pre></td></tr></table></figure><h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><h3 id="评测用例规模与约定"><a href="#评测用例规模与约定" class="headerlink" title="评测用例规模与约定"></a>评测用例规模与约定</h3><p>对于所有评测用例，$1 ≤ N ≤ 100000，−100000 ≤ A_i ≤ 100000。$</p><ul><li><strong>注意最后一层可能没有填满的情况</strong></li><li>用前缀和数组优化同一层求和的运算</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">100005</span>];</span><br><span class="line"><span class="type">int</span> s[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="type">int</span> n;</span><br><span class="line">cin&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">cin&gt;&gt;a[i];</span><br><span class="line">s[i] = s[i<span class="number">-1</span>] + a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> level=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">pow</span>(<span class="number">2</span>,level)<span class="number">-1</span> &lt; n)&#123;</span><br><span class="line">level++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans_s = a[<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">2</span> ; i &lt;= level; i++)&#123;</span><br><span class="line"><span class="type">int</span> start = <span class="built_in">pow</span>(<span class="number">2</span>,i<span class="number">-1</span>);</span><br><span class="line"><span class="type">int</span> end = <span class="built_in">pow</span>(<span class="number">2</span>,i)<span class="number">-1</span>;</span><br><span class="line">end = <span class="built_in">min</span>(end, n);</span><br><span class="line"><span class="type">int</span> t = s[end] - s[start<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(t &gt; ans_s)&#123;</span><br><span class="line">ans_s = t;</span><br><span class="line">ans = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout&lt;&lt;ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
            <tag> 前缀和 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大整数运算</title>
      <link href="/2023/04/01/node%E5%A4%A7%E6%95%B4%E6%95%B0%E8%BF%90%E7%AE%97/"/>
      <url>/2023/04/01/node%E5%A4%A7%E6%95%B4%E6%95%B0%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<h2 id="大整数A-B"><a href="#大整数A-B" class="headerlink" title="大整数A+B"></a>大整数A+B</h2><p>输入两个整数A、B，求 A + B。</p><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h3><p>首先输入一个正整数T，表示测试数据的组数，然后是T组测试数据。每组测试输入2个正整数A、B。整数可能很大，但每个整数的位数不会超过1000。</p><h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式:"></a>输出格式:</h3><p>对于每组测试输出两行数据；第一行输出”Case #:”，#表示测试组号，第二行输出形式为“A + B = Sum”，Sum表示A+B的结果。每两组测试数据之间空一行。</p><h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例:"></a>输入样例:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1 2</span><br><span class="line">88888888888888888888888 11111111111111111111111</span><br></pre></td></tr></table></figure><h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例:"></a>输出样例:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Case 1:</span><br><span class="line">1 + 2 = 3</span><br><span class="line"></span><br><span class="line">Case 2:</span><br><span class="line">88888888888888888888888 + 11111111111111111111111 = 99999999999999999999999</span><br></pre></td></tr></table></figure><p><strong>出处:</strong><br>HDOJ 1002</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">add</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a,vector&lt;<span class="type">int</span>&gt; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>() || i &lt; b.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//短的位数就不加</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; a.<span class="built_in">size</span>())</span><br><span class="line">            t += a[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; b.<span class="built_in">size</span>())</span><br><span class="line">            t += b[i];</span><br><span class="line">        c.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t)</span><br><span class="line">        c.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> cnt=<span class="number">1</span>;cnt&lt;=n;cnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        string s1, s2;</span><br><span class="line">        cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; v1, v2, v3;</span><br><span class="line">        <span class="comment">//反过来储存</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = s1.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            v1.<span class="built_in">push_back</span>(s1[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = s2.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            v2.<span class="built_in">push_back</span>(s2[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        v3 = <span class="built_in">add</span>(v1, v2);</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Case &quot;</span>&lt;&lt;cnt&lt;&lt;<span class="string">&quot;:&quot;</span>&lt;&lt;endl;</span><br><span class="line">        cout&lt;&lt;s1&lt;&lt;<span class="string">&quot; + &quot;</span>&lt;&lt;s2&lt;&lt;<span class="string">&quot; = &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = v3.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            cout &lt;&lt; v3[i];</span><br><span class="line">        <span class="keyword">if</span>(cnt != n)</span><br><span class="line">            cout&lt;&lt;endl&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">else</span>    </span><br><span class="line">            cout&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="大整数A-B-1"><a href="#大整数A-B-1" class="headerlink" title="大整数A-B"></a>大整数A-B</h2><p>给定两个正整数（不含前导0），计算它们的差，计算结果可能为负数。</p><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式:"></a>输入格式:</h3><p>共两行，每行包含一个整数。</p><h3 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式:"></a>输出格式:</h3><p>共一行，包含所求的差。</p><h3 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围:"></a>数据范围:</h3><p>1 ≤ 整数长度 ≤ 10^5</p><h3 id="输入样例-1"><a href="#输入样例-1" class="headerlink" title="输入样例:"></a>输入样例:</h3><p>在这里给出一组输入。例如：32 11</p><h3 id="输出样例-1"><a href="#输出样例-1" class="headerlink" title="输出样例:"></a>输出样例:</h3><p>在这里给出相应的输出。例如：21</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//判断是否交换</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NeedSwap</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a, vector&lt;<span class="type">int</span>&gt; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.<span class="built_in">size</span>() &gt; b.<span class="built_in">size</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(a.<span class="built_in">size</span>() &lt; b.<span class="built_in">size</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i] &gt; b[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[i] &lt; b[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Swap</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;a, vector&lt;<span class="type">int</span>&gt; &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; temp;</span><br><span class="line">    temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//减法 大 - 小</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a, vector&lt;<span class="type">int</span>&gt; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>; <span class="comment">//借位</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        t = a[i] - t; <span class="comment">//减去之前借的位</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; b.<span class="built_in">size</span>())</span><br><span class="line">            t -= b[i];</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) <span class="comment">//不够减 需要借位</span></span><br><span class="line">        &#123;</span><br><span class="line">            c.<span class="built_in">push_back</span>((t + <span class="number">10</span>) % <span class="number">10</span>);</span><br><span class="line">            t = <span class="number">1</span>; <span class="comment">//记录向前借了1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//不需要借位</span></span><br><span class="line">        &#123;</span><br><span class="line">            c.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">            t = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//解决反转后的(答案)前导0问题 即pop c的末尾0</span></span><br><span class="line">    <span class="keyword">while</span> (c.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; c.<span class="built_in">back</span>() == <span class="number">0</span>)</span><br><span class="line">        c.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s1, s2;</span><br><span class="line">    cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v1, v2, v3;</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">0</span>;<span class="comment">//要不要加负号</span></span><br><span class="line">    <span class="comment">//反过来储存 输出</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = s1.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        v1.<span class="built_in">push_back</span>(s1[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = s2.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        v2.<span class="built_in">push_back</span>(s2[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">NeedSwap</span>(v1, v2))&#123;</span><br><span class="line">        <span class="built_in">Swap</span>(v1, v2);</span><br><span class="line">        flag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 = <span class="built_in">sub</span>(v1, v2);</span><br><span class="line">    <span class="keyword">if</span>(flag) cout&lt;&lt;<span class="string">&quot;-&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = v3.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        cout &lt;&lt; v3[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="高精度A-低精度b"><a href="#高精度A-低精度b" class="headerlink" title="高精度A * 低精度b"></a>高精度A * 低精度b</h2><p>给定两个非负整数（不含前导 0） A 和 B，请你计算 A×B 的值。</p><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式:"></a>输入格式:</h3><p>共两行，第一行包含整数 A，第二行包含整数 B。</p><h3 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式:"></a>输出格式:</h3><p>共一行，包含 A×B 的值。</p><h3 id="数据范围-1"><a href="#数据范围-1" class="headerlink" title="数据范围:"></a>数据范围:</h3><p>1 ≤ A的长度 ≤ 100000,<br>0 ≤ B ≤ 10000</p><h3 id="输入样例-2"><a href="#输入样例-2" class="headerlink" title="输入样例:"></a>输入样例:</h3><p>在这里给出一组输入。例如：<br>2<br>3<br>输出样例:<br>6</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//高精度*低精度</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>; <span class="comment">//进位</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        t += a[i] * b;</span><br><span class="line">        c.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t)</span><br><span class="line">        c.<span class="built_in">push_back</span>(t);</span><br><span class="line">    <span class="comment">//解决反转后的(答案)前导0问题 即pop c的末尾0</span></span><br><span class="line">    <span class="keyword">while</span> (c.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; c.<span class="built_in">back</span>() == <span class="number">0</span>)</span><br><span class="line">        c.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    string s;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    cin&gt;&gt;s&gt;&gt;b;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = s.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">         a.<span class="built_in">push_back</span>(s[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v3;</span><br><span class="line">    v3=<span class="built_in">mul</span>(a,b);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = v3.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        cout &lt;&lt; v3[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大整数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 1211. 蚂蚁感冒</title>
      <link href="/2023/03/29/ACWing1211%E8%9A%82%E8%9A%81%E6%84%9F%E5%86%92/"/>
      <url>/2023/03/29/ACWing1211%E8%9A%82%E8%9A%81%E6%84%9F%E5%86%92/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：11420</span><br><span class="line">总尝试数：22089</span><br><span class="line">来源：第五届蓝桥杯省赛C++A/B组</span><br><span class="line">算法标签</span><br><span class="line">数学</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>长 100 厘米的细长直杆子上有 n 只蚂蚁。</p><p>它们的头有的朝左，有的朝右。</p><p>每只蚂蚁都只能沿着杆子向前爬，速度是 1 厘米/秒。</p><p>当两只蚂蚁碰面时，它们会同时掉头往相反的方向爬行。</p><p>这些蚂蚁中，有 1 只蚂蚁感冒了。</p><p>并且在和其它蚂蚁碰面时，会把感冒传染给碰到的蚂蚁。</p><p>请你计算，当所有蚂蚁都爬离杆子时，有多少只蚂蚁患上了感冒。</p><p><strong>输入格式</strong><br>第一行输入一个整数 n, 表示蚂蚁的总数。</p><p>接着的一行是 n 个用空格分开的整数 Xi, Xi 的绝对值表示蚂蚁离开杆子左边端点的距离。</p><p>正值表示头朝右，负值表示头朝左，数据中不会出现 0 值，也不会出现两只蚂蚁占用同一位置。</p><p>其中，第一个数据代表的蚂蚁感冒了。</p><p><strong>输出格式</strong><br>输出1个整数，表示最后感冒蚂蚁的数目。</p><p><strong>数据范围</strong><br>$1&lt;n&lt;50,$<br>$0&lt;|X_i|&lt;100$<br><strong>输入样例1：</strong><br>3<br>5 -2 8<br><strong>输出样例1：</strong><br>1<br><strong>输入样例2：</strong><br>5<br>-10 8 -20 12 25<br><strong>输出样例2：</strong><br>3</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>先分两种大的情况，<br>第一个感冒的蚂蚁向左还是向右<br>这里把两个蚂蚁碰到后掉头爬行看成直接穿过，可以理解成两个蚂蚁互换身体，代替这对方继续走<br>如果向右， 那么它右面向左走的一定会传染，右面向右走的一定不会传染<br>它左面向左走的一定不会传染，它左面向右走的会被它右面向左走的感染<br>如果向左，与上同理</p><p>这样想代码比较容易实现，也容易讨论</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n, pos;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">abs</span>(a) &lt; <span class="built_in">abs</span>(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  cin &gt;&gt; n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    cin &gt;&gt; a[i];</span><br><span class="line">  <span class="type">int</span> pre = a[<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">sort</span>(a, a + n, cmp); <span class="comment">//先按绝对值 将蚂蚁的位置排好</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (a[i] == pre)</span><br><span class="line">      pos = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (pre &gt; <span class="number">0</span>) <span class="comment">//首先感染的蚂蚁向右走</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos + <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[i] &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span> (a[i] &lt; <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        ans++;</span><br><span class="line">        flag = <span class="number">1</span>; <span class="comment">//标记右面有蚂蚁向左走</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="comment">//在右边有往左走的蚂蚁前提下</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; <span class="number">0</span>) <span class="comment">//如果左面有向右走的那么肯定会传染</span></span><br><span class="line">          ans++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (pre &lt; <span class="number">0</span>)  <span class="comment">//首先感染的蚂蚁向左走，方法同上</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[i] &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span> (a[i] &gt; <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        ans++;</span><br><span class="line">        flag = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos + <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[i] &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span> (flag)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; <span class="number">0</span>)</span><br><span class="line">          ans++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing 1210. 连号区间数</title>
      <link href="/2023/03/28/ACWing1210%E8%BF%9E%E5%8F%B7%E5%8C%BA%E9%97%B4%E6%95%B0/"/>
      <url>/2023/03/28/ACWing1210%E8%BF%9E%E5%8F%B7%E5%8C%BA%E9%97%B4%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：11844</span><br><span class="line">总尝试数：19938</span><br><span class="line">来源：第四届蓝桥杯省赛C++B组,第四届蓝桥杯省赛JAVAB组</span><br><span class="line">算法标签</span><br><span class="line">枚举</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小明这些天一直在思考这样一个奇怪而有趣的问题：</p><p>在 1∼N 的某个排列中有多少个连号区间呢？</p><p>这里所说的连号区间的定义是：</p><p>如果区间 <code>[L,R]</code> 里的所有元素（即此排列的第 L 个到第 R 个元素）递增排序后能得到一个长度为 <code>R−L+1</code> 的“连续”数列，则称这个区间连号区间。</p><p>当 N 很小的时候，小明可以很快地算出答案，但是当 N 变大的时候，问题就不是那么简单了，现在小明需要你的帮助。</p><p><strong>输入格式</strong><br>第一行是一个正整数 N，表示排列的规模。</p><p>第二行是 N 个不同的数字 $P_i$，表示这 N 个数字的某一排列。</p><p><strong>输出格式</strong><br>输出一个整数，表示不同连号区间的数目。</p><p><strong>数据范围</strong><br>$1≤N≤10000$<br>$1≤P_i≤N$<br><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">3 2 4 1</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">3 4 2 5 1</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>第一个用例中，有 7 个连号区间分别是：<code>[1,1],[1,2],[1,3],[1,4],[2,2],[3,3],[4,4]</code></p><p>第二个用例中，有 9 个连号区间分别是：<code>[1,1],[1,2],[1,3],[1,4],[1,5],[2,2],[3,3],[4,4],[5,5]</code></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>因为没有重复的数，并且区间内排序后为递增序列差值为1，因此可以转化为区间<strong>最大最小值作差等于区间长度</strong>，即<code>max - min = j - i</code></p><blockquote><p>初尝试：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">10005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= n; l++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> r = l; r &lt;= n; r++) &#123;</span><br><span class="line">            <span class="type">int</span> max_ = <span class="number">-1</span>, min_ = <span class="number">10005</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                max_ = <span class="built_in">max</span>(a[i], max_);</span><br><span class="line">                min_ = <span class="built_in">min</span>(a[i], min_);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (max_ - min_ == r - l) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上述做法超时了，第三层循环可以进一步优化掉:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">10005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= n; l++) &#123;</span><br><span class="line">        <span class="type">int</span> max_ = <span class="number">-1</span>, min_ = <span class="number">10005</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> r = l; r &lt;= n; r++) &#123;</span><br><span class="line">            max_ = <span class="built_in">max</span>(a[r], max_);</span><br><span class="line">            min_ = <span class="built_in">min</span>(a[r], min_);</span><br><span class="line">            <span class="keyword">if</span> (max_ - min_ == r - l) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建hexo并git到GitHub出现的一些问题及解决</title>
      <link href="/2023/03/25/tools-mcjufe%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"/>
      <url>/2023/03/25/tools-mcjufe%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="hexo部分"><a href="#hexo部分" class="headerlink" title="hexo部分"></a>hexo部分</h2><h3 id="部署后发现没有css样式"><a href="#部署后发现没有css样式" class="headerlink" title="部署后发现没有css样式"></a>部署后发现没有css样式</h3><p>注意仓库路径问题，如果不是以io结尾<strong>要到hexo的config.yml文件中添加仓库URL路径(<a href="https://username.github.io/project)并设置root(/project">https://username.github.io/project)并设置root(/project</a>)</strong></p><h3 id="关于仓库路径-Page链接绑定域名"><a href="#关于仓库路径-Page链接绑定域名" class="headerlink" title="关于仓库路径 Page链接绑定域名"></a>关于仓库路径 Page链接绑定域名</h3><p>由于域名的DNS信息中CNAME记录的记录值需为域名形式（如abc.example.com）<br>仓库似乎不能乱命名（避免出现<a href="https://username.github.io/project的情况">https://username.github.io/project的情况</a>)</p><h2 id="git部分（hexo-d）"><a href="#git部分（hexo-d）" class="headerlink" title="git部分（hexo d）"></a>git部分（hexo d）</h2><h3 id="解决报错：The-requested-URL-returned-error-403-或-Logon-failed-use-ctrl-c-to-cancel-basic-credential-prompt-的解决方法"><a href="#解决报错：The-requested-URL-returned-error-403-或-Logon-failed-use-ctrl-c-to-cancel-basic-credential-prompt-的解决方法" class="headerlink" title="解决报错：The requested URL returned error: 403 或 Logon failed, use ctrl+c to cancel basic credential prompt.的解决方法"></a>解决报错：The requested URL returned error: 403 或 Logon failed, use ctrl+c to cancel basic credential prompt.的解决方法</h3><p>推送上传文件到远程仓库时总是跳出，说密码或者账号输入错误<br>第一次是输入github的登陆用户名和密码；<br>第二次是输入usernuserame（用户名） 和生成的tokens（密码）<br><img src="https://img-blog.csdnimg.cn/img_convert/c791f038dfa49557246cf1beaeeb683d.png" alt=""><br><strong>解决方法</strong><br>去生成一个第二次登录的token<br><a href="https://blog.csdn.net/weixin_46622106/article/details/111914231">解决方法链接在这</a></p><h3 id="关于GitHub-git-443-Timed-out的报错"><a href="#关于GitHub-git-443-Timed-out的报错" class="headerlink" title="关于GitHub git 443: Timed out的报错"></a>关于GitHub git 443: Timed out的报错</h3><p>网络问题</p><ol><li>git取消全局代理（一般来说默认就是这样）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure></li><li><p>别用校园网（局域网可能设了啥限制），就没成功过</p></li><li><p>把自己电脑的网络代理服务器关了<br>以我的体验不需要科学上网git也挺流畅的</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 排错日志 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing 3417.砝码称重</title>
      <link href="/2023/03/25/ACWing3417%E7%A0%9D%E7%A0%81%E7%A7%B0%E9%87%8D/"/>
      <url>/2023/03/25/ACWing3417%E7%A0%9D%E7%A0%81%E7%A7%B0%E9%87%8D/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.acwing.com/problem/content/description/3420/">原题链接</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：6792</span><br><span class="line">总尝试数：15019</span><br><span class="line">来源：第十二届蓝桥杯省赛第一场C++A/B/研究生组</span><br><span class="line">算法标签</span><br><span class="line">DP 背包问题</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>你有一架天平和 N 个砝码，这 N 个砝码重量依次是 $W_1,W_2,W_3,⋅⋅⋅,W_N$。</p><p>请你计算一共可以称出多少种不同的正整数重量？</p><p>注意砝码可以放在天平两边。</p><p><strong>输入格式</strong><br>输入的第一行包含一个整数 N。</p><p>第二行包含 N 个整数：$W_1,W_2,W_3,⋅⋅⋅,W_N$。</p><p><strong>输出格式</strong><br>输出一个整数代表答案。</p><p><strong>数据范围</strong><br>对于 50% 的评测用例，1≤N≤15。<br>对于所有评测用例，1≤N≤100，N 个砝码总重不超过 10^5。</p><p><strong>输入样例：</strong><br>3<br>1 4 6<br><strong>输出样例：</strong><br>10<br><strong>样例解释</strong><br>能称出的 10 种重量是：1、2、3、4、5、6、7、9、10、11</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1 = 1；</span><br><span class="line">2 = 6 − 4 (天平一边放 6，另一边放 4)；</span><br><span class="line">3 = 4 − 1；</span><br><span class="line">4 = 4；</span><br><span class="line">5 = 6 − 1；</span><br><span class="line">6 = 6；</span><br><span class="line">7 = 1 + 6；</span><br><span class="line">9 = 4 + 6 − 1；</span><br><span class="line">10 = 4 + 6；</span><br><span class="line">11 = 1 + 4 + 6。</span><br></pre></td></tr></table></figure><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>动态规划背包问题：</strong><br><img src="https://cdn.acwing.com/media/article/image/2021/04/28/39421_a2e7f5a0a8-2.png" alt=""><br><code>f[i-1][j-w[i]]</code>会出现下标为负值的问题，由实际含义可知下标可取绝对值（称重）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">110</span>, m = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> w[N];</span><br><span class="line"><span class="type">int</span> sum = <span class="number">0</span>, n;</span><br><span class="line"><span class="type">bool</span> dp[N][m];<span class="comment">//布尔值来表示前n个物品中能不能凑出质量m </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">cin&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;w[i]);</span><br><span class="line">sum += w[i];</span><br><span class="line">&#125;</span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= sum; j++)&#123;</span><br><span class="line">dp[i][j] = dp[i<span class="number">-1</span>][j] || dp[i<span class="number">-1</span>][<span class="built_in">abs</span>(j-w[i])] || dp[i<span class="number">-1</span>][j+w[i]];<span class="comment">//不选 放左边 放右边 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= sum; i++)</span><br><span class="line"><span class="keyword">if</span>(dp[n][i]) ans++;</span><br><span class="line">cout&lt;&lt;ans;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>dfs暴力练手</strong><br>50%数据<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"><span class="type">int</span> w[<span class="number">1000000</span>]; </span><br><span class="line"><span class="type">bool</span> st[<span class="number">100000</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> sum)</span><span class="comment">//表示k个的砝码,重量是sum </span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(k &gt; n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; <span class="number">0</span> &amp;&amp; !st[sum])<span class="comment">// 判断选出来的n个砝码的重量是否没被标记过 ，如没标记则答案加1 </span></span><br><span class="line">        &#123;</span><br><span class="line">            ans++;</span><br><span class="line">            st[sum] = <span class="literal">true</span>;<span class="comment">//标记这个重量 </span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(k+<span class="number">1</span>,sum-w[k]);<span class="comment">//砝码放左边</span></span><br><span class="line">        <span class="built_in">dfs</span>(k+<span class="number">1</span>,sum);<span class="comment">//不选用当前的砝码 </span></span><br><span class="line">        <span class="built_in">dfs</span>(k+<span class="number">1</span>,sum+w[k]);<span class="comment">//砝码放右边 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n); </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;w[i]); </span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dp </tag>
            
            <tag> dfs </tag>
            
            <tag> 背包问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023-3-11蓝桥杯模拟赛</title>
      <link href="/2023/03/11/%E8%93%9D%E6%A1%A5%E6%9D%AF%E6%A8%A1%E6%8B%9F%E8%B5%9B20230311/"/>
      <url>/2023/03/11/%E8%93%9D%E6%A1%A5%E6%9D%AF%E6%A8%A1%E6%8B%9F%E8%B5%9B20230311/</url>
      
        <content type="html"><![CDATA[<h2 id="填空题"><a href="#填空题" class="headerlink" title="填空题"></a>填空题</h2><h3 id="最小的十六进制-答案：2730"><a href="#最小的十六进制-答案：2730" class="headerlink" title="最小的十六进制(答案：2730)"></a>最小的十六进制(答案：2730)</h3><p><strong>问题描述</strong><br>　　请找到一个大于 2022 的最小数，这个数转换成十六进制之后，所有的数位（不含前导 0）都为字母（A 到 F）。</p><blockquote><p>直接用程序员计算器即可</p></blockquote><h3 id="Excel的列-答案：BYT"><a href="#Excel的列-答案：BYT" class="headerlink" title="Excel的列(答案：BYT)"></a>Excel的列(答案：BYT)</h3><p><strong>问题描述</strong><br>　　在 Excel 中，列的名称使用英文字母的组合。前 26 列用一个字母，依次为 A 到 Z，接下来 26*26 列使用两个字母的组合，依次为 AA 到 ZZ。<br>　　请问第 2022 列的名称是什么？</p><blockquote><p>新定义进制转换<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022 % 26 = 20 == T</span><br><span class="line">2022 /= 26 ==  77</span><br><span class="line">77 % 26 == 25 == Y</span><br><span class="line">77 /= 26 == 2</span><br><span class="line">2 == B</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="相等日期-答案：70910"><a href="#相等日期-答案：70910" class="headerlink" title="相等日期(答案：70910)"></a>相等日期(答案：70910)</h3><p><strong>问题描述</strong></p><p>对于一个日期，我们可以计算出年份的各个数位上的数字之和，也可以分别计算月和日的各位数字之和。请问从 1900 年 1 月 1 日至 9999 年 12 月 31 日，总共有多少天，年份的数位数字之和等于月的数位数字之和加日的数位数字之和。<br>例如，2022年11月13日满足要求，因为 2+0+2+2=(1+1)+(1+3) 。<br>请提交满足条件的日期的总数量。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> m[<span class="number">12</span>] = &#123;<span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line"><span class="type">int</span> m2[<span class="number">12</span>] = &#123;<span class="number">31</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//是闰年</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isRun</span><span class="params">(<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>((y% <span class="number">4</span>  == <span class="number">0</span> &amp;&amp; y %<span class="number">100</span> != <span class="number">0</span> )|| y % <span class="number">400</span> == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(<span class="type">int</span> y, <span class="type">int</span>  m, <span class="type">int</span> d)</span></span>&#123;</span><br><span class="line"><span class="type">int</span> sy = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(y)&#123;</span><br><span class="line">sy += y % <span class="number">10</span>;</span><br><span class="line">y/=<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> sd = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(m)&#123;</span><br><span class="line">sd+=m%<span class="number">10</span>;</span><br><span class="line">m/=<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(d)&#123;</span><br><span class="line">sd+=d%<span class="number">10</span>;</span><br><span class="line">d/=<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(sy == sd) ans++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1900</span>; y &lt;= <span class="number">9999</span>; y++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">isRun</span>(y))&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> d = <span class="number">1</span>; d &lt;= m[i<span class="number">-1</span>]; d++)&#123;</span><br><span class="line"><span class="built_in">check</span>(y,i,d);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> d = <span class="number">1</span>; d &lt;= m2[i<span class="number">-1</span>]; d++)&#123;</span><br><span class="line"><span class="built_in">check</span>(y,i,d);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout&lt;&lt;ans;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多少种取法-答案：189"><a href="#多少种取法-答案：189" class="headerlink" title="多少种取法(答案：189)"></a>多少种取法(答案：189)</h3><p><strong>问题描述</strong><br>　　小蓝有 30 个数，分别为：99, 22, 51, 63, 72, 61, 20, 88, 40, 21, 63, 30, 11, 18, 99, 12, 93, 16, 7, 53, 64, 9, 28, 84, 34, 96, 52, 82, 51, 77 。<br>　　小蓝可以在这些数中取出两个序号不同的数，共有 30*29/2=435 种取法。<br>　　请问这 435 种取法中，有多少种取法取出的两个数的乘积大于等于 2022 。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">30</span>] = &#123;<span class="number">99</span>, <span class="number">22</span>, <span class="number">51</span>, <span class="number">63</span>, <span class="number">72</span>, <span class="number">61</span>, <span class="number">20</span>, <span class="number">88</span>, <span class="number">40</span>, <span class="number">21</span>, <span class="number">63</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">18</span>, <span class="number">99</span>, <span class="number">12</span>, <span class="number">93</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">53</span>, <span class="number">64</span>, <span class="number">9</span>, <span class="number">28</span>, <span class="number">84</span>, <span class="number">34</span>, <span class="number">96</span>, <span class="number">52</span>, <span class="number">82</span>, <span class="number">51</span>, <span class="number">77</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i ++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">30</span>; j ++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line"><span class="type">int</span> m = a[i] * a[j];</span><br><span class="line"><span class="keyword">if</span>(m &gt;= <span class="number">2022</span>) ans++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout&lt;&lt;ans/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="最大连通分块-答案：148"><a href="#最大连通分块-答案：148" class="headerlink" title="最大连通分块(答案：148)"></a>最大连通分块(答案：148)</h3><p><strong>问题描述</strong><br>　　小蓝有一个 30 行 60 列的数字矩阵，矩阵中的每个数都是 0 或 1 。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">　　110010000011111110101001001001101010111011011011101001111110</span><br><span class="line">　　010000000001010001101100000010010110001111100010101100011110</span><br><span class="line">　　001011101000100011111111111010000010010101010111001000010100</span><br><span class="line">　　101100001101011101101011011001000110111111010000000110110000</span><br><span class="line">　　010101100100010000111000100111100110001110111101010011001011</span><br><span class="line">　　010011011010011110111101111001001001010111110001101000100011</span><br><span class="line">　　101001011000110100001101011000000110110110100100110111101011</span><br><span class="line">　　101111000000101000111001100010110000100110001001000101011001</span><br><span class="line">　　001110111010001011110000001111100001010101001110011010101110</span><br><span class="line">　　001010101000110001011111001010111111100110000011011111101010</span><br><span class="line">　　011111100011001110100101001011110011000101011000100111001011</span><br><span class="line">　　011010001101011110011011111010111110010100101000110111010110</span><br><span class="line">　　001110000111100100101110001011101010001100010111110111011011</span><br><span class="line">　　111100001000001100010110101100111001001111100100110000001101</span><br><span class="line">　　001110010000000111011110000011000010101000111000000110101101</span><br><span class="line">　　100100011101011111001101001010011111110010111101000010000111</span><br><span class="line">　　110010100110101100001101111101010011000110101100000110001010</span><br><span class="line">　　110101101100001110000100010001001010100010110100100001000011</span><br><span class="line">　　100100000100001101010101001101000101101000000101111110001010</span><br><span class="line">　　101101011010101000111110110000110100000010011111111100110010</span><br><span class="line">　　101111000100000100011000010001011111001010010001010110001010</span><br><span class="line">　　001010001110101010000100010011101001010101101101010111100101</span><br><span class="line">　　001111110000101100010111111100000100101010000001011101100001</span><br><span class="line">　　101011110010000010010110000100001010011111100011011000110010</span><br><span class="line">　　011110010100011101100101111101000001011100001011010001110011</span><br><span class="line">　　000101000101000010010010110111000010101111001101100110011100</span><br><span class="line">　　100011100110011111000110011001111100001110110111001001000111</span><br><span class="line">　　111011000110001000110111011001011110010010010110101000011111</span><br><span class="line">　　011110011110110110011011001011010000100100101010110000010011</span><br><span class="line">　　010011110011100101010101111010001001001111101111101110011101</span><br></pre></td></tr></table></figure><br>　　如果从一个标为 1 的位置可以通过上下左右走到另一个标为 1 的位置，则称两个位置连通。与某一个标为 1 的位置连通的所有位置（包括自己）组成一个连通分块。<br>　　请问矩阵中最大的连通分块有多大？<br>答案提交<br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> g[<span class="number">35</span>][<span class="number">65</span>];</span><br><span class="line"><span class="type">bool</span> st[<span class="number">35</span>][<span class="number">65</span>];</span><br><span class="line"><span class="type">int</span> n = <span class="number">30</span>, m = <span class="number">60</span>;</span><br><span class="line"><span class="type">int</span> dx[] = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;, dy[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">st[u][v] = <span class="literal">true</span>;</span><br><span class="line">queue &lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; q;</span><br><span class="line">q.<span class="built_in">push</span>(&#123;u, v&#125;);</span><br><span class="line"><span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line"><span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">q.<span class="built_in">pop</span>();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i ++) &#123;</span><br><span class="line"><span class="type">int</span> x = dx[i] + t.first, y = dy[i] + t.second;</span><br><span class="line"><span class="keyword">if</span>(x &lt; <span class="number">1</span> || x &gt; n || y &lt; <span class="number">1</span> || y &gt; m) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(st[x][y]) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(g[x][y] == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">st[x][y] = <span class="literal">true</span>;</span><br><span class="line">q.<span class="built_in">push</span>(&#123;x, y&#125;);</span><br><span class="line">ans ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(st, <span class="number">0</span>, <span class="keyword">sizeof</span> st);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">30</span>; i ++)</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">60</span>; j ++)</span><br><span class="line">cin &gt;&gt; g[i][j];</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">30</span>; i ++)</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">60</span>; j ++)</span><br><span class="line"><span class="keyword">if</span>(!st[i][j] &amp;&amp; g[i][j] == <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">max</span>(res, <span class="built_in">bfs</span>(i, j));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编程题"><a href="#编程题" class="headerlink" title="编程题"></a>编程题</h2><h3 id="哪一天"><a href="#哪一天" class="headerlink" title="哪一天"></a>哪一天</h3><p><strong>问题描述</strong><br>　　给定一天是一周中的哪天，请问 n 天后是一周中的哪天？<br><strong>输入格式</strong><br>　　输入第一行包含一个整数 w，表示给定的天是一周中的哪天，w 为 1 到 6 分别表示周一到周六，w 为 7 表示周日。<br>　　第二行包含一个整数 n。<br><strong>输出格式</strong><br>　　输出一行包含一个整数，表示 n 天后是一周中的哪天，1 到 6 分别表示周一到周六，7 表示周日。<br><strong>样例输入</strong><br>6<br>10<br><strong>样例输出</strong><br>2<br><strong>评测用例规模与约定</strong><br>对于所有评测用例，1 &lt;= n &lt;= 1000000。</p><blockquote><p>day等于7的时候需要特判一下输出7 </p></blockquote><h3 id="信号覆盖"><a href="#信号覆盖" class="headerlink" title="信号覆盖"></a>信号覆盖</h3><p><strong>问题描述</strong><br>小蓝负责一块区域的信号塔安装，整块区域是一个长方形区域，建立坐标轴后，西南角坐标为 (0, 0)， 东南角坐标为 (W, 0)， 西北角坐标为 (0, H)， 东北角坐标为 (W, H)。其中 W, H 都是整数。<br>他在 n 个位置设置了信号塔，每个信号塔可以覆盖以自己为圆心，半径为 R 的圆形（包括边缘）。<br>为了对信号覆盖的情况进行检查，小蓝打算在区域内的所有横纵坐标为整数的点进行测试，检查信号状态。其中横坐标范围为 0 到 W，纵坐标范围为 0 到 H，总共测试 (W+1) <em> (H+1) 个点。<br>给定信号塔的位置，请问这 (W+1)</em>(H+1) 个点中有多少个点被信号覆盖。</p><p><strong>输入格式</strong></p><p>输入第一行包含四个整数 W, H, n, R，相邻整数之间使用一个空格分隔。<br>接下来 n 行，每行包含两个整数 x, y，表示一个信号塔的坐标。信号塔可能重合，表示两个信号发射器装在了同一个位置。</p><p><strong>输出格式</strong><br>输出一行包含一个整数，表示答案。</p><p><strong>样例输入</strong><br>10 10 2 5<br>0 0<br>7 0<br><strong>样例输出</strong><br>57<br><strong>评测用例规模与约定</strong><br>对于所有评测用例，1 &lt;= W, H &lt;= 100，1 &lt;= n &lt;= 100, 1 &lt;= R &lt;= 100, 0 &lt;= x &lt;= W, 0 &lt;= y &lt;= H。</p><blockquote><p>暴力枚举<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> w,h,n,r;</span><br><span class="line"><span class="type">int</span> x[<span class="number">102</span>];</span><br><span class="line"><span class="type">int</span> y[<span class="number">102</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> ix, <span class="type">int</span> jy)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line"><span class="type">int</span> s = (ix-x[i])*(ix-x[i]) + (jy-y[i])*(jy-y[i]);</span><br><span class="line"><span class="keyword">if</span>(s &lt;= r*r)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">cin&gt;&gt;w&gt;&gt;h&gt;&gt;n&gt;&gt;r;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">cin &gt;&gt; x[i] &gt;&gt; y[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= w; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= h; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">check</span>(i, j)) ans ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout&lt;&lt;ans;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="清理水草"><a href="#清理水草" class="headerlink" title="清理水草"></a>清理水草</h3><p><strong>问题描述</strong><br>小蓝有一个 n * m 大小的矩形水域，小蓝将这个水域划分为 n 行 m 列，行数从 1 到 n 标号，列数从 1 到 m 标号。每行和每列的宽度都是单位 1 。<br>现在，这个水域长满了水草，小蓝要清理水草。<br>每次，小蓝可以清理一块矩形的区域，从第 r1 行（含）到第 r2 行（含）的第 c1 列（含）到 c2 列（含）。<br>经过一段时间清理后，请问还有多少地方没有被清理过。</p><p><strong>输入格式</strong><br>输入第一行包含两个整数 n, m，用一个空格分隔。<br>第二行包含一个整数 t ，表示清理的次数。<br>接下来 t 行，每行四个整数 r1, c1, r2, c2，相邻整数之间用一个空格分隔，表示一次清理。请注意输入的顺序。</p><p><strong>输出格式</strong><br>输出一行包含一个整数，表示没有被清理过的面积。</p><p><strong>样例输入1</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2 3</span><br><span class="line">2</span><br><span class="line">1 1 1 3</span><br><span class="line">1 2 2 2</span><br></pre></td></tr></table></figure></p><p><strong>样例输出1</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>样例输入2</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">30 20</span><br><span class="line">2</span><br><span class="line">5 5 10 15</span><br><span class="line">6 7 15 9</span><br></pre></td></tr></table></figure></p><p><strong>样例输出2</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">519</span><br></pre></td></tr></table></figure><br><strong>评测用例规模与约定</strong><br>对于所有评测用例，1 &lt;= r1 &lt;= r2 &lt;= n &lt;= 100, 1 &lt;= c1 &lt;= c2 &lt;= m &lt;= 100, 0 &lt;= t &lt;= 100。</p><blockquote><p><a href="https://blog.csdn.net/weixin_45629285/article/details/111146240?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167853523116800227459868%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167853523116800227459868&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-2-111146240-null-null.142^v73^pc_new_rank,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=%E4%BA%8C%E7%BB%B4%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84&amp;spm=1018.2226.3001.4187">二维差分数组</a></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,t;</span><br><span class="line"><span class="type">int</span> a[<span class="number">105</span>][<span class="number">105</span>];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2)</span></span>&#123;</span><br><span class="line">    a[x1][y1] += <span class="number">1</span>;</span><br><span class="line">    a[x2 + <span class="number">1</span>][y1] -= <span class="number">1</span>;</span><br><span class="line">    a[x1][y2 + <span class="number">1</span>] -= <span class="number">1</span>;</span><br><span class="line">    a[x2 + <span class="number">1</span>][y2 + <span class="number">1</span>] += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; t;</span><br><span class="line">    <span class="type">int</span> r1, c1, r2, c2;</span><br><span class="line">    <span class="comment">//处理二维差分数组</span></span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        cin &gt;&gt; r1 &gt;&gt; c1 &gt;&gt; r2 &gt;&gt; c2;</span><br><span class="line">        <span class="built_in">insert</span>(r1, c1, r2, c2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//恢复二维差分数组</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)&#123;</span><br><span class="line">            a[i][j] += a[i - <span class="number">1</span>][j] + a[i][j - <span class="number">1</span>] - a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!a[i][j])</span><br><span class="line">                ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="最长滑行"><a href="#最长滑行" class="headerlink" title="最长滑行"></a>最长滑行</h3><p><strong>问题描述</strong><br>　　小蓝准备在一个空旷的场地里面滑行，这个场地的高度不一，小蓝用一个 n 行 m 列的矩阵来表示场地，矩阵中的数值表示场地的高度。<br>　　如果小蓝在某个位置，而他上、下、左、右中有一个位置的高度（严格）低于当前的高度，小蓝就可以滑过去，滑动距离为 1 。<br>　　如果小蓝在某个位置，而他上、下、左、右中所有位置的高度都大于等于当前的高度，小蓝的滑行就结束了。<br>　　小蓝不能滑出矩阵所表示的场地。<br>　　小蓝可以任意选择一个位置开始滑行，请问小蓝最多能滑行多远距离。<br><strong>输入格式</strong><br>　　输入第一行包含两个整数 n, m，用一个空格分隔。<br>　　接下来 n 行，每行包含 m 个整数，相邻整数之间用一个空格分隔，依次表示每个位置的高度。<br><strong>输出格式</strong><br>输出一行包含一个整数，表示答案。<br><strong>样例输入</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 5</span><br><span class="line">1 4 6 3 1</span><br><span class="line">11 8 7 3 1</span><br><span class="line">9 4 5 2 1</span><br><span class="line">1 3 2 2 1</span><br></pre></td></tr></table></figure><br><strong>样例输出</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7</span><br></pre></td></tr></table></figure><br><strong>样例说明</strong><br>滑行的位置一次为 (2, 1), (2, 2), (2, 3), (3, 3), (3, 2), (4, 2), (4, 3)。<br><strong>评测用例规模与约定</strong><br>对于 30% 评测用例，1 &lt;= n &lt;= 20，1 &lt;= m &lt;= 20，0 &lt;= 高度 &lt;= 100。<br>对于所有评测用例，1 &lt;= n &lt;= 100，1 &lt;= m &lt;= 100，0</p><blockquote><p>dfs暴力 \ 记忆化搜索？？？不会</p></blockquote><h3 id="区间最小值"><a href="#区间最小值" class="headerlink" title="区间最小值"></a>区间最小值</h3><p><strong>题目描述</strong><br>小蓝有一个序列a[1], a[2]. …. a[n].<br>给定一个正整数k，请问对于每一个1到n之间的序号i，a[i-k], a[i-k+1]…. a[i+k]这2k+1个数中的最小值是多少?当某个下标超过1到n的范围时，数不存在，求最小值时只取存在的那些值。<br><strong>输入格式</strong><br>输入的第一行包含一整数n。<br>第二行包含n个整数，分别表示a[1], a[2]. … a[n]。第三行包含一个整数k。<br><strong>输出格式</strong><br>输出一行，包含n个整数，分别表示对于每个序号求得的最小值。<br><strong>样例输入</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">5 2 7 4 3</span><br><span class="line">1</span><br></pre></td></tr></table></figure><br><strong>样例输出</strong><br><code>2 2 2 3 3</code><br><strong>评测用例规模与约定</strong><br>对于30%的评测用例，1&lt;= n&lt;= 1000，1 &lt;= a[i]&lt;=1000。<br>对于50%的评测用例，1&lt;= n&lt;= 10000，1 &lt;= a[]&lt;=10000。<br>对于所有评测用例，1&lt;= n&lt;= 1000000，1 &lt;= a[i]&lt;=100000。</p><blockquote><p>暴力骗分 单调队列、ST表？？？不会<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">1000005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i&lt;= n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> k;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;k);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i&lt;= n; i++)&#123;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1000005</span>;</span><br><span class="line"><span class="type">int</span> l = <span class="built_in">max</span>(<span class="number">1</span>, i-k);</span><br><span class="line"><span class="type">int</span> r = <span class="built_in">min</span>(n, i+k);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = l; j&lt;= r; j++)&#123;</span><br><span class="line">ans = <span class="built_in">min</span>(ans, a[j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
            <tag> 枚举 </tag>
            
            <tag> 进制转换 </tag>
            
            <tag> dfs </tag>
            
            <tag> 差分 </tag>
            
            <tag> bfs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing 4405. 统计子矩阵</title>
      <link href="/2023/03/09/ACWing4405%E7%BB%9F%E8%AE%A1%E5%AD%90%E7%9F%A9%E9%98%B5/"/>
      <url>/2023/03/09/ACWing4405%E7%BB%9F%E8%AE%A1%E5%AD%90%E7%9F%A9%E9%98%B5/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：4005</span><br><span class="line">总尝试数：10637</span><br><span class="line">来源：第十三届蓝桥杯省赛C++B组</span><br><span class="line">算法标签</span><br><span class="line">枚举 前缀和 双指针</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个 N×M 的矩阵 A，请你统计有多少个子矩阵 (最小 1×1，最大 N×M) 满足子矩阵中所有数的和不超过给定的整数 K?</p><p><strong>输入格式</strong><br>第一行包含三个整数 N,M 和 K。</p><p>之后 N 行每行包含 M 个整数，代表矩阵 A。</p><p><strong>输出格式</strong><br>一个整数代表答案。</p><p><strong>数据范围</strong><br>对于$30%$的数据，$N,M≤20$，<br>对于$70%$的数据，$N,M≤100$，<br>对于$100%$的数据，$1≤N,M≤500;0≤A_{ij}≤1000;1≤K≤2.5×10^8$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 4 10</span><br><span class="line">1 2 3 4</span><br><span class="line">5 6 7 8</span><br><span class="line">9 10 11 12</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">19</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">满足条件的子矩阵一共有 19，包含：</span><br><span class="line">大小为 1×1 的有 10 个。</span><br><span class="line">大小为 1×2 的有 3 个。</span><br><span class="line">大小为 1×3 的有 2 个。</span><br><span class="line">大小为 1×4 的有 1 个。</span><br><span class="line">大小为 2×1 的有 3 个。</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>二维前缀和</strong></p><p><a href="笔记二维前缀和.md">二维前缀和</a>预处理矩阵<br>枚举子矩阵的左上、右下两个端点(x1,x2,x3,x4), 计算子矩阵的和<br>时间复杂度O(n^4)，需优化<br>结果： Time Limit Exceeded 通过了 4/10个数据</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">505</span>][<span class="number">505</span>];</span><br><span class="line"><span class="type">int</span> s[<span class="number">505</span>][<span class="number">505</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m,k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i][j]);</span><br><span class="line">            s[i][j] = s[i<span class="number">-1</span>][j] + s[i][j<span class="number">-1</span>] - s[i<span class="number">-1</span>][j<span class="number">-1</span>] + a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x1 = <span class="number">1</span>; x1 &lt;= n; x1 ++ )&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> y1 = <span class="number">1</span>; y1 &lt;= m; y1 ++ )&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x2 = <span class="number">1</span>; x2 &lt;= n; x2 ++ )&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> y2 = <span class="number">1</span>; y2 &lt;= m; y2 ++ )&#123;</span><br><span class="line">                    <span class="keyword">if</span>(x2 &lt; x1 || y2 &lt; y1) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(s[x2][y2] - s[x1<span class="number">-1</span>][y2] - s[x2][y1<span class="number">-1</span>] + s[x1<span class="number">-1</span>][y1<span class="number">-1</span>] &lt;= k) ans++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优化：一维前缀和 +  双指针</strong></p><p><a href="https://www.acwing.com/video/4234/">视频</a></p><p><img src="https://cdn.acwing.com/media/article/image/2022/04/11/115313_9c85b174b9-%E6%97%A0%E6%A0%87%E9%A2%98.png" alt=""></p><p>优化的方法是：<br>1) 通过指针 s 和 t 确定矩阵上下边界<br>2) 一维前缀和处理上下边界内的每一列<br>3) 枚举子矩阵的 左边界i 和 右边界j，i固定 j向右移动直到子矩阵刚好过大<br>4) i向右移动，使得子矩阵减小至范围内<br>5) 每一次竖指针发生变化 ans += 右-左+1</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">505</span>][<span class="number">505</span>];</span><br><span class="line"><span class="type">int</span> s[<span class="number">505</span>][<span class="number">505</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m,k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i][j]);</span><br><span class="line">            s[i][j] = s[i<span class="number">-1</span>][j] + a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++ )&#123;<span class="comment">// 横线</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt;= n; j ++ )&#123; <span class="comment">// 横线</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>, sum = <span class="number">0</span>; r &lt;= m; r++ )&#123;<span class="comment">//移动右指针</span></span><br><span class="line">                sum += s[j][r] - s[i<span class="number">-1</span>][r];</span><br><span class="line">                <span class="keyword">while</span>(sum &gt; k)&#123;<span class="comment">//移动左指针</span></span><br><span class="line">                    sum -= s[j][l] - s[i<span class="number">-1</span>][l];</span><br><span class="line">                    l++;</span><br><span class="line">                &#125;</span><br><span class="line">                ans += r - l + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
            <tag> 双指针 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二维前缀和</title>
      <link href="/2023/03/07/%E7%AC%94%E8%AE%B0%E4%BA%8C%E7%BB%B4%E5%89%8D%E7%BC%80%E5%92%8C/"/>
      <url>/2023/03/07/%E7%AC%94%E8%AE%B0%E4%BA%8C%E7%BB%B4%E5%89%8D%E7%BC%80%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本篇介绍二维前缀和模板及应用</p></blockquote><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/2309d130fa81f7423bd7c21a1141e6e2.png" alt=""></p><p>首先我们用s数组来表示前缀和，那么<br><code>s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i- 1][j - 1] + a[i][j]</code><br>即这一个点的二位前缀和等于它左边的点和上面的点的前缀和之和减去左上角的点的前缀和（即多加的部分）再加上这个点的值就是该点的二维前缀和。</p><p>既然我们求出了每一个点对应的二维前缀和，那么如果需要求<strong>子矩阵的二维前缀和</strong>，该怎么求。</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f2380a1259a36819cda1b0f2647e6267.png" alt=""></p><p>其实也很简单，从定义出发，以（x1，y1）为左上角，（x2，y2）为右下角的子矩阵的前缀和可以看成是（x2，y2）的前缀和减去（x2，y1-1）的前缀和再减去（x1-1，y2）的前缀和最后再加上（x1-1，y1-1）的前缀和即可。用公式表示就是<br><code>s[x2][y2] - s[x2][y1 - 1] - s[x1 - 1][y2] + s[x1 - 1][y1 - 1]</code></p><p>红色部分为所求区域，绿色和橙色是多余部分要减去，而灰色部分是多减了要加回来。</p><h2 id="模板题"><a href="#模板题" class="headerlink" title="模板题"></a>模板题</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>输入一个n行m列的整数矩阵，再输入q个询问，每个询问包含四个整数x1, y1, x2, y2，表示一个子矩阵的左上角坐标和右下角坐标。</p><p>对于每个询问输出子矩阵中所有数的和。</p><p><strong>输入格式</strong><br>第一行包含三个整数n，m，q。</p><p>接下来n行，每行包含m个整数，表示整数矩阵。</p><p>接下来q行，每行包含四个整数x1, y1, x2, y2，表示一组询问。</p><p><strong>输出格式</strong><br>共q行，每行输出一个询问的结果。</p><p><strong>数据范围</strong><br>1 ≤ n , m ≤ 1000 ,<br>1 ≤ q ≤ 200000 ,<br>1 ≤ x 1 ≤ x 2 ≤ n ,<br>1 ≤ y 1 ≤ y 2 ≤ m ,<br>− 1000 ≤ 矩阵内元素的值 ≤ 1000</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3 4 3</span><br><span class="line">1 7 2 4</span><br><span class="line">3 6 2 8</span><br><span class="line">2 1 2 3</span><br><span class="line">1 1 2 2</span><br><span class="line">2 1 3 4</span><br><span class="line">1 3 3 4</span><br></pre></td></tr></table></figure></p><p><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">17</span><br><span class="line">27</span><br><span class="line">21</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, q;</span><br><span class="line"><span class="type">int</span> a[N][N] , s[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span> , &amp;a[i][j]);</span><br><span class="line">            s[i][j] = s[i - <span class="number">1</span>][j] + s[i][j - <span class="number">1</span>] - s[i - <span class="number">1</span>][j - <span class="number">1</span>] + a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="type">int</span> x1, y1, x2, y2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span> , s[x2][y2] - s[x2][y1 - <span class="number">1</span>] - s[x1 - <span class="number">1</span>][y2] + s[x1 - <span class="number">1</span>][y1 - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 2058. 笨拙的手指</title>
      <link href="/2023/03/04/ACWing2058%E7%AC%A8%E6%8B%99%E7%9A%84%E6%89%8B%E6%8C%87/"/>
      <url>/2023/03/04/ACWing2058%E7%AC%A8%E6%8B%99%E7%9A%84%E6%89%8B%E6%8C%87/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：10012</span><br><span class="line">总尝试数：18453</span><br><span class="line">来源：USACO 2011 November Contest Bronze Division</span><br><span class="line">算法标签</span><br><span class="line">枚举 进位制 哈希表</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>奶牛贝茜正在学习如何在不同进制之间转换数字。</p><p>但是她总是犯错误，因为她无法轻易的用两个前蹄握住笔。</p><p>每当贝茜将数字转换为一个新的进制并写下结果时，她总是将其中的某一位数字写错。</p><p>例如，如果她将数字 14 转换为二进制数，那么正确的结果应为 1110，但她可能会写下 0110 或 1111。</p><p>贝茜不会额外添加或删除数字，但是可能会由于写错数字的原因，写下包含前导 0 的数字。</p><p>给定贝茜将数字 N 转换为二进制数字以及三进制数字的结果，请确定 N 的正确初始值（十进制表示）。</p><p><strong>输入格式</strong><br>第一行包含 N 的二进制表示，其中一位是错误的。</p><p>第二行包含 N 的三进制表示，其中一位是错误的。</p><p><strong>输出格式</strong><br>输出正确的 N 的值。</p><p><strong>数据范围</strong><br>$ 0≤N≤10^9 $，且存在唯一解。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1010</span><br><span class="line">212</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">14</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">14</span><br><span class="line"> 在二进制下的正确表示为 1110</span><br><span class="line">，在三进制下的正确表示为 112。</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>思路：</strong><br>枚举二进制出错的位置，通过异或运算还原，<br>将还原出的二进制字符串通过秦九韶算法转换为10进制数<code>t</code><br>用哈希表<code>unordered_set</code>容器记录<code>t</code></p><p>同理枚举三进制出错的位置，再枚举该位置下的所有可能性<br>（0或1或2 且 与原数字不同）<br>将还原出的三进制字符串通过秦九韶算法转换为10进制数<code>x</code><br>通过<code>count()</code>函数判断哈希表中是否存在<code>x</code>, 若存在即为答案。</p><p><strong>注意：</strong><br>字符串处理时要注意字符和数字的转换</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将b进制的数转化成十进制</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(string s, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 秦九韶算法</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c: s)</span><br><span class="line">        res = res * b + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a, b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">    unordered_set&lt;<span class="type">int</span>&gt; S;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">length</span>(); i++)<span class="comment">//2进制</span></span><br><span class="line">    &#123;</span><br><span class="line">        string ta = a;</span><br><span class="line">        ta[i] ^= <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//前导0</span></span><br><span class="line">        <span class="keyword">if</span>(ta.<span class="built_in">length</span>() &gt; <span class="number">1</span> &amp;&amp; ta[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        S.<span class="built_in">insert</span>(<span class="built_in">get</span>(ta, <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; b.<span class="built_in">length</span>(); i++)<span class="comment">//三进制</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j ++)&#123;<span class="comment">//枚举0-2</span></span><br><span class="line">            string tb = b;</span><br><span class="line">            <span class="keyword">if</span>(b[i] - <span class="string">&#x27;0&#x27;</span> != j)&#123;</span><br><span class="line">                tb[i] = j + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(tb.<span class="built_in">length</span>() &gt; <span class="number">1</span> &amp;&amp; tb[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> x = <span class="built_in">get</span>(tb, <span class="number">3</span>);</span><br><span class="line">                <span class="keyword">if</span> (S.<span class="built_in">count</span>(x)) <span class="comment">// 如果哈希表中存在这个数x，则直接返回即为答案</span></span><br><span class="line">                &#123;</span><br><span class="line">                    cout &lt;&lt; x &lt;&lt; endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="进制转换总结"><a href="#进制转换总结" class="headerlink" title="进制转换总结"></a>进制转换总结</h3><p><a href="https://blog.csdn.net/weixin_44668898/article/details/101443574">csdn</a></p><ol><li><p>任意2~36进制数转化为10进制数:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//m是要转换成的进制，s是给定的m进制下的字符串</span></span><br><span class="line"><span class="comment">//结果为int型</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binary</span><span class="params">(<span class="type">int</span> m, string s)</span></span>&#123; </span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="type">char</span> t=s[i];</span><br><span class="line">        <span class="keyword">if</span>(t&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;t&lt;=<span class="string">&#x27;9&#x27;</span>) </span><br><span class="line">ans=ans*m+t-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">ans=ans*m+t-<span class="string">&#x27;a&#x27;</span>+<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>10进制数转换为任意的n进制数:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//n是待转换的十进制数，m是待转换成的进制数 </span></span><br><span class="line"><span class="function">string <span class="title">intToA</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    string ans=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">do</span>&#123;<span class="comment">//使用do&#123;&#125;while()循环类型以防止输入为0的情况</span></span><br><span class="line">        <span class="type">int</span> t=n%m;</span><br><span class="line">        <span class="keyword">if</span>(t&gt;=<span class="number">0</span>&amp;&amp;t&lt;=<span class="number">9</span>)    </span><br><span class="line">ans+=(t+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">ans+=(t+<span class="string">&#x27;a&#x27;</span><span class="number">-10</span>);</span><br><span class="line">        n/=m;</span><br><span class="line">    &#125;<span class="keyword">while</span>(n);   </span><br><span class="line">    ans.<span class="built_in">reverse</span>();</span><br><span class="line">    <span class="keyword">return</span> ans;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 哈希表 </tag>
            
            <tag> 进制转换 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 1249 亲戚（并查集）</title>
      <link href="/2023/03/01/ACWing1249%E4%BA%B2%E6%88%9A%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
      <url>/2023/03/01/ACWing1249%E4%BA%B2%E6%88%9A%E5%B9%B6%E6%9F%A5%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：4391</span><br><span class="line">总尝试数：12317</span><br><span class="line">来源：《信息学奥赛一本通》</span><br><span class="line">算法标签</span><br><span class="line">并查集</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>或许你并不知道，你的某个朋友是你的亲戚。</p><p>他可能是你的曾祖父的外公的女婿的外甥女的表姐的孙子。</p><p>如果能得到完整的家谱，判断两个人是否是亲戚应该是可行的，但如果两个人的最近公共祖先与他们相隔好几代，使得家谱十分庞大，那么检验亲戚关系实非人力所能及。</p><p>在这种情况下，最好的帮手就是计算机。</p><p>为了将问题简化，你将得到一些亲戚关系的信息，如Marry和Tom是亲戚，Tom和Ben是亲戚，等等。</p><p>从这些信息中，你可以推出Marry和Ben是亲戚。</p><p>请写一个程序，对于我们的关于亲戚关系的提问，以最快的速度给出答案。</p><p><strong>输入格式</strong><br>输入由两部分组成。</p><p>第一部分以 N,M 开始。N 为问题涉及的人的个数。这些人的编号为 1,2,3,…,N。下面有 M 行，每行有两个数 ai,bi，表示已知 ai 和 bi 是亲戚。</p><p>第二部分以 Q 开始。以下 Q 行有 Q 个询问，每行为 ci,di，表示询问 ci 和 di 是否为亲戚。</p><p><strong>输出格式</strong><br>对于每个询问 ci,di，输出一行：若 ci 和 di 为亲戚，则输出“Yes”，否则输出“No”。</p><p><strong>数据范围</strong><br>$%1≤N≤20000,$<br>$1≤M≤10^6,$<br>$1≤Q≤10^6$</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">10 7</span><br><span class="line">2 4</span><br><span class="line">5 7</span><br><span class="line">1 3</span><br><span class="line">8 9</span><br><span class="line">1 2</span><br><span class="line">5 6</span><br><span class="line">2 3</span><br><span class="line">3</span><br><span class="line">3 4</span><br><span class="line">7 10</span><br><span class="line">8 9</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes</span><br><span class="line">No</span><br><span class="line">Yes</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>经典并查集算法：</strong></p><p>并查集是一种树型的数据结构，用于处理一些不相交集合的合并及查询问题。常常在使用中以森林来表示。</p><p><strong>合并：</strong></p><p>当许多组元素需要合并在一起时，只需将各组元素的老大(根)合并在一起即可，也就是让其中一个根指向另一个根，就使得两棵树合并成了一棵树，也就把两个组合并为了一个组。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">                       4</span><br><span class="line">  1       4           / \</span><br><span class="line"> / \   +   \     =   1   5</span><br><span class="line">2   3       5        /\   \</span><br><span class="line">             \      2  3   6</span><br><span class="line">              6</span><br></pre></td></tr></table></figure><br>因为并查集的结构是树状结构，所以需注意退化问题。避免退化发生的方法如下：<br>首先，我们合并时，可记录这棵树的高度。接下来当我们需合并两棵树时，我们先对两棵树的高度进行判断，如不同，则让高度小的树的根指向高度大的根。</p><p><strong>查询:</strong><br>当我们要查询两个元素是否属于同一个组时，我们需要沿着各个节点往上向树的根进行查询，如果最终发现<strong>两个元素的根相同</strong>，那么他们就属于同一个组。反之，则不属于同一个组。</p><div class="table-container"><table><thead><tr><th style="text-align:left">数据存储</th><th style="text-align:center">作用及举例</th></tr></thead><tbody><tr><td style="text-align:left">parent[]</td><td style="text-align:center">parent[ i ] = j 表示 节点 i 的父节点是 j（比如上面根结点为10的那棵树，有 parent[ 7 ] = 6 , parent[ 6 ] = 10 …）</td></tr><tr><td style="text-align:left">h[]</td><td style="text-align:center">h[ i ] = j 表示 节点 i 的高度为  j</td></tr></tbody></table></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> parent[<span class="number">20005</span>];<span class="comment">//记录父节点 parent[a]表示a的父节点下标</span></span><br><span class="line"><span class="type">int</span> h[<span class="number">20005</span>];<span class="comment">//height</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//找到根(父节点为自己)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findP</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == parent[i])</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">findP</span>(parent[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="comment">//初始化 父节点为自己</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">        parent[i] = i;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="type">int</span> fa = <span class="built_in">findP</span>(a);</span><br><span class="line">        <span class="type">int</span> fb = <span class="built_in">findP</span>(b);</span><br><span class="line">        <span class="comment">//接枝</span></span><br><span class="line">        <span class="keyword">if</span> (h[fa] &lt;= h[fb])&#123;</span><br><span class="line">            parent[fa] = fb;</span><br><span class="line">            h[fb]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            parent[fb] = fa;</span><br><span class="line">            h[fa]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> q;</span><br><span class="line">    cin &gt;&gt; q;</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    <span class="keyword">while</span> (q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findP</span>(a) == <span class="built_in">findP</span>(b))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Yes\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径压缩优化查询</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findP</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == parent[i])</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        parent[i] = <span class="built_in">findP</span>(parent[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并查集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 3777. 砖块</title>
      <link href="/2023/02/26/ACWing3777%E7%A0%96%E5%9D%97/"/>
      <url>/2023/02/26/ACWing3777%E7%A0%96%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：4942</span><br><span class="line">总尝试数：8862</span><br><span class="line">来源：CF1271B</span><br><span class="line">算法标签</span><br><span class="line">递推</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>n 个砖块排成一排，从左到右编号依次为 1∼n。</p><p>每个砖块要么是黑色的，要么是白色的。</p><p>现在你可以进行以下操作若干次（可以是 0 次）：</p><p><strong>选择两个相邻的砖块，反转它们的颜色。（黑变白，白变黑）</strong></p><p>你的目标是通过不超过 3n 次操作，将所有砖块的颜色变得一致。</p><p><strong>输入格式</strong><br>第一行包含整数 T，表示共有 T 组测试数据。</p><p>每组数据第一行包含一个整数 n。</p><p>第二行包含一个长度为 n 的字符串 s。其中的每个字符都是 W 或 B，如果第 i 个字符是 W，则表示第 i 号砖块是白色的，如果第 i 个字符是 B，则表示第 i 个砖块是黑色的。</p><p><strong>输出格式</strong><br>每组数据，如果无解则输出一行 −1。</p><p>否则，首先输出一行 k，表示需要的操作次数。</p><p>如果 k&gt;0，则还需再输出一行 k 个整数，p1,p2,…,pk。其中 pi 表示第 i 次操作，选中的砖块为 pi 和 pi+1 号砖块。</p><p>如果方案不唯一，则输出任意合理方案即可。</p><p><strong>数据范围</strong><br>1≤T≤10，<br>2≤n≤200。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">8</span><br><span class="line">BWWWWWWB</span><br><span class="line">4</span><br><span class="line">BWBB</span><br><span class="line">5</span><br><span class="line">WWWWW</span><br><span class="line">3</span><br><span class="line">BWB</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">6 2 4</span><br><span class="line">-1</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">2 1</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>贪心</strong>：<br>最终的字符串，要么全为白色，要么全为黑色。</p><ul><li>以目标全为白色为例，遍历字符串的前 n−1 个砖块，每遇到一个黑色砖块，就对其进行一次操作，将该砖块和下一个砖块变为另一种颜色，并将结果记录到数组中。如果发现最后一个砖块不为白色，那说明无法将砖块全部转化为白色；黑色同理。</li><li>若最终全转化为白色和全转化为黑色均不可行，则输出 −1。</li><li>输出一种可行的方案即可。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">char</span>&amp; c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">        c = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        c = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">turnTo</span><span class="params">(string s, <span class="type">char</span> c)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;<span class="comment">//记录操作位置</span></span><br><span class="line">    string str = s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; str.<span class="built_in">length</span>() - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] != c)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">update</span>(str[i]);</span><br><span class="line">            <span class="built_in">update</span>(str[i + <span class="number">1</span>]);</span><br><span class="line">            res.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断最后一个位置</span></span><br><span class="line">    <span class="keyword">if</span>(str.<span class="built_in">back</span>() != c)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        cout &lt;&lt; res.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = res.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; res[i] + <span class="number">1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        string s;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">turnTo</span>(s, <span class="string">&#x27;B&#x27;</span>) &amp;&amp; !<span class="built_in">turnTo</span>(s, <span class="string">&#x27;W&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;-1&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>讨论奇偶性进行模拟</strong></p><ul><li>如果个数都是奇数次，则不可能构造出来</li><li>如果w是奇数个。那就把b变成w</li><li>如果b是奇数个，或者b和w都是偶数个。把w都变成b即可</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> T;    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> n;    cin &gt;&gt; n;</span><br><span class="line">        string s;    cin &gt;&gt; s;</span><br><span class="line">        <span class="type">int</span> w_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> b_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : s)</span><br><span class="line">        &#123;</span><br><span class="line">            w_cnt += (c == <span class="string">&#x27;W&#x27;</span>);</span><br><span class="line">            b_cnt += (c == <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (w_cnt % <span class="number">2</span> == <span class="number">1</span> &amp;&amp; b_cnt % <span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> res_cnt = <span class="number">0</span>;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">            <span class="keyword">if</span> (w_cnt % <span class="number">2</span> == <span class="number">1</span>) <span class="comment">//w是奇数个，b是偶数个。则b要变w</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; n - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s[i] == <span class="string">&#x27;B&#x27;</span> &amp;&amp; s[i+<span class="number">1</span>] == <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        s[i] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">                        s[i+<span class="number">1</span>] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">                        res_cnt ++ ;</span><br><span class="line">                        res.<span class="built_in">push_back</span>(i + <span class="number">1</span>);</span><br><span class="line">                        i += <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;B&#x27;</span> &amp;&amp; s[i+<span class="number">1</span>] == <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        s[i] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">                        s[i+<span class="number">1</span>] = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                        res_cnt ++;</span><br><span class="line">                        res.<span class="built_in">push_back</span>(i + <span class="number">1</span>);</span><br><span class="line">                        i ++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        i ++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>        <span class="comment">//w要变b</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> i = <span class="number">0</span>; </span><br><span class="line">                <span class="keyword">while</span> (i &lt; n - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s[i] == <span class="string">&#x27;W&#x27;</span> &amp;&amp; s[i+<span class="number">1</span>] == <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        s[i] = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                        s[i+<span class="number">1</span>] = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                        res_cnt ++;</span><br><span class="line">                        res.<span class="built_in">push_back</span>(i + <span class="number">1</span>);</span><br><span class="line">                        i += <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;W&#x27;</span> &amp;&amp; s[i+<span class="number">1</span>] == <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        s[i] = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                        s[i+<span class="number">1</span>] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">                        res_cnt ++;</span><br><span class="line">                        res.<span class="built_in">push_back</span>(i + <span class="number">1</span>);</span><br><span class="line">                        i += <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        i ++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (res_cnt &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; res_cnt &lt;&lt; endl;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> x : res)</span><br><span class="line">                &#123;</span><br><span class="line">                    cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                cout &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 1460 我在那</title>
      <link href="/2023/02/23/ACWing1460%E6%88%91%E5%9C%A8%E5%93%AA/"/>
      <url>/2023/02/23/ACWing1460%E6%88%91%E5%9C%A8%E5%93%AA/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：6138</span><br><span class="line">总尝试数：8947</span><br><span class="line">来源：USACO 2019 December Contest Bronze</span><br><span class="line">算法标签</span><br><span class="line">哈希表 字符串哈希</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>农夫约翰出门沿着马路散步，但是他现在发现自己可能迷路了！</p><p>沿路有一排共 $N$ 个农场。</p><p>不幸的是农场并没有编号，这使得约翰难以分辨他在这条路上所处的位置。</p><p>然而，每个农场都沿路设有一个彩色的邮箱，所以约翰希望能够通过查看最近的几个邮箱的颜色来唯一确定他所在的位置。</p><p>每个邮箱的颜色用 <code>A..Z</code> 之间的一个字母来指定，所以沿着道路的 $N$ 个邮箱的序列可以用一个长为 $N$ 的由字母 <code>A..Z</code> 组成的字符串来表示。</p><p>某些邮箱可能会有相同的颜色。</p><p>约翰想要知道最小的 <code>K</code> 的值，使得他查看任意连续 <code>K</code> 个邮箱序列，他都可以唯一确定这一序列在道路上的位置。</p><p>例如，假设沿路的邮箱序列为 <code>ABCDABC</code> 。</p><p>约翰不能令 K=3，因为如果他看到了 <code>ABC</code>，则沿路有两个这一连续颜色序列可能所在的位置。</p><p>最小可行的 K 的值为 K=4，因为如果他查看任意连续 4 个邮箱，那么可得到的连续颜色序列可以唯一确定他在道路上的位置。</p><p><strong>输入格式</strong><br>输入的第一行包含 N ，第二行包含一个由 N 个字符组成的字符串，每个字符均在 A..Z 之内。</p><p><strong>输出格式</strong><br>输出一行，包含一个整数，为可以解决农夫约翰的问题的最小 K 值。</p><p><strong>数据范围</strong><br>$1≤N≤100$</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">ABCDABC</span><br></pre></td></tr></table></figure><br>输出样例：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>枚举步长和子串的起始点，通过set容器判断该子串是否出现过<br><code>st.count(s.substr(begin, end))</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    string s;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        set&lt;string&gt; st;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i+k<span class="number">-1</span> &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            string t = s.<span class="built_in">substr</span>(i,k);</span><br><span class="line">            <span class="keyword">if</span> (st.<span class="built_in">count</span>(t) != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                st.<span class="built_in">insert</span>(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; k;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 哈希表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcWing 3729. 改变数组元素</title>
      <link href="/2023/02/19/ACWing3729%E6%94%B9%E5%8F%98%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0/"/>
      <url>/2023/02/19/ACWing3729%E6%94%B9%E5%8F%98%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：2s / 256MB</span><br><span class="line">总通过数：5478</span><br><span class="line">总尝试数：10327</span><br><span class="line">来源：CF1501B</span><br><span class="line">算法标签</span><br><span class="line">差分 区间合并</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个空数组 V 和一个整数数组 a1,a2,…,an。<br>现在要对数组 V 进行 n 次操作。</p><p>第 i 次操作的具体流程如下：</p><p>从数组 V 尾部插入整数 0。<br>将位于数组 V 末尾的 $a_i$ 个元素都变为 1（已经是 1 的不予理会）。<br>注意：<br>$a_i$可能为 0，即不做任何改变。<br>$a_i$可能大于目前数组 V 所包含的元素个数，此时视为将数组内所有元素变为 1。<br>请你输出所有操作完成后的数组 V。</p><p><strong>输入格式</strong><br>第一行包含整数 T，表示共有 T 组测试数据。</p><p>每组数据第一行包含整数 n。</p><p>第二行包含 n 个整数 a1,a2,…,an。</p><p><strong>输出格式</strong><br>每组数据输出一行结果，表示所有操作完成后的数组 V，数组内元素之间用空格隔开。</p><p><strong>数据范围</strong><br>$1≤T≤20000$,<br>$1≤n≤2×10^5$,<br>$0≤a_i≤n$,<br>保证一个测试点内所有 n 的和不超过 $2×10^5$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">6</span><br><span class="line">0 3 0 0 1 3</span><br><span class="line">10</span><br><span class="line">0 0 0 1 0 5 0 0 0 2</span><br><span class="line">3</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0 1 1 1</span><br><span class="line">0 1 1 1 1 1 0 0 1 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>差分算法</strong></p><p>根据题意，有n次操作，每次操作都会在数组后面添加个0，那么最终得到的<strong>数组长度是原数组的两倍</strong>。我们需要输出的为<strong>后半段数组</strong>元素。</p><p>每次操作还会将某个区间内的数变为 1</p><p>故可以用差分数组记录数组中该位置被操作的次数，若次数大于0则代表该元素变为1。</p><p>对于初始数组的元素，因为不需要输出且仅用于确定一个区间，故我们可以用一个临时变量来记录，差分数组记录的范围可只保留后半段数组，即将后半段数组的第一个元素在差分数组中记录为第一个元素</p><p><strong>第i次操作区间：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = i;</span><br><span class="line">l = max(0, i-x+1) //x为初始数组的第i元素，用临时变量x记录</span><br></pre></td></tr></table></figure></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200005</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> c[N];<span class="comment">//差分数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    <span class="type">int</span> n, x;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            cin &gt;&gt; x;</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">max</span>(<span class="number">0</span>, i - x + <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> r = i;</span><br><span class="line">            c[l]++;</span><br><span class="line">            c[r + <span class="number">1</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//恢复差分数组</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            c[i] += c[i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (c[i] &gt; <span class="number">0</span>)</span><br><span class="line">                cout &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n+<span class="number">1</span>; i++)</span><br><span class="line">            c[i] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>暴力模拟</strong><br>TLE 5/10<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        cin&gt;&gt;n;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            cin&gt;&gt;temp;</span><br><span class="line">            a.<span class="built_in">push_back</span>(temp);</span><br><span class="line">            b.<span class="built_in">push_back</span>(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            a.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> temp = b[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">min</span>(temp,n); j++)&#123;</span><br><span class="line">                a.<span class="built_in">pop_back</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">min</span>(temp,n); j++)&#123;</span><br><span class="line">                a.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = a.<span class="built_in">size</span>() - n; i &lt; a.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            cout&lt;&lt;a[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        a.<span class="built_in">clear</span>();</span><br><span class="line">        b.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于equals()方法的新发现</title>
      <link href="/2023/02/16/Java%E5%A4%8D%E4%B9%A0%E5%85%B3%E4%BA%8Eequals%E6%96%B9%E6%B3%95/"/>
      <url>/2023/02/16/Java%E5%A4%8D%E4%B9%A0%E5%85%B3%E4%BA%8Eequals%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>补充笔记：<a href="Java复习equas_compareTo.md">关于 “equals” 和 “==” 和 “compareTo”</a></p></blockquote><p>在复习时发现一个奇怪的点：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span>&#123;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">      <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">      System.out.println((o1 == o2) + <span class="string">&quot; &quot;</span> + (o1.equals(o2)));</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">      <span class="type">String</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">      System.out.println((t1 == t2) + <span class="string">&quot; &quot;</span> + (t1.equals(t2)));</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">false false</span><br><span class="line">false true</span><br></pre></td></tr></table></figure><p>同样是equals方法，比较方式在不同的类中似乎有区别</p><h3 id="equals-方法在Object类中定义"><a href="#equals-方法在Object类中定义" class="headerlink" title="equals()方法在Object类中定义:"></a>equals()方法在Object类中定义:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span> == obj);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上边我们很明显看出是比较2个对象<strong>引用地址</strong>是否相同，但是我们平时在调用<code>String、Integer</code>等封装类型时的equals方法时是<strong>比较的内容</strong>是否一致而不是地址一致，如果是地址一致，那所有的String比较都是相等的，所以封装类型都重写了equals方法。</p><h3 id="equals-方法在String类中定义"><a href="#equals-方法在String类中定义" class="headerlink" title="equals()方法在String类中定义:"></a>equals()方法在String类中定义:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object anObject)</span> &#123;  </span><br><span class="line">    <span class="comment">//判断是否为同一个对象</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> == anObject) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//判断是否为String对象</span></span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">anotherString</span> <span class="operator">=</span> (String)anObject;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> value.length;  </span><br><span class="line">        <span class="comment">//判断调用String的char数组和比较String的char数组长度是否一致</span></span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.count) &#123;  </span><br><span class="line">            <span class="type">char</span> v1[] = value;  </span><br><span class="line">            <span class="type">char</span> v2[] = anotherString.value;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> offset;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> anotherString.offset;  </span><br><span class="line">            <span class="comment">//循环判断每个字符是否一致</span></span><br><span class="line">            <span class="keyword">while</span> (n– != <span class="number">0</span>) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (v1[i++] != v2[j++])  </span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据以上源码可以看出封装类型的String对equals进行了重写，其他封装类型原理一样，只是根据不同的类型去判断值</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 String s = &quot;Hello&quot; 和 String s = new String(&quot;Hello&quot;)</title>
      <link href="/2023/02/16/Java%E5%A4%8D%E4%B9%A0string%E5%92%8CnewString/"/>
      <url>/2023/02/16/Java%E5%A4%8D%E4%B9%A0string%E5%92%8CnewString/</url>
      
        <content type="html"><![CDATA[<p>Java为了避免产生大量的String对象，设计了一个字符串常量池。<br>工作原理是这样的，创建一个字符串时，JVM首先为检查字符串常量池中是否有值相等的字符串，<br>如果有，则不再创建，直接返回该字符串的引用地址，<br>若没有，则创建，然后放到字符串常量池中，并返回新创建的字符串的引用地址。</p><p><a href="https://imgse.com/i/pSbekUU"><img src="https://s1.ax1x.com/2023/02/16/pSbekUU.png" alt="pSbekUU.png"></a></p><p><code>String s = new String(&quot;Hello&quot;);</code><br><strong>创建两个对象，或者创建一个对象：</strong><br>JVM首先是在字符串常量池中找”Hello”字符串，如果没有创建字符串常量，然后放到常量池中，若已存在，则不需要创建；当遇到 new 时，还会在内存（在堆里面）上创建一个新的String对象，存储”Hello”，并将内存上的String对象引用地址返回</p><p><code>String s2 = &quot;Hello&quot;</code><br><strong>创建一个对象，或者不创建对象：</strong><br>String s2 直接赋值, 在常量池里找, 有就直接赋值, 把”hello”的地址给了s2,<br>String s2指向了常量池里的”hello”;<br>反之没有则创建，然后放到字符串常量池中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">String s1=<span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">String s2=<span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">String s3=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;s1和s2 引用地址是否相同：&quot;</span>+(s1 == s2));</span><br><span class="line">System.out.println(<span class="string">&quot;s1和s2 值是否相同：&quot;</span>+s1.equals(s2));</span><br><span class="line">System.out.println(<span class="string">&quot;s1和s3 引用地址是否相同：&quot;</span>+(s1 == s3));</span><br><span class="line">System.out.println(<span class="string">&quot;s1和s3 值是否相同：&quot;</span>+s1.equals(s3));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s1和s2 引用地址是否相同：true</span><br><span class="line">s1和s2 值是否相同：true</span><br><span class="line">s1和s3 引用地址是否相同：false</span><br><span class="line">s1和s3 值是否相同：true</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span>&#123;</span><br><span class="line">      String s1=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">      String s2=<span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">      String s3=<span class="string">&quot;Hello&quot;</span>;    </span><br><span class="line">      System.out.println(s1==s2);</span><br><span class="line">      System.out.println(s1.equals(s2));</span><br><span class="line"></span><br><span class="line">      System.out.println(s2==s3);</span><br><span class="line">      System.out.println(s2.equals(s3));</span><br><span class="line"> </span><br><span class="line">      String s4=s1;</span><br><span class="line">      System.out.println(s1==s4);</span><br><span class="line">      System.out.println(s1.equals(s4));</span><br><span class="line"></span><br><span class="line">      String s5=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">      System.out.println(s1==s5);</span><br><span class="line">      System.out.println(s1.equals(s5));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br><span class="line">true</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing 3956. 截断数组</title>
      <link href="/2023/02/13/AcWing3956%E6%88%AA%E6%96%AD%E6%95%B0%E7%BB%84/"/>
      <url>/2023/02/13/AcWing3956%E6%88%AA%E6%96%AD%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：4585</span><br><span class="line">总尝试数：20229</span><br><span class="line">来源：AcWing,第16场周赛</span><br><span class="line">算法标签:</span><br><span class="line">枚举 前缀和</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个长度为 n 的数组 a1,a2,…,an。</p><p>现在，要将该数组从中间截断，得到三个非空子数组。</p><p>要求，三个子数组内各元素之和都相等。</p><p>请问，共有多少种不同的截断方法？</p><p><strong>输入格式</strong><br>第一行包含整数 n。<br>第二行包含 n 个整数 a1,a2,…,an。</p><p><strong>输出格式</strong><br>输出一个整数，表示截断方法数量。</p><p><strong>数据范围</strong><br>前六个测试点满足 $1≤n≤10$<br>所有测试点满足 $1≤n≤10^5，−10000≤a_i≤10000。$</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 2 3 3</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2 3 4 5</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure><br><strong>输入样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">0 0</span><br></pre></td></tr></table></figure><br><strong>输出样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>既然分为三个数组，且元素和相等</p><p>那么每个数组的元素和为原数组的<strong>1/3</strong></p><p>若除不尽或<code>n &lt; 3</code>则答案为0</p><p>sum[]为前缀和, averge=原数组总和/3<br>我们只需要寻找一个位置 <code>sum[i] == averge*2</code></p><p>此时<code>ans += count(sum[1] ~ sum[i-1] == averge)</code>即可</p><p>即第i位 满足2*averge, 只需要加上能使前i位的数组 分为 两个值为averge的位置 的数量即可(sum[]==ave)</p><p>注意 前缀和、ans、count开long long<br><code>if (sum[i] == ave*2) ans += count;</code><br><code>if (sum[i] == ave) count++;</code><br>顺序不可变 例：3-&gt; 0 0 0 </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">100005</span>];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> sum[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        sum[i] = a[i] + sum[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum[n] % <span class="number">3</span> || n &lt; <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ave = sum[n] / <span class="number">3</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> count = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == ave*<span class="number">2</span>)</span><br><span class="line">            ans += count;</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == ave)</span><br><span class="line">            count++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于抽象类和接口</title>
      <link href="/2023/02/06/Java%E5%A4%8D%E4%B9%A0%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3/"/>
      <url>/2023/02/06/Java%E5%A4%8D%E4%B9%A0%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Coach</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">defend</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在一个抽象类中，<strong>至少有一个抽象方法</strong>（通过关键字 abstract 定义的方法，<strong>并且没有方法体</strong>，如上例中的 defend() 方法和 attack() 方法），否则就没有必要称之为抽象类。需要注意的是，抽象类是<strong>不能实例化</strong>的！它<strong>需要被一个子类继承</strong>；方法的具体实现都要由抽象类的子类确定，抽象类本身并不负责。<strong>抽象类中可存在非抽象方法。</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Coach</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">defend</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hesai</span> <span class="keyword">extends</span> <span class="title class_">Coach</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">defend</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;防守&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;攻击&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>我们知道，有抽象方法的类被称为抽象类，也就意味着抽象类中还能有不是抽象方法的方法。这样的类就不能算作纯粹的接口，尽管它也可以提供接口的功能<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐式的abstract</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Coach</span> &#123;</span><br><span class="line"><span class="comment">// 隐式的public</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">defend</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>接口是隐式抽象的，所以声明时没有必要使用 <code>abstract</code> 关键字；接口的每个方法都是隐式抽象的，所以同样不需要使用 <code>abstract</code> 关键字；接口中的方法都是隐式 <code>public</code> 的。</p><p>和抽象类一样，接口也不能直接被实例化，它需要一个类来实现它</p><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><ol><li><p>接口可以继承多个接口，抽象类不可以多继承类，但可以单继承类或多实现接口。</p></li><li><p>抽象方法和接口函数都不能使用static修饰。抽象方法的访问修饰符可以是public、protected和default，不能是private；接口的默认访问修饰符为public，不能使用其他修饰符。</p></li><li><p>接口的变量只能是不可变常量，默认修饰符都是public static final；但是抽象类的变量可以是普通变量</p></li><li><p>抽象类可以有构造器，接口不能有构造器。</p></li><li><p>接口实现类必须实现接口中的所有声明的方法，但抽象类的子类可以部分实现父类的抽象方法，但如果子类不能全部实现抽象方法，那么该子类只能是抽象类；</p></li><li><p>抽象类可以有非抽象方法，接口中只能有常量和抽象方法。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 &quot;equals&quot; 和 &quot;==&quot; 和 &quot;compareTo&quot;</title>
      <link href="/2023/02/05/Java%E5%A4%8D%E4%B9%A0equas_compareTo/"/>
      <url>/2023/02/05/Java%E5%A4%8D%E4%B9%A0equas_compareTo/</url>
      
        <content type="html"><![CDATA[<ol><li><code>==</code> 是指对内存地址进行比较, 判断两个变量或实例是不是指向同一个内存空间</li><li><code>equals</code> 是对字符串的内容进行比较, 判断两个变量或实例所指向的内存空间的值是不是相同<blockquote><p>在Object类中是比较2个对象引用地址是否相同, 详情见 <a href="Java复习关于equals方法.md">关于equals()方法的新发现</a></p></blockquote></li><li><code>compareTo</code> 按字典顺序比较两个字符串，不考虑大小写。<ul><li>即参与比较的两个字符串如果首字符相同，则比较下一个字符，直到有不同的为止，返回该不同的字符的ascII码差值</li><li>如果两个字符串不一样长，可以参与比较的字符又完全一样，则返回两个字符串的长度差值</li></ul></li></ol><p><strong>“compareTo” 的一些例子：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>, str2 = <span class="string">&quot;ab&quot;</span>, str3 = <span class="string">&quot;abccc&quot;</span>, str4 = <span class="string">&quot;abe&quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;str1.compareTo(str2):&quot;</span> + str1.compareTo(str2)); </span><br><span class="line">System.out.println(<span class="string">&quot;str2.compareTo(str1):&quot;</span> + str2.compareTo(str1));</span><br><span class="line">System.out.println(<span class="string">&quot;str1.compareTo(str3):&quot;</span> + str1.compareTo(str3));</span><br><span class="line">System.out.println(<span class="string">&quot;str1.compareTo(str4):&quot;</span> + str1.compareTo(str4));</span><br><span class="line"></span><br><span class="line"><span class="type">Integer</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">1</span>, num2 = <span class="number">4</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;num1.compareTo(num2):&quot;</span> + num1.compareTo(num2));</span><br><span class="line">System.out.println(<span class="string">&quot;num2.compareTo(num1):&quot;</span> + num2.compareTo(num1));</span><br><span class="line"><span class="type">Character</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>, d = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;a.compareTo(d):&quot;</span> + a.compareTo(d));</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str1.compareTo(str2): 1</span><br><span class="line">str2.compareTo(str1): -1</span><br><span class="line">str1.compareTo(str3): -2</span><br><span class="line">str1.compareTo(str4): -2</span><br><span class="line">num1.compareTo(num2): -1</span><br><span class="line">num2.compareTo(num1): 1</span><br><span class="line">a.compareTo(d): -3</span><br></pre></td></tr></table></figure></p><p>建立字符对象Character x = new Character(‘a’), 下列哪个语句返回true? (A)<br>A) x.equals(new Character(‘a’))<br>B) x.compareToIgnoreCase(‘A’)<br>C) x.equalsIgnoreCase(‘A’)<br>D) x.equals(“a”)</p><p><strong>分析下面代码:</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    System.out.print((o1 == o2) + <span class="string">&quot; &quot;</span> + (o1.equals(o2)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>解析:</strong><br>这段代码是Java语言的代码，它的作用是创建了两个Java对象，分别是o1和o2，并将它们的内存地址和对象内容比较的结果输出到控制台。</p><p>具体来说，在Java语言中，”==”运算符用来比较两个对象的内存地址是否相同，也就是说，判断它们是否指向同一个对象。因此，结果 “o1 == o2” 将输出false，因为它们是两个不同的对象，所以它们的内存地址不相同。</p><p>然而，”equals”方法用于比较两个对象的内容是否相等。因为Object类的默认实现是比较内存地址，所以结果 “o1.equals(o2)” 也是false。</p><p>最终，代码的输出结果是 “false false”。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于Java中的static关键字</title>
      <link href="/2023/02/04/Java%E5%A4%8D%E4%B9%A0static/"/>
      <url>/2023/02/04/Java%E5%A4%8D%E4%B9%A0static/</url>
      
        <content type="html"><![CDATA[<hr><p>java中的<code>static</code>关键字主要用于内存管理。</p><p><strong>作用范围：</strong><br> <code>static</code>关键字属于类，而不是类的实例。</p><p><strong>修饰如下：</strong></p><ul><li>变量：称为类变量、静态变量</li><li>方法：称为类方法、静态方法</li><li>代码块：称为静态代码块</li><li>内部类：称为静态内部类</li></ul><hr><h3 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h3><p>类的成员变量可以分为以下两种：</p><ol><li>静态变量（或称为类变量），被 <code>static</code> 修饰的成员变量。</li><li>实例变量，没有被 <code>static</code> 修饰的成员变量。</li></ol><h4 id="区别："><a href="#区别：" class="headerlink" title="区别："></a>区别：</h4><p>(1) 静态变量</p><ul><li>运行时，Java 虚拟机只为静态变量分配一次内存，<strong>加载类过程中完成静态变量的内存分配。</strong></li><li>在类的内部，可以在任何方法内直接访问静态变量。</li><li>在其他类中，可以<strong>通过类名</strong>访问该类中的静态变量。</li></ul><p>(2) 实例变量</p><ul><li>每创建一个实例，Java 虚拟机就会为实例变量分配一次内存。</li><li>在类的内部，可以在<strong>非静态方法中直接访问实例变量</strong>。</li><li>在本类的静态方法或其他类中则需要通过类的实例对象进行访问。</li></ul><h4 id="静态变量在类中的作用如下："><a href="#静态变量在类中的作用如下：" class="headerlink" title="静态变量在类中的作用如下："></a>静态变量在类中的作用如下：</h4><p>(1) 静态变量可以被类的所有实例共享，因此静态变量可以作为实例之间的共享数据，增加<strong>实例之间的交互性</strong>。<br>(2) 如果类的所有实例都包含一个相同的常量属性，则可以把这个属性定义为静态常量类型，从而节省内存空间。例如，在类中定义一个静态常量 PI。它能使程序存储器高效(即它节省内存)。</p><h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p>成员方法也可以分为以下两种：</p><ol><li>静态方法（或称为类方法），被 static 修饰的成员方法。</li><li>实例方法，没有被 static 修饰的成员方法。</li></ol><h4 id="区别：-1"><a href="#区别：-1" class="headerlink" title="区别："></a>区别：</h4><ol><li>静态方法，属于类，而不属于类的对象。<ul><li>它通过类直接被调用，无需创建类的对象。</li><li>静态方法中，不能使用 this 关键字，也不能直接访问所属类的实例变量和实例方法；</li><li>静态方法中，可以直接访问所属类的静态变量和静态方法。</li><li>同this 关键字，super 关键字也与类的实例相关，静态方法中不能使用 super 关键字。</li></ul></li><li>实例方法，可直接访问所属类的静态变量、静态方法、实例变量和实例方法。</li></ol><h4 id="静态方法与静态变量好处："><a href="#静态方法与静态变量好处：" class="headerlink" title="静态方法与静态变量好处："></a>静态方法与静态变量好处：</h4><ol><li><p>属于类级别，无需创建对象就即可直接使用，使用方便。</p></li><li><p>全局唯一，内存中唯一，静态变量可以唯一标识某些状态。</p></li><li><p>类加载时候初始化，常驻在内存，调用快捷方便。</p></li></ol><h4 id="静态方法与静态变量缺点："><a href="#静态方法与静态变量缺点：" class="headerlink" title="静态方法与静态变量缺点："></a>静态方法与静态变量缺点：</h4><ol><li><p>静态方法<strong>不能调用非静态的方法和变量</strong>。</p></li><li><p>不能使用this和super关键字。</p></li></ol><h4 id="静态方法与静态变量适用场景："><a href="#静态方法与静态变量适用场景：" class="headerlink" title="静态方法与静态变量适用场景："></a>静态方法与静态变量适用场景：</h4><ol><li><p>静态方法适合工具类中方法的定义，比如文件操作，日期处理方法等。</p></li><li><p>静态方法适合入口方法定义，比如单例模式，因从外部拿不到构造函数，所以定义一个静态的方法获取对象非常有必要。</p></li><li><p>静态变量适合全局变量的定义；举例：用一个布尔型静态成员变量做控制标志。</p></li></ol><h3 id="静态代码块"><a href="#静态代码块" class="headerlink" title="静态代码块"></a>静态代码块</h3><p>静态代码块，是 Java 类中的 <code>static&#123; &#125;</code> 修饰的代码。</p><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p>用于类初始化时，为类的<strong>静态变量</strong>赋初始值，提升程序性能。不能调用非静态成员</p><h4 id="静态代码块的特点："><a href="#静态代码块的特点：" class="headerlink" title="静态代码块的特点："></a>静态代码块的特点：</h4><ol><li>静态代码块，有点类似于一个方法，但不可以存在于任何方法体内。</li><li>静态代码块，可以置于类中的任何地方，类中可以有多个静态初始化块。 </li><li>Java 虚拟机在加载类时执行，将只需要进行一次初始化的操作放在 static 代码块。</li><li>类中含多个静态代码块，Java虚拟机将按它们在类中出现的顺序依次执行，且都执行一次。</li><li>静态代码块不能直接访问类的实例变量和实例方法，需通过类的对象访问。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;----------&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">    A() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;i is &quot;</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;i is &quot;</span>+i);</span><br><span class="line">        i += j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;j is &quot;</span>+j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>输出:</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">j is 7</span><br><span class="line">i is 6</span><br><span class="line">i is 13</span><br><span class="line">----------</span><br><span class="line">i is 6</span><br><span class="line">i is 13</span><br><span class="line"></span><br><span class="line">静态代码块：类初始化时运行一次</span><br><span class="line">普通代码块：每个对象创建是运行一次</span><br></pre></td></tr></table></figure></p><p><strong>初始化顺序：</strong></p><ol><li>父类：静态属性/静态代码块</li><li>子类：静态属性/静态代码块</li><li>父类：成员属性/普通代码块</li><li>父类：构造器</li><li>子类：成员属性/普通代码块</li><li>子类：构造器</li></ol><h3 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h3><ol><li><p>静态内部类，跟静态方法一样，<strong>只能访问静态成员变量和方法</strong>，不能访问非静态方法和属性。</p></li><li><p>静态内部类，可以声明普通成员变量和方法，而普通内部类不能声明static成员变量和方法。</p></li><li><p>普通内部类，可以访问任意外部类的成员变量和方法，相当于外部类的成员。</p></li><li><p>静态内部类，可以单独初始化。</p><ul><li>静态内部类的初始化：<code>Inner i = new Outer.Inner();</code></li><li>普通内部类的初始化：<code>Inner i = new Outer().new Inner();</code></li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4455.出行计划</title>
      <link href="/2023/01/20/%5BACWing%E5%AF%92%E5%81%8712%5D%E5%87%BA%E8%A1%8C%E8%AE%A1%E5%88%92/"/>
      <url>/2023/01/20/%5BACWing%E5%AF%92%E5%81%8712%5D%E5%87%BA%E8%A1%8C%E8%AE%A1%E5%88%92/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1.5s / 64MB</span><br><span class="line">总通过数：3041</span><br><span class="line">总尝试数：8079</span><br><span class="line">来源：第25次CCF计算机软件能力认证</span><br><span class="line">算法标签</span><br><span class="line">差分</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>最近西西艾弗岛上出入各个场所都要持有一定时限内的核酸检测阴性证明。</p><p>具体来时，如果在 <code>t</code> 时刻做了核酸检测，则经过一段时间后可以得到核酸检测阴性证明。</p><p>这里我们假定等待核酸检测结果需要 <code>k</code> 个单位时间，即在 <code>t+k</code> 时刻可以获得结果。</p><p>如果一个场所要求持 <code>24</code> 个单位时间内核酸检测结果入内，那么凭上述的核酸检测结果，可以在第 <code>t+k</code> 时刻到第 <code>t+k+23</code> 时刻进入该场所。</p><p>小C按时间顺序列出接下来的 n 项出行计划，其中第 i 项$（1≤i≤n）$可以概括为：$t_i$ 时刻进入某场所，该场所需持有 $c_i$ 个单位时间内的核酸检测结果入内，其中 $0&lt;c_i≤2×10^5$。</p><p>为了合理安排核酸检测时间，试根据小C的出行计划，回答如下查询：</p><p>如果在 q 时刻做了核酸检测，有多少项出行计划的核酸检测要求可以得到满足？<br>这样的查询共有 m 个，分别为 q1,q2,⋯,qm ；查询之间互不影响。</p><p><strong>输入格式</strong><br>输入的第一行包含空格分隔的三个正整数 <code>n、m 和 k</code>，分别表示出行计划数目、查询个数以及等待核酸检测结果所需时间。</p><p>接下来输入 <code>n</code> 行，其中每行包含用空格分隔的两个正整数 $t_i<br>、c_i$，表示一项出行计划；出行计划按时间顺序给出，满足$0&lt;t_1≤t_2≤⋯≤t_n≤2×10^5$。</p><p>最后输入 <code>m</code> 行，每行仅包含一个正整数 $q_i$<br>，表示一个查询。<code>m</code> 个查询亦按照时间顺序给出，满足 $0&lt;q_1&lt;q_2&lt;⋯&lt;q_m≤2×10^5$。</p><p><strong>输出格式</strong><br>输出共 m 行，每行一个整数，表示对应查询的答案。</p><p><strong>数据范围</strong><br>$40\%$ 的测试数据满足 $0&lt;n,k≤1000<br>、m=1$；<br>$70\%$ 的测试数据满足 $0&lt;n,m,k≤1000$；<br>全部的测试数据满足 $0&lt;n,m,k≤10^5$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">6 2 10</span><br><span class="line">5 24</span><br><span class="line">10 24</span><br><span class="line">11 24</span><br><span class="line">34 24</span><br><span class="line">35 24</span><br><span class="line">35 48</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>时刻 1<br> 做检测，可以满足第三、四、六项出行计划；</p><p>时刻 2<br> 做检测，可以满足第四、五、六项出行计划。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>根据数据范围猜测时间复杂度应控制在<code>O(nlogn)</code>内，因此每次询问的时间复杂度应控制在<code>O(logn)</code>内, 故每次询问先计算核酸有效期再枚举计算可行计划数的方式是不可行的。</p><p><strong>差分算法：</strong><br>q：核酸检测的时刻<br>k：检测完核酸等待结果的时间<br>t：进入到出行场所的时刻<br>c：出行场所的核酸检查要求</p><p>根据题目可知 对于每个出行地点都有，可得 <code>q+k &lt;= t &lt;= q+k+c-1</code>, 故 <code>t-k-c+1 &lt;= q &lt;= t-k</code>，<strong>即t时刻成功进入该场合的核酸检测时刻范围。</strong><br>通过差分数组记录该范围，下标表示时刻，值表示所有出行安排的核酸检测时刻范围涉及到该时刻的次数，该次数即是当前时刻做核酸能够满足的出行计划个数。</p><p>注意：处理差分数组时，下标 l、r 的值可能小于1，不符合实际意义，也会造成数组越界，故需要特殊处理。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200005</span>;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//出行计划数目、查询个数以及等待核酸检测结果所需时间</span></span><br><span class="line">    <span class="type">int</span> n, m, k;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="keyword">while</span> (n--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//出行时间、核酸要求</span></span><br><span class="line">        <span class="type">int</span> t, c;</span><br><span class="line">        cin &gt;&gt; t &gt;&gt; c;</span><br><span class="line">        <span class="comment">//处理差分数组</span></span><br><span class="line">        <span class="type">int</span> l = t - k - c + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> r = t - k;</span><br><span class="line">        <span class="keyword">if</span>(r &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            a[<span class="built_in">max</span>(l, <span class="number">1</span>)]++;<span class="comment">//l可能为负数</span></span><br><span class="line">            a[r + <span class="number">1</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//还原差分数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++)</span><br><span class="line">        a[i] += a[i - <span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> q;</span><br><span class="line">        cin &gt;&gt; q;</span><br><span class="line">        cout &lt;&lt; a[q] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L1-046 整除光棍</title>
      <link href="/2023/01/18/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B04%5D/"/>
      <url>/2023/01/18/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B04%5D/</url>
      
        <content type="html"><![CDATA[<h2 id="L1-046-整除光棍"><a href="#L1-046-整除光棍" class="headerlink" title="L1-046 整除光棍"></a>L1-046 整除光棍</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>这里所谓的“光棍”，并不是指单身汪啦~ 说的是全部由1组成的数字，比如1、11、111、1111等。传说任何一个光棍都能被一个不以5结尾的奇数整除。比如，111111就可以被13整除。 现在，你的程序要读入一个整数x，这个整数一定是奇数并且不以5结尾。然后，经过计算，输出两个数字：第一个数字s，表示x乘以s是一个光棍，第二个数字n是这个光棍的位数。这样的解当然不是唯一的,题目要求你输出最小的解。</p><p>提示：一个显然的办法是逐渐增加光棍的位数，直到可以整除x为止。但难点在于，s可能是个非常大的数 —— 比如，程序输入31，那么就输出3584229390681和15，因为31乘以3584229390681的结果是111111111111111，一共15个1。</p><p><strong>输入格式：</strong><br>输入在一行中给出一个不以5结尾的正奇数x（&lt;1000）。</p><p><strong>输出格式：</strong><br>在一行中输出相应的最小的s和n，其间以1个空格分隔。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">31</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3584229390681 15</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>思路:</strong> 模拟除法过程<br><img src="https://s1.ax1x.com/2023/01/18/pS3HOo9.png" alt=""></p><ul><li>先找到恰好大于除数的被除数(全是1)</li><li>模拟除法过程，如果除尽则结束，没有除尽则余数*10+1继续进行除法，即除数的位数加1了<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//模拟除法</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;<span class="comment">//除数</span></span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">1</span>;<span class="comment">//被除数(全为1)</span></span><br><span class="line">    <span class="type">int</span> num = <span class="number">1</span>;<span class="comment">//被除数位数</span></span><br><span class="line">    <span class="keyword">while</span>(s &lt; n)<span class="comment">//使得被除数大于除数</span></span><br><span class="line">    &#123;</span><br><span class="line">        s = s * <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;s/n;<span class="comment">//一位一位输出</span></span><br><span class="line">        s = s % n;<span class="comment">//余数</span></span><br><span class="line">        <span class="keyword">if</span>(s == <span class="number">0</span>)<span class="comment">//余数为0，结束</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = s * <span class="number">10</span> + <span class="number">1</span>;<span class="comment">//下一位</span></span><br><span class="line">            num++;<span class="comment">//位数+1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;num;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> GPLT 一阶题目集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L1-039 古风排版 L1-043 阅览室</title>
      <link href="/2023/01/17/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B03%5D/"/>
      <url>/2023/01/17/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B03%5D/</url>
      
        <content type="html"><![CDATA[<h2 id="L1-039-古风排版"><a href="#L1-039-古风排版" class="headerlink" title="L1-039 古风排版"></a>L1-039 古风排版</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>中国的古人写文字，是从右向左竖向排版的。本题就请你编写程序，把一段文字按古风排版。</p><p><strong>输入格式：</strong><br>输入在第一行给出一个正整数N（&lt;100），是每一列的字符数。第二行给出一个长度不超过1000的非空字符串，以回车结束。</p><p><strong>输出格式：</strong><br>按古风格式排版给定的字符串，每列N个字符（除了最后一列可能不足N个）。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">This is a test case</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">asa T</span><br><span class="line">st ih</span><br><span class="line">e tsi</span><br><span class="line"> ce s</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>找数学关系：<strong>将字符串通过添加一定数量的空格使其长度为n的倍数</strong>，按行输出，第 $i$ 行第一个字符一定为字符串的倒数第$(n-i)$个字符，即下标为<code>s.length()-1 -(n-i)</code>,每一行输出第一个字符后，下一个输出字符的下标是上一个输出字符的下标减 $n$ <strong>同一行的字符下标一定同余于n</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    string s;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="built_in">getline</span>(cin, s);</span><br><span class="line">    <span class="type">int</span> t = s.<span class="built_in">length</span>()%n;</span><br><span class="line">    <span class="keyword">if</span>(t)&#123;</span><br><span class="line">        <span class="type">int</span> space = n - t;</span><br><span class="line">        <span class="keyword">while</span>(space--)</span><br><span class="line">            s += <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">1</span>; i&lt;=n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j =s.<span class="built_in">length</span>()+i<span class="number">-1</span>-n; j&gt;=<span class="number">0</span>; j-=n)</span><br><span class="line">            cout&lt;&lt;s[j];</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="L1-043-阅览室"><a href="#L1-043-阅览室" class="headerlink" title="L1-043 阅览室"></a>L1-043 阅览室</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>天梯图书阅览室请你编写一个简单的图书借阅统计程序。当读者借书时，管理员输入书号并按下S键，程序开始计时；当读者还书时，管理员输入书号并按下E键，程序结束计时。书号为不超过1000的正整数。当管理员将0作为书号输入时，表示一天工作结束，你的程序应输出当天的读者借书次数和平均阅读时间。</p><p>注意：由于线路偶尔会有故障，可能出现不完整的纪录，即只有S没有E，或者只有E没有S的纪录，系统应能自动忽略这种无效纪录。另外，题目保证书号是书的唯一标识，同一本书在任何时间区间内只可能被一位读者借阅。</p><p><strong>输入格式：</strong><br>输入在第一行给出一个正整数 $N（N≤10）$，随后给出 $N$ 天的纪录。每天的纪录由若干次借阅操作组成，每次操作占一行，格式为：</p><p>书号（$[1, 1000]$ 内的整数） 键值（$S$或$E$） 发生时间（hh:mm，其中hh是$[0,23]$内的整数，mm是$[0, 59]$内整数）</p><p>每一天的纪录保证按时间递增的顺序给出。</p><p><strong>输出格式：</strong><br>对每天的纪录，在一行中输出当天的读者借书次数和平均阅读时间（以分钟为单位的精确到个位的整数时间）。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">1 S 08:10</span><br><span class="line">2 S 08:35</span><br><span class="line">1 E 10:00</span><br><span class="line">2 E 13:16</span><br><span class="line">0 S 17:00</span><br><span class="line">0 S 17:00</span><br><span class="line">3 E 08:10</span><br><span class="line">1 S 08:20</span><br><span class="line">2 S 09:00</span><br><span class="line">1 E 09:20</span><br><span class="line">0 E 17:00</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 196</span><br><span class="line">0 0</span><br><span class="line">1 60</span><br></pre></td></tr></table></figure></p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><p>注意：</p><ul><li>求平均阅读时间时要四舍五入，<code>ave = (int)(ave*1.0 / times + 0.5)</code></li><li>times作为被除数不能为0，即需要特判</li><li>当操作符为‘E’，且<code>borrow[index]</code>为1时才表示一次有效借还</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> book[<span class="number">1005</span>];</span><br><span class="line"><span class="type">int</span> borrow[<span class="number">1005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> times = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ave = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> opr, c;</span><br><span class="line">        <span class="type">int</span> id, hour, min;</span><br><span class="line">        cin &gt;&gt; id &gt;&gt; opr &gt;&gt; hour &gt;&gt; c &gt;&gt; min;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (times &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                ave = (<span class="type">int</span>)(ave*<span class="number">1.0</span> / times + <span class="number">0.5</span>);   </span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; times &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; ave &lt;&lt; endl;</span><br><span class="line">            times = <span class="number">0</span>;</span><br><span class="line">            ave = <span class="number">0</span>;</span><br><span class="line">            n--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (opr == <span class="string">&#x27;S&#x27;</span>)&#123;</span><br><span class="line">                borrow[id] = <span class="number">1</span>;</span><br><span class="line">                book[id] = hour * <span class="number">60</span> + min;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (opr == <span class="string">&#x27;E&#x27;</span> &amp;&amp; borrow[id]) &#123;</span><br><span class="line">                times++;</span><br><span class="line">                ave += (hour * <span class="number">60</span> + min) - book[id];</span><br><span class="line">                borrow[id] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> GPLT 一阶题目集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L1-025 正整数A+B L1-027 出租</title>
      <link href="/2023/01/14/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B02%5D/"/>
      <url>/2023/01/14/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B02%5D/</url>
      
        <content type="html"><![CDATA[<h2 id="L1-025-正整数A-B"><a href="#L1-025-正整数A-B" class="headerlink" title="L1-025 正整数A+B"></a>L1-025 正整数A+B</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>题的目标很简单，就是求两个正整数A和B的和，其中A和B都在区间<code>[1,1000]</code>。稍微有点麻烦的是，输入并不保证是两个正整数。</p><p><strong>输入格式：</strong><br>输入在一行给出A和B，其间以空格分开。问题是A和B不一定是满足要求的正整数，有时候可能是<strong>超出范围的数字、负数、带小数点的实数、甚至是一堆乱码</strong>。</p><p>注意：我们把输入中出现的第1个空格认为是A和B的分隔。题目保证至少存在一个空格，并且B不是一个空字符串。</p><p><strong>输出格式：</strong><br>如果输入的确是两个正整数，则按格式A + B = 和输出。如果某个输入不合要求，则在相应位置输出?，显然此时和也是?。</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123 456</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123 + 456 = 579</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">22. 18</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? + 18 = ?</span><br></pre></td></tr></table></figure><br><strong>输入样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-100 blabla bla...33</span><br></pre></td></tr></table></figure><br><strong>输出样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? + ? = ?</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>思路getline读取一行，将空格前的子串赋值给a字符串，将空格后的子串赋值给b字符串<br>条件判断：</p><ul><li>超出<code>[1,1000]</code>范围的数字: 先判断<code>length() &gt; 4</code>，若为true继续判断<code>stoi(s)</code>是否在范围内；stox(string)方法：stoi\stof\stol\stoll…</li><li>负数、带小数点的实数、甚至是一堆乱码：遍历字符串，根据ASCII码范围判断。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isZ</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">    <span class="comment">//超出[1, 1000]范围</span></span><br><span class="line">    <span class="keyword">if</span>(s.<span class="built_in">length</span>() &gt; <span class="number">4</span>) </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">stoi</span>(s) &gt; <span class="number">1000</span> || <span class="built_in">stoi</span>(s) &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//判断是否为正整数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">length</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="built_in">getline</span>(cin, s);</span><br><span class="line">    string a = <span class="string">&quot;&quot;</span>, b = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">bool</span> spaceFlag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">length</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            spaceFlag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!spaceFlag)</span><br><span class="line">                a += s[i];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                b += s[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isZ</span>(a) &amp;&amp; <span class="built_in">isZ</span>(b))&#123;</span><br><span class="line">        <span class="type">int</span> A = <span class="built_in">stoi</span>(a);</span><br><span class="line">        <span class="type">int</span> B = <span class="built_in">stoi</span>(b);</span><br><span class="line">        cout &lt;&lt; a &lt;&lt; <span class="string">&quot; + &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot; = &quot;</span> &lt;&lt; A + B;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isZ</span>(a))</span><br><span class="line">            cout &lt;&lt; a &lt;&lt; <span class="string">&quot; + &quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;? + &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isZ</span>(b))</span><br><span class="line">            cout &lt;&lt; b &lt;&lt;<span class="string">&quot; = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;? = ?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="L1-027-出租"><a href="#L1-027-出租" class="headerlink" title="L1-027 出租"></a>L1-027 出租</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>下面是新浪微博上曾经很火的一张图：<br><img src="https://images.ptausercontent.com/187" alt=""></p><p>一时间网上一片求救声，急问这个怎么破。其实这段代码很简单，index数组就是arr数组的下标，<code>index[0]=2</code> 对应 <code>arr[2]=1</code>，<code>index[1]=0</code> 对应 <code>arr[0]=8</code>，<code>index[2]=3</code> 对应 <code>arr[3]=0</code>，以此类推…… 很容易得到电话号码是<code>18013820100</code>。</p><p>本题要求你编写一个程序，为任何一个电话号码生成这段代码 —— 事实上，只要生成最前面两行就可以了，后面内容是不变的。</p><p><strong>输入格式：</strong><br>输入在一行中给出一个由11位数字组成的手机号码。</p><p><strong>输出格式：</strong><br>为输入的号码生成代码的前两行，其中arr中的数字必须按递减顺序给出。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">18013820100</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int[] arr = new int[]&#123;8,3,2,1,0&#125;;</span><br><span class="line">int[] index = new int[]&#123;3,0,4,3,1,0,2,4,3,4,4&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> ct[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> arr[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> index[<span class="number">11</span>];</span><br><span class="line"><span class="type">int</span> p;<span class="comment">//arr下标</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string number;</span><br><span class="line">    cin &gt;&gt; number;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : number) &#123;</span><br><span class="line">        ct[c - <span class="string">&#x27;0&#x27;</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ct[i] &gt; <span class="number">0</span>)</span><br><span class="line">            arr[p++] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(arr, arr + p, cmp);</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : number) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] == c - <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">                index[i] = j;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int[] arr = new int[]&#123;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; p; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == p<span class="number">-1</span>)&#123;</span><br><span class="line">            cout &lt;&lt; arr[i] &lt;&lt;<span class="string">&quot;&#125;;&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             cout &lt;&lt; arr[i] &lt;&lt;<span class="string">&quot;,&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int[] index = new int[]&#123;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">10</span>)&#123;</span><br><span class="line">            cout &lt;&lt; index[i] &lt;&lt;<span class="string">&quot;&#125;;&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             cout &lt;&lt; index[i] &lt;&lt;<span class="string">&quot;,&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> GPLT 一阶题目集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4699.如此编码</title>
      <link href="/2023/01/12/%5BACWing%E5%AF%92%E5%81%8711%5D%E5%A6%82%E6%AD%A4%E7%BC%96%E7%A0%81/"/>
      <url>/2023/01/12/%5BACWing%E5%AF%92%E5%81%8711%5D%E5%A6%82%E6%AD%A4%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：第27次CCF计算机软件能力认证</span><br><span class="line">算法标签</span><br><span class="line">进位制</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>某次测验后，顿顿老师在黑板上留下了一串数字 23333 便飘然而去。</p><p>凝望着这个神秘数字，小 P 同学不禁陷入了沉思……</p><p>已知某次测验包含 n 道单项选择题，其中第 i 题$（1≤i≤n<br>）$ 有 $a_i$ 个选项，正确选项为 $b_i$ ，满足 $a_i≥2$ 且 $0≤b_i&lt;a_i$ 。</p><p>比如说，$a_i=4$ 表示第 $i$ 题有 $4$ 个选项，此时正确选项 $b_i$的取值一定是 0、1、2、3 其中之一。</p><p>顿顿老师设计了如下方式对正确答案进行编码，使得仅用一个整数 m 便可表示 b1,b2,⋯,bn.</p><p>首先定义一个辅助数组 $c_i$，表示数组 $a_i$ 的前缀乘积。</p><p>当 $1≤i≤n$ 时，满足：</p><p>$c_i=a_1×a_2×⋯×a_i$<br>特别地，定义 $c_0=1$。</p><p>于是 m 便可按照如下公式算出：</p><script type="math/tex; mode=display">m=\sum_{i=1}^n c_{i-1} * b_i=c_0×b_1+c_1×b_2+⋯+c_{n−1}×b_n</script><p>易知，$0≤m&lt;c_n$，最小值和最大值分别当 $b_i$ 全部为 0 和 $b_i=a_i−1$时取得。</p><p>试帮助小 P 同学，把测验的正确答案 b1,b2,⋯,bn 从顿顿老师留下的神秘整数 m 中恢复出来。</p><p><strong>输入格式</strong><br>输入共两行。</p><p>第一行包含用空格分隔的两个整数 n 和 m，分别表示题目数量和顿顿老师的神秘数字。</p><p>第二行包含用空格分隔的 n 个整数 a1,a2,⋯,an ，依次表示每道选择题的选项数目。</p><p><strong>输出格式</strong><br>输出仅一行，包含用空格分隔的 n个整数 b1,b2,⋯,bn ，依次表示每道选择题的正确选项。</p><p><strong>数据范围</strong><br>50% 的测试数据满足：$a_i$全部等于 2，即每道题均只有两个选项，此时 $c_i=2i$；<br>全部的测试数据满足：$1≤n≤20，a_i≥2 且 c_n≤10^9$<br>（根据题目描述中的定义 $c_n$ 表示全部 $a_i$ 的乘积）。</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">15 32767</span><br><span class="line">2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4 0</span><br><span class="line">2 3 2 5</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 0 0</span><br></pre></td></tr></table></figure><br><strong>输入样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7 23333</span><br><span class="line">3 5 20 10 4 3 10</span><br></pre></td></tr></table></figure><br><strong>输出样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 2 15 7 3 1 0</span><br></pre></td></tr></table></figure><br>样例3解释<br><img src="https://cdn.acwing.com/media/article/image/2022/09/30/19_7ff1f53c40-QQ%E6%88%AA%E5%9B%BE20220930112511.png" alt=""></p><p><strong>提示</strong><br>对任意的 $1≤j≤n$，因为 $c<em>{j+1},c</em>{j+2},⋯$均为 $c_j$ 的倍数，所以 $m$ 除以 $c_j$ 的余数具有如下性质：</p><script type="math/tex; mode=display">m\%c_j = \sum_{i=1}^jc_{i−1}×b_i</script><p>其中 $\%$ 表示取余运算。</p><p>令 $j$ 取不同的值，则有如下等式：</p><script type="math/tex; mode=display">m\% c_1 = c_0×b_1</script><script type="math/tex; mode=display">m\% c_2 = c_0×b_1+c_1×b_2</script><script type="math/tex; mode=display">m\% c_3 = c_0×b_1+c_1×b_2+c_2×b_3</script><script type="math/tex; mode=display">⋯</script><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>理解题意 根据提示内容模拟解题过程</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">22</span>]; <span class="comment">//选修数量</span></span><br><span class="line"><span class="type">int</span> b[<span class="number">22</span>]; <span class="comment">//答案</span></span><br><span class="line"><span class="type">int</span> c[<span class="number">22</span>] = &#123;<span class="number">1</span>&#125;; <span class="comment">//a的前缀乘积</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        c[i] = c[i - <span class="number">1</span>] * a[i];</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>)</span><br><span class="line">            b[i] = (m % c[i]) / c[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            b[i] = (m % c[i] - m % c[i - <span class="number">1</span>]) / c[i - <span class="number">1</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        cout &lt;&lt; b[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4454.未初始化警告 4509.归一化处理</title>
      <link href="/2023/01/11/%5BACWing%E5%AF%92%E5%81%8710%5D%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E5%BD%92%E4%B8%80%E5%8C%96/"/>
      <url>/2023/01/11/%5BACWing%E5%AF%92%E5%81%8710%5D%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E5%BD%92%E4%B8%80%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p><strong>这两题主要是理解题意</strong></p><h2 id="4454-未初始化警告"><a href="#4454-未初始化警告" class="headerlink" title="4454. 未初始化警告"></a>4454. 未初始化警告</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：第25次CCF计算机软件能力认证</span><br><span class="line">算法标签</span><br><span class="line">模拟</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>一个未经初始化的变量，里面存储的值可能是任意的。</p><p>因此直接使用未初始化的变量，比如将其赋值给另一个变量，并不符合一般的编程逻辑。</p><p>代码中出现这种情况，往往是因为遗漏了初始化语句、或是打错了变量名。</p><p>对代码中使用了未初始化变量的语句进行检查，可以方便地排查出代码中的一些隐秘 Bug。</p><p>考虑一段包含 $k$ 条赋值语句的简单代码。</p><p>该段代码最多使用到 $n$ 个变量，分别记作 <code>a1,a2,⋯,an</code>；该段代码使用的常量均记作 <code>a0</code>。</p><p>第 $i$ 条$（1≤i≤k）$赋值语句为 $a<em>{x_i}=a</em>{y<em>i}$，满足 $1≤x_i≤n、0≤y_i≤n$，表示将 $a</em>{y<em>i}$ 的值赋给变量 $a</em>{x_i}$。</p><p>其中 $a<em>{x_i}$ 被称为该赋值语句的左值，一定是个变量；$a</em>{y_i}$ 被称为右值，可以是一个常量或变量。</p><p>对于任意一条赋值语句 $a<em>{x_i}=a</em>{y<em>i}$，如果右值 $a</em>{y_i}$ 是一个变量，则其应该在此之前被初始化过。</p><p>具体来说，如果变量 $a<em>{y_i}$ 在前 $i−1$ 条赋值语句中做为左值出现过，即存在 $j&lt;i$ 满足 $x_j=y_i$（这里无需考虑第 $j$ 条赋值语句本身是否也有右值未初始化的问题），我们就认为在第 $i$ 条赋值语句中 $a</em>{y_i}$ 已被初始化；否则，我们认为该条语句存在右值未初始化的问题。</p><p>按照上述规则，试统计给定的代码中，有多少条赋值语句右值未被初始化。</p><p><strong>输入格式</strong><br>输入的第一行包含空格分隔的两个正整数 $n、k$，分别表示变量的数量和赋值语句的条数。</p><p>接下来输入 $k$ 行，其中第 $i$ 行$（1≤i≤k）$包含空格分隔的两个正整数 $x_i、y_i$，表示第 $i$ 条赋值语句。</p><p>纠错：其实 $y_i$ 可以等于 $0$，所以 $y_i$ 不一定是正整数（可参考样例），此为官网题面描述存在问题，特此指出。</p><p><strong>输出格式</strong><br>输出一个整数，表示有右值未被初始化问题的赋值语句条数。</p><p><strong>数据范围</strong><br>$50$% 的测试数据满足 $0&lt;n,k≤1000$；<br>全部的测试数据满足 $0&lt;n,k≤10^5，1≤x_i≤n，0≤y_i≤n$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">10 7</span><br><span class="line">1 2</span><br><span class="line">3 3</span><br><span class="line">3 0</span><br><span class="line">3 3</span><br><span class="line">6 2</span><br><span class="line">2 1</span><br><span class="line">8 2</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>其中第一、二、五条赋值语句右值未被初始化。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> flag[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k, n, x, y;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    flag[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (k --)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!flag[y])&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        flag[x] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4509-归一化处理"><a href="#4509-归一化处理" class="headerlink" title="4509. 归一化处理"></a>4509. 归一化处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：0.5s / 512MB</span><br><span class="line">来源：第26次CCF计算机软件能力认证</span><br><span class="line">算法标签</span><br><span class="line">模拟</span><br></pre></td></tr></table></figure><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>在机器学习中，对数据进行归一化处理是一种常用的技术。</p><p>将数据从各种各样分布调整为平均值为 0、方差为 1 的标准分布，在很多情况下都可以有效地加速模型的训练。</p><p>这里假定需要处理的数据为 n 个整数 a1,a2,⋯,an。</p><p>这组数据的平均值：</p><script type="math/tex; mode=display">\overline{a}=(a_1+a_2+⋯+a_n)/n</script><p>方差：</p><script type="math/tex; mode=display">D(a)=1/n \sum_{i=1}^n (a_i - \overline{a})^2</script><p>使用如下函数处理所有数据，得到的 n 个浮点数 f(a1),f(a2),⋯,f(an) 即满足平均值为 0 且方差为 1：</p><script type="math/tex; mode=display">f(a_i)=(a_i−\overline{a})/\sqrt{D(a)}</script><p><strong>输入格式</strong><br>第一行包含一个整数 n，表示待处理的整数个数。</p><p>第二行包含空格分隔的 n 个整数，依次表示 a1,a2,⋯,an。</p><p><strong>输出格式</strong><br>输出共 n 行，每行一个浮点数，依次表示按上述方法归一化处理后的数据 f(a1),f(a2),⋯,f(an)。</p><p>如果你输出的每个浮点数与参考结果相比，均满足绝对误差不大于 10−4，则该测试点满分，否则不得分。</p><p><strong>数据范围</strong><br>全部的测试数据保证 n,|ai|≤1000，其中 |ai| 表示 ai 的绝对值。<br>且输入的 n 个整数 a1,a2,⋯,an 满足：方差 D(a)≥1。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">-4 293 0 -22 12 654 1000</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-0.7485510379073613</span><br><span class="line">0.04504284674812264</span><br><span class="line">-0.7378629047806881</span><br><span class="line">-0.7966476369773906</span><br><span class="line">-0.7057985054006686</span><br><span class="line">1.0096468614303775</span><br><span class="line">1.9341703768876082</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>平均值：a¯≈276.14285714285717<br>方差：D(a)≈140060.69387755104<br>标准差：D(a)−−−−√≈374.24683549437134</p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">double</span> a[<span class="number">1010</span>];     </span><br><span class="line"><span class="type">double</span> ave, var;</span><br><span class="line"><span class="type">double</span> ans;              </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        ave += a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    ave = ave / n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        var+=(a[i]-ave)*(a[i]-ave);         </span><br><span class="line">    &#125;</span><br><span class="line">    var=<span class="built_in">sqrt</span>(var/n);        <span class="comment">//标准差</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;          </span><br><span class="line">        ans=(a[i]-ave)/var;</span><br><span class="line">        cout &lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L1-006 连续因子 L1-009 N个数求和 L1-020 帅到没朋友</title>
      <link href="/2023/01/10/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B01%5D/"/>
      <url>/2023/01/10/%5Bpta%E5%A4%A9%E6%A2%AF%E8%B5%9B01%5D/</url>
      
        <content type="html"><![CDATA[<h2 id="L1-006-连续因子"><a href="#L1-006-连续因子" class="headerlink" title="L1-006 连续因子"></a>L1-006 连续因子</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>一个正整数 N 的因子中可能存在若干连续的数字。例如 630 可以分解为 3×5×6×7，其中 5、6、7 就是 3 个连续的数字。给定任一正整数 N，要求编写程序求出最长连续因子的个数，并输出最小的连续因子序列。</p><p><strong>输入格式：</strong><br>输入在一行中给出一个正整数 $N（1&lt;N&lt;2^{31})$</p><p><strong>输出格式：</strong><br>首先在第 1 行输出最长连续因子的个数；然后在第 2 行中按 因子1 <em> 因子2 </em> …… * 因子k 的格式输出最小的连续因子序列，其中因子按递增顺序输出，1 不算在内。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">630</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">5*6*7</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>注意素数特殊情况</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> startNum = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//枚举连续数的起始点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= <span class="built_in">sqrt</span>(n); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> temp = n;</span><br><span class="line">        <span class="type">int</span> j = i;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (temp % j == <span class="number">0</span>)&#123;</span><br><span class="line">            temp /= j;</span><br><span class="line">            j++;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; ans)&#123;</span><br><span class="line">            ans = count;</span><br><span class="line">            startNum = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//素数</span></span><br><span class="line">    <span class="keyword">if</span> (ans == <span class="number">0</span>)&#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ans; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (i != ans <span class="number">-1</span>)</span><br><span class="line">                cout &lt;&lt; startNum + i &lt;&lt; <span class="string">&quot;*&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout &lt;&lt; startNum + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="L1-009-N个数求和"><a href="#L1-009-N个数求和" class="headerlink" title="L1-009 N个数求和"></a>L1-009 N个数求和</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>本题的要求很简单，就是求N个数字的和。麻烦的是，这些数字是以有理数分子/分母的形式给出的，你输出的和也必须是有理数的形式。</p><p><strong>输入格式：</strong><br>输入第一行给出一个正整数N（≤100）。随后一行按格式a1/b1 a2/b2 …给出N个有理数。题目保证所有分子和分母都在长整型范围内。另外，负数的符号一定出现在分子前面。</p><p><strong>输出格式：</strong><br>输出上述数字和的最简形式 —— 即将结果写成整数部分 分数部分，其中分数部分写成分子/分母，要求分子小于分母，且它们没有公因子。如果结果的整数部分为0，则只输出分数部分。</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">2/5 4/15 1/30 -2/60 8/3</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 1/3</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">4/3 2/3</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>输入样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">1/3 -1/6 1/8</span><br></pre></td></tr></table></figure><br><strong>输出样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7/24</span><br></pre></td></tr></table></figure></p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><p><strong>输出时注意分子为0，整数，假分数，真分数</strong><br><strong>每加完一个分数，分子分母要约分，防止爆数据范围</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line"><span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">int</span> c = a % b;</span><br><span class="line">a = b;</span><br><span class="line">b = c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> up = <span class="number">0</span>, down = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> n, a, b;</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="keyword">while</span> (n--) &#123;</span><br><span class="line">cin &gt;&gt; a &gt;&gt; c &gt;&gt; b;</span><br><span class="line">up = b * up + a * down;</span><br><span class="line">down = down * b;</span><br><span class="line"><span class="type">int</span> d = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(up), <span class="built_in">abs</span>(down));</span><br><span class="line">up /= d;</span><br><span class="line">down /= d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (up == <span class="number">0</span>)</span><br><span class="line">cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (up % down == <span class="number">0</span>)</span><br><span class="line">cout &lt;&lt; up / down;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">int</span> z = up / down;</span><br><span class="line"><span class="keyword">if</span> (z)&#123;</span><br><span class="line">cout &lt;&lt; z &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; up - z * down &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; down;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="L1-020-帅到没朋友"><a href="#L1-020-帅到没朋友" class="headerlink" title="L1-020 帅到没朋友"></a>L1-020 帅到没朋友</h2><h3 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h3><p>当芸芸众生忙着在朋友圈中发照片的时候，总有一些人因为太帅而没有朋友。本题就要求你找出那些帅到没有朋友的人。</p><p><strong>输入格式：</strong><br>输入第一行给出一个正整数N（≤100），是已知朋友圈的个数；随后N行，每行首先给出一个正整数K（≤1000），为朋友圈中的人数，然后列出一个朋友圈内的所有人——为方便起见，每人对应一个ID号，为5位数字（从00000到99999），ID间以空格分隔；之后给出一个正整数M（≤10000），为待查询的人数；随后一行中列出M个待查询的ID，以空格分隔。</p><p>注意：没有朋友的人可以是根本没安装“朋友圈”，<strong>也可以是只有自己一个人在朋友圈的人</strong>。虽然有个别自恋狂会自己把自己反复加进朋友圈，但题目保证所有K超过1的朋友圈里都至少有2个不同的人。</p><p><strong>输出格式：</strong><br>按输入的顺序输出那些帅到没朋友的人。ID间用1个空格分隔，行的首尾不得有多余空格。如果没有人太帅，则输出<code>No one is handsome</code>。</p><p>注意：同一个人可以被查询多次，但只输出一次。</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 11111 22222 55555</span><br><span class="line">2 33333 44444</span><br><span class="line">4 55555 66666 99999 77777</span><br><span class="line">8</span><br><span class="line">55555 44444 10000 88888 22222 11111 23333 88888</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10000 88888 23333</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 11111 22222 55555</span><br><span class="line">2 33333 44444</span><br><span class="line">4 55555 66666 99999 77777</span><br><span class="line">4</span><br><span class="line">55555 44444 22222 11111</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No one is handsome</span><br></pre></td></tr></table></figure></p><h3 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//a数组记录出现次数 b数组记录答案 x为b的下标</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">100005</span>], b[<span class="number">10001</span>], x=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, k, t;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">        cin &gt;&gt; k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">0</span>; l &lt; k; l++)&#123;</span><br><span class="line">            cin &gt;&gt; t;</span><br><span class="line">            <span class="keyword">if</span>(k != <span class="number">1</span>)<span class="comment">//排除一个人的pyq</span></span><br><span class="line">a[t]++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">        cin &gt;&gt; t;</span><br><span class="line">        <span class="keyword">if</span> (a[t] == <span class="number">0</span>)&#123;</span><br><span class="line">            b[x++] = t;</span><br><span class="line">&#125;</span><br><span class="line">        a[t] = <span class="number">-1</span>;<span class="comment">//表示已查询</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; x; i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%05d &quot;</span>, b[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(x == <span class="number">0</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;No one is handsome&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> GPLT 一阶题目集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TankWar</title>
      <link href="/2023/01/07/TankWar/"/>
      <url>/2023/01/07/TankWar/</url>
      
        <content type="html"><![CDATA[<h3 id="视频展示"><a href="#视频展示" class="headerlink" title="视频展示"></a>视频展示</h3><iframe src="//player.bilibili.com/player.html?aid=649971654&bvid=BV1Qe4y137vf&cid=953990346&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height=550 width=700> </iframe><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s1.ax1x.com/2023/01/07/pSE7Eod.png" alt=""></p><h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p><a href="https://gitee.com/sheepFly03/tank-war">TankWar</a></p><h3 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h3><ul><li>myPanel作为一个线程每隔30ms完成一系列操作后 repaint一下，如果gameOver线程则退出<ul><li>在run中执行hitEnemy和hitHero方法，遍历所有子弹和坦克，调用hitTank方法，通过alive判断是否要从容器中删除对象。</li><li>hitTank方法，传入一个子弹，一个坦克，根据坦克的不同方向分别判断子弹是否击中，如果击中则相应alive设置为false。</li><li>在run中子弹生成敌方坦克，用一个变量记录时间间隔，还设置了一个变量记录己方发射间隔（30ms自增一次）</li><li>KeyPressed控制己方坦克，末尾调用repaint方法</li><li>paint方法：!gameOver则 drawMyInfo(g); drawHero(g); drawEnemyTank(g);drawBombs(g);  gameOver则showReplay(g); 关闭坦克、子弹线程; 重绘重新绘制子组件; 播放结束bgm</li></ul></li><li><p>每个敌方坦克作为线程，使坦克自动移动、发射，在MyPanel中用Vector储存敌方坦克对象</p><ul><li>敌方坦克碰撞判断：new每个enemy时 将储存所有enemy的Vector(myPanel中)通过EnemTank的set方法传入enemy对象的vector数组，判断时先沿当前坦克方向预处理一段距离，遍历所有坦克，如果发生位置重叠，则发生了碰撞</li><li>在敌方坦克线程中，通过选择语句根据坦克的direction作出不同方向的动作，如果在边界内并且没有发生碰撞则调用Tank中的4个move方法，并在不同的时机发射炮弹；通过循环和Thread.sleep方法可以阻止坦克瞬移，并沿当前方向移动一段距离。若到达边界或发生了碰撞需提前break，然后通过随机函数随机不同的方向。线程结束条件是Tank.alive == false。</li></ul></li><li><p>每个坦克有自己的bullet Vector，每个bullet对象是一个线程，线程中每休眠30ms则根据bullet初始化的方向移动一段距离，直到子弹到达边界或bullet.alive == false线程结束, false的可能性有子弹到达边界、子弹射到坦克。</p></li><li>Tank.Shot方法传入一个子弹Vector容器，负责初始化bullet，向容器中添加子弹，然后开启该子弹的线程。在敌方坦克线程和MyPanel监听到空格中调用</li></ul>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 坦克大战 </tag>
            
            <tag> 多线程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4655.重新排序</title>
      <link href="/2023/01/05/%5BACWing%E5%AF%92%E5%81%8709%5D%E9%87%8D%E6%96%B0%E6%8E%92%E5%BA%8F/"/>
      <url>/2023/01/05/%5BACWing%E5%AF%92%E5%81%8709%5D%E9%87%8D%E6%96%B0%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">来源：第十三届蓝桥杯省赛C++C组</span><br><span class="line">算法标签:</span><br><span class="line">差分 贪心 排序不等式</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个数组 A 和一些查询 $L_i,R_i$，求数组中第 $L_i$ 至第 $R_i$ 个元素之和。</p><p>小蓝觉得这个问题很无聊，于是他想重新排列一下数组，使得最终每个查询结果的和尽可能地大。</p><p>小蓝想知道相比原数组，所有查询结果的总和最多可以增加多少?</p><p><strong>输入格式</strong><br>输入第一行包含一个整数 n。</p><p>第二行包含 n 个整数 $A_1,A_2,⋅⋅⋅,A_n$，相邻两个整数之间用一个空格分隔。</p><p>第三行包含一个整数 m 表示查询的数目。</p><p>接下来 m 行，每行包含两个整数 $L_i、R_i$，相邻两个整数之间用一个空格分隔。</p><p><strong>输出格式</strong><br>输出一行包含一个整数表示答案。</p><p><strong>数据范围</strong><br>对于 30% 的评测用例，$n,m≤50$；<br>对于 50% 的评测用例，$n,m≤500$；<br>对于 70% 的评测用例，$n,m≤5000$；<br>对于所有评测用例，$1≤n,m≤10^5，1≤A_i≤10^6，1≤L_i≤R_i≤n$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2 3 4 5</span><br><span class="line">2</span><br><span class="line">1 3</span><br><span class="line">2 5</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>原来的和为 6+14=20，重新排列为 (1,4,5,2,3) 后和为 10+14=24，增加了 4。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>贪心思路：</strong><br>样例中两个范围 [1,3] 和 [2,5] ,下标 2，3 出现了两次，即下标为2和3的两个数需要相加两次，要使相加后的数最大，则要使下标为2和3的两个数为数组中最大的两个数。<br>故有了初步思路，遍历每个范围，c数组记录该下标数字被加次数，用sort函数对A数组和计次数组排序，<code>for i -&gt; n &#123; sum += a[i] * c[i] &#125;</code></p><p><strong>初步分析代码如下：</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">100010</span>];<span class="comment">//数组A</span></span><br><span class="line"><span class="type">int</span> c[<span class="number">100010</span>];<span class="comment">//涉及到的次数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> preSum = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="keyword">while</span> (m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l - <span class="number">1</span>; i &lt; r; i++)&#123;</span><br><span class="line">            c[i]++;</span><br><span class="line">            preSum += a[i];</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a, a + n, cmp);</span><br><span class="line">    <span class="built_in">sort</span>(c, c + n, cmp);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        sum += a[i] * c[i];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, sum - preSum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果：Time Limit Exceeded  通过了 7/10个数据  运行时间： N/A  运行空间： N/A</p></blockquote><p><strong>进一步优化</strong><br>上述while循环中的for循环是不必要的，也是造成超时的关键原因。<br>对于c数组计数我们可以用<strong>差分数组</strong>来进行优化, 而对于第一次求和，我们可以借助<strong>前缀和数组</strong>进行 <code>sum =  s[r] - s[l-1]</code><br><strong>注意</strong>：前缀和数组、sum1、sum2、a数组要开<code>long long</code> ，如果a数组不开longlong那么sum1和sum2要进行强制类型转换。</p><p>代码如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> a[<span class="number">100010</span>];<span class="comment">//数组A</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> s[<span class="number">100010</span>];<span class="comment">//前缀和数组</span></span><br><span class="line"><span class="type">int</span> c[<span class="number">100010</span>];<span class="comment">//差分数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;a[i]);</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] + a[i];<span class="comment">//初始化前缀和数组</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (m--)&#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        sum1 += s[r] - s[l<span class="number">-1</span>];</span><br><span class="line">        <span class="comment">//初始化差分数组</span></span><br><span class="line">        c[l]++;</span><br><span class="line">        c[r + <span class="number">1</span>]--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//恢复差分数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        c[i] += c[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>, a+<span class="number">1</span> + n);</span><br><span class="line">    <span class="built_in">sort</span>(c+<span class="number">1</span>, c+<span class="number">1</span> + n);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum2 = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//被求和次数少的放小的数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        sum2 += a[i] * c[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; sum2 - sum1;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>B站相关视频：</li></ul><iframe src="//player.bilibili.com/player.html?aid=542382432&bvid=BV1pi4y1j7si&cid=246393911&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height=550 width=700> </iframe>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
            <tag> 差分 </tag>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4653.数位排序</title>
      <link href="/2023/01/03/%5BACWing%E5%AF%92%E5%81%8708%5D%E6%95%B0%E4%BD%8D%E6%8E%92%E5%BA%8F/"/>
      <url>/2023/01/03/%5BACWing%E5%AF%92%E5%81%8708%5D%E6%95%B0%E4%BD%8D%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">来源：第十三届蓝桥杯省赛C++C组</span><br><span class="line">算法标签:</span><br><span class="line">排序 二分</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小蓝对一个数的数位之和很感兴趣，今天他要按照数位之和给数排序。</p><p>当两个数各个数位之和不同时，将数位和较小的排在前面，当数位之和相等时，将数值小的排在前面。</p><p>例如，2022 排在 409 前面，因为 2022 的数位之和是 6，小于 409 的数位之和 13。</p><p>又如，6 排在 2022 前面，因为它们的数位之和相同，而 6 小于 2022。</p><p>给定正整数 n，m，请问对 1 到 n 采用这种方法排序时，排在第 m 个的元素是多少？</p><p><strong>输入格式</strong><br>输入第一行包含一个正整数 n。</p><p>第二行包含一个正整数 m。</p><p><strong>输出格式</strong><br>输出一行包含一个整数，表示答案。</p><p><strong>数据范围</strong><br>对于 30% 的评测用例，$1≤m≤n≤300$<br>对于 50% 的评测用例，$1≤m≤n≤1000$<br>对于所有评测用例，$1≤m≤n≤10^6$</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">13</span><br><span class="line">5</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>$1$ 到 $13$ 的排序为：$1,10,2,11,3,12,4,13,5,6,7,8,9$</p><p>第 $5$ 个数为 $3$。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>数据范围1e6, 时间复杂度O(nlogn)可以解决，故可以直接用sort改写cmp方法。</p><p><strong>初次尝试：</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sum_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> sum_b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> t1 = a, t2 = b;</span><br><span class="line">    <span class="keyword">while</span> (t1)&#123;</span><br><span class="line">        sum_a += t1 % <span class="number">10</span>;</span><br><span class="line">        t1 /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (t2)&#123;</span><br><span class="line">        sum_b += t2 % <span class="number">10</span>;</span><br><span class="line">        t2 /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum_a != sum_b)</span><br><span class="line">        <span class="keyword">return</span> sum_a &lt; sum_b;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">1000010</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        a[i] = i + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(a, a + n, cmp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, a[m - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>结果超时了，原因是将拆分数的循环动作放在了cmp函数里面，导致了很多重复的动作，可以在main函数中先预处理，将拆分和存储起来。</p><p><strong>第二次尝试（结构体储存）：</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">&#125; a[<span class="number">1000010</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">    <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        a[i].x = i + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> t = i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(t)&#123;</span><br><span class="line">            a[i].y += t % <span class="number">10</span>;</span><br><span class="line">            t /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a, a + n, cmp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, a[m - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4644.求和</title>
      <link href="/2023/01/02/%5BACWing%E5%AF%92%E5%81%8707%5D%E6%B1%82%E5%92%8C/"/>
      <url>/2023/01/02/%5BACWing%E5%AF%92%E5%81%8707%5D%E6%B1%82%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">来源：第十三届蓝桥杯省赛C++A/C组 , 第十三届蓝桥杯省赛JAVAA组</span><br><span class="line">算法标签:</span><br><span class="line">推公式 前缀和</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定 n 个整数 $a_1,a_2,⋅⋅⋅,a_n$，求它们两两相乘再相加的和，即</p><p>$S=a<em>1⋅a_2+a_1⋅a_3+⋅⋅⋅+a_1⋅a_n+a_2⋅a_3+⋅⋅⋅+a</em>{n−2}⋅a<em>{n−1}+a</em>{n−2}⋅a<em>n+a</em>{n−1}⋅a_n$</p><p><strong>输入格式</strong><br>输入的第一行包含一个整数 n。</p><p>第二行包含 n 个整数 a1,a2,⋅⋅⋅,an。</p><p><strong>输出格式</strong><br>输出一个整数 S，表示所求的和。</p><p>请使用合适的数据类型进行运算。</p><p><strong>数据范围</strong><br>对于 30% 的数据，$1≤n≤1000，1≤a_i≤100。$<br>对于所有评测用例，$1≤n≤200000，1≤a_i≤1000。$</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 3 6 9</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">117</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>数据范围为2e6，暴力两重循环O(n^2)肯定会超时,可对公式进一步解析：</p><p>$S=a<em>1⋅a_2+a_1⋅a_3+⋅⋅⋅+a_1⋅a_n+a_2⋅a_3+⋅⋅⋅+a</em>{n−2}⋅a<em>{n−1}+a</em>{n−2}⋅a<em>n+a</em>{n−1}⋅a<em>n$<br>等价于：<br>$S=a_1⋅(a_2+a_3+⋅⋅⋅+a_n)+⋅⋅⋅+a</em>{n−2}⋅(a<em>{n−1}+a_n)+a</em>{n−1}⋅a<em>n$<br><strong>对于和的部分可以用前缀和解决</strong>，例如：设前缀和数组为S，则 $a_1$ 后面的和则等于 $S[n] - S[1]$ (下标从1开始)；<br>故只需要初始化前缀和数组O(n), 再枚举 $a_1$ 至 $a</em>{n-1}$ O(n) 即可解决问题，时间复杂度：O(n)。</p><p><strong>注意</strong>：前缀和数组和答案需要<code>long long</code>类型</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">200010</span>];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> preSum[<span class="number">200010</span>];<span class="comment">//前缀和</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        preSum[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//求前缀和</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">        preSum[i] += preSum[i - <span class="number">1</span>];</span><br><span class="line">    <span class="comment">//求结果</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        ans += (a[i] * (preSum[n] - preSum[i]));</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>已AC</p></blockquote><p><strong>进一步优化空间复杂度</strong>：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">int</span> arr[<span class="number">200010</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    LL ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        cin&gt;&gt;arr[i];</span><br><span class="line">        ans+=arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    LL S=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        S+=arr[i]*(ans-arr[i]);</span><br><span class="line">        ans-=arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;S&lt;&lt;endl;</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing第84场周赛 2022/12/31</title>
      <link href="/2022/12/31/%5BACWing%E7%AC%AC84%E5%9C%BA%E5%91%A8%E8%B5%9B%5D%20%E8%B7%A8%E5%B9%B4%E8%B5%9B/"/>
      <url>/2022/12/31/%5BACWing%E7%AC%AC84%E5%9C%BA%E5%91%A8%E8%B5%9B%5D%20%E8%B7%A8%E5%B9%B4%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="4788-最大数量"><a href="#4788-最大数量" class="headerlink" title="4788. 最大数量"></a>4788. 最大数量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：1535</span><br><span class="line">总尝试数：3350</span><br><span class="line">来源：AcWing,第84场周赛</span><br><span class="line">算法标签:</span><br><span class="line">哈希表</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>某商场在一天中一共来了 n 个客人。</p><p>每个客人进入商场的具体时刻（精确到分钟）已知。</p><p>请你计算并输出在同一时刻（精确到分钟）进入商场的最大客人数量。</p><p><strong>输入格式</strong><br>第一行包含整数 n。</p><p>接下来 n 行，每行包含两个整数 h,m，表示一个客人在 h 时 m 分进入商场。</p><p>所有时间都按照时间先后顺序给出。</p><p>时间采用 24 小时制。</p><p><strong>输出格式</strong><br>一个整数，表示在同一时刻（精确到分钟）进入商场的最大客人数量。</p><p><strong>数据范围</strong><br>前 $5$ 个测试点满足 $1≤n≤10。$<br>所有测试点满足 $1≤n≤10^5，0≤h_i≤23，0≤m_i≤59。$</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">8 0</span><br><span class="line">8 10</span><br><span class="line">8 10</span><br><span class="line">8 45</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">0 12</span><br><span class="line">10 11</span><br><span class="line">22 22</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">1500</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, res = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> h, m;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;h, &amp;m);</span><br><span class="line">        res = <span class="built_in">max</span>(res, ++a[h * <span class="number">60</span> + m]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4789-前缀和序列"><a href="#4789-前缀和序列" class="headerlink" title="4789. 前缀和序列"></a>4789. 前缀和序列</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：1351</span><br><span class="line">总尝试数：3481</span><br><span class="line">来源：AcWing,第84场周赛</span><br><span class="line">算法标签:</span><br><span class="line">前缀和</span><br></pre></td></tr></table></figure><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个长度为 n 的正整数序列 a1,a2,…,an。</p><p>如果将该序列从小到大排序，则可以得到另一个长度为 n 的正整数序列 b1,b2,…,bn。</p><p>现在，请你回答 m 个询问，询问共分为以下两种：</p><ul><li><code>1 l r</code>，请你计算并输出 $ \sum_{i=l}^{r} a_i $</li><li><code>2 l r</code>，请你计算并输出 $ \sum_{i=l}^{r} b_i $</li></ul><p><strong>输入格式</strong><br>第一行包含整数 n。</p><p>第二行包含 n 个正整数 a1,a2,…,an。</p><p>第三行包含整数 m。</p><p>接下来 m 行，每行包含一个询问，格式如题面描述。</p><p><strong>输出格式</strong><br>共 m 行，每个询问输出一行答案。</p><p><strong>数据范围</strong><br>前 $3$ 个测试点满足 $1≤n,m≤10$<br>所有测试点满足 $1≤n,m≤10^5，1≤a_i≤10^9，1≤l≤r≤n$</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">6 4 2 7 2 7</span><br><span class="line">3</span><br><span class="line">2 3 6</span><br><span class="line">1 3 4</span><br><span class="line">1 1 6</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">24</span><br><span class="line">9</span><br><span class="line">28</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">5 5 2 3</span><br><span class="line">10</span><br><span class="line">1 2 4</span><br><span class="line">2 1 4</span><br><span class="line">1 1 1</span><br><span class="line">2 1 4</span><br><span class="line">2 1 2</span><br><span class="line">1 1 1</span><br><span class="line">1 3 3</span><br><span class="line">1 1 3</span><br><span class="line">1 4 4</span><br><span class="line">1 2 2</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">15</span><br><span class="line">5</span><br><span class="line">15</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">2</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure><br><strong>输入样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">2 2 3 6</span><br><span class="line">9</span><br><span class="line">2 2 3</span><br><span class="line">1 1 3</span><br><span class="line">2 2 3</span><br><span class="line">2 2 3</span><br><span class="line">2 2 2</span><br><span class="line">1 1 3</span><br><span class="line">1 1 3</span><br><span class="line">2 1 4</span><br><span class="line">1 1 2</span><br></pre></td></tr></table></figure><br><strong>输出样例3：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">7</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">2</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">13</span><br><span class="line">4</span><br></pre></td></tr></table></figure></p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[N], b[N];</span><br><span class="line">ll s1[N], s2[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">        b[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span> (b, b + n);</span><br><span class="line">    <span class="comment">//前缀和初始化</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)</span><br><span class="line">        s1[i] = s1[i - <span class="number">1</span>] + a[i]; </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)</span><br><span class="line">        s2[i] = s2[i - <span class="number">1</span>] + b[i];</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="type">int</span> op, l, r;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, s1[r - <span class="number">1</span>] - s1[l - <span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, s2[r - <span class="number">1</span>] - s2[l - <span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4790-买可乐"><a href="#4790-买可乐" class="headerlink" title="4790. 买可乐"></a>4790. 买可乐</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">总通过数：1263</span><br><span class="line">总尝试数：3117</span><br><span class="line">来源：AcWing,第84场周赛</span><br><span class="line">算法标签:</span><br><span class="line">枚举 贪心</span><br></pre></td></tr></table></figure><h3 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h3><p>某商店目前库存可乐数量为 $k$ 瓶。</p><p>可乐的进货价格如下：</p><ul><li>整箱：<code>c</code> 元/箱。每箱有 <code>n</code> 瓶。</li><li>单瓶：<code>d</code> 元/瓶。</li></ul><p>请问，为了使得库存可乐数量不低于 $n×m$ 瓶，该商店至少需要花费多少元钱来购进可乐。</p><p>显然，当 $k≥n×m$ 时，无需购进可乐。</p><p><strong>输入格式</strong><br>第一行包含两个整数 c,d。</p><p>第二行包含两个整数 n,m。</p><p>第三行包含整数 k。</p><p><strong>输出格式</strong><br>一个整数，表示最少花费的金额。</p><p><strong>数据范围</strong><br>前 $4$ 个测试点满足 $1≤c,d,n,m,k≤10$。<br>所有测试点满足 $1≤c,d,n,m,k≤100$。</p><p><strong>输入样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 10</span><br><span class="line">7 2</span><br><span class="line">1</span><br></pre></td></tr></table></figure><br><strong>输出样例1：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>输入样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 2</span><br><span class="line">2 1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><br><strong>输出样例2：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure></p><h3 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3><p><strong>注意买整箱不一定比单买划算（易忽视）</strong><br><strong><code>res = min(c * box, d * box * n)</code>表示买整箱便宜还是单买便宜</strong><br><strong><code>res = min(res + c, res + bottle * d)</code>表示剩余的可乐（少于n瓶）中，买一箱（n瓶）还是单买剩余的可乐划算</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c, d;<span class="comment">//c元/箱(n瓶) d元/瓶</span></span><br><span class="line">    cin &gt;&gt; c &gt;&gt; d;</span><br><span class="line">    <span class="type">int</span> n, m;<span class="comment">//库存需 &gt;= n*m</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="type">int</span> k;<span class="comment">//库存</span></span><br><span class="line">    cin &gt;&gt; k;</span><br><span class="line">    <span class="keyword">if</span> (k &gt;= n * m)</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="type">int</span> box = (n * m - k) / n;</span><br><span class="line">        <span class="type">int</span> bottle = (n * m - k) % n;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        res = <span class="built_in">min</span>(c * box, d * box * n);</span><br><span class="line">        res = <span class="built_in">min</span>(res + c, res + bottle * d);</span><br><span class="line">        cout &lt;&lt; res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4645.选数异或</title>
      <link href="/2022/12/31/%5BACWing%E5%AF%92%E5%81%8706%5D%E9%80%89%E6%95%B0%E5%BC%82%E6%88%96/"/>
      <url>/2022/12/31/%5BACWing%E5%AF%92%E5%81%8706%5D%E9%80%89%E6%95%B0%E5%BC%82%E6%88%96/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 256MB</span><br><span class="line">来源：第十三届蓝桥杯省赛C++A/C/研究生组</span><br><span class="line">算法标签:</span><br><span class="line">None</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个长度为 n 的数列 A1,A2,⋅⋅⋅,An 和一个非负整数 x，给定 m 次查询，每次询问能否从某个区间 [ l,r ] 中选择两个数使得他们的异或等于 x。</p><p><strong>输入格式</strong><br>输入的第一行包含三个整数 n, m, x。</p><p>第二行包含 n 个整数 A1,A2,⋅⋅⋅,An。</p><p>接下来 m 行，每行包含两个整数 $l_i,r_i$ 表示询问区间 $[l_i,r_i]$。</p><p><strong>输出格式</strong><br>对于每个询问，如果该区间内存在两个数的异或为 x 则输出 <code>yes</code>，否则输出 <code>no</code>。</p><p><strong>数据范围</strong><br>对于 20% 的评测用例，$1≤n,m≤100$；<br>对于 40% 的评测用例，$1≤n,m≤1000$；<br>对于所有评测用例，$1≤n,m≤100000，0≤x&lt;2^{20}，1≤l_i≤r_i≤n，0≤A_i&lt;2^{20}$。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4 4 1</span><br><span class="line">1 2 3 4</span><br><span class="line">1 4</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line">3 3</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yes</span><br><span class="line">no</span><br><span class="line">yes</span><br><span class="line">no</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>显然整个数列中只有 2,3 的异或为 1。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>暴力法：<br>Time Limit Exceeded  通过了 6/10个数据  运行时间：N/A  运行空间: N/A<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l<span class="number">-1</span>; i &lt; r; i++)&#123;</span><br><span class="line">        <span class="type">int</span> A = a[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = l<span class="number">-1</span>; i != j &amp;&amp; j &lt; r; j++)&#123;</span><br><span class="line">            <span class="type">int</span> B = a[j];</span><br><span class="line">            <span class="keyword">if</span> ((A ^ B) == x) </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, x;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) </span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="keyword">while</span> (m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(l, r, x)) </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;yes\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;no\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>动态规划：</strong><br>一条异或的性质：如果存在<code>a^b=x</code>，那么一定满足<code>a^x=b</code>，<code>b^x=a</code>。</p><p>对此，我们可以处理得到数组中所有符合的数对 $(a, b)$，其中 $a$ 是数组中靠左的数，$b$ 是靠右边的。我们可以枚举 $b$ (其中 $b &lt;= r$ ), 然后判断在 $b$ 前面是否出现过数 $a$ ，这一步我们可以使用哈希表(值初始化为0)记录维护每个数对左端的位置，键表示b，值表示a的位置，如果值不为0则说明找到一对符合的数对。</p><p>我们定义<code>dp[i]</code>为前<code>i</code>个数的所有数对中<code>a</code>的最大下标<br>这样我们对于每个查询<code>[l,r]</code>，只需要去判断<code>dp[r] &gt;= l</code>即可，符合则输出<code>yes</code>，否则输出<code>no</code>。</p><p>对于当前的值<code>v</code>,下标为<code>i</code>。如果哈希表中不存在数<code>x^v</code>，则<code>dp[i] = dp[i-1]</code>，如果存在则为<code>dp[i] = max(dp[i−1], m[vˆx])</code></p><blockquote><p><a href="https://www.acwing.com/video/4586/">视频讲解</a></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> dp[N];</span><br><span class="line">map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, x, a;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a;</span><br><span class="line">        dp[i] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>], mp[a ^ x]);</span><br><span class="line">        mp[a] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        cout &lt;&lt; (dp[r] &gt;= l ? <span class="string">&quot;yes&quot;</span> : <span class="string">&quot;no&quot;</span>) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4818.奶牛大学</title>
      <link href="/2022/12/30/%5BACWing%E5%AF%92%E5%81%8705%5D%E5%A5%B6%E7%89%9B%E5%A4%A7%E5%AD%A6/"/>
      <url>/2022/12/30/%5BACWing%E5%AF%92%E5%81%8705%5D%E5%A5%B6%E7%89%9B%E5%A4%A7%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：USACO 2022 December Contest Bronze</span><br><span class="line">算法标签:</span><br><span class="line">排序 枚举</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Farmer John 计划为奶牛们新开办一所大学！</p><p>有 N 头奶牛可能会入学。</p><p>每头奶牛最多愿意支付 $c_i$ 的学费。</p><p>Farmer John 可以设定所有奶牛入学需要支付的学费。</p><p>如果这笔学费大于一头奶牛愿意支付的最高金额，那么这头奶牛就不会入学。</p><p>Farmer John 想赚尽可能多的钱，从而可以给他的讲师提供一笔可观的工资。</p><p>请求出他能赚到的钱的数量，以及此时应当收取多少学费。</p><p>输入格式<br>输入的第一行包含 N。</p><p>第二行包含 N 个整数 c1,c2,…,cN，其中 ci 是奶牛 i 愿意支付的最高学费金额。</p><p>输出格式<br>输出 Farmer John 可以赚到的最大金额以及最优情况下他应该收取的学费。如果有多个解，输出收取学费最小的解。</p><p>注意这个问题涉及到的整数可能需要使用 64 位整数型（例如，Java 中的 “long”，C/C++ 中的 “long long”）。</p><p><strong>数据范围</strong><br>$1≤N≤10^5,$<br>$1≤c_i≤10^6$</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 6 4 6</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12 4</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br>如果 Farmer John 收费 4，那么 3 头奶牛将会入学，从而使他赚取 3×4=12 的金额。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>[O(n^2)] 直接暴力枚举fee再遍历数组累加满足要求的数据会超时<br>[O(nlogn)]  可以先排序，遍历i枚举排序好的数组(fee一定为数组内的元素), incone = fee * (n - i)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> c[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;c[i]);</span><br><span class="line">    <span class="built_in">sort</span>(c, c + n);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> incone = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> BestFee = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> fee = c[i];</span><br><span class="line">        <span class="comment">//收入(取c[i]作为fee，则有n-i头奶牛愿意支付fee)</span></span><br><span class="line">        <span class="keyword">if</span> (fee * (n - i) &gt; incone)&#123;</span><br><span class="line">            incone = fee * (n - i);<span class="comment">//更新收入</span></span><br><span class="line">            BestFee = fee;<span class="comment">//更新最优费用</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld&quot;</span>, incone, BestFee);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 枚举 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4366.上课睡觉（石堆）</title>
      <link href="/2022/12/28/%5BACWing%E5%AF%92%E5%81%8703%5D%E4%B8%8A%E8%AF%BE%E7%9D%A1%E8%A7%89/"/>
      <url>/2022/12/28/%5BACWing%E5%AF%92%E5%81%8703%5D%E4%B8%8A%E8%AF%BE%E7%9D%A1%E8%A7%89/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：USACO 2022 February Contest Bronze</span><br><span class="line">算法标签:</span><br><span class="line">None</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>有 N 堆石子，每堆的石子数量分别为 a1,a2,…,aN。</p><p>你可以对石子堆进行合并操作，将两个相邻的石子堆合并为一个石子堆，例如，如果 a=[1,2,3,4,5]，合并第 2,3 堆石子，则石子堆集合变为 a=[1,5,4,5]。</p><p>我们希望通过尽可能少的操作，使得石子堆集合中的每堆石子的数量都相同。</p><p>请你输出所需的最少操作次数。</p><p>本题一定有解，因为可以将所有石子堆合并为一堆。</p><p><strong>输入格式</strong><br>第一行包含整数 T，表示共有 T 组测试数据。</p><p>每组数据第一行包含整数 N。</p><p>第二行包含 N 个整数 a1,a2,…,aN。</p><p><strong>输出格式</strong><br>每组数据输出一行结果。</p><p><strong>数据范围</strong><br>$1≤T≤10,$<br>$1≤N≤10^5,$<br>$0≤a<em>i≤10^6,$<br>$\sum</em>{i=1}^{n}a_i≤a_i≤10^6,$<br>每个输入所有 N 之和不超过 105。</p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">6</span><br><span class="line">1 2 3 1 1 1</span><br><span class="line">3</span><br><span class="line">2 2 3</span><br><span class="line">5</span><br><span class="line">0 0 0 0 0</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">0</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">第一组数据，只需要用 3 个操作来完成：</span><br><span class="line"></span><br><span class="line">   1 2 3 1 1 1</span><br><span class="line">-&gt; 3 3 1 1 1</span><br><span class="line">-&gt; 3 3 2 1</span><br><span class="line">-&gt; 3 3 3</span><br><span class="line">第二组数据，只需要用 2 个操作来完成：</span><br><span class="line"></span><br><span class="line">   2 2 3</span><br><span class="line">-&gt; 2 5</span><br><span class="line">-&gt; 7</span><br><span class="line">第三组数据，我们什么都不需要做。</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>假设初始堆数为N, 最终堆数为x, 每次合并石子，石子堆的个数就会 -1<br>最终的每个石子堆有 $y=∑ai/x$ 个石子<br>也就是说 $y$ 是 $∑ai$ 的因子，且有 $y⋅x=∑ai$<br>对于一个整数，它的因子是有限的<br>所以，我们可以枚举 $y$，然后检查 $y$ 是否可以作为最终的石子数量。如果可以的话，找到最小的 $y$，就能得到最小的 $x$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100005</span>;</span><br><span class="line"><span class="type">int</span> t, n, x;<span class="comment">//n为初始堆数，x为变化后的堆数</span></span><br><span class="line"><span class="type">int</span> a[N];<span class="comment">//初始石堆</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; d;<span class="comment">//sum的因子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//是否有解</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s += a[i];</span><br><span class="line">        <span class="keyword">if</span> (s &gt; y)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (s == y)</span><br><span class="line">            s = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        sum += a[i];</span><br><span class="line">    <span class="comment">//枚举因子</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= sum; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum % y == <span class="number">0</span> &amp;&amp; <span class="built_in">check</span>(y))&#123;</span><br><span class="line">            x = sum / y;</span><br><span class="line">            <span class="keyword">return</span> n - x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        x = n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">solve</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 valueless合集</title>
      <link href="/2022/12/27/%5BACWing%E5%AF%92%E5%81%8702%5D%E7%AE%80%E5%8D%95%E5%90%88%E9%9B%86/"/>
      <url>/2022/12/27/%5BACWing%E5%AF%92%E5%81%8702%5D%E7%AE%80%E5%8D%95%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h2 id="统计次数"><a href="#统计次数" class="headerlink" title="统计次数"></a>统计次数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：清华大学考研机试题</span><br><span class="line">算法标签:</span><br><span class="line">None</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定两个正整数 n 和 k，求从 1 到 n 这 n 个正整数的十进制表示中 k 出现的次数。</p><p>输入格式<br>共一行，包含两个整数 n 和 k。</p><p>输出格式<br>输出一个整数，表示答案。</p><p>数据范围<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1≤n≤10^6,</span><br><span class="line">1≤k≤9</span><br></pre></td></tr></table></figure><br>输入样例：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12 1</span><br></pre></td></tr></table></figure><br>输出样例：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><br>样例解释<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从 1 到 12 这些整数中包含 1 的数字有 1,10,11,12，一共出现了 5 次 1。</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, k;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = i;</span><br><span class="line">        <span class="keyword">while</span> (t &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (t % <span class="number">10</span> == k) ans++;</span><br><span class="line">            t /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="学分绩点"><a href="#学分绩点" class="headerlink" title="学分绩点"></a>学分绩点</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">难度：简单</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">来源：北京大学考研机试题</span><br><span class="line">算法标签:</span><br><span class="line">None</span><br></pre></td></tr></table></figure><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>北京大学对本科生的成绩施行平均学分绩点制（GPA）。</p><p>既将学生的实际考分根据不同的学科的不同学分按一定的公式进行计算。</p><p>公式如下：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">实际成绩     绩点 </span><br><span class="line">90——100     4.0 </span><br><span class="line">85——89      3.7 </span><br><span class="line">82——84      3.3 </span><br><span class="line">78——81      3.0 </span><br><span class="line">75——77      2.7 </span><br><span class="line">72——74      2.3 </span><br><span class="line">68——71      2.0 </span><br><span class="line">64——67      1.5 </span><br><span class="line">60——63      1.0 </span><br><span class="line">60以下        0</span><br></pre></td></tr></table></figure><br>一门课程的学分绩点 = 该课绩点 × 该课学分</p><p>总评绩点 = 所有学科学分绩点之和 / 所有课程学分之和</p><p>现要求你编写程序求出某人 A 的总评绩点（GPA）。</p><p><strong>输入格式</strong><br>第一行，总的课程数 n；</p><p>第二行，相应课程的学分（两个学分间用空格隔开）；</p><p>第三行，对应课程的实际得分；</p><p>此处输入的所有数字均为整数。</p><p><strong>输出格式</strong><br>输出有一行，总评绩点，精确到小数点后 2 位小数。</p><p><strong>数据范围</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 ≤ n ≤ 10,</span><br><span class="line">学分取值范围 [1,10],</span><br><span class="line">课程得分范围 [0,100]。</span><br></pre></td></tr></table></figure></p><p><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">4 3 4 2 3</span><br><span class="line">91 88 72 69 56</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.52</span><br></pre></td></tr></table></figure></p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Course</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">float</span> credit;</span><br><span class="line">    <span class="type">float</span> grade;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">GetPoint</span><span class="params">(<span class="type">float</span> grade)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> point;</span><br><span class="line">    <span class="keyword">if</span> (grade &gt;= <span class="number">90</span>) &#123;</span><br><span class="line">        point = <span class="number">4.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">85</span>) &#123;</span><br><span class="line">        point = <span class="number">3.7</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">82</span>) &#123;</span><br><span class="line">        point = <span class="number">3.3</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">78</span>) &#123;</span><br><span class="line">        point = <span class="number">3.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">75</span>) &#123;</span><br><span class="line">        point = <span class="number">2.7</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">72</span>) &#123;</span><br><span class="line">        point = <span class="number">2.3</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">68</span>) &#123;</span><br><span class="line">        point = <span class="number">2.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">64</span>) &#123;</span><br><span class="line">        point = <span class="number">1.5</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grade &gt;= <span class="number">60</span>) &#123;</span><br><span class="line">        point = <span class="number">1.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        point = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> point;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">float</span> CreditSum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">float</span> CreditPointSum = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    Course *a = <span class="keyword">new</span> Course[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i].credit;</span><br><span class="line">        CreditSum += a[i].credit;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i].grade;</span><br><span class="line">        CreditPointSum += <span class="built_in">GetPoint</span>(a[i].grade) * a[i].credit;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> GPA = CreditPointSum / CreditSum;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2f&quot;</span>, GPA);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基于哈夫曼编码实现对文本文件的压缩与解压缩</title>
      <link href="/2022/12/27/%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81/"/>
      <url>/2022/12/27/%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<blockquote><p>大一下小学期写的程序，可支持ASCII字符文本文件的压缩与解压缩。</p></blockquote><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol><li>扫描待压缩的文件，统计字符出现的频次，构造出哈夫曼树，得到叶子结点的编码。</li><li><p>压缩过程：</p><ul><li>读取原文件字符构建哈夫曼树，遍历哈夫曼树找到对应的叶子结点，将字符转换为哈夫曼编码用string储存；</li><li>将头信息（编码末尾添0的数量、字符及对应频次）写入压缩文件，用于解压时重构哈夫曼树。</li><li>将string储存的二进制码（哈夫曼编码）以八位一组的等长编码转成字符写入压缩文件，得到压缩效果。（最后一组可能不足8位需要添0）</li></ul></li><li><p>解压缩过程</p><ul><li>读取压缩文件的头信息重构哈夫曼树</li><li>将字符按8位等长编码的形式解码，用string储存得到的二进制码（即哈夫曼编码）</li><li>将哈夫曼编码通过哈夫曼树解码成原字符</li><li>将解码出的字符写入解压缩的文件</li></ul></li></ol><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p><strong>Scanner.h</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//该节点需要链表转哈夫曼树</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> c;<span class="comment">//该字符</span></span><br><span class="line"><span class="type">int</span> rate;<span class="comment">//该字符出现频次</span></span><br><span class="line">string coding;<span class="comment">//哈夫曼编码</span></span><br><span class="line">Node* Next;<span class="comment">//连接下一个结点</span></span><br><span class="line">Node* parent;<span class="comment">//父指针</span></span><br><span class="line">Node* left;<span class="comment">//左指针</span></span><br><span class="line">Node* right;<span class="comment">//右指针</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scanner</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">string text;</span><br><span class="line">ifstream in;<span class="comment">//创建流对象 写入文件</span></span><br><span class="line">string filename;<span class="comment">//文件名</span></span><br><span class="line">Node* Character;<span class="comment">//字符根结点</span></span><br><span class="line"><span class="type">int</span> num;<span class="comment">//记录读取的字符数量</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Scanner</span>() &#123; num = <span class="number">0</span>; &#125;</span><br><span class="line"><span class="comment">//读取文件（字符频率）</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReadFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请输入文件名：&quot;</span>;</span><br><span class="line">cin &gt;&gt; filename;</span><br><span class="line">in.<span class="built_in">open</span>(filename);<span class="comment">//打开文件</span></span><br><span class="line"><span class="keyword">while</span> (!in)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;读取错误，请检查文件名后重新输入：&quot;</span>;</span><br><span class="line">cin &gt;&gt; filename;</span><br><span class="line">in.<span class="built_in">open</span>(filename);</span><br><span class="line">&#125;</span><br><span class="line">Character = <span class="keyword">new</span> Node;<span class="comment">//字符结点</span></span><br><span class="line">Node* p;</span><br><span class="line">Node* temp_root;<span class="comment">//用于定位</span></span><br><span class="line"><span class="type">char</span> temp;<span class="comment">//暂时储存读入的一个字符</span></span><br><span class="line">p = temp_root = Character;</span><br><span class="line"><span class="comment">//读文件</span></span><br><span class="line"><span class="keyword">while</span> (!in.<span class="built_in">eof</span>()) </span><br><span class="line">&#123;</span><br><span class="line">in.<span class="built_in">read</span>(&amp;temp, <span class="number">1</span>);<span class="comment">//读一个字符存入temp</span></span><br><span class="line"><span class="keyword">if</span> (in.<span class="built_in">eof</span>())</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">if</span> (num == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">Character-&gt;c = temp;</span><br><span class="line">Character-&gt;rate = <span class="number">1</span>;</span><br><span class="line">Character-&gt;Next = Character-&gt;left = Character-&gt;right = Character-&gt;parent = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//相同字符则在IsNew函数中执行rate++</span></span><br><span class="line"><span class="comment">//新字符则进行以下操作</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsNew</span>(temp))</span><br><span class="line">&#123;</span><br><span class="line">p = <span class="keyword">new</span> Node;</span><br><span class="line">p-&gt;c = temp;</span><br><span class="line">p-&gt;rate = <span class="number">1</span>;</span><br><span class="line">p-&gt;left = p-&gt;right = p-&gt;parent = <span class="literal">NULL</span>;</span><br><span class="line">temp_root-&gt;Next = p;</span><br><span class="line">temp_root = temp_root-&gt;Next;</span><br><span class="line">temp_root-&gt;Next = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">in.<span class="built_in">close</span>();<span class="comment">//关闭文件</span></span><br><span class="line"><span class="built_in">Sort</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;                 文件已读入&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (Node* temp = Character; temp != <span class="literal">NULL</span>; temp = temp-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//换行 回车</span></span><br><span class="line"><span class="keyword">if</span> (temp-&gt;c == <span class="number">10</span> || temp-&gt;c == <span class="number">13</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt; &quot;</span> &lt;&lt; <span class="string">&quot;\\n &quot;</span>;</span><br><span class="line">cout &lt;&lt; temp-&gt;rate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//空格</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (temp-&gt;c == <span class="number">32</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt; &quot;</span> &lt;&lt; <span class="string">&quot;__ &quot;</span>;</span><br><span class="line">cout &lt;&lt; temp-&gt;rate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Tab</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (temp-&gt;c == <span class="number">9</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;&quot;</span> &lt;&lt; <span class="string">&quot;Tab &quot;</span>;</span><br><span class="line">cout &lt;&lt; temp-&gt;rate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt; &quot;</span> &lt;&lt; temp-&gt;c &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">cout &lt;&lt; temp-&gt;rate;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;字符数:&quot;</span> &lt;&lt; num &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ps:\&quot;__\&quot;表示空格 \&quot;\\n表示换行or回车\&quot;&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//频率进行选择排序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* temp;</span><br><span class="line"><span class="type">int</span> R;<span class="comment">//rate</span></span><br><span class="line"><span class="type">char</span> Ch;<span class="comment">//字符</span></span><br><span class="line"><span class="keyword">for</span> (temp = Character; temp-&gt;Next != <span class="literal">NULL</span>; temp = temp-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line">Node* temp1 = temp;</span><br><span class="line">Node* temp2 = temp-&gt;Next;</span><br><span class="line"><span class="keyword">while</span> (temp2 != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (temp2-&gt;rate &lt; temp1-&gt;rate)</span><br><span class="line">temp1 = temp2;<span class="comment">//temp1指向当前最小结点</span></span><br><span class="line">temp2 = temp2-&gt;Next;<span class="comment">//temp2找下一个</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将当前循环得到的最小结点与temp交换</span></span><br><span class="line"><span class="keyword">if</span> (temp1 != temp)</span><br><span class="line">&#123;</span><br><span class="line">Ch = temp1-&gt;c;</span><br><span class="line">R = temp1-&gt;rate;</span><br><span class="line">temp1-&gt;c = temp-&gt;c;</span><br><span class="line">temp-&gt;c = Ch;</span><br><span class="line">temp1-&gt;rate = temp-&gt;rate;</span><br><span class="line">temp-&gt;rate = R;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断该字符是否新出现</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsNew</span><span class="params">(<span class="type">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* temp;</span><br><span class="line"><span class="keyword">for</span> (temp= Character; temp!=<span class="literal">NULL</span>; temp=temp-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (temp-&gt;c == c)</span><br><span class="line">&#123;</span><br><span class="line">temp-&gt;rate++;<span class="comment">//相同字符则rate++</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><strong>huffman.h</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;scanner.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HuffmanComress</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Menu</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;cls&quot;</span>);</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;1. 选择打开文件并对其进行压缩；&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2. 选择压缩文件并解压成源文件；&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;3. 退出程序；&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请选择操作(序号)：&quot;</span>;</span><br><span class="line"><span class="type">int</span> Select;</span><br><span class="line">cin &gt;&gt; Select;</span><br><span class="line"><span class="keyword">switch</span> (Select)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="built_in">ToCompressFile</span>();</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="built_in">ToSourceFile</span>();</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;输入错误!&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//--------------压缩源文件-----------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToCompressFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">PreWork</span>();<span class="comment">//准备工作</span></span><br><span class="line"><span class="comment">/*--------------------------</span></span><br><span class="line"><span class="comment">源文件-&gt;哈夫曼编码文件</span></span><br><span class="line"><span class="comment">---------------------------*/</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请输入压缩后文件的文件名：&quot;</span>;</span><br><span class="line">cin &gt;&gt; compressFile;</span><br><span class="line">in.<span class="built_in">open</span>(source, ios::in);</span><br><span class="line">out.<span class="built_in">open</span>(compressFile, ios::binary);</span><br><span class="line"><span class="comment">//读取源文件的字符</span></span><br><span class="line"><span class="keyword">while</span> (!in.<span class="built_in">eof</span>())</span><br><span class="line">&#123;</span><br><span class="line">string s;</span><br><span class="line"><span class="type">char</span> temp;<span class="comment">//存放读取的字符</span></span><br><span class="line">in.<span class="built_in">get</span>(temp);<span class="comment">//每次读一个字符</span></span><br><span class="line"><span class="keyword">if</span> (in.<span class="built_in">eof</span>())</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="built_in">CharToHuffCode</span>(temp, BinTree, s);</span><br><span class="line">out &lt;&lt; s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭文件</span></span><br><span class="line">out.<span class="built_in">close</span>();</span><br><span class="line">in.<span class="built_in">close</span>();</span><br><span class="line"><span class="comment">/*--------------------------</span></span><br><span class="line"><span class="comment">哈夫曼编码文件-&gt;压缩文件</span></span><br><span class="line"><span class="comment">---------------------------*/</span></span><br><span class="line">in.<span class="built_in">open</span>(compressFile, ios::in);</span><br><span class="line">string s;</span><br><span class="line">in&gt;&gt;s;<span class="comment">//读取哈夫曼编码</span></span><br><span class="line">in.<span class="built_in">close</span>();</span><br><span class="line">out.<span class="built_in">open</span>(compressFile, ios::out);</span><br><span class="line"><span class="comment">//将字符及频率写在压缩文件头部，用于重构哈夫曼树</span></span><br><span class="line"><span class="built_in">SaveHeadInformation</span>();</span><br><span class="line"><span class="comment">//8位一组转为char</span></span><br><span class="line">string s_temp;</span><br><span class="line"><span class="type">int</span> num_i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; s[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">s_temp += s[i];</span><br><span class="line"><span class="keyword">if</span> ((i+<span class="number">1</span>) % <span class="number">8</span> == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line"><span class="built_in">BinaryToChar</span>(s_temp, c);</span><br><span class="line">out &lt;&lt; c;</span><br><span class="line">s_temp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">num_i = i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不足8位</span></span><br><span class="line"><span class="keyword">if</span> (num_i % <span class="number">8</span> &gt; <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">zeroNum = <span class="number">8</span> - (num_i % <span class="number">8</span>);</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; zeroNum; i++)</span><br><span class="line">&#123;</span><br><span class="line">s_temp.<span class="built_in">push_back</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">BinaryToChar</span>(s_temp, c);</span><br><span class="line">out &lt;&lt; c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将zeroNum保存到文件头部</span></span><br><span class="line">out.<span class="built_in">seekp</span>(<span class="number">0</span>, ios::beg);</span><br><span class="line">out &lt;&lt; zeroNum;</span><br><span class="line">out.<span class="built_in">close</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;                压缩完成。&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//---------------------解压缩----------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToSourceFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请输入需要解压的文件名：&quot;</span>;</span><br><span class="line">cin &gt;&gt;compressFile;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请输入解压后的文件名：&quot;</span>;</span><br><span class="line">cin &gt;&gt; decompressFile;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"><span class="comment">//需解压的文件 ios::binary确保读到文件尾</span></span><br><span class="line">in.<span class="built_in">open</span>(compressFile, ios::binary);</span><br><span class="line"><span class="comment">//解压后的文件</span></span><br><span class="line">out.<span class="built_in">open</span>(decompressFile, ios::out);</span><br><span class="line"><span class="type">char</span> c;<span class="comment">//存放编码对应的字符</span></span><br><span class="line"><span class="type">int</span> flag = <span class="number">0</span>;<span class="comment">//判断是否能找到对应字符</span></span><br><span class="line">string s;<span class="comment">//储存解码出的哈夫曼编码</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\t解压中...&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//---------读取文件头信息 ------------</span></span><br><span class="line"><span class="built_in">ReadHeadInformation</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------</span></span><br><span class="line"><span class="comment"> 将压缩文件解码成哈夫曼编码</span></span><br><span class="line"><span class="comment">-----------------------------------*/</span></span><br><span class="line"><span class="keyword">while</span> (!in.<span class="built_in">eof</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> tempc;</span><br><span class="line"></span><br><span class="line">in.<span class="built_in">get</span>(tempc);</span><br><span class="line"><span class="keyword">if</span> (in.<span class="built_in">eof</span>())</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="type">char</span> end_ch = in.<span class="built_in">peek</span>();<span class="comment">//观测</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  对压缩文件最后一个字符做特殊处理</span></span><br><span class="line"><span class="comment">  之前将huff编码转为字符时 编码不满8位做了添0处理</span></span><br><span class="line"><span class="comment">  现在需要将添加的0删去</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (end_ch == EOF)</span><br><span class="line">&#123;</span><br><span class="line">string temps;</span><br><span class="line"><span class="built_in">CharToBinary</span>(tempc, temps);</span><br><span class="line"><span class="comment">//不添加多余的0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span> - zeroNum; i++)</span><br><span class="line">&#123;</span><br><span class="line">s.<span class="built_in">push_back</span>(temps[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">CharToBinary</span>(tempc, s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*-----------------------------------</span></span><br><span class="line"><span class="comment"> 将哈夫曼编码进行解码</span></span><br><span class="line"><span class="comment">-----------------------------------*/</span></span><br><span class="line">string temp_s;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; s[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">temp_s += s[i];</span><br><span class="line"><span class="built_in">FindChar</span>(c, BinTree, temp_s, flag);</span><br><span class="line"><span class="comment">//找到了对应字符</span></span><br><span class="line"><span class="keyword">if</span> (flag)</span><br><span class="line">&#123;</span><br><span class="line">temp_s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">out &lt;&lt; c;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">out.<span class="built_in">close</span>();</span><br><span class="line">in.<span class="built_in">close</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;                   解压完成。&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">ifstream in;<span class="comment">//创建流对象</span></span><br><span class="line">ofstream out;<span class="comment">//创建流对象</span></span><br><span class="line">string source;<span class="comment">//源文件</span></span><br><span class="line">string compressFile;<span class="comment">//压缩后的文件</span></span><br><span class="line">string decompressFile;<span class="comment">//解压后的文件</span></span><br><span class="line">Node* BinTree;<span class="comment">//根结点 字符链表-&gt;哈夫曼树</span></span><br><span class="line"><span class="type">int</span> charLength = <span class="number">0</span>;<span class="comment">//字符长度</span></span><br><span class="line"><span class="type">int</span> zeroNum = <span class="number">0</span>;<span class="comment">//huff编码补0的个数</span></span><br><span class="line">Scanner scan;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------将字符转为哈夫曼编码-------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CharToHuffCode</span><span class="params">(<span class="type">char</span> c, Node* p, string&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//遍历左右子树直到找到对应叶子</span></span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;c == c)</span><br><span class="line">&#123;</span><br><span class="line">s = p-&gt;coding;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CharToHuffCode</span>(c, p-&gt;left, s);</span><br><span class="line"><span class="built_in">CharToHuffCode</span>(c, p-&gt;right, s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----------将八位二进制码转为字符--------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BinaryToChar</span><span class="params">(string s, <span class="type">char</span>&amp; c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">c = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">c = (<span class="type">char</span>)(c + (s[i] - <span class="string">&#x27;0&#x27;</span>) * m);</span><br><span class="line">m *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------将字符转为二进制码------------------妙啊</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CharToBinary</span><span class="params">(<span class="type">char</span> c, string&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> k = <span class="number">0x80</span>;<span class="comment">//二进制1000,0000</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++, k &gt;&gt;= <span class="number">1</span>)<span class="comment">//右移后赋值</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c &amp; k)<span class="comment">//按位与</span></span><br><span class="line">s = s + <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">s = s + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------将扫描文件中排好序的链表复制过来BinTree------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Copy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* temp;</span><br><span class="line">BinTree = <span class="keyword">new</span> Node;</span><br><span class="line">Node* p = BinTree;</span><br><span class="line">Node* q;</span><br><span class="line"><span class="keyword">for</span> (temp = scan.Character; temp != <span class="literal">NULL</span>; temp = temp-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line">q = <span class="keyword">new</span> Node;</span><br><span class="line">q-&gt;c = temp-&gt;c;</span><br><span class="line">q-&gt;rate = temp-&gt;rate;</span><br><span class="line">q-&gt;left = q-&gt;right = q-&gt;parent = q-&gt;Next = <span class="literal">NULL</span>;</span><br><span class="line">p-&gt;Next = q;</span><br><span class="line">p = p-&gt;Next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------将新节点插入BinTree字符结点链表合适位置------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InsertNewNode</span><span class="params">(Node* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* temp;</span><br><span class="line">Node* front = BinTree;</span><br><span class="line"><span class="comment">//当新节点rate最小 插入表头</span></span><br><span class="line"><span class="keyword">if</span> (p-&gt;rate &lt;= front-&gt;rate)</span><br><span class="line">&#123;</span><br><span class="line">p-&gt;Next = BinTree;</span><br><span class="line">BinTree = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (temp = BinTree-&gt;Next; temp != <span class="literal">NULL</span>; temp = temp-&gt;Next, front = front-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;rate &lt;= temp-&gt;rate)</span><br><span class="line">&#123;</span><br><span class="line">front-&gt;Next = p;</span><br><span class="line">p-&gt;Next = temp;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新节点最大</span></span><br><span class="line"><span class="keyword">if</span> (temp == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">front-&gt;Next = p;</span><br><span class="line">p-&gt;Next = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------------创建哈夫曼树----------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateHuffmanTree</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node* p = <span class="literal">NULL</span>;</span><br><span class="line">BinTree = BinTree-&gt;Next;</span><br><span class="line"><span class="keyword">while</span> (BinTree != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//两两一对合并</span></span><br><span class="line">p = <span class="keyword">new</span> Node;</span><br><span class="line">p-&gt;left = BinTree;</span><br><span class="line">BinTree-&gt;coding = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">BinTree-&gt;parent = p;</span><br><span class="line">BinTree = BinTree-&gt;Next;</span><br><span class="line">p-&gt;right = BinTree;</span><br><span class="line">BinTree-&gt;coding = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">BinTree-&gt;parent = p;</span><br><span class="line">p-&gt;rate = p-&gt;left-&gt;rate + p-&gt;right-&gt;rate;</span><br><span class="line">BinTree = BinTree-&gt;Next;</span><br><span class="line"><span class="built_in">InsertNewNode</span>(p);<span class="comment">//将合并的结点插入合适的位置</span></span><br><span class="line"><span class="comment">//只剩下两个节点的时候</span></span><br><span class="line"><span class="keyword">if</span> (BinTree-&gt;Next-&gt;Next == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">p = <span class="keyword">new</span> Node;</span><br><span class="line">p-&gt;left = BinTree;</span><br><span class="line">BinTree-&gt;coding = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">BinTree-&gt;parent = p;</span><br><span class="line">BinTree = BinTree-&gt;Next;</span><br><span class="line">p-&gt;right = BinTree;</span><br><span class="line">BinTree-&gt;coding = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">BinTree-&gt;parent = p;</span><br><span class="line">p-&gt;rate = p-&gt;left-&gt;rate + p-&gt;right-&gt;rate;</span><br><span class="line">BinTree = p;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------完善哈夫曼树叶子结点的编码-----------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetCode</span><span class="params">(Node* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//p不是根结点</span></span><br><span class="line"><span class="keyword">if</span> (p != BinTree)</span><br><span class="line">&#123;</span><br><span class="line">p-&gt;coding = p-&gt;parent-&gt;coding + p-&gt;coding;<span class="comment">//父编码加上自己的编码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;left == <span class="literal">NULL</span> &amp;&amp; p-&gt;right == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历左右子树</span></span><br><span class="line"><span class="built_in">GetCode</span>(p-&gt;left);</span><br><span class="line"><span class="built_in">GetCode</span>(p-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//------------------------压缩前的准备工作---------------------------</span></span><br><span class="line"><span class="comment">//读取文件 统计频率 将读取的链表信息拷贝至BinTree 创建哈夫曼树(BinTree) 得到哈夫曼编码</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PreWork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">scan.<span class="built_in">ReadFile</span>();</span><br><span class="line"><span class="built_in">Copy</span>();</span><br><span class="line">source = scan.filename;</span><br><span class="line">charLength = scan.num;</span><br><span class="line"><span class="comment">//创建哈夫曼树</span></span><br><span class="line"><span class="built_in">CreateHuffmanTree</span>();</span><br><span class="line">BinTree-&gt;coding = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">//Node* temp = BinTree;</span></span><br><span class="line"><span class="comment">//得到哈夫曼树产生的编码</span></span><br><span class="line"><span class="built_in">GetCode</span>(BinTree);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------------保存用于重构哈夫曼树的头信息------------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SaveHeadInformation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">out &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">Node* temp;</span><br><span class="line"><span class="keyword">for</span> (temp = scan.Character; temp != <span class="literal">NULL</span>; temp = temp-&gt;Next)</span><br><span class="line">&#123;</span><br><span class="line">out &lt;&lt; temp-&gt;c &lt;&lt; temp-&gt;rate&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">out &lt;&lt; <span class="string">&quot;\\&quot;</span>;<span class="comment">//头信息结束的标志</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------------读取头信息并重构哈夫曼树------------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReadHeadInformation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">in &gt;&gt; zeroNum;</span><br><span class="line"><span class="type">char</span> pass;</span><br><span class="line">in.<span class="built_in">get</span>(pass);<span class="comment">//消除空格影响</span></span><br><span class="line"><span class="type">char</span> ch;</span><br><span class="line">in.<span class="built_in">get</span>(ch);</span><br><span class="line">BinTree = <span class="keyword">new</span> Node;</span><br><span class="line">Node* temp = BinTree;</span><br><span class="line"><span class="keyword">while</span> (ch!=<span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* q = <span class="keyword">new</span> Node;</span><br><span class="line">q-&gt;c = ch;</span><br><span class="line">in &gt;&gt; q-&gt;rate;</span><br><span class="line">q-&gt;left = q-&gt;right = q-&gt;parent = q-&gt;Next = <span class="literal">NULL</span>;</span><br><span class="line">temp-&gt;Next = q;</span><br><span class="line">temp = temp-&gt;Next;</span><br><span class="line">in.<span class="built_in">get</span>(pass);<span class="comment">//消除空格影响</span></span><br><span class="line">in.<span class="built_in">get</span>(ch);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建哈夫曼树</span></span><br><span class="line"><span class="built_in">CreateHuffmanTree</span>();</span><br><span class="line">BinTree-&gt;coding = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">//得到哈夫曼树叶子结点的编码</span></span><br><span class="line"><span class="built_in">GetCode</span>(BinTree);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------在哈夫曼树中找到字符 ？？？---------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FindChar</span><span class="params">(<span class="type">char</span>&amp; c, Node* p, string s, <span class="type">int</span>&amp; flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//字符串为空 表示该字符串已读完</span></span><br><span class="line"><span class="keyword">if</span> (s.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//判断是不是叶子结点</span></span><br><span class="line"><span class="keyword">if</span> ((p-&gt;left == <span class="literal">NULL</span>) &amp;&amp; (p-&gt;right == <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line">c = p-&gt;c;</span><br><span class="line">flag = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不是叶子结点 说明这个子串不是对应某个字符的前缀码</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//删除字符串中的第一个元素 表示该元素已读</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">size</span>(); i++)</span><br><span class="line">s[i - <span class="number">1</span>] = s[i];</span><br><span class="line">s.<span class="built_in">pop_back</span>();</span><br><span class="line"><span class="comment">//左子树</span></span><br><span class="line"><span class="built_in">FindChar</span>(c, p-&gt;left, s, flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">// s[0]==&#x27;1&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//删除字符串中的第一个元素 表示该元素已读</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">size</span>(); i++)</span><br><span class="line">s[i - <span class="number">1</span>] = s[i];</span><br><span class="line">s.<span class="built_in">pop_back</span>();</span><br><span class="line"><span class="comment">//右子树</span></span><br><span class="line"><span class="built_in">FindChar</span>(c, p-&gt;right, s, flag);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><strong>main.cpp</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;huffman.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;scanner.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HuffmanComress h;</span><br><span class="line">h.<span class="built_in">Menu</span>();</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 压缩算法 </tag>
            
            <tag> huffman </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACWing寒假 4261.孤独的照片</title>
      <link href="/2022/12/26/%5BACWing%E5%AF%92%E5%81%8701%5D%E5%AD%A4%E7%8B%AC%E7%9A%84%E7%85%A7%E7%89%87/"/>
      <url>/2022/12/26/%5BACWing%E5%AF%92%E5%81%8701%5D%E5%AD%A4%E7%8B%AC%E7%9A%84%E7%85%A7%E7%89%87/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">难度：中等</span><br><span class="line">时/空限制：1s / 64MB</span><br><span class="line">总通过数：3070</span><br><span class="line">总尝试数：9311</span><br><span class="line">来源：USACO 2021 December Contest Bronze</span><br><span class="line">算法标签:</span><br><span class="line">枚举 乘法原理</span><br></pre></td></tr></table></figure><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Farmer John 最近购入了 N 头新的奶牛，每头奶牛的品种是更赛牛（Guernsey）或荷斯坦牛（Holstein）之一。</p><p>奶牛目前排成一排，Farmer John 想要为每个连续不少于三头奶牛的序列拍摄一张照片。</p><p>然而，他不想拍摄这样的照片，其中只有一头牛的品种是更赛牛，或者只有一头牛的品种是荷斯坦牛——他认为这头奇特的牛会感到孤立和不自然。</p><p>在为每个连续不少于三头奶牛的序列拍摄了一张照片后，他把所有「孤独的」照片，即其中只有一头更赛牛或荷斯坦奶牛的照片，都扔掉了。</p><p>给定奶牛的排列方式，请帮助 Farmer John 求出他会扔掉多少张孤独的照片。</p><p>如果两张照片以不同位置的奶牛开始或结束，则认为它们是不同的。</p><p><strong>输入格式</strong><br>输入的第一行包含 N。</p><p>输入的第二行包含一个长为 N 的字符串。如果队伍中的第 i 头奶牛是更赛牛，则字符串的第 i 个字符为 <strong>G</strong>。否则，第 i 头奶牛是荷斯坦牛，该字符为 <strong>H</strong>。</p><p><strong>输出格式</strong><br>输出 Farmer John 会扔掉的孤独的照片数量。</p><p><strong>数据范围</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3≤N≤5×10^5</span><br></pre></td></tr></table></figure><br><strong>输入样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">GHGHG</span><br></pre></td></tr></table></figure><br><strong>输出样例：</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><br><strong>样例解释</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这个例子中的每一个长为 3 的子串均恰好包含一头更赛牛或荷斯坦牛——所以这些子串表示孤独的照片，并会被 Farmer John 扔掉。</span><br><span class="line"></span><br><span class="line">所有更长的子串（GHGH、HGHG 和 GHGHG）都可以被接受。</span><br></pre></td></tr></table></figure></p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>暴力解法超时(10e5)：</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Alone</span><span class="params">(string t)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> countG = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> countH = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; t.<span class="built_in">length</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (t[i] == <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">            countG++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t[i] == <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">            countH++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (countG &gt;= <span class="number">2</span> &amp;&amp; countH &gt;= <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((countG == <span class="number">0</span> &amp;&amp; countH &gt;= <span class="number">2</span>) || (countG &gt;= <span class="number">2</span> &amp;&amp; countH == <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    string s;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cin &gt;&gt; s;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n<span class="number">-3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        len = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">while</span> (i + len - <span class="number">1</span> &lt; n)</span><br><span class="line">        &#123;</span><br><span class="line">            string temp = s.<span class="built_in">substr</span>(i, len);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Alone</span>(temp))</span><br><span class="line">                count++;</span><br><span class="line">            len++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; count;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>排列组合解法思路O(n):</strong></p><ul><li>枚举孤独牛出现的位置，假设孤独的牛是G种 </li><li>此时有三种情况：<ol><li>G出现在中间位置，左右两边都是H牛</li><li>G出现在左端点，右边至少两只H牛</li><li>G出现在右端点，左边至少两只H牛<br><img src="https://s1.ax1x.com/2022/12/27/zxjkDI.png" alt=""></li></ol></li><li>如上图，假设G左边有连续L个H牛，右边有连续R个H牛。则<strong>情况1:</strong> G点左侧可以有1~L头H牛，右侧可以有1~R头H牛，共<strong>L*R</strong>种情况；<strong>情况2:</strong> G在左端点，故G右侧即R中要取<strong>2头以上连续的H牛</strong>，故有<strong>R-1</strong>种情况；<strong>情况3</strong>同理<strong>L-1</strong>种情况。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500010</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> str[N];</span><br><span class="line"><span class="type">int</span> l[N], r[N];<span class="comment">//分别表示左边，右边有多少个连续非孤独牛</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cin &gt;&gt; str;</span><br><span class="line">    <span class="comment">//求l[i]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, Hnum = <span class="number">0</span>, Gnum = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">&#x27;G&#x27;</span>)&#123;</span><br><span class="line">            l[i] = Hnum;<span class="comment">//h牛的数量</span></span><br><span class="line">            Hnum = <span class="number">0</span>;</span><br><span class="line">            Gnum++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            l[i] = Gnum;<span class="comment">//g牛的数量</span></span><br><span class="line">            Gnum = <span class="number">0</span>;</span><br><span class="line">            Hnum++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//求r[i]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>, Hnum = <span class="number">0</span>, Gnum = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">&#x27;G&#x27;</span>)&#123;</span><br><span class="line">            r[i] = Hnum;<span class="comment">//h牛的数量</span></span><br><span class="line">            Hnum = <span class="number">0</span>;</span><br><span class="line">            Gnum++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            r[i] = Gnum;<span class="comment">//g牛的数量</span></span><br><span class="line">            Gnum = <span class="number">0</span>;</span><br><span class="line">            Hnum++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LL count = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//遍历孤独牛的位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="comment">//三种情况</span></span><br><span class="line">        count += (LL)l[i] * r[i] + <span class="built_in">max</span>(l[i] - <span class="number">1</span>, <span class="number">0</span>) + <span class="built_in">max</span>(r[i] - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; count;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.acwing.com/video/4574/">视频讲解</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
          <category> ACWing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思维 </tag>
            
            <tag> 排列组合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>八皇后问题回溯法-作业</title>
      <link href="/2022/12/21/8%E7%9A%87%E5%90%8E%E5%9B%9E%E6%BA%AF%E6%B3%95/"/>
      <url>/2022/12/21/8%E7%9A%87%E5%90%8E%E5%9B%9E%E6%BA%AF%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="回溯算法——八皇后问题"><a href="#回溯算法——八皇后问题" class="headerlink" title="回溯算法——八皇后问题"></a>回溯算法——八皇后问题</h3><h4 id="（1）问题描述"><a href="#（1）问题描述" class="headerlink" title="（1）问题描述"></a>（1）问题描述</h4><p>在8×8格的国际象棋上摆放8个皇后，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法。<br><img src="https://s1.ax1x.com/2022/12/24/zvp8A0.png" alt=""></p><h4 id="（2）问题分析"><a href="#（2）问题分析" class="headerlink" title="（2）问题分析"></a>（2）问题分析</h4><p>在解决八皇后问题时，如果采用穷举法，即八层循环遍历，则需要列举8^8种情形，浪费了太多的计算资源在各种无用功上面。<br>8皇后问题可抽象为n皇后问题，即在n×n格的国际象棋上摆放n个皇后，使其不能互相攻击，问有多少种摆法。<br>为了使问题简化，以下以4皇后为例进行分析：</p><p>若4皇后问题采用穷举法，则需要列举4^4种情况。然而，如下图所示，当第一个皇后位于第一列，第二个皇后位于第三列时，第三行的皇后若放置于第一列则与第一个皇后同列冲突，放置于第二、四列则与第二个皇后斜线上冲突，放置于第三列则与第二个皇后同列冲突，故此时第三个皇后无正确放法。此时则无需继续向下一层枚举。处理方法可用回溯法进行优化，即撤销上一行的枚举情况，将第二行的皇后放置第四列继续枚举。<br> <img src="https://s1.ax1x.com/2022/12/24/zvpUc4.png" alt=""></p><h4 id="（3）算法描述"><a href="#（3）算法描述" class="headerlink" title="（3）算法描述"></a>（3）算法描述</h4><p>回溯法介绍：回溯法又称试探法，其处理思想类似于枚举搜索，我们枚举出每一种情况，然后在根据条件进行筛选，找到满足期望的值。回溯算法的基本思想是从一条路往前走，能进则进，不能进则退回，换另一条路进行尝试。<br>利用回溯法解决八皇后问题的步骤如下：</p><ol><li>设一维数组 x[]，下标代表第几行，值代表该行中皇后的位置。设一变量k，代表此时在下第几行；</li><li>设一个判断是否符合条件（不同列，不同对角线）的函数，不符合条件的直接跳过，即缩小解空间；</li><li>利用for循环，将符合条件的可行解放入数组x中，当数组x填满后，此时一种方案结束。</li><li>利用递归实现回溯，直到所有可行方案输出，结束。</li></ol><p><strong>判断当前皇后位置是否符合条件（不同行、列，不同对角线）的方法：</strong><br>程序中设置每行放置一个皇后，故可以保证每个皇后不同行；判断当前行皇后的列位置与之前所有行的皇后列位置是否存在相同，若相同则不符合条件；对角线已知斜率为1或-1，故满足规律：当前行皇后与之前所有行皇后的位置依次进行比较，若二者列之差的绝对值与行之差的绝对值相同，则不符合条件。<br>以下为回溯法解决4皇后问题的部分演示：<br><img src="https://s1.ax1x.com/2022/12/24/zvprAx.png" alt=""></p><h4 id="（4）算法实现"><a href="#（4）算法实现" class="headerlink" title="（4）算法实现"></a>（4）算法实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Queen</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        eightQueen(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> []Queen=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//递归</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">eightQueen</span><span class="params">(<span class="type">int</span> row)</span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (row == <span class="number">8</span>)&#123;<span class="comment">//一组解</span></span><br><span class="line">            count++;</span><br><span class="line">            printQueens(Queen);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">column</span> <span class="operator">=</span> <span class="number">0</span>; column &lt; <span class="number">8</span>; column++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (judge(row,column))&#123;</span><br><span class="line">               Queen[row] = column;</span><br><span class="line">               eightQueen(row+<span class="number">1</span>);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">judge</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> column)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> row-<span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Queen[i] == column)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//垂直方向是否有皇后</span></span><br><span class="line">            <span class="keyword">if</span> (Math.abs(row - i) == Math.abs(column - Queen[i])) </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//对角线是否有皇后</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printQueens</span><span class="params">(<span class="type">int</span> []Queen)</span>&#123;</span><br><span class="line">    System.out.println(count+<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> <span class="number">0</span>; row &lt; <span class="number">8</span>; row++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">column</span> <span class="operator">=</span> <span class="number">0</span>; column &lt; <span class="number">8</span>; column++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Queen[row] == column) </span><br><span class="line">                System.out.print(<span class="string">&quot; Q &quot;</span>);</span><br><span class="line">                <span class="keyword">else</span> </span><br><span class="line">                System.out.print(<span class="string">&quot; * &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 回溯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可视化表达式计算器</title>
      <link href="/2022/12/18/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%99%A8/"/>
      <url>/2022/12/18/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>功能：基本的加减乘除运算，正弦余弦运算，取模运算，指数运算，表达式优先级处理<br>（表达式中可包含负数）</p></blockquote><hr><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p><img src="https://s1.ax1x.com/2022/12/18/zqEcCT.png" alt=""></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="Calculate"><a href="#Calculate" class="headerlink" title="Calculate"></a>Calculate</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluationExpression</span><span class="params">(String expression)</span> &#123;</span><br><span class="line">        <span class="comment">//符号栈</span></span><br><span class="line">        LinkedList&lt;Character&gt; stackOptr = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//数字栈</span></span><br><span class="line">        LinkedList&lt;Double&gt; stackOpnd = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//标记Optr栈底</span></span><br><span class="line">        stackOptr.addFirst(<span class="string">&#x27;@&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; expression.length()) &#123;</span><br><span class="line">            <span class="comment">//数字</span></span><br><span class="line">            <span class="keyword">if</span> ((expression.charAt(i) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; expression.charAt(i) &lt;= <span class="string">&#x27;9&#x27;</span>) || expression.charAt(i) == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">belowZero</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">//负数</span></span><br><span class="line">                <span class="keyword">if</span> (expression.charAt(i) == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                    belowZero = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">//在负数前面加上&#x27;+&#x27;</span></span><br><span class="line">                    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; expression.charAt(i-<span class="number">1</span>) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; expression.charAt(i-<span class="number">1</span>) &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">                        stackOptr.addFirst(<span class="string">&#x27;+&#x27;</span>);</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//完整的数</span></span><br><span class="line">                <span class="type">double</span> number;</span><br><span class="line">                <span class="comment">//整数部分和小数部分</span></span><br><span class="line">                <span class="type">double</span> <span class="variable">integerPart</span> <span class="operator">=</span> <span class="number">0</span>, decimalPart = <span class="number">0</span>;</span><br><span class="line">                <span class="comment">//小数点标记 区分整数和小数部分</span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">beforeDecimalPoint</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">decimalRank</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> ((expression.charAt(i) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; expression.charAt(i) &lt;= <span class="string">&#x27;9&#x27;</span>) || expression.charAt(i) == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&#x27;.&#x27;</span> == expression.charAt(i)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (beforeDecimalPoint) &#123;</span><br><span class="line">                            beforeDecimalPoint = <span class="literal">false</span>;</span><br><span class="line">                            i++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (beforeDecimalPoint) &#123;</span><br><span class="line">                        integerPart = integerPart * <span class="number">10</span> + (expression.charAt(i) - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        decimalPart = decimalPart + (<span class="type">double</span>) (expression.charAt(i) - <span class="string">&#x27;0&#x27;</span>) / decimalRank;</span><br><span class="line">                        decimalRank *= <span class="number">10</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//整数部分 + 小数部分</span></span><br><span class="line">                number = integerPart + decimalPart;</span><br><span class="line">                <span class="keyword">if</span> (belowZero)</span><br><span class="line">                    number = -number;</span><br><span class="line">                <span class="comment">//进数字栈</span></span><br><span class="line">                stackOpnd.addFirst(number);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//符号</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//处理符号栈</span></span><br><span class="line">                <span class="keyword">switch</span> (Priority(stackOptr.getFirst(), expression.charAt(i))) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">                        stackOptr.addFirst(expression.charAt(i));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">                        stackOptr.removeFirst();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">                        <span class="comment">//cos</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&#x27;c&#x27;</span> == stackOptr.getFirst()) &#123;</span><br><span class="line">                            <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> stackOpnd.removeFirst();</span><br><span class="line">                            stackOpnd.addFirst(Math.cos(a));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//sin</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&#x27;s&#x27;</span> == stackOptr.getFirst()) &#123;</span><br><span class="line">                            <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> stackOpnd.removeFirst();</span><br><span class="line">                            stackOpnd.addFirst(Math.sin(a));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//a _ b</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> stackOpnd.removeFirst();</span><br><span class="line">                            <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> stackOpnd.removeFirst();</span><br><span class="line">                            stackOpnd.addFirst(operate(a, stackOptr.getFirst(), b));</span><br><span class="line">                        &#125;</span><br><span class="line">                        i--;</span><br><span class="line">                        stackOptr.removeFirst();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&#x27;s&#x27;</span> == expression.charAt(i) || <span class="string">&#x27;c&#x27;</span> == expression.charAt(i) || <span class="string">&#x27;m&#x27;</span> == expression.charAt(i)) &#123;</span><br><span class="line">                    i += <span class="number">3</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(stackOpnd.getFirst());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">Priority</span><span class="params">(<span class="type">char</span> ch1, <span class="type">char</span> ch2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (ch1) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                a = <span class="number">5</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                a = <span class="number">15</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                a = <span class="number">15</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:<span class="comment">//mod</span></span><br><span class="line">                a = <span class="number">15</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">                a = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">                a = <span class="number">25</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">                a = <span class="number">20</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:<span class="comment">//sin</span></span><br><span class="line">                a = <span class="number">20</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:<span class="comment">//cos</span></span><br><span class="line">                a = <span class="number">20</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">                a = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (ch2) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                b = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                b = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                b = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:<span class="comment">//mod</span></span><br><span class="line">                b = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">                b = <span class="number">22</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">                b = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">                b = <span class="number">19</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                b = <span class="number">19</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">                b = <span class="number">19</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">                b = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a &gt; b)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (a == b)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&lt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> <span class="title function_">operate</span><span class="params">(<span class="type">double</span> a, <span class="type">char</span> optr, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="comment">//b是先进栈的数</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">aa</span> <span class="operator">=</span> BigDecimal.valueOf(a);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">bb</span> <span class="operator">=</span> BigDecimal.valueOf(b);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">answer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (optr) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                answer = bb.add(aa);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                answer = bb.multiply(aa);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                answer = bb.divide(aa);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">                <span class="type">double</span> <span class="variable">ans1</span> <span class="operator">=</span> b % a;</span><br><span class="line">                answer = BigDecimal.valueOf(ans1);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">                <span class="type">double</span> <span class="variable">ans2</span> <span class="operator">=</span> Math.pow(b, a);</span><br><span class="line">                answer = BigDecimal.valueOf(ans2);</span><br><span class="line">                <span class="comment">//answer = bb.pow(aa.intValue());</span></span><br><span class="line">                <span class="comment">//BigDecimal的pow方法只能计算整数幂</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(answer);</span><br><span class="line">        <span class="keyword">return</span> answer.doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Display</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] keys = &#123;</span><br><span class="line">            <span class="string">&quot;AC&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;Delete&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sin&quot;</span>, <span class="string">&quot;cos&quot;</span>, <span class="string">&quot;mod&quot;</span>, <span class="string">&quot;+&quot;</span>,</span><br><span class="line">            <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;-&quot;</span>,</span><br><span class="line">            <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;*&quot;</span>,</span><br><span class="line">            <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;/&quot;</span>,</span><br><span class="line">            <span class="string">&quot;.&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;=&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">JTextField</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTextField</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JButton[] button = <span class="keyword">new</span> <span class="title class_">JButton</span>[keys.length];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Display</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化Result</span></span><br><span class="line">        result.setText(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        result.setBackground(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">240</span>,<span class="number">243</span>,<span class="number">249</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResult</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        result.setText(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> JTextField <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/* get numbers from text box */</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> JButton[] getButton() &#123;</span><br><span class="line">        <span class="keyword">return</span> button;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setButton</span><span class="params">(JButton button, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.button[i] = button;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getKey</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> keys[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuildUI</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">    <span class="type">Display</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Display</span>();</span><br><span class="line">    String expression;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Font</span> <span class="variable">resultFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Helvetica&quot;</span>, Font.PLAIN, <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Font</span> <span class="variable">buttonFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Helvetica&quot;</span>, Font.PLAIN, <span class="number">30</span>);</span><br><span class="line">    <span class="comment">//ResultBuffer rb = new ResultBuffer();</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BuildUI</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setTitle(<span class="string">&quot;表达式计算器&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.buildLayout();</span><br><span class="line">        <span class="built_in">this</span>.setSize(<span class="number">600</span>,<span class="number">800</span>);</span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.setDefaultCloseOperation(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">this</span>.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildLayout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">calFrame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        calFrame.setBackground(Color.black);</span><br><span class="line"></span><br><span class="line">        calFrame.setLayout(<span class="keyword">new</span> <span class="title class_">GridLayout</span>(<span class="number">7</span>, <span class="number">1</span>));</span><br><span class="line">        <span class="comment">//添加结果文本框</span></span><br><span class="line">        calFrame.add(dis.getResult());</span><br><span class="line">        dis.getResult().setFont(resultFont);</span><br><span class="line"></span><br><span class="line">        Container[] con = <span class="keyword">new</span> <span class="title class_">Container</span>[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; con.length; i++) &#123;</span><br><span class="line">            con[i] = <span class="keyword">new</span> <span class="title class_">Container</span>();</span><br><span class="line">            con[i].setLayout(<span class="keyword">new</span> <span class="title class_">GridLayout</span>(<span class="number">1</span>, <span class="number">4</span>));</span><br><span class="line">            <span class="comment">//添加六行单元格1*4</span></span><br><span class="line">            calFrame.add(con[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; dis.getButton().length; i++) &#123;</span><br><span class="line">            <span class="type">JButton</span> <span class="variable">newButton</span> <span class="operator">=</span> setBtnForm(i);</span><br><span class="line"><span class="comment">//                        newButton.setForeground(Color.DARK_GRAY);</span></span><br><span class="line"></span><br><span class="line">            dis.setButton(newButton, i);</span><br><span class="line">            con[i / <span class="number">4</span>].add(newButton);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        getContentPane().add(calFrame);</span><br><span class="line">        expression = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> JButton <span class="title function_">setBtnForm</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="comment">/* set font, color, shape of the buttom */</span></span><br><span class="line">        <span class="type">JButton</span> <span class="variable">newButton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(dis.getKey(i));</span><br><span class="line">        newButton.setBorderPainted(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">            newButton.setForeground(Color.black);</span><br><span class="line">            newButton.setBackground(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">247</span>, <span class="number">249</span>, <span class="number">252</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">23</span>) &#123;</span><br><span class="line">            newButton.setForeground(Color.black);</span><br><span class="line">            newButton.setBackground(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">0</span>, <span class="number">103</span>, <span class="number">192</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span> || i == <span class="number">22</span> || i == <span class="number">20</span>) &#123;</span><br><span class="line">            newButton.setForeground(Color.black);</span><br><span class="line">            newButton.setBackground(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">247</span>, <span class="number">249</span>, <span class="number">252</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newButton.setForeground(Color.black);</span><br><span class="line">            newButton.setBackground(Color.white);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        newButton.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        newButton.setFont(buttonFont);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> newButton;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> e.getActionCommand();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dis.getKey(<span class="number">0</span>).equals(action)) &#123;</span><br><span class="line">            <span class="comment">/* press AC */</span></span><br><span class="line">            pressAC();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dis.getKey(<span class="number">3</span>).equals(action)) &#123;</span><br><span class="line">            <span class="comment">/* press Delete */</span></span><br><span class="line">            pressDelete();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dis.getKey(<span class="number">23</span>).equals(action)) &#123;</span><br><span class="line">            <span class="comment">/* press = */</span></span><br><span class="line">            pressCalculate();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* press 1, 2, 3, +, - ...*/</span></span><br><span class="line">            pressExpression(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressAC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/* clear the text box */</span></span><br><span class="line">        expression = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        dis.setResult(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressDelete</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/* delete the last character in the text box */</span></span><br><span class="line">        expression = expression.substring(<span class="number">0</span>, expression.length() - <span class="number">1</span>);</span><br><span class="line">        dis.setResult(expression);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressCalculate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/* compute */</span></span><br><span class="line">        <span class="type">Calculate</span> <span class="variable">cal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculate</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">re</span> <span class="operator">=</span> cal.evaluationExpression(expression + <span class="string">&#x27;@&#x27;</span>);</span><br><span class="line">        dis.setResult(re);</span><br><span class="line">        expression = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressExpression</span><span class="params">(String action)</span> &#123;</span><br><span class="line">        <span class="comment">/* input... */</span></span><br><span class="line">        expression += action;</span><br><span class="line">        dis.setResult(expression);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MalformedURLException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">BuildUI</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaSwing </tag>
            
            <tag> 栈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PuzzleGame_4*4华容道</title>
      <link href="/2022/12/17/PuzzleGame/"/>
      <url>/2022/12/17/PuzzleGame/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>功能：</strong><br>切换图片 - 运动 || 动物 || 随机<br>重新游戏<br>计步数<br>长按A查看完整图片<br>W一键通关<br>背景音乐</p></blockquote><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p><img src="https://s1.ax1x.com/2022/12/19/zLZYMF.png" alt=""></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="GameJFrame"><a href="#GameJFrame" class="headerlink" title="GameJFrame"></a>GameJFrame</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.border.BevelBorder;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ListDataListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyListener;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameJFrame</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> <span class="keyword">implements</span> <span class="title class_">KeyListener</span>, ActionListener &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> [][]imgNumber = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="comment">//空槽的位置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="comment">//图片路径</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;..\\puzzleGame\\image\\animal\\animal9\\&quot;</span>;</span><br><span class="line">    <span class="comment">//计步</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//用于判断win的数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> [][]win = &#123;</span><br><span class="line">            &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;,</span><br><span class="line">            &#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;,</span><br><span class="line">            &#123;<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;,</span><br><span class="line">            &#123;<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//二级菜单条目</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenu</span> <span class="variable">switchImg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenu</span>(<span class="string">&quot;切换图片&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">replayItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;重新游戏&quot;</span>);</span><br><span class="line">    <span class="comment">//private JMenuItem reloginItem = new JMenuItem(&quot;重新登录&quot;);</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">closeItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;关闭游戏&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">WechatItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;V我50&quot;</span>);</span><br><span class="line">    <span class="comment">//三级菜单</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">sport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;运动&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;动物&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JMenuItem</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;随机&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GameJFrame</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//初始化界面</span></span><br><span class="line">        initJFrame();</span><br><span class="line">        <span class="comment">//初始化菜单</span></span><br><span class="line">        initJMenubar(); </span><br><span class="line">        <span class="comment">//初始化数据</span></span><br><span class="line">        initData();</span><br><span class="line">        <span class="comment">//初始化图片</span></span><br><span class="line">        initImage();</span><br><span class="line">        <span class="comment">//显示窗口</span></span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//打乱图片索引序列</span></span><br><span class="line">        <span class="type">int</span> []temp = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">            temp[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; temp.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> r.nextInt(temp.length);</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> temp[index];</span><br><span class="line">            temp[index] = temp[i];</span><br><span class="line">            temp[i] = t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//用temp数组初始化二维数组</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; temp.length; i++) &#123;</span><br><span class="line">            <span class="comment">//空槽</span></span><br><span class="line">            <span class="keyword">if</span> (temp[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                x = i / <span class="number">4</span>;</span><br><span class="line">                y = i % <span class="number">4</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            imgNumber[i / <span class="number">4</span>][i % <span class="number">4</span>] = temp[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initImage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//清空界面</span></span><br><span class="line">        <span class="built_in">this</span>.getContentPane().removeAll();</span><br><span class="line">        <span class="keyword">if</span> (Victory())&#123;</span><br><span class="line">            <span class="type">JLabel</span> <span class="variable">winPic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(<span class="string">&quot;..\\puzzleGame\\image\\win.png&quot;</span>));</span><br><span class="line">            winPic.setBounds(<span class="number">203</span>,<span class="number">283</span>,<span class="number">197</span>,<span class="number">73</span>);</span><br><span class="line">            <span class="built_in">this</span>.getContentPane().add(winPic);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//添加拼图</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">                <span class="comment">//创建图片ImageIcon对象</span></span><br><span class="line">                <span class="comment">//创建Jlabel对象 管理img</span></span><br><span class="line">                <span class="type">JLabel</span> <span class="variable">partImg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(path+imgNumber[i][j]+<span class="string">&quot;.jpg&quot;</span>));</span><br><span class="line">                <span class="comment">//指定img位置</span></span><br><span class="line">                partImg.setBounds(<span class="number">83</span> + <span class="number">105</span> * j,<span class="number">134</span> + <span class="number">105</span> * i,<span class="number">105</span>,<span class="number">105</span>);</span><br><span class="line">                <span class="comment">//小图片边框</span></span><br><span class="line">                partImg.setBorder(<span class="keyword">new</span> <span class="title class_">BevelBorder</span>(BevelBorder.RAISED));</span><br><span class="line">                <span class="comment">//界面添加管理容器</span></span><br><span class="line">                <span class="built_in">this</span>.getContentPane().add(partImg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//添加背景图片</span></span><br><span class="line">        <span class="type">JLabel</span> <span class="variable">background</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(<span class="string">&quot;..\\puzzleGame\\image\\background.png&quot;</span>));</span><br><span class="line">        background.setBounds(<span class="number">40</span>,<span class="number">40</span>,<span class="number">508</span>,<span class="number">560</span>);</span><br><span class="line">        <span class="built_in">this</span>.getContentPane().add(background);</span><br><span class="line">        <span class="comment">//添加计步器</span></span><br><span class="line">        <span class="type">JLabel</span> <span class="variable">stepCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;步数：&quot;</span>+count);</span><br><span class="line">        stepCount.setBounds(<span class="number">50</span>,<span class="number">20</span>,<span class="number">100</span>,<span class="number">30</span>);</span><br><span class="line">        <span class="built_in">this</span>.getContentPane().add(stepCount);</span><br><span class="line">        <span class="comment">//设置提示</span></span><br><span class="line">        <span class="type">JLabel</span> <span class="variable">helpL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;方向键控制游戏&quot;</span>);</span><br><span class="line">        helpL.setBounds(<span class="number">120</span>,<span class="number">20</span>,<span class="number">100</span>,<span class="number">30</span>);</span><br><span class="line">        <span class="built_in">this</span>.getContentPane().add(helpL);</span><br><span class="line">        <span class="type">JLabel</span> <span class="variable">helpR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;A：查看完整图片     W：一键通关&quot;</span>);</span><br><span class="line">        helpR.setBounds(<span class="number">355</span>,<span class="number">20</span>,<span class="number">300</span>,<span class="number">30</span>);</span><br><span class="line">        <span class="built_in">this</span>.getContentPane().add(helpR);</span><br><span class="line">        <span class="comment">//刷新界面</span></span><br><span class="line">        <span class="built_in">this</span>.getContentPane().repaint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initJMenubar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JMenuBar</span> <span class="variable">menubar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuBar</span>();</span><br><span class="line">        <span class="comment">//一级菜单</span></span><br><span class="line">        <span class="type">JMenu</span> <span class="variable">functionMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenu</span>(<span class="string">&quot;功能&quot;</span>);</span><br><span class="line">        <span class="type">JMenu</span> <span class="variable">aboutMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenu</span>(<span class="string">&quot;关于我们&quot;</span>);</span><br><span class="line">        menubar.add(functionMenu);</span><br><span class="line">        menubar.add(aboutMenu);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加组件</span></span><br><span class="line">        functionMenu.add(switchImg);</span><br><span class="line">        functionMenu.add(replayItem);</span><br><span class="line">        <span class="comment">//functionMenu.add(reloginItem);</span></span><br><span class="line">        functionMenu.add(closeItem);</span><br><span class="line">        switchImg.add(sport);</span><br><span class="line">        switchImg.add(animal);</span><br><span class="line">        switchImg.add(random);</span><br><span class="line">        aboutMenu.add(WechatItem);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加动作监听</span></span><br><span class="line">        sport.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        animal.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        random.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        WechatItem.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        replayItem.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">        closeItem.addActionListener(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//给界面设置菜单</span></span><br><span class="line">        <span class="built_in">this</span>.setJMenuBar(menubar);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initJFrame</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//set界面大小</span></span><br><span class="line">        <span class="built_in">this</span>.setSize(<span class="number">603</span>,<span class="number">680</span>);</span><br><span class="line">        <span class="comment">//set界面标题</span></span><br><span class="line">        <span class="built_in">this</span>.setTitle(<span class="string">&quot;lrx的拼图小游戏&quot;</span>);</span><br><span class="line">        <span class="comment">//居中</span></span><br><span class="line">        <span class="built_in">this</span>.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//界面置顶</span></span><br><span class="line">        <span class="built_in">this</span>.setAlwaysOnTop(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//set关闭游戏方式</span></span><br><span class="line">        <span class="built_in">this</span>.setDefaultCloseOperation(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//取消默认的居中放置图片</span></span><br><span class="line">        <span class="built_in">this</span>.setLayout(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//给整个界面添加键盘监听事件</span></span><br><span class="line">        <span class="built_in">this</span>.addKeyListener(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyTyped</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyPressed</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line">        <span class="comment">//判断游戏是否胜利</span></span><br><span class="line">        <span class="keyword">if</span> (Victory())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//a: 65</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> e.getKeyCode();</span><br><span class="line">        <span class="keyword">if</span> (code == <span class="number">65</span>)&#123;</span><br><span class="line">            <span class="comment">//清空界面</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().removeAll();</span><br><span class="line">            <span class="comment">//加载完整图片</span></span><br><span class="line">            <span class="type">JLabel</span> <span class="variable">all</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(path+<span class="string">&quot;all.jpg&quot;</span>));</span><br><span class="line">            all.setBounds(<span class="number">83</span>,<span class="number">134</span>,<span class="number">420</span>,<span class="number">420</span>);</span><br><span class="line">            <span class="comment">//添加容器</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().add(all);</span><br><span class="line">            <span class="comment">//加载背景图片</span></span><br><span class="line">            <span class="type">JLabel</span> <span class="variable">background</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(<span class="string">&quot;..\\puzzleGame\\image\\background.png&quot;</span>));</span><br><span class="line">            background.setBounds(<span class="number">40</span>,<span class="number">40</span>,<span class="number">508</span>,<span class="number">560</span>);</span><br><span class="line">            <span class="built_in">this</span>.getContentPane().add(background);</span><br><span class="line">            <span class="comment">//刷新界面</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().repaint();</span><br><span class="line">            System.out.println(<span class="string">&quot;查看完整图片&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyReleased</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line">        <span class="comment">//判断游戏是否胜利</span></span><br><span class="line">        <span class="keyword">if</span> (Victory())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//左：37 上：38 右：39 下：40 a: 65 w: 87</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> e.getKeyCode();</span><br><span class="line">        <span class="keyword">if</span> (code == <span class="number">37</span>)&#123;</span><br><span class="line">            imgNumber[x][y] = imgNumber[x][y+<span class="number">1</span>];</span><br><span class="line">            imgNumber[x][y+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            y++;<span class="comment">//更新空槽坐标</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;向左移动 step：&quot;</span>+count);</span><br><span class="line">            initImage();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">38</span>)&#123;</span><br><span class="line">            imgNumber[x][y] = imgNumber[x+<span class="number">1</span>][y];</span><br><span class="line">            imgNumber[x+<span class="number">1</span>][y] = <span class="number">0</span>;</span><br><span class="line">            x++;<span class="comment">//更新空槽坐标</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;向上移动 step：&quot;</span>+count);</span><br><span class="line">            initImage();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">39</span>)&#123;</span><br><span class="line">            imgNumber[x][y] = imgNumber[x][y-<span class="number">1</span>];</span><br><span class="line">            imgNumber[x][y-<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            y--;<span class="comment">//更新空槽坐标</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;向右移动 step：&quot;</span>+count);</span><br><span class="line">            initImage();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">40</span>)&#123;</span><br><span class="line">            imgNumber[x][y] = imgNumber[x-<span class="number">1</span>][y];</span><br><span class="line">            imgNumber[x-<span class="number">1</span>][y] = <span class="number">0</span>;</span><br><span class="line">            x--;<span class="comment">//更新空槽坐标</span></span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;向下移动 step：&quot;</span>+count);</span><br><span class="line">            initImage();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">65</span>)&#123;</span><br><span class="line">            initImage();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">87</span>)&#123;</span><br><span class="line">            imgNumber = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>&#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            initImage();</span><br><span class="line">            System.out.println(<span class="string">&quot;一键通关&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断获胜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">Victory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; imgNumber.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; imgNumber.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (imgNumber[i][j] != win[i][j])</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">        <span class="type">JMenuItem</span> <span class="variable">item</span> <span class="operator">=</span> (JMenuItem) e.getSource();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (item == replayItem)&#123;</span><br><span class="line">            count = <span class="number">0</span>;<span class="comment">//计步器清0</span></span><br><span class="line">            initData();</span><br><span class="line">            initImage();</span><br><span class="line">            System.out.println(<span class="string">&quot;重新游戏&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == WechatItem) &#123;</span><br><span class="line">            <span class="comment">//清空界面</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().removeAll();</span><br><span class="line">            <span class="comment">//加载完整图片</span></span><br><span class="line">            <span class="type">JLabel</span> <span class="variable">about</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(<span class="string">&quot;..\\puzzleGame\\image\\about.jpg&quot;</span>));</span><br><span class="line">            about.setBounds(<span class="number">83</span>,<span class="number">134</span>,<span class="number">420</span>,<span class="number">420</span>);</span><br><span class="line">            <span class="comment">//添加容器</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().add(about);</span><br><span class="line">            <span class="comment">//加载背景图片</span></span><br><span class="line">            <span class="type">JLabel</span> <span class="variable">background</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="keyword">new</span> <span class="title class_">ImageIcon</span>(<span class="string">&quot;..\\puzzleGame\\image\\background.png&quot;</span>));</span><br><span class="line">            background.setBounds(<span class="number">40</span>,<span class="number">40</span>,<span class="number">508</span>,<span class="number">560</span>);</span><br><span class="line">            <span class="built_in">this</span>.getContentPane().add(background);</span><br><span class="line">            <span class="comment">//刷新界面</span></span><br><span class="line">            <span class="built_in">this</span>.getContentPane().repaint();</span><br><span class="line">            System.out.println(<span class="string">&quot;v我50&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == closeItem)&#123;</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断胜利则不执行</span></span><br><span class="line">        <span class="keyword">if</span> (Victory())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (item == sport)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> r.nextInt(<span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">            path = <span class="string">&quot;..\\puzzleGame\\image\\sport\\sport&quot;</span>+index+<span class="string">&quot;\\&quot;</span>;</span><br><span class="line">            count = <span class="number">0</span>;<span class="comment">//计步器清0</span></span><br><span class="line">            initImage();</span><br><span class="line">            System.out.println(<span class="string">&quot;随机运动&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == animal)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> r.nextInt(<span class="number">9</span>) + <span class="number">1</span>;</span><br><span class="line">            path = <span class="string">&quot;..\\puzzleGame\\image\\animal\\animal&quot;</span>+index+<span class="string">&quot;\\&quot;</span>;</span><br><span class="line">            count = <span class="number">0</span>;<span class="comment">//计步器清0</span></span><br><span class="line">            initImage();</span><br><span class="line">            System.out.println(<span class="string">&quot;随机动物&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == random)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">choice</span> <span class="operator">=</span> r.nextInt(<span class="number">2</span>);</span><br><span class="line">            <span class="comment">//随机到beauty</span></span><br><span class="line">            <span class="keyword">if</span> (choice == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> r.nextInt(<span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">                path = <span class="string">&quot;..\\puzzleGame\\image\\sport\\sport&quot;</span>+index+<span class="string">&quot;\\&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//随机到animal</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> r.nextInt(<span class="number">9</span>) + <span class="number">1</span>;</span><br><span class="line">                path = <span class="string">&quot;..\\puzzleGame\\image\\animal\\animal&quot;</span>+index+<span class="string">&quot;\\&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">            initImage();</span><br><span class="line">            System.out.println(<span class="string">&quot;随机任意图片&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Music"><a href="#Music" class="headerlink" title="Music"></a>Music</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//copy的背景音乐类</span></span><br><span class="line"><span class="keyword">package</span> UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.AudioFormat;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.AudioInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.AudioSystem;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.DataLine;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.FloatControl;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.LineUnavailableException;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.SourceDataLine;</span><br><span class="line"><span class="keyword">import</span> javax.sound.sampled.UnsupportedAudioFileException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Music</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">EXTERNAL_BUFFER_SIZE</span> <span class="operator">=</span> <span class="number">524288</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Music</span><span class="params">(String wavFile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileName = wavFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unused&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">soundFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName); <span class="comment">// 播放音乐的文件名</span></span><br><span class="line">        <span class="keyword">if</span> (!soundFile.exists()) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Wave file not found:&quot;</span> + fileName);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="comment">// 设置循环播放</span></span><br><span class="line">            <span class="type">AudioInputStream</span> <span class="variable">audioInputStream</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// 创建音频输入流对象</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                audioInputStream = AudioSystem.getAudioInputStream(soundFile); <span class="comment">// 创建音频对象</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedAudioFileException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">AudioFormat</span> <span class="variable">format</span> <span class="operator">=</span> audioInputStream.getFormat(); <span class="comment">// 音频格式</span></span><br><span class="line">            <span class="type">SourceDataLine</span> <span class="variable">auline</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// 源数据线</span></span><br><span class="line">            DataLine.<span class="type">Info</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataLine</span>.Info(SourceDataLine.class, format);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                auline = (SourceDataLine) AudioSystem.getLine(info);</span><br><span class="line">                auline.open(format);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (LineUnavailableException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (auline.isControlSupported(FloatControl.Type.PAN)) &#123;</span><br><span class="line">                <span class="type">FloatControl</span> <span class="variable">pan</span> <span class="operator">=</span> (FloatControl) auline.getControl(FloatControl.Type.PAN);</span><br><span class="line">            &#125;</span><br><span class="line">            auline.start();</span><br><span class="line">            <span class="type">int</span> <span class="variable">nBytesRead</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span>[] abData = <span class="keyword">new</span> <span class="title class_">byte</span>[EXTERNAL_BUFFER_SIZE];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (nBytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line">                    nBytesRead = audioInputStream.read(abData, <span class="number">0</span>, abData.length);</span><br><span class="line">                    <span class="keyword">if</span> (nBytesRead &gt;= <span class="number">0</span>)</span><br><span class="line">                        auline.write(abData, <span class="number">0</span>, nBytesRead);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                auline.drain();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UI.GameJFrame;</span><br><span class="line"><span class="keyword">import</span> UI.Music;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Music</span> <span class="variable">playWave</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Music</span>(<span class="string">&quot;bgm.wav&quot;</span>);</span><br><span class="line">        playWave.start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GameJFrame</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaSwing </tag>
            
            <tag> 小游戏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaWebCrawler</title>
      <link href="/2022/12/13/JavaWebCrawler/"/>
      <url>/2022/12/13/JavaWebCrawler/</url>
      
        <content type="html"><![CDATA[<h2 id="实验名称：统计英文网页中各单词出现的次数"><a href="#实验名称：统计英文网页中各单词出现的次数" class="headerlink" title="实验名称：统计英文网页中各单词出现的次数"></a>实验名称：统计英文网页中各单词出现的次数</h2><h3 id="实验内容："><a href="#实验内容：" class="headerlink" title="实验内容："></a>实验内容：</h3><p>对于某个给定的英文网页，编写一个处理程序统计该网页中每个单词出现的次数</p><h3 id="要求："><a href="#要求：" class="headerlink" title="要求："></a>要求：</h3><ul><li>输入一个英文网页地址，下载该网页的内容；</li><li>提取该网页中的文本内容；</li><li>统计文本内容中各单词出现的频次，并按降序排列。</li></ul><h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><ul><li>下载该网页的HTML源码并保存至index.html</li><li>利用Jsoup解析HTML，提取出文本内容，并将文本写入text.txt文件</li><li>读取文本内容至str字符串，通过split方法分割str字符串并得到words字符串数组，利用hashmap容器对字符串数组进行单词频次统计，最后将map中的元素放入list集合中进行降序排序</li></ul><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> webCrawler.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadFromURL</span> &#123;</span><br><span class="line"><span class="comment">//读入html代码并保存至index.html文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">crawler</span><span class="params">(String URLSting)</span> &#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">java.net.<span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.net.URL(URLSting);</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(url.openStream());</span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;index.html&quot;</span>));</span><br><span class="line"><span class="keyword">while</span> (input.hasNext()) &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">writer.write(line);</span><br><span class="line">writer.newLine();</span><br><span class="line">&#125;</span><br><span class="line">input.close();</span><br><span class="line">writer.close();</span><br><span class="line">System.out.println(<span class="string">&quot;index.html保存成功&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(java.net.MalformedURLException e)&#123;</span><br><span class="line">System.err.println(<span class="string">&quot;URL Error: &quot;</span> + e.getMessage());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">System.err.println(<span class="string">&quot;IO Error：&quot;</span>+ e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提取html中的文本内容 并保存至text.txt文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">toText</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">FileWriter</span> <span class="variable">filewriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;text.txt&quot;</span>);</span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(filewriter);</span><br><span class="line">text = Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;index.html&quot;</span>)).text();</span><br><span class="line">writer.write(text);</span><br><span class="line">writer.close();</span><br><span class="line">System.out.println(<span class="string">&quot;text.txt保存成功&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统计文本内容</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">wordsStatistics</span><span class="params">()</span> &#123;</span><br><span class="line">Map&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Integer&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;text.txt&quot;</span>));</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">reader.close();</span><br><span class="line"><span class="comment">//分割字符串</span></span><br><span class="line">String[] words = str.split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">System.out.println(words.length + <span class="string">&quot; words&quot;</span>);</span><br><span class="line"><span class="comment">//统计单词</span></span><br><span class="line"><span class="keyword">for</span> (String s : words) &#123;</span><br><span class="line"><span class="keyword">if</span> (!map.containsKey(s)) &#123;</span><br><span class="line">map.put(s, <span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">map.put(s, map.get(s)+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将map的entryset放入list集合</span></span><br><span class="line">List&lt;Map.Entry&lt;String,Integer&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.entrySet()); </span><br><span class="line"><span class="comment">//对list进行排序，并通过Comparator传入自定义的排序规则</span></span><br><span class="line">Collections.sort(list,<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Map.Entry&lt;String, Integer&gt;&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Entry&lt;String, Integer&gt; o1, Entry&lt;String, Integer&gt; o2)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> o2.getValue() - o1.getValue(); <span class="comment">//重写排序规则</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//遍历list</span></span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String,Integer&gt; entry : list) &#123;</span><br><span class="line">System.out.println(entry);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">System.out.println(<span class="string">&quot;Enter a URL: &quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">scanner.close();</span><br><span class="line">crawler(URL);</span><br><span class="line">toText();</span><br><span class="line">wordsStatistics();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jsoup </tag>
            
            <tag> webCrawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022/12/4蓝桥杯模拟赛</title>
      <link href="/2022/12/04/%E8%93%9D%E6%A1%A5%E6%9D%AF%E7%BB%83%E4%B9%A0%E8%B5%9B20221204/"/>
      <url>/2022/12/04/%E8%93%9D%E6%A1%A5%E6%9D%AF%E7%BB%83%E4%B9%A0%E8%B5%9B20221204/</url>
      
        <content type="html"><![CDATA[<h3 id="1"><a href="#1" class="headerlink" title="#1"></a>#1</h3><p><strong>问题描述</strong><br>　　请找到一个大于 2022 的最小数，这个数转换成二进制之后，最低的 6 个二进制为全为 0 。<br>　　请将这个数的十进制形式作为答案提交。<br><strong>答案提交</strong><br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。</p><blockquote><p>答案：2048（用计算器程序员模式）</p></blockquote><h3 id="2"><a href="#2" class="headerlink" title="#2"></a>#2</h3><p><strong>问题描述</strong><br>　　我们计从 1949 年 10 月 1 日至 1949 年 10 月 2 日为经过了 1 天。<br>　　请问从 1949 年 10 月 1 日至 2022 年 1 月 1 日经过了多少天？<br><strong>答案提交</strong><br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。</p><blockquote><p>26390（用Excel很方便计算）</p></blockquote><h3 id="3"><a href="#3" class="headerlink" title="#3"></a>#3</h3><p><strong>问题描述</strong><br>　　8518 是一个非常特殊的数，如果把这个数看成 16 进制数，它的值为 (8518)16=8<em>16</em>16<em>16+5</em>16<em>16+1</em>16+8=34072，而 34072 正好是 8518 的整数倍。<br>　　9558 也是这样一个数，当看成 16 进制时是 38232。<br>　　其实长度为 1 的数 0 到 9 都满足看成 16 进制后是自己的整数倍（1倍）。<br>　　请问，除开长度为 1 的数，最小的满足这样条件的数是多少？<br><strong>答案提交</strong><br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (num)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = num % <span class="number">10</span>;</span><br><span class="line">        num /= <span class="number">10</span>;</span><br><span class="line">        ans += temp * <span class="built_in">pow</span>(<span class="number">16</span>, p);</span><br><span class="line">        p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">10</span>; ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="built_in">f</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (t % i == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; i;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>1038</p></blockquote><h3 id="4"><a href="#4" class="headerlink" title="#4"></a>#4</h3><p><strong>问题描述</strong><br>　　小蓝有一个 30 行 60 列的数字矩阵，矩阵中的每个数都是 0 到 9 之间的数字。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">174094882455171152761423221685761892795431233411387427793198</span><br><span class="line">650286024865090061389344606618496378829135984076361542097372</span><br><span class="line">601657541200146071777733599818266038012509478351201640618984</span><br><span class="line">143988087783837107349651099683484992553337438088068198972282</span><br><span class="line">890781586124258626539246182119762952003918195325258677229419</span><br><span class="line">698255491250839396799769357665825441616335532825361862146291</span><br><span class="line">503649293440596342887581257444442930778730382520372975343211</span><br><span class="line">325351222640703400531067500454956482168314849207060705673849</span><br><span class="line">265774579830223671554026061117300483012903885770893074783710</span><br><span class="line">083450145620356667677191627276513995926532444279237315785832</span><br><span class="line">411595106453089134746365281031552217482363035280722591085079</span><br><span class="line">053410485925413958279617719034175332412908745680774313630190</span><br><span class="line">429314820559328748143552689295945058801322270313370955837837</span><br><span class="line">939182801848609300876356583948397645861551964542532682663945</span><br><span class="line">625356614462682551015176002433628234343684739800880514363921</span><br><span class="line">982340231989891351425389287014819359798014755509282450440511</span><br><span class="line">590838726938103384801541373585690893606978941566666714061214</span><br><span class="line">952341523168827712604946036245881214982452998386986623826275</span><br><span class="line">782780208928205527678781609589000725521486468983551558405472</span><br><span class="line">149903035076783644195574734088152324666290493119955560594634</span><br><span class="line">905391288186024902215444250421277955403412298227858394469856</span><br><span class="line">607272647132163832860126054679347881638761723785858733108109</span><br><span class="line">249157334220127702410373959720286708183036202841837581704881</span><br><span class="line">367895556630088230650972282944827258473951902831431040790814</span><br><span class="line">079538232104075905120989173307660289899942087873076421916033</span><br><span class="line">622143260549608274076012938515668898707915863945382394851328</span><br><span class="line">164677964192631597026176253407553188801750590935427267220117</span><br><span class="line">591817866992665840378311257621611574856498432538327068011953</span><br><span class="line">631534031790352912617015229051836886166704989498756486878095</span><br><span class="line">690013558017746707412183571476823027885971347137127534455141</span><br></pre></td></tr></table></figure><br>　　现在小蓝想从这个矩阵的第一行第一列画一条折线到第 30 行 60 列，线只能沿水平向右走或竖直向下走，只能在有数字的地方拐弯。小蓝想知道，这样一条线经过的数字的和最大是多少。<br><strong>答案提交</strong><br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dfs</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> direct[<span class="number">2</span>][<span class="number">2</span>] = &#123; &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125; &#125;;<span class="comment">//向右 向下</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">35</span>][<span class="number">65</span>];</span><br><span class="line"><span class="type">int</span> map[<span class="number">35</span>][<span class="number">65</span>];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">string s;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> col, <span class="type">int</span> tempAns)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (row == <span class="number">29</span> &amp;&amp; col == <span class="number">59</span>)</span><br><span class="line">&#123;</span><br><span class="line">ans = <span class="built_in">max</span>(ans, tempAns);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> new_row = row + direct[i][<span class="number">0</span>];</span><br><span class="line"><span class="type">int</span> new_col = col + direct[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (new_row &gt;= <span class="number">0</span> &amp;&amp; new_row &lt; <span class="number">30</span> &amp;&amp; new_col &gt;= <span class="number">0</span> &amp;&amp; new_col &lt; <span class="number">60</span>)</span><br><span class="line">&#123;</span><br><span class="line">tempAns += a[new_row][new_col];</span><br><span class="line"><span class="built_in">dfs</span>(new_row, new_col, tempAns);</span><br><span class="line"><span class="comment">//回溯</span></span><br><span class="line">tempAns -= a[new_row][new_col];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line"><span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">cin &gt;&gt; s;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">60</span>; j++)</span><br><span class="line">a[i][j] = s[p++] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">dfs</span>(<span class="number">0</span>, <span class="number">0</span>, a[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">cout &lt;&lt; ans;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>没跑出来…</p></blockquote><h3 id="5"><a href="#5" class="headerlink" title="#5"></a>#5</h3><p><strong>问题描述</strong><br>　　将 2022 拆分成不同的质数的和，请问最多拆分成几个？<br><strong>答案提交</strong><br>　　这是一道结果填空的题，你只需要算出结果后提交即可。本题的结果为一个整数，在提交答案时只填写这个整数，填写多余的内容将无法得分。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//思路：从小到大累加质数直到超过2022 同时打印累加的质数</span></span><br><span class="line"><span class="comment">//算出累加结果与2022的差，减去部分质数去抵消差</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    a.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num = <span class="number">3</span>; num &lt;= <span class="number">2022</span>; num += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= <span class="built_in">sqrt</span>(num); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (num % i == <span class="number">0</span>) &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">            a.<span class="built_in">push_back</span>(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">initA</span>();</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; sum &lt;= <span class="number">2022</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        sum += a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; sum &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sum - 2022 = &quot;</span> &lt;&lt; sum - <span class="number">2022</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; i;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97 101 103 107 109 113 127 131 137 139</span><br><span class="line">2127</span><br><span class="line">sum - 2022 = 105</span><br><span class="line">34</span><br></pre></td></tr></table></figure></p><blockquote><p>显然105仅由一个质数无法组成，而105=2+103 刚好能通过两个质数抵消sum与2022的差 故答案为34-2=<strong>32</strong></p></blockquote><h3 id="6"><a href="#6" class="headerlink" title="#6"></a>#6</h3><p><strong>问题描述</strong><br>　　小蓝正在拷贝一份文件，他现在已经拷贝了 t 秒时间，已经拷贝了 c 字节，文件总共有 s 字节，如果拷贝是匀速进行的，请问小蓝大概还需要拷贝多少秒？<br>输入格式<br>　　输入一行包含三个整数 t, c, s，相邻两个整数之间用一个空格分隔。<br>输出格式<br>　　输出一个整数，表示答案。数据保证答案正好是整数。<br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 10 20</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 14 21</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">15</span><br></pre></td></tr></table></figure><br>评测用例规模与约定<br>　　对于 50% 的评测用例，1 &lt;= t, c, s &lt;= 10000。<br>　　对于所有评测用例，1 &lt;= t, c, s &lt;= 1000000000</p><blockquote><p>略</p></blockquote><h3 id="7"><a href="#7" class="headerlink" title="#7"></a>#7</h3><p><strong>问题描述</strong><br>　　小蓝有 n 个单词，但是单词中有一些是重复的，请帮小蓝去除重复的单词。<br>输入格式<br>　　输入第一行包含一个正整数 n ，表示小蓝的单词数量。<br>　　接下来 n 行，每行包含一个由小写字母组成的单词。<br>输出格式<br>　　请输出去除重复后的那些单词。如果一个单词出现了多遍，请保留第一次出现的单词，去除之后出现的单词，按输入的顺序输出。<br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">lanqiao</span><br><span class="line">hi</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">lanqiao</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lanqiao</span><br><span class="line">hi</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><br>评测用例规模与约定<br>　　对于所有评测用例，1 &lt;= n &lt;= 100，每个单词的长度不超过 100。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">vector&lt;string&gt; a;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span> (n--)</span><br><span class="line">    &#123;</span><br><span class="line">        string s;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;<span class="comment">//未重复</span></span><br><span class="line">        cin &gt;&gt; s;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> temp : a)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (temp == s)&#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">        &#123;</span><br><span class="line">            a.<span class="built_in">push_back</span>(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : a)</span><br><span class="line">        cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8"><a href="#8" class="headerlink" title="#8"></a>#8</h3><p><strong>问题描述</strong><br>　　一个字符串如果从左向右读和从右向左读相同，则称为一个回文串，例如 lanqiaoaiqnal 是一个回文串。<br>　　小蓝有一个字符串，请将这个字符串右边加上一些字符，使其成为一个回文串。<br>　　如果有多种方案，请输出最短的回文串。<br>输入格式<br>　　输入一行包含一个字符串，由小写英文字母组成。<br>输出格式<br>　　输出一行包含答案。<br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lanqiao</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lanqiaoaiqnal</span><br></pre></td></tr></table></figure><br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">banana</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bananab</span><br></pre></td></tr></table></figure><br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noon</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noon</span><br></pre></td></tr></table></figure><br>评测用例规模与约定<br>　　对于所有评测用例，1 &lt;= 字符串长度 &lt;= 100。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>()/<span class="number">2</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] != s[s.<span class="built_in">size</span>()<span class="number">-1</span>-i])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    cin &gt;&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">check</span>(s))</span><br><span class="line">        cout &lt;&lt; s;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//截止字符</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            string temps = s;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">                temps.<span class="built_in">push_back</span>(s[j]);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(temps))</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; temps;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-1"><a href="#8-1" class="headerlink" title="#8"></a>#8</h3><p><strong>问题描述</strong><br>　　给定一个字母矩阵。一个 X 图形由中心点和由中心点向四个45度斜线方向引出的直线段组成，四条线段的长度相同，而且四条线段上的字母和中心点的字母相同。<br>　　一个 X图形可以使用三个整数 r, c, L 来描述，其中 r, c 表示中心点位于第 r 行第 c 列，正整数 L 表示引出的直线段的长度。 对于 1 到 L 之间的每个整数 i，X图形满足：第 r-i 行第 c-i 列与第 r 行第 c 列相同，第 r-i 行第 c+i 列与第 r 行第 c 列相同，第 r+i 行第 c-i 列与第 r 行第 c 列相同，第 r+i 行第 c+i 列与第 r 行第 c 列相同。<br>　　例如，对于下面的字母矩阵中，所有的字母 L 组成一个 X图形，其中中间的 5 个 L 也组成一个 X图形。所有字母 Q 组成了一个 X图形。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LAAALA</span><br><span class="line">ALQLQA</span><br><span class="line">AALQAA</span><br><span class="line">ALQLQA</span><br><span class="line">LAAALA</span><br></pre></td></tr></table></figure><br>　　给定一个字母矩阵，请求其中有多少个 X图形。<br>输入格式<br>　　输入第一行包含两个整数 n, m，分别表示字母矩阵的行数和列数。<br>　　接下来 n 行，每行 m 个大写字母，为给定的矩阵。<br>输出格式<br>　　输出一行，包含一个整数，表示答案。<br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5 6</span><br><span class="line">LAAALA</span><br><span class="line">ALQLQA</span><br><span class="line">AALQAA</span><br><span class="line">ALQLQA</span><br><span class="line">LAAALA</span><br></pre></td></tr></table></figure></p><p>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure></p><p>评测用例规模与约定<br>　　对于 50% 的评测用例，1 &lt;= n, m &lt;= 10。<br>　　对于所有评测用例，1 &lt;= n, m &lt;= 100。</p><h3 id="10"><a href="#10" class="headerlink" title="#10"></a>#10</h3><p><strong>问题描述</strong><br>　　小蓝有一个序列 a[1], a[2], …, a[n]，每次可以交换相邻的两个元素，代价为两个元素中较大的那个。<br>　　请问，要通过交换将序列变为从小到大递增的序列，总代价最少为多少？<br>输入格式<br>　　输入一行包含一个整数 n ，表示序列长度。<br>　　第二行包含 n 个整数，表示给定的序列。<br>输出格式<br>　　输出一行包含一个整数，表示最少代价的值。<br>样例输入<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 5 2 1</span><br></pre></td></tr></table></figure><br>样例输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12</span><br></pre></td></tr></table></figure><br>评测用例规模与约定<br>　　对于 30% 的评测用例，1 &lt;= n &lt;= 1000, 1 &lt;= a[i] &lt;= 1000。<br>　　对于 60% 的评测用例，1 &lt;= n &lt;= 50000, 1 &lt;= a[i] &lt;= 50000。<br>　　对于所有评测用例，1 &lt;= n &lt;= 1000000, 1 &lt;= a[i] &lt;= 1000000。</p>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 进制转换 </tag>
            
            <tag> dfs </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 字符串 </tag>
            
            <tag> 逆序对 </tag>
            
            <tag> 树状数组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>221第十四周SQL练习题</title>
      <link href="/2022/12/02/221%E7%AC%AC%E5%8D%81%E5%9B%9B%E5%91%A8%E7%BB%83%E4%B9%A0%E9%A2%98/"/>
      <url>/2022/12/02/221%E7%AC%AC%E5%8D%81%E5%9B%9B%E5%91%A8%E7%BB%83%E4%B9%A0%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="习题一"><a href="#习题一" class="headerlink" title="习题一"></a>习题一</h2><p>设有一个 SPJ 数据库，包括 S、P、J、SPJ4 个关系模式：</p><blockquote><p>S ( SNO, SNAME, STATUS, CITY );<br>P ( PNO, PNAME, COLOR, WEIGHT );<br>J ( JNO, JNAME, CITY );<br>SPJ ( SNO, PNO, JNO, QTY );</p></blockquote><ul><li>供应商表 S 由供应商代码（SNO）、供应商姓名（SNAME）、供应商状态（STATUS）、供应商所在城市（CITY）组成。</li><li>零件表 P 由零件代码（PNO）、零件名（PNAME）、颜色（COLOR）、重量（WEIGHT）组成。</li><li>工程项目表 J 由工程项目代码（JNO）、工程项目名（JNAME）、工程项目所在城市（CITY）组成。</li><li>供应情况表 SPJ 由供应商代码（SNO）、零件代码（PNO）、工程项目代码（JNO）、供应数量（QTY）组成，表示某供应商供应某种零件给某工程项目的数量为 QTY。</li></ul><p>今有若干数据如下：<br><img src="https://s1.ax1x.com/2022/11/30/zw7hTJ.png" alt=""></p><p>建表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*建立S表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> S(</span><br><span class="line">SNO <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">SNAME <span class="type">CHAR</span>(<span class="number">24</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">STATUS <span class="type">INT</span>(<span class="number">4</span>),</span><br><span class="line">CITY <span class="type">CHAR</span>(<span class="number">16</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*P表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> P(</span><br><span class="line">PNO <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">PNAME <span class="type">CHAR</span>(<span class="number">24</span>),</span><br><span class="line">COLOR <span class="type">CHAR</span>(<span class="number">8</span>),</span><br><span class="line">WEIGHT <span class="type">INT</span>(<span class="number">4</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*J表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> J(</span><br><span class="line">JNO <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">JNAME <span class="type">CHAR</span>(<span class="number">24</span>),</span><br><span class="line">CITY <span class="type">CHAR</span>(<span class="number">16</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*spj表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SPJ(</span><br><span class="line">SNO <span class="type">CHAR</span>(<span class="number">9</span>),</span><br><span class="line">PNO <span class="type">CHAR</span>(<span class="number">9</span>),</span><br><span class="line">JNO <span class="type">CHAR</span>(<span class="number">9</span>),</span><br><span class="line">QTY <span class="type">INT</span>(<span class="number">6</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY(SNO,PNO,JNO),</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(SNO) <span class="keyword">REFERENCES</span> S(SNO),</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(PNO) <span class="keyword">REFERENCES</span> P(PNO),</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(JNO) <span class="keyword">REFERENCES</span> J(JNO)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*S表添加数据*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> S <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>,<span class="string">&#x27;精益&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> S <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>,<span class="string">&#x27;盛锡&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> S <span class="keyword">VALUES</span>(<span class="string">&#x27;S3&#x27;</span>,<span class="string">&#x27;东方红&#x27;</span>,<span class="number">30</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> S <span class="keyword">VALUES</span>(<span class="string">&#x27;S4&#x27;</span>,<span class="string">&#x27;丰泰盛&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> S <span class="keyword">VALUES</span>(<span class="string">&#x27;S5&#x27;</span>,<span class="string">&#x27;为民&#x27;</span>,<span class="number">30</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*P表添加数据*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P1&#x27;</span>,<span class="string">&#x27;螺母&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="number">12</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P2&#x27;</span>,<span class="string">&#x27;螺栓&#x27;</span>,<span class="string">&#x27;绿&#x27;</span>,<span class="number">17</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P3&#x27;</span>,<span class="string">&#x27;螺丝刀&#x27;</span>,<span class="string">&#x27;蓝&#x27;</span>,<span class="number">14</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P4&#x27;</span>,<span class="string">&#x27;螺丝刀&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="number">14</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P5&#x27;</span>,<span class="string">&#x27;凸轮&#x27;</span>,<span class="string">&#x27;蓝&#x27;</span>,<span class="number">40</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> P <span class="keyword">VALUES</span>(<span class="string">&#x27;P6&#x27;</span>,<span class="string">&#x27;齿轮&#x27;</span>,<span class="string">&#x27;红&#x27;</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*J表添加数据*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J1&#x27;</span>,<span class="string">&#x27;三建&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J2&#x27;</span>,<span class="string">&#x27;一汽&#x27;</span>,<span class="string">&#x27;长春&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J3&#x27;</span>,<span class="string">&#x27;弹簧厂&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J4&#x27;</span>,<span class="string">&#x27;造船厂&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J5&#x27;</span>,<span class="string">&#x27;机车厂&#x27;</span>,<span class="string">&#x27;唐山&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J6&#x27;</span>,<span class="string">&#x27;无线电厂&#x27;</span>,<span class="string">&#x27;常州&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> J <span class="keyword">VALUES</span>(<span class="string">&#x27;J7&#x27;</span>,<span class="string">&#x27;半导体厂&#x27;</span>,<span class="string">&#x27;南京&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*SPJ表添加数据*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P1&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P1&#x27;</span>, <span class="string">&#x27;J3&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P1&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">700</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P2&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">700</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P2&#x27;</span>, <span class="string">&#x27;J2&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">400</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J2&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">500</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J5&#x27;</span>,<span class="number">400</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P5&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">400</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P5&#x27;</span>, <span class="string">&#x27;J2&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;P1&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;P5&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;P6&#x27;</span>, <span class="string">&#x27;J3&#x27;</span>,<span class="number">300</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;P6&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;P2&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;P3&#x27;</span>, <span class="string">&#x27;J1&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;P6&#x27;</span>, <span class="string">&#x27;J2&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;P6&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">500</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;P2&#x27;</span>, <span class="string">&#x27;J4&#x27;</span>,<span class="number">700</span>);</span><br></pre></td></tr></table></figure><p>试用SQL语句写出如下查询：</p><ol><li>求供应工程J1零件的供应商号码SNO。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> SNO </span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="operator">=</span> <span class="string">&#x27;J1&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>求供应工程J1零件P1的供应商号码SNO。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO </span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="operator">=</span> <span class="string">&#x27;J1&#x27;</span> <span class="keyword">AND</span> PNO <span class="operator">=</span> <span class="string">&#x27;P1&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>求供应工程J1零件为红色的供应商号码SNO。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*写法1：*/</span></span><br><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> PNO </span><br><span class="line"><span class="keyword">FROM</span> P</span><br><span class="line"><span class="keyword">WHERE</span> COLOR <span class="operator">=</span> <span class="string">&#x27;红&#x27;</span></span><br><span class="line">) t1,(</span><br><span class="line"><span class="keyword">SELECT</span> SNO, PNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="operator">=</span> <span class="string">&#x27;J1&#x27;</span></span><br><span class="line">) t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.PNO <span class="operator">=</span> t2.PNO;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*写法2：*/</span></span><br><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ,P</span><br><span class="line"><span class="keyword">WHERE</span> JNO<span class="operator">=</span><span class="string">&#x27;J1&#x27;</span> <span class="keyword">AND</span> P.COLOR<span class="operator">=</span><span class="string">&#x27;红&#x27;</span> <span class="keyword">AND</span> SPJ.PNO<span class="operator">=</span>P.PNO;</span><br></pre></td></tr></table></figure><blockquote><p>思考：1.在网上看到很多这样的文章，在进行多表查询的时候，<strong>用小表或者交叉表做基础表，放在后面</strong>，大表放在from后面的位置，因为<strong>表的访问顺序是从右往左的</strong>，这样查询效率更高。（mysql sql优化器会对sql的表的连接顺序做一定的优化） 2.<strong>WHERE</strong>后面<strong>将筛选掉数据多的条件放前面</strong>（执行顺序左到右）</p></blockquote><ol><li>求没有使用天津供应商生产的红色零件的工程号。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*写法1：*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> JNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> JNO</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> CITY <span class="operator">=</span> <span class="string">&#x27;天津&#x27;</span></span><br><span class="line">) t1,(</span><br><span class="line"><span class="keyword">SELECT</span> SNO, PNO, JNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line">) t2,(</span><br><span class="line"><span class="keyword">SELECT</span> PNO</span><br><span class="line"><span class="keyword">FROM</span> P</span><br><span class="line"><span class="keyword">WHERE</span> COLOR <span class="operator">=</span> <span class="string">&#x27;红&#x27;</span></span><br><span class="line">) t3</span><br><span class="line"><span class="keyword">WHERE</span> t1.SNO <span class="operator">=</span> t2.SNO <span class="keyword">AND</span> t2.PNO <span class="operator">=</span> t3.PNO</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">写法<span class="number">2</span>：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> JNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="keyword">NOT</span> <span class="keyword">IN</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> JNO</span><br><span class="line">    <span class="keyword">FROM</span> SPJ, P, S</span><br><span class="line">    <span class="keyword">WHERE</span> S.CITY<span class="operator">=</span><span class="string">&#x27;天津&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> SPJ.SNO<span class="operator">=</span>S.SNO</span><br><span class="line">    <span class="keyword">AND</span> SPJ.PNO<span class="operator">=</span>P.PNO </span><br><span class="line">    <span class="keyword">AND</span> P.COLOR<span class="operator">=</span><span class="string">&#x27;红&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li><strong>求至少用了供应商S2所供应的全部零件的工程号JNO。</strong> </li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> jno</span><br><span class="line"><span class="keyword">FROM</span> spj spjz</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> spj spjx</span><br><span class="line"><span class="keyword">WHERE</span> spjx.sno <span class="operator">=</span> <span class="string">&#x27;S2&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> spj spjy</span><br><span class="line"><span class="keyword">WHERE</span> spjy.pno <span class="operator">=</span> spjx.pno <span class="keyword">AND</span> spjy.jno <span class="operator">=</span> spjz.jno</span><br><span class="line">)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li>找出所有供应商的姓名和所在城市。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNAME, CITY </span><br><span class="line"><span class="keyword">FROM</span> S;</span><br></pre></td></tr></table></figure></li><li>找出所有零件的名称、颜色、重量。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PNAME, COLOR, WEIGHT </span><br><span class="line"><span class="keyword">FROM</span> P;</span><br></pre></td></tr></table></figure></li><li>找出所有工程项目名及所在城市。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> JCITY</span><br><span class="line"><span class="keyword">FROM</span> J;</span><br></pre></td></tr></table></figure><ol><li>找出使用供应商S3所供应零件的工程号码。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> JNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> SNO <span class="operator">=</span> <span class="string">&#x27;S3&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>找出工程项目J2使用的各种零件的名称及其数量。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PNAME, QTY</span><br><span class="line"><span class="keyword">FROM</span> SPJ, P</span><br><span class="line"><span class="keyword">WHERE</span> SPJ.PNO <span class="operator">=</span> P.PNO <span class="keyword">AND</span> JNO <span class="operator">=</span> <span class="string">&#x27;J2&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>找出上海厂商供应的所有零件的号码。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> PNO </span><br><span class="line"><span class="keyword">FROM</span> SPJ </span><br><span class="line"><span class="keyword">WHERE</span> SNO <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> CITY <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li>找出使用北京产的零件的工程名称。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> JNO </span><br><span class="line"><span class="keyword">FROM</span> SPJ </span><br><span class="line"><span class="keyword">WHERE</span> SNO <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> CITY <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>找出没有使用天津产的零件的工程号码</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> JNO </span><br><span class="line"><span class="keyword">FROM</span> SPJ </span><br><span class="line"><span class="keyword">WHERE</span> JNO <span class="keyword">NOT</span> <span class="keyword">IN</span>(</span><br><span class="line"><span class="keyword">SELECT</span> JNO</span><br><span class="line"><span class="keyword">FROM</span> SPJ, S</span><br><span class="line"><span class="keyword">WHERE</span> CITY <span class="operator">=</span> <span class="string">&#x27;天津&#x27;</span> <span class="keyword">AND</span> SPJ.SNO <span class="operator">=</span> S.SNO</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li>把全部红色零件的颜色改成绿色</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> P </span><br><span class="line"><span class="keyword">SET</span> COLOR <span class="operator">=</span> <span class="string">&#x27;绿&#x27;</span> </span><br><span class="line"><span class="keyword">WHERE</span> COLOR<span class="operator">=</span><span class="string">&#x27;红&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>由S5供给J4的零件P6改为用S3供应。请作必要的修改</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> SPJ</span><br><span class="line"><span class="keyword">SET</span> SNO <span class="operator">=</span> <span class="string">&#x27;S3&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> SNO<span class="operator">=</span><span class="string">&#x27;S5&#x27;</span> <span class="keyword">AND</span> PNO<span class="operator">=</span><span class="string">&#x27;P6&#x27;</span> <span class="keyword">AND</span> JNO <span class="operator">=</span> <span class="string">&#x27;J4&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>从供应商关系中删除S2的记录，并从供应情况关系中删除相应记录</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> SNO <span class="operator">=</span> <span class="string">&#x27;S2&#x27;</span>;</span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> SPJ</span><br><span class="line"><span class="keyword">WHERE</span> SNO <span class="operator">=</span> <span class="string">&#x27;S2&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>请将(S2,J6,P4,100)插入供应情况关系</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SPJ <span class="keyword">VALUES</span>(<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;P4&#x27;</span>, <span class="string">&#x27;J6&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure><ol><li>请为三建工程项目建立一个供应情况的视图，包括供应商代码（SNO）、零件代码（PNO）、供应数量（QTY）。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> v1 <span class="keyword">AS</span>(</span><br><span class="line"><span class="keyword">SELECT</span> SNO, PNO, QTY</span><br><span class="line"><span class="keyword">FROM</span> SPJ, J</span><br><span class="line"><span class="keyword">WHERE</span> SPJ.JNO <span class="operator">=</span> J.JNO <span class="keyword">AND</span> JNAME <span class="operator">=</span> <span class="string">&#x27;三建&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li>针对18题的视图，找出三建工程项目使用的各种零件代码及其数量。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> PNO, QTY</span><br><span class="line"><span class="keyword">FROM</span> v1;</span><br></pre></td></tr></table></figure><ol><li>针对18题的视图，找出供应商S1的供应情况。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> v1</span><br><span class="line"><span class="keyword">WHERE</span> SNO<span class="operator">=</span><span class="string">&#x27;S1&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="习题二："><a href="#习题二：" class="headerlink" title="习题二："></a>习题二：</h2><p>假设有下面两个关系模式：</p><blockquote><p>职工(职工号,姓名,年龄,职务,工资,部门号)，其中职工号为主码；<br>部门(部门号,名称,经理名,地址,电话)，其中部门号为主码。</p></blockquote><p>用SQL语言定义这两个关系模式，要求在模式中完成以下完整性约束条件的定义：<br>约束1：定义每个模式的主码；<br>约束2：<strong>定义参照完整性；</strong><br>约束3：<strong>定义职工年龄不得超过50岁。</strong></p><ol><li>定义关系模式：职工(职工号,姓名,年龄,职务,工资,部门号)，其中职工号为主码；</li><li>定义关系模式：部门(部门号,名称,经理名,电话)，其中部门号为主码；</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span> 部门(</span><br><span class="line">    部门号 <span class="type">Char</span>(<span class="number">10</span>) <span class="keyword">Primary</span> Key,</span><br><span class="line">    名称 <span class="type">Char</span>(<span class="number">10</span>),</span><br><span class="line">    经理名 <span class="type">Char</span>(<span class="number">10</span>),</span><br><span class="line">    电话 <span class="type">Char</span>(<span class="number">11</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span> 职工(</span><br><span class="line">    职工号 <span class="type">Char</span>(<span class="number">10</span>) <span class="keyword">Primary</span> Key,</span><br><span class="line">    姓名 <span class="type">Char</span>(<span class="number">10</span>),</span><br><span class="line">    年龄 <span class="type">Char</span>(<span class="number">2</span>) <span class="keyword">Check</span>(年龄 <span class="operator">&lt;=</span> <span class="number">60</span>),</span><br><span class="line">    职务 <span class="type">Char</span>(<span class="number">10</span>),</span><br><span class="line">    工资 <span class="type">Char</span>(<span class="number">6</span>),</span><br><span class="line">    部门号 <span class="type">Char</span>(<span class="number">10</span>),</span><br><span class="line">    <span class="keyword">Foreign</span> Key(部门号) <span class="keyword">References</span> 部门(部门号)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="习题三："><a href="#习题三：" class="headerlink" title="习题三："></a>习题三：</h2><p>假设有下面两个关系模式：</p><blockquote><p>职工(职工号,姓名,年龄,职务,工资,部门号)<br>部门(部门号,名称,经理名,地址,电话)</p></blockquote><p>使用SQL的GRANT和REVOKE语句（加上视图机制）完成以下授权定义或存取控制功能：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Dept (</span><br><span class="line">Dno <span class="type">CHAR</span> (<span class="number">10</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">Dname <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line">Mname <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line">Address <span class="type">CHAR</span> (<span class="number">20</span>),</span><br><span class="line">Tel <span class="type">CHAR</span> (<span class="number">11</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Staff (</span><br><span class="line">Sno <span class="type">CHAR</span> (<span class="number">10</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">Sname <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line">Sage <span class="type">CHAR</span> (<span class="number">2</span>) <span class="keyword">CHECK</span> (Sage <span class="operator">&lt;=</span> <span class="number">60</span>),</span><br><span class="line">Post <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line">Pay <span class="type">CHAR</span> (<span class="number">6</span>),</span><br><span class="line">Dno <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (Dno) <span class="keyword">REFERENCES</span> Dept (Dno)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 王明 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 李勇 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 刘星 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 张新 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 周平 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> 杨兰 IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>用户王明对两个表有SELECT权限。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> dept</span><br><span class="line"><span class="keyword">TO</span> 王明;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff</span><br><span class="line"><span class="keyword">TO</span> 王明;</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>不能写成：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> dept,staff</span><br><span class="line"><span class="keyword">TO</span> 王明;</span><br></pre></td></tr></table></figure><br>↑ 语法报错</p></blockquote><ol><li>用户李勇对两个表有INSERT和DELETE权限。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span>,<span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> dept</span><br><span class="line"><span class="keyword">TO</span> 李勇;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span>,<span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff</span><br><span class="line"><span class="keyword">TO</span> 李勇;</span><br></pre></td></tr></table></figure><ol><li><strong>每个职工只对自己的记录有SELECT权限</strong></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff </span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">USER</span>()<span class="operator">=</span> Sname</span><br><span class="line"><span class="keyword">TO</span> <span class="keyword">ALL</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ALL指代所有用户，事实上mysql不能这样写</p><ol><li>用户刘星对职工表有SELECT权限，对工资字段具有UPDATE权限。</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span>(Pay)</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff</span><br><span class="line"><span class="keyword">TO</span> 刘星;</span><br></pre></td></tr></table></figure><ol><li>用户张新具有修改这两个表的结构的权限。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALTER</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff <span class="keyword">TO</span> 张新;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALTER</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> dept <span class="keyword">TO</span> 张新;</span><br></pre></td></tr></table></figure><ol><li>用户周平具有对两个表的所有权限(读、插、改、删数据)，并具有给其他用户授权的权限。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> staff <span class="keyword">TO</span> 周平</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> dept <span class="keyword">TO</span> 周平</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br></pre></td></tr></table></figure><h2 id="习题四："><a href="#习题四：" class="headerlink" title="习题四："></a>习题四：</h2><p>对下列两个关系模式：<br>学生(学号，姓名，年龄，性别，家庭住址，班级号)<br>班级(班级号，班级名，班主任，班长)<br>使用GRANT 语句完成下列授权功能：</p><ol><li>授予用户U1对两个表的所有权限，并可给其他用户授权。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES</span><br><span class="line"><span class="keyword">ON</span> Class</span><br><span class="line"><span class="keyword">TO</span> U1</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION；</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES</span><br><span class="line"><span class="keyword">ON</span> Student</span><br><span class="line"><span class="keyword">TO</span> U1</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION；</span><br></pre></td></tr></table></figure></li><li>授予用户U2对学生表具有查看权限,对家庭住址具有更新权限。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span>(Saddress)</span><br><span class="line"><span class="keyword">ON</span> Student</span><br><span class="line"><span class="keyword">TO</span> U2；</span><br></pre></td></tr></table></figure></li><li>将对班级表查看权限授予所有用户。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> Class</span><br><span class="line"><span class="keyword">TO</span> <span class="keyword">ALL</span>;</span><br></pre></td></tr></table></figure></li><li>将对学生表的查询、更新权限授予角色R1。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">ON</span> Student</span><br><span class="line"><span class="keyword">TO</span> R1;</span><br></pre></td></tr></table></figure></li><li>将角色R1授予用户U1，并且U1可继续授权给其他角色。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> R1</span><br><span class="line"><span class="keyword">TO</span> U1</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br></pre></td></tr></table></figure></li></ol><h2 id="习题五："><a href="#习题五：" class="headerlink" title="习题五："></a>习题五：</h2><p>设教学数据库education有三个关系：<strong>学生关系S（SNO，SNAME，SAGE，SSEX，SDEPT）</strong>； 其中，SDEPT学生为所在系 <strong>学习关系SC（SNO，CNO，GRADE）</strong>；其中GRADE为成绩 <strong>课程关系C（CNO，CNAME，CDEPT，TNAME）</strong>，其中TNAME为授课教师姓名 用SQL语句表达下列操作：</p><ol><li>查所有年龄在20岁以下的学生姓名及年龄。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNAME, AGE</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> AGE <span class="operator">&lt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure></li><li>查考试成绩有不及格（&lt;60）的学生的学号。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">WHERE</span> GRADE <span class="operator">&lt;</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure></li><li>查所年龄在20至23岁之间的学生姓名、系别及年龄。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNAME,SDEPT,AGE</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> AGE <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">23</span>;</span><br></pre></td></tr></table></figure></li><li>查所有姓“刘”的学生的姓名、学号和性别。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNAME,SNO,SEX</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> SNAME <span class="keyword">LIKE</span> <span class="string">&#x27;刘%&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查所有不姓“张”的学生的姓名。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNAME</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> SNAME <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查课程名为db_design的课程号。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CNO</span><br><span class="line"><span class="keyword">FROM</span> C</span><br><span class="line"><span class="keyword">WHERE</span> CNAME <span class="operator">=</span> <span class="string">&#x27;DB_Design&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查缺考（GRADE为NULL）的学生的学号和课程号。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,CNO</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">WHERE</span> GRADE <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure></li><li>查年龄为空值的学生的学号和姓名。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,SNAME</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> AGE <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure></li><li>查计算机系（CS）20岁以下的学生的学号和姓名。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,SNAME</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> SDEPT <span class="operator">=</span> <span class="string">&#x27;CS&#x27;</span> <span class="keyword">AND</span> AGE <span class="operator">&lt;</span> <span class="number">20</span></span><br></pre></td></tr></table></figure></li><li>查询选修了c3课程的学生的学号和成绩，其结果按分数的降序排列。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,GRADE</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">WHERE</span> CNO <span class="operator">=</span> <span class="string">&#x27;c3&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GRADE <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure></li><li>查询学生总人数。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> S</span><br></pre></td></tr></table></figure></li><li>计算选修了c1课程的学生平均成绩。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(GRADE)</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">WHERE</span> CNO <span class="operator">=</span> <span class="string">&#x27;c1&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查询学习c3课程的学生最高分数。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(GRADE)</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">WHERE</span> CNO <span class="operator">=</span> <span class="string">&#x27;c3&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查询各个课程号与相应的选课人数。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CNO,<span class="built_in">COUNT</span>(SNO)</span><br><span class="line"><span class="keyword">FROM</span> SC</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> CNO</span><br></pre></td></tr></table></figure></li><li><p>求基本表S中男同学的每一年龄组（超过50人）有多少人？要求查询结果按人数升序排列，人数相同按年龄降序排列</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> AGE,<span class="built_in">COUNT</span>(SNO)</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> AGE</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">50</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">ASC</span>, AGE <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><blockquote><p>不能用where having指定组条件 往往与 GROUP BY 配合使用，为聚合操作指定条件</p></blockquote></li><li><p>查询每个学生及其选修课程的情况。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> S.SNO,SNAME,SC.CNO,C.CNAME,SC.GRADE</span><br><span class="line"><span class="keyword">FROM</span> S,SC,C</span><br><span class="line"><span class="keyword">WHERE</span> S.SNO <span class="operator">=</span> SC.SNO <span class="keyword">AND</span> SC.CNO <span class="operator">=</span> C.CNO</span><br></pre></td></tr></table></figure></li><li>查询选修了c2课程且成绩在90分以上的所有学生。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> S.SNO,S.SNAME</span><br><span class="line"><span class="keyword">FROM</span> S,SC</span><br><span class="line"><span class="keyword">WHERE</span> SC.CNO <span class="operator">=</span> <span class="string">&#x27;c2&#x27;</span> <span class="keyword">AND</span> SC.GRADE <span class="operator">&gt;</span> <span class="number">90</span> <span class="keyword">AND</span> S.SNO <span class="operator">=</span> SC.SNO </span><br></pre></td></tr></table></figure></li><li>查询每个学生选修的课程名及其成绩。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> S.SNO,S.SNAME,C.CNAME,SC.GRADE</span><br><span class="line"><span class="keyword">FROM</span> S,SC,C</span><br><span class="line"><span class="keyword">WHERE</span> SC.SNO <span class="operator">=</span> S.SNO <span class="keyword">AND</span> SC.CNO <span class="operator">=</span> C.CNO</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> S.SNO, C.CNAME</span><br></pre></td></tr></table></figure></li><li>查询与“张三”在同一个系学习的学生学号、姓名和系别。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,SNAME,SDEPT</span><br><span class="line"><span class="keyword">FROM</span> S</span><br><span class="line"><span class="keyword">WHERE</span> SDEPT <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> SDEPT</span><br><span class="line">    <span class="keyword">FROM</span> S</span><br><span class="line">    <span class="keyword">WHERE</span> SNAME <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li>查询选修课程名为“数据库”（CNAME=’DB’）的学生学号和姓名。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SNO,SNAME</span><br><span class="line"><span class="keyword">FROM</span> S,SC,C</span><br><span class="line"><span class="keyword">WHERE</span> CNAME <span class="operator">=</span> <span class="string">&#x27;DB&#x27;</span> <span class="keyword">AND</span> S.SNO <span class="operator">=</span> SC.SNO <span class="keyword">AND</span> C.CNO <span class="operator">=</span> SC.CNO</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Floyd求多源最短路径</title>
      <link href="/2022/11/30/%E5%A4%A7%E4%B8%80Floyd/"/>
      <url>/2022/11/30/%E5%A4%A7%E4%B8%80Floyd/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这篇文章记录一下大一写的Floyd算法求多源最短路径</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 32767 <span class="comment">//表示无穷</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 99</span></span><br><span class="line"><span class="comment">//邻接矩阵类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AMgraph</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//创建无向网 undirected net</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Create_UDnet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入总顶点数和总边数：&quot;</span> &lt;&lt; endl;</span><br><span class="line">cin &gt;&gt; VertexNum &gt;&gt; EdgeNum;</span><br><span class="line"><span class="comment">//输入错误</span></span><br><span class="line"><span class="keyword">if</span> (VertexNum &lt; <span class="number">1</span> || EdgeNum &lt; <span class="number">1</span> || (EdgeNum &gt; VertexNum * (VertexNum - <span class="number">1</span>)))</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;input error！&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//依次输入点的信息</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入点的信息：&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">cin &gt;&gt; Vertex[i];</span><br><span class="line"><span class="comment">//初始化邻接矩阵</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; EdgeNum; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i == j)</span><br><span class="line">Matrix[i][j] == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">Matrix[i][j] = INF;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输入边的信息</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入每条边连接的两个顶点及边的权值：&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="type">char</span> v1, v2;<span class="comment">//边连接的两个顶点</span></span><br><span class="line"><span class="type">int</span> x, y;<span class="comment">//在邻接矩阵中的坐标</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; EdgeNum; i++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; v1 &gt;&gt; v2 &gt;&gt; weight;</span><br><span class="line">x = <span class="built_in">GetPos</span>(v1);</span><br><span class="line">y = <span class="built_in">GetPos</span>(v2);</span><br><span class="line">Matrix[x][y] = weight;</span><br><span class="line">Matrix[y][x] = weight;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建有向网 directed net</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Create_Dnet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入总顶点数和总边数：&quot;</span> &lt;&lt; endl;</span><br><span class="line">cin &gt;&gt; VertexNum &gt;&gt; EdgeNum;</span><br><span class="line"><span class="comment">//输入错误</span></span><br><span class="line"><span class="keyword">if</span> (VertexNum &lt; <span class="number">1</span> || EdgeNum &lt; <span class="number">1</span> || (EdgeNum &gt; VertexNum * (VertexNum - <span class="number">1</span>)))</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;input error！&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//依次输入点的信息</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入点的信息：&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">cin &gt;&gt; Vertex[i];</span><br><span class="line"><span class="comment">//初始化邻接矩阵</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; VertexNum; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i == j)</span><br><span class="line">Matrix[i][j] == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">Matrix[i][j] = INF;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输入边的信息</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请依次输入每条边连接的起点和终点及边的权值：&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="type">char</span> v1, v2;<span class="comment">//边连接的两个顶点</span></span><br><span class="line"><span class="type">int</span> x, y;<span class="comment">//在邻接矩阵中的坐标</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; EdgeNum; i++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; v1 &gt;&gt; v2 &gt;&gt; weight;</span><br><span class="line">x = <span class="built_in">GetPos</span>(v1);</span><br><span class="line">y = <span class="built_in">GetPos</span>(v2);</span><br><span class="line">Matrix[x][y] = weight;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印邻接矩阵</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;邻接矩阵：&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; VertexNum; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//无穷</span></span><br><span class="line"><span class="keyword">if</span> (Matrix[i][j] == INF)</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;∞ &quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">cout &lt;&lt; Matrix[i][j] &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Floyd算法的实现</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Floyd_Path</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//初始化</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; VertexNum; j++)</span><br><span class="line">&#123;</span><br><span class="line">Path[i][j] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//算法实现</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; VertexNum; k++)<span class="comment">//过度顶点</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)<span class="comment">//起点</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; VertexNum; j++)<span class="comment">//终点</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i != j &amp;&amp; i != k &amp;&amp; j != k) </span><br><span class="line"><span class="keyword">if</span> (Matrix[i][j] &gt; Matrix[i][k] + Matrix[k][j])</span><br><span class="line">&#123;</span><br><span class="line">Matrix[i][j] = Matrix[i][k] + Matrix[k][j];</span><br><span class="line">Path[i][j] = Vertex[k];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印最短路径</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowPath</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; VertexNum; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (Matrix[i][j] == INF)</span><br><span class="line">cout &lt;&lt; Vertex[i] &lt;&lt; <span class="string">&quot;---&gt;&quot;</span> &lt;&lt; Vertex[j] &lt;&lt; <span class="string">&quot; : Weight: ∞&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (i != j)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; Vertex[i] &lt;&lt; <span class="string">&quot;---&gt;&quot;</span> &lt;&lt; Vertex[j];</span><br><span class="line">cout &lt;&lt; <span class="string">&quot; : Weight:&quot;</span> &lt;&lt; <span class="built_in">setw</span>(<span class="number">3</span>) &lt;&lt; Matrix[i][j];</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;  Path: &quot;</span> &lt;&lt; Vertex[i] &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line"><span class="built_in">GetPath</span>(Vertex[i], Vertex[j]);</span><br><span class="line">cout &lt;&lt; Vertex[j];</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">char</span> Vertex[MAX]; <span class="comment">//顶点集合</span></span><br><span class="line"><span class="type">int</span> Matrix[MAX][MAX];<span class="comment">//邻接矩阵</span></span><br><span class="line"><span class="type">int</span> VertexNum; <span class="comment">//顶点数</span></span><br><span class="line"><span class="type">int</span> EdgeNum; <span class="comment">//边数</span></span><br><span class="line"><span class="type">int</span> weight; <span class="comment">//权值</span></span><br><span class="line"><span class="type">char</span> Path[MAX][MAX];  <span class="comment">//记录中间点</span></span><br><span class="line"><span class="comment">//查找顶点的坐标</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetPos</span><span class="params">(<span class="type">char</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; VertexNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (v == Vertex[i])</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//递归得到中间路径</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetPath</span><span class="params">(<span class="type">char</span> x, <span class="type">char</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="built_in">GetPos</span>(x);</span><br><span class="line"><span class="type">int</span> b = <span class="built_in">GetPos</span>(y);</span><br><span class="line"><span class="keyword">if</span> (Path[a][b] != <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> temp = <span class="built_in">GetPos</span>(Path[a][b]);</span><br><span class="line"><span class="comment">//判断从起点到中间点之间是否还有过渡点</span></span><br><span class="line"><span class="keyword">if</span> (Path[a][temp] == <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">cout &lt;&lt; Path[a][b] &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//起点到中间点之间还有过渡点</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">GetPath</span>(x, Path[a][b]);</span><br><span class="line"><span class="comment">//中间点到终点</span></span><br><span class="line"><span class="built_in">GetPath</span>(Path[a][b], y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AMgraph g;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;cls&quot;</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\n     1.无向图  2.有向图  3.退 出&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;--------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;&gt;请选择类型或退出：&quot;</span>;</span><br><span class="line"><span class="type">int</span> select;</span><br><span class="line">cin &gt;&gt; select;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"><span class="keyword">switch</span> (select)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">g.<span class="built_in">Create_UDnet</span>();</span><br><span class="line">g.<span class="built_in">display</span>();</span><br><span class="line">g.<span class="built_in">Floyd_Path</span>();</span><br><span class="line">g.<span class="built_in">ShowPath</span>();</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">g.<span class="built_in">Create_Dnet</span>();</span><br><span class="line">g.<span class="built_in">display</span>();</span><br><span class="line">g.<span class="built_in">Floyd_Path</span>();</span><br><span class="line">g.<span class="built_in">ShowPath</span>();</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;输入错误，请重新选择！&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">Function</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Floyd </tag>
            
            <tag> 邻接矩阵 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>堆排序</title>
      <link href="/2022/11/28/%E5%A0%86%E6%8E%92%E5%BA%8F/"/>
      <url>/2022/11/28/%E5%A0%86%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h1><hr><h2 id="1-知识准备"><a href="#1-知识准备" class="headerlink" title="1 知识准备"></a>1 知识准备</h2><p>堆的结构可以分为大根堆和小根堆，是一个完全二叉树，而堆排序是根据堆的这种数据结构设计的一种排序，下面先来看看什么是大根堆和小根堆。</p><h3 id="1-1-大根堆和小根堆"><a href="#1-1-大根堆和小根堆" class="headerlink" title="1.1 大根堆和小根堆"></a>1.1 大根堆和小根堆</h3><p><strong>[大根堆]：</strong> 每个结点的值都大于其左孩子和右孩子结点的值<br><strong>[小根堆]：</strong> 每个结点的值都小于其左孩子和右孩子结点的值<br><a href="https://imgse.com/i/zaTLZ9"><img src="https://s1.ax1x.com/2022/11/28/zaTLZ9.md.png" alt="zaTLZ9.md.png"></a><br><strong>[数组储存]：</strong> 可用数组储存此类完全二叉树 </p><p><strong>父节点索引：</strong> (i-1)/2<br><strong>左孩子索引：</strong> 2<em>i + 1<br><strong>右孩子索引：</strong> 2</em>i + 2</p><blockquote><p>大根堆 需要满足 arr(i)&gt;arr(2<em>i+1) &amp;&amp; arr(i)&gt;arr(2</em>i+2)<br>小根堆 需要满足 arr(i)&lt;arr(2<em>i+1) &amp;&amp; arr(i)&lt;arr(2</em>i+2)</p></blockquote><h2 id="2-堆排序步骤"><a href="#2-堆排序步骤" class="headerlink" title="2 堆排序步骤"></a>2 堆排序步骤</h2><p>（1）首先将待排序的数组构造成一个大根堆，此时，整个数组的最大值就是堆结构的顶端</p><p>（2）将顶端的数与末尾的数交换，此时，末尾的数为最大值，剩余待排序数组个数为n-1</p><p>（3）将剩余的n-1个数再构造成大根堆，再将顶端数与n-1位置的数交换……如此反复执行，便能得到有序数组</p><h3 id="2-2-构造初始的大根堆"><a href="#2-2-构造初始的大根堆" class="headerlink" title="2.2 构造初始的大根堆"></a>2.2 构造初始的大根堆</h3><p>（1）从<strong>最后一棵子树</strong>开始（即最后一个元素的父节点 index = size/2 - 1），从后往前调整<br>（2）每次调整，从上往下调整 <strong>(递归思想)</strong>，使所有父节点始终大于子节点<br>（3）构建成大根堆</p><h3 id="2-3-顶端与末尾的数交换后如何调整堆"><a href="#2-3-顶端与末尾的数交换后如何调整堆" class="headerlink" title="2.3 顶端与末尾的数交换后如何调整堆"></a>2.3 顶端与末尾的数交换后如何调整堆</h3><p>由于执行该步操作后顶端的子树并未发生变化（此时堆或者说数组的长度-1），且<strong>子树依旧是大根堆</strong>，所以之后的调整堆并不需要像第一次构造堆一样从后往前调整每一棵子树，<strong>我们只需要对交换后的顶端重新调整，即HeapAdjust(a, 0, size)。</strong></p><h3 id="2-4-代码实现"><a href="#2-4-代码实现" class="headerlink" title="2.4 代码实现"></a>2.4 代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HeapAdjust</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> i, <span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> p = i;<span class="comment">//下标</span></span><br><span class="line">    <span class="type">int</span> left = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> right = <span class="number">2</span> * i + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (left &lt; size &amp;&amp; a[left] &gt; a[p])</span><br><span class="line">        p = left;</span><br><span class="line">    <span class="keyword">if</span> (right &lt; size &amp;&amp; a[right] &gt; a[p])</span><br><span class="line">        p = right;</span><br><span class="line">    <span class="keyword">if</span> (p != i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(a[p], a[i]);</span><br><span class="line">        <span class="built_in">HeapAdjust</span>(a, p, size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HeapSort</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//建立初始大根堆</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = size/<span class="number">2</span> <span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="built_in">HeapAdjust</span>(a, i, size);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = size - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(a[<span class="number">0</span>], a[i]);</span><br><span class="line">        <span class="built_in">HeapAdjust</span>(a, <span class="number">0</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">8</span>] = &#123;<span class="number">53</span>, <span class="number">17</span>, <span class="number">78</span>, <span class="number">9</span>, <span class="number">45</span>, <span class="number">65</span>, <span class="number">87</span>, <span class="number">23</span>&#125;;</span><br><span class="line">    <span class="built_in">HeapSort</span>(a, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="&quot;https://www.bilibili.com/video/BV1fp4y1D7cj/?spm_id_from=333.337.search-card.all.click&amp;vd_source=4c4e06d9794ecf36566117b17c0bf46a&quot;">B站相关视频演示</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【传智】莲子的机械动力学</title>
      <link href="/2022/11/28/%5B%E4%BC%A0%E6%99%BA%5DB%E8%8E%B2%E5%AD%90%E7%9A%84%E6%9C%BA%E6%A2%B0%E5%8A%A8%E5%8A%9B%E5%AD%A6/"/>
      <url>/2022/11/28/%5B%E4%BC%A0%E6%99%BA%5DB%E8%8E%B2%E5%AD%90%E7%9A%84%E6%9C%BA%E6%A2%B0%E5%8A%A8%E5%8A%9B%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>新定义竖式运算</p></blockquote><h1 id="莲子的机械动力学"><a href="#莲子的机械动力学" class="headerlink" title="莲子的机械动力学"></a>莲子的机械动力学</h1><h2 id="题目背景"><a href="#题目背景" class="headerlink" title="题目背景"></a>题目背景</h2><p><strong>【题目背景和题目描述的两个题面是完全等价的，您可以选择阅读其中一部分。】</strong></p><p>专攻超统一物理学的莲子，对机械结构的运动颇有了解。如下图所示，是一个三进制加法计算器的（超简化）示意图。</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/l6gm0j36.png" alt=""></p><p>一个四位的三进制整数，从低到高位，标为 $x<em>1,x_2,x_3,x_4$。换言之，这个数可以写成 $\overline{x_4x_3x_2x_1}</em>{(3)}$。把它放在这四个齿轮里，对应箭头指向的数字就是现在这位的数值。</p><p>在这种机械式计算机里，我们通过齿轮的啮合来实现数位间的连接。通过不同齿轮半径的比例来确定进制。图中所有浅灰色的小齿轮的半径，比上使用皮带相接的较大齿轮的半径，都是 $1:3$。那么小齿轮每转动一圈，大齿轮就转动 $\dfrac{1}{3}$ 圈，也就是刚好一个数码的角度。</p><p>于是，我们通过控制齿轮的半径实现了 $3$ 进制的进位。</p><p>如果需要实现三进制加法，则只需要在对应数位拨动对应的数码长度即可。</p><p>如下是个例子，实现 $\overline{1021}<em>{(3)}+\overline{0021}</em>{(3)}=\overline{1112}_{(3)}$</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/4kcgnp7j.png" alt=""></p><p>初始时齿轮的状态如上。</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/dcd66l5v.png" alt=""></p><p>把第一个齿轮拨动一个单位长度，变为如上图所示。</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/oiexg3yw.png" alt=""></p><p>把第二个齿轮拨动两个单位长度，变为如上图所示。读数，得到结果 $\overline{1112}_{(3)}$。</p><hr><p>现在莲子设计了如下图所示的机械结构。对于从左往右数的第 $i$ 枚齿轮，它上面的浅色小齿轮与第 $i+1$ 枚齿轮上的深色小齿轮的半径之比为 $1:(i+2)$。也就是说，第 $i$ 枚齿轮每转动 $1$ 圈，第 $i+1$ 枚齿轮转过的角度恰好为它上面的一个数码。</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/zi1d0qnn.png" alt=""></p><p>莲子想要知道，在这样的特别的进制表示下，给定 $a,b$，那么计算出的 $a+b$ 的结果是多少。</p><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>题目背景的问题可以转化为如下描述：</p><p>给定两个长度分别为 $n,m$ 的整数 $a,b$，计算它们的和。</p><p>但是要注意的是，这里的 $a,b$ 采用了某种特殊的进制表示法。最终的结果也会采用该种表示法。具体而言，从低位往高位数起，第 $i$ 位采用的是 $i+1$ 进制。换言之，相较于十进制下每一位的「逢 $10$ 进 $1$」，该种进制下第 $i$ 位是「逢 $i+1$ 进 $1$」。</p><p>下图所示，左边是十进制的竖式加法；右边是这种特殊进制的竖式加法。图中的红色加号表示上一位发生了进位。</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/px92d6yd.png" alt=""></p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><ul><li>第一行有两个整数 $n,m$，分别表示 $a$ 和 $b$ 的位数。</li><li>第二行有 $n$ 个整数，中间用空格隔开，<strong>从高到低位</strong>描述 $a$ 的每个数码。</li><li>第三行有 $m$ 个整数，中间用空格隔开，<strong>从高到低位</strong>描述 $b$ 的每个数码。</li></ul><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><ul><li>输出有若干个整数，从高到低位输出 $a+b$ 在这种特殊表示法下的结果。</li></ul><h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例 #1"></a>样例 #1</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入 #1"></a>样例输入 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5 4</span><br><span class="line">3 3 2 1 1</span><br><span class="line">3 2 2 1</span><br></pre></td></tr></table></figure><h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出 #1"></a>样例输出 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 2 1 1 0</span><br></pre></td></tr></table></figure><h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例 #2"></a>样例 #2</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入 #2"></a>样例输入 #2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10 1</span><br><span class="line">10 9 8 7 6 5 4 3 2 1</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出 #2"></a>样例输出 #2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 9 8 7 6 5 4 3 2 1</span><br></pre></td></tr></table></figure><h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>对于全部数据，保证 $1\le n,m\le 2\times 10^5$，从低位往高位数起有 $a_i\in[0,i]$，$b_i\in[0,i]$。请使用 Java 或 Python 语言作答的选手注意输入输出时的效率。</p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>类似于高精度运算的模板<br><strong>坑点：</strong><br>主要是细节 进位后总长度为 max(n, m) + 1 例如：0 + 0 = 0<br>这个0也是有长度的 但要小心输出0 0 <em>if(进位 &gt; 0)</em>再pushback</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">400010</span>;</span><br><span class="line"><span class="type">int</span> x[N], y[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line"><span class="type">int</span> m;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a; i++)</span><br><span class="line">        cin &gt;&gt; x[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; b; i++)</span><br><span class="line">        cin &gt;&gt; y[i];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = a - <span class="number">1</span>, j = b - <span class="number">1</span>; i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span>; i--, j--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a &lt; b)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> s = t;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">0</span>)</span><br><span class="line">                s += x[i];</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= <span class="number">0</span>)</span><br><span class="line">                s += y[j];</span><br><span class="line">            <span class="type">int</span> r = a - i + <span class="number">1</span>;</span><br><span class="line">            c.<span class="built_in">push_back</span>(s % r);</span><br><span class="line">            t = s / r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> s = t;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">0</span>)</span><br><span class="line">                s += x[i];</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= <span class="number">0</span>)</span><br><span class="line">                s += y[j];</span><br><span class="line">            <span class="type">int</span> r = b - j + <span class="number">1</span>;</span><br><span class="line">            c.<span class="built_in">push_back</span>(s % r);</span><br><span class="line">            t = s / r;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t)</span><br><span class="line">        c.<span class="built_in">push_back</span>(t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = c.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        cout &lt;&lt; c[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法练习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
